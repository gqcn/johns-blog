"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["1967"],{19214:function(e,n,i){i.r(n),i.d(n,{metadata:()=>c,contentTitle:()=>l,default:()=>a,assets:()=>o,toc:()=>t,frontMatter:()=>r});var c=JSON.parse('{"id":"docs/AI\u6280\u672F/NVIDIA/GPU\u73AF\u5883\u642D\u5EFA\u6307\u5357\uFF1A\u5728\u88F8\u673A\u3001Docker\u3001K8S\u73AF\u5883\u4E2D\u4F7F\u7528GPU","title":"GPU\u73AF\u5883\u642D\u5EFA\u6307\u5357\uFF1A\u5728\u88F8\u673A\u3001Docker\u3001K8S\u73AF\u5883\u4E2D\u4F7F\u7528GPU","description":"\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u5728\u88F8\u673A\u3001Docker\u548CKubernetes\u73AF\u5883\u4E2D\u914D\u7F6E\u548C\u4F7F\u7528NVIDIA GPU\uFF0C\u5305\u62ECGPU\u9A71\u52A8\u5B89\u88C5\u3001CUDA Toolkit\u914D\u7F6E\u3001nvidia-container-toolkit\u90E8\u7F72\u3001K8S device-plugin\u5B89\u88C5\u4EE5\u53CAGPU\u76D1\u63A7\u914D\u7F6E\u7684\u5B8C\u6574\u6307\u5357","source":"@site/docs/docs/1000-AI\u6280\u672F/0-NVIDIA/9000-GPU\u73AF\u5883\u642D\u5EFA\u6307\u5357\uFF1A\u5728\u88F8\u673A\u3001Docker\u3001K8S\u73AF\u5883\u4E2D\u4F7F\u7528GPU.md","sourceDirName":"docs/1000-AI\u6280\u672F/0-NVIDIA","slug":"/ai/gpu-environment-setup-guide","permalink":"/ai/gpu-environment-setup-guide","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9000,"frontMatter":{"slug":"/ai/gpu-environment-setup-guide","title":"GPU\u73AF\u5883\u642D\u5EFA\u6307\u5357\uFF1A\u5728\u88F8\u673A\u3001Docker\u3001K8S\u73AF\u5883\u4E2D\u4F7F\u7528GPU","hide_title":true,"keywords":["GPU\u73AF\u5883\u642D\u5EFA","NVIDIA GPU","GPU Driver","CUDA Toolkit","nvidia-container-toolkit","K8S GPU","device-plugin","Docker GPU","nvidia-smi","GPU\u76D1\u63A7","DCGM exporter","Tesla T4"],"description":"\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u5728\u88F8\u673A\u3001Docker\u548CKubernetes\u73AF\u5883\u4E2D\u914D\u7F6E\u548C\u4F7F\u7528NVIDIA GPU\uFF0C\u5305\u62ECGPU\u9A71\u52A8\u5B89\u88C5\u3001CUDA Toolkit\u914D\u7F6E\u3001nvidia-container-toolkit\u90E8\u7F72\u3001K8S device-plugin\u5B89\u88C5\u4EE5\u53CAGPU\u76D1\u63A7\u914D\u7F6E\u7684\u5B8C\u6574\u6307\u5357"},"sidebar":"mainSidebar","previous":{"title":"GPU MIG\u62C6\u5361\u540EPod\u5076\u53D1Pending/Terminating\u72B6\u6001\u963B\u585E\u95EE\u9898\u6392\u67E5","permalink":"/ai/gpu-mig-pod-pending-terminating-troubleshooting"},"next":{"title":"\u5206\u5E03\u5F0F\u63A8\u7406","permalink":"/ai/distributed-inference"}}'),d=i("85893"),s=i("50065");let r={slug:"/ai/gpu-environment-setup-guide",title:"GPU\u73AF\u5883\u642D\u5EFA\u6307\u5357\uFF1A\u5728\u88F8\u673A\u3001Docker\u3001K8S\u73AF\u5883\u4E2D\u4F7F\u7528GPU",hide_title:!0,keywords:["GPU\u73AF\u5883\u642D\u5EFA","NVIDIA GPU","GPU Driver","CUDA Toolkit","nvidia-container-toolkit","K8S GPU","device-plugin","Docker GPU","nvidia-smi","GPU\u76D1\u63A7","DCGM exporter","Tesla T4"],description:"\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u5728\u88F8\u673A\u3001Docker\u548CKubernetes\u73AF\u5883\u4E2D\u914D\u7F6E\u548C\u4F7F\u7528NVIDIA GPU\uFF0C\u5305\u62ECGPU\u9A71\u52A8\u5B89\u88C5\u3001CUDA Toolkit\u914D\u7F6E\u3001nvidia-container-toolkit\u90E8\u7F72\u3001K8S device-plugin\u5B89\u88C5\u4EE5\u53CAGPU\u76D1\u63A7\u914D\u7F6E\u7684\u5B8C\u6574\u6307\u5357"},l=void 0,o={},t=[{value:"1. \u6982\u8FF0",id:"1-\u6982\u8FF0",level:2},{value:"2. \u88F8\u673A\u73AF\u5883",id:"2-\u88F8\u673A\u73AF\u5883",level:2},{value:"\u5B89\u88C5\u9A71\u52A8",id:"\u5B89\u88C5\u9A71\u52A8",level:3},{value:"\u5B89\u88C5 CUDA Toolkit",id:"\u5B89\u88C5-cuda-toolkit",level:3},{value:"\u6D4B\u8BD5",id:"\u6D4B\u8BD5",level:3},{value:"3. Docker \u73AF\u5883",id:"3-docker-\u73AF\u5883",level:2},{value:"\u5B89\u88C5 nvidia-container-toolkit",id:"\u5B89\u88C5-nvidia-container-toolkit",level:3},{value:"\u914D\u7F6E\u4F7F\u7528\u8BE5 runtime",id:"\u914D\u7F6E\u4F7F\u7528\u8BE5-runtime",level:3},{value:"\u6D4B\u8BD5",id:"\u6D4B\u8BD5-1",level:3},{value:"4. K8S \u73AF\u5883",id:"4-k8s-\u73AF\u5883",level:2},{value:"\u5B89\u88C5 device-plugin",id:"\u5B89\u88C5-device-plugin",level:3},{value:"\u5B89\u88C5 GPU \u76D1\u63A7",id:"\u5B89\u88C5-gpu-\u76D1\u63A7",level:3},{value:"\u6D4B\u8BD5",id:"\u6D4B\u8BD5-2",level:3},{value:"5. \u5C0F\u7ED3",id:"5-\u5C0F\u7ED3",level:2}];function h(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u672C\u6765\u6253\u7B97\u7F16\u5199\u4E00\u7BC7\u4ECE",(0,d.jsx)(n.code,{children:"0"}),"\u5230",(0,d.jsx)(n.code,{children:"1"}),"\u642D\u5EFA",(0,d.jsx)(n.code,{children:"GPU"}),"\u73AF\u5883\u7684\u6559\u7A0B\uFF0C\u4F46\u662F\u53D1\u73B0\u7F51\u4E0A\u5DF2\u7ECF\u6709\u5F88\u591A\u4F18\u79C0\u7684\u6559\u7A0B\u4E86\uFF0C\u672C\u6587\u53C2\u8003\u7684\u539F\u6587\u94FE\u63A5\uFF1A",(0,d.jsx)(n.a,{href:"https://www.lixueduan.com/posts/ai/01-how-to-use-gpu/",children:"https://www.lixueduan.com/posts/ai/01-how-to-use-gpu/"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"1-\u6982\u8FF0",children:"1. \u6982\u8FF0"}),"\n",(0,d.jsxs)(n.p,{children:["\u4EC5\u4EE5\u6BD4\u8F83\u5E38\u89C1\u7684",(0,d.jsx)(n.code,{children:"NVIDIA GPU"}),"\u4E3E\u4F8B\uFF0C\u7CFB\u7EDF\u4E3A",(0,d.jsx)(n.code,{children:"Ubuntu"}),"\uFF0C\u5BF9\u4E8E\u5176\u4ED6\u5382\u5BB6\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\u7406\u8BBA\u4E0A\u6D41\u7A0B\u90FD\u662F\u4E00\u6837\u7684\u3002"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.p,{children:"\u7701\u6D41\uFF1A"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u4E8E\u88F8\u673A\u73AF\u5883\uFF0C\u53EA\u9700\u8981\u5B89\u88C5\u5BF9\u5E94\u7684",(0,d.jsx)(n.code,{children:"GPU Driver"}),"\u4EE5\u53CA",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u5E94",(0,d.jsx)(n.code,{children:"Docker"}),"\u73AF\u5883\uFF0C\u9700\u8981\u989D\u5916\u5B89\u88C5",(0,d.jsx)(n.code,{children:"nvidia-container-toolkit"}),"\u5E76\u914D\u7F6E",(0,d.jsx)(n.code,{children:"docker"}),"\u4F7F\u7528",(0,d.jsx)(n.code,{children:"nvidia runtime"}),"\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u5E94",(0,d.jsx)(n.code,{children:"K8S"}),"\u73AF\u5883\uFF0C\u9700\u8981\u989D\u5916\u5B89\u88C5\u5BF9\u5E94\u7684",(0,d.jsx)(n.code,{children:"device-plugin"}),"\u4F7F\u5F97",(0,d.jsx)(n.code,{children:"kubelet"}),"\u80FD\u591F\u611F\u77E5\u5230\u8282\u70B9\u4E0A\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\uFF0C\u4EE5\u4FBF",(0,d.jsx)(n.code,{children:"K8S"}),"\u80FD\u591F\u8FDB\u884C",(0,d.jsx)(n.code,{children:"GPU"}),"\u7BA1\u7406\u3002"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u4E00\u822C\u5728",(0,d.jsx)(n.code,{children:"K8S"}),"\u4E2D\u4F7F\u7528\u90FD\u4F1A\u76F4\u63A5\u4F7F\u7528",(0,d.jsx)(n.code,{children:"gpu-operator"}),"\u65B9\u5F0F\u8FDB\u884C\u5B89\u88C5\uFF0C\u672C\u6587\u4E3B\u8981\u4E3A\u4E86\u641E\u6E05\u5404\u4E2A\u7EC4\u4EF6\u7684\u4F5C\u7528\uFF0C\u56E0\u6B64\u8FDB\u884C\u624B\u52A8\u5B89\u88C5\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"2-\u88F8\u673A\u73AF\u5883",children:"2. \u88F8\u673A\u73AF\u5883"}),"\n",(0,d.jsxs)(n.p,{children:["\u88F8\u673A\u4E2D\u8981\u4F7F\u7528\u4E0A",(0,d.jsx)(n.code,{children:"GPU"}),"\u9700\u8981\u5B89\u88C5\u4EE5\u4E0B\u7EC4\u4EF6\uFF1A"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"GPU Driver"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"CUDA Toolkit"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4E8C\u8005\u7684\u5173\u7CFB\u5982",(0,d.jsx)(n.code,{children:"NVIDIA"}),"\u5B98\u7F51\u4E0A\u7684\u8FD9\u4E2A\u56FE\u6240\u793A\uFF1A"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(29666).Z+"",width:"500",height:"390"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"GPU Driver"}),"\u5305\u62EC\u4E86",(0,d.jsx)(n.code,{children:"GPU"}),"\u9A71\u52A8\u548C",(0,d.jsx)(n.code,{children:"CUDA"}),"\u9A71\u52A8\uFF0C",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u5219\u5305\u542B\u4E86",(0,d.jsx)(n.code,{children:"CUDA Runtime"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"GPU"}),"\u4F5C\u4E3A\u4E00\u4E2A",(0,d.jsx)(n.code,{children:"PCIE"}),"\u8BBE\u5907\uFF0C\u53EA\u8981\u5B89\u88C5\u597D\u4E4B\u540E\uFF0C\u5728\u7CFB\u7EDF\u4E2D\u5C31\u53EF\u4EE5\u901A\u8FC7",(0,d.jsx)(n.code,{children:"lspci"}),"\u547D\u4EE4\u67E5\u770B\u5230\uFF0C\u5148\u786E\u8BA4\u673A\u5668\u4E0A\u662F\u5426\u6709",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"root@test:~# lspci | grep NVIDIA\n3b:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1)\n86:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1)\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C\u8BE5\u8BBE\u5907\u6709\u4E24\u5F20",(0,d.jsx)(n.code,{children:"Tesla T4 GPU"}),"\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5B89\u88C5\u9A71\u52A8",children:"\u5B89\u88C5\u9A71\u52A8"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u5728",(0,d.jsx)(n.code,{children:"Ubuntu"}),"\u7CFB\u7EDF\u4E0B\uFF0C\u53EF\u4EE5\u4F7F\u7528",(0,d.jsx)(n.code,{children:"apt"}),"\u6E90\u6765\u5B89\u88C5\u9A71\u52A8\uFF08\u5177\u4F53\u53C2\u8003\uFF1A",(0,d.jsx)(n.a,{href:"https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes",children:"https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes"})," \uFF09\uFF0C\u4E5F\u53EF\u4EE5\u624B\u52A8\u4E0B\u8F7D",(0,d.jsx)(n.code,{children:"run"}),"\u6587\u4EF6\u6765\u5B89\u88C5\u3002\u672C\u6587\u4EE5\u624B\u52A8\u4E0B\u8F7D",(0,d.jsx)(n.code,{children:"run"}),"\u6587\u4EF6\u6765\u5B89\u88C5\u4E3A\u4F8B\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148\u5230 ",(0,d.jsx)(n.a,{href:"https://www.nvidia.cn/Download/index.aspx?lang=cn#",children:"NVIDIA \u9A71\u52A8\u4E0B\u8F7D"})," \u4E0B\u8F7D\u5BF9\u5E94\u7684\u663E\u5361\u9A71\u52A8\uFF1A"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(82070).Z+"",width:"1356",height:"1478"})}),"\n",(0,d.jsxs)(n.p,{children:["\u6700\u7EC8\u4E0B\u8F7D\u5F97\u5230\u7684\u662F\u4E00\u4E2A",(0,d.jsx)(n.code,{children:".run"}),"\u6587\u4EF6\uFF0C\u4F8B\u5982 ",(0,d.jsx)(n.code,{children:"NVIDIA-Linux-x86_64-550.54.14.run"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u7136\u540E\u76F4\u63A5",(0,d.jsx)(n.code,{children:"sh"}),"\u65B9\u5F0F\u8FD0\u884C\u8BE5\u6587\u4EF6\u5373\u53EF"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"sh NVIDIA-Linux-x86_64-550.54.14.run\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u63A5\u4E0B\u6765\u4F1A\u8FDB\u5165\u56FE\u5F62\u5316\u754C\u9762\uFF0C\u4E00\u8DEF\u9009\u62E9",(0,d.jsx)(n.code,{children:"yes/ok"}),"\u5C31\u597D\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u68C0\u67E5\u662F\u5426\u5B89\u88C5\u6210\u529F\uFF1A"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"nvidia-smi\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u679C\u51FA\u73B0\u663E\u5361\u4FE1\u606F\u5219\u662F\u5B89\u88C5\u6210\u529F\uFF0C\u5C31\u50CF\u8FD9\u6837\uFF1A"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"root@test:~ nvidia-smi\nWed Jul 10 05:41:52 2024\n+---------------------------------------------------------------------------------------+\n| NVIDIA-SMI 535.161.08             Driver Version: 535.161.08   CUDA Version: 12.2     |\n|-----------------------------------------+----------------------+----------------------+\n| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |\n|                                         |                      |               MIG M. |\n|=========================================+======================+======================|\n|   0  Tesla T4                       On  | 00000000:3B:00.0 Off |                    0 |\n| N/A   51C    P0              29W /  70W |  12233MiB / 15360MiB |      0%      Default |\n|                                         |                      |                  N/A |\n+-----------------------------------------+----------------------+----------------------+\n|   1  Tesla T4                       On  | 00000000:86:00.0 Off |                    0 |\n| N/A   49C    P0              30W /  70W |   6017MiB / 15360MiB |      0%      Default |\n|                                         |                      |                  N/A |\n+-----------------------------------------+----------------------+----------------------+\n+---------------------------------------------------------------------------------------+\n| Processes:                                                                            |\n|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |\n|        ID   ID                                                             Usage      |\n|=======================================================================================|\n|   \n+---------------------------------------------------------------------------------------+\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u81F3\u6B64\uFF0C\u6211\u4EEC\u5C31\u5B89\u88C5\u597D",(0,d.jsx)(n.code,{children:"GPU"}),"\u9A71\u52A8\u4E86\uFF0C\u7CFB\u7EDF\u4E5F\u80FD\u6B63\u5E38\u8BC6\u522B\u5230",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u8FD9\u91CC\u663E\u793A\u7684",(0,d.jsx)(n.code,{children:"CUDA"}),"\u7248\u672C\u8868\u793A\u5F53\u524D\u9A71\u52A8\u6700\u5927\u652F\u6301\u7684",(0,d.jsx)(n.code,{children:"CUDA"}),"\u7248\u672C\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5B89\u88C5-cuda-toolkit",children:"\u5B89\u88C5 CUDA Toolkit"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u5728",(0,d.jsx)(n.code,{children:"Ubuntu"}),"\u7CFB\u7EDF\u4E0B\uFF0C\u53EF\u4EE5\u4F7F\u7528",(0,d.jsx)(n.code,{children:"apt"}),"\u6E90\u6765\u5B89\u88C5",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\uFF08\u5177\u4F53\u53C2\u8003\uFF1A",(0,d.jsx)(n.a,{href:"https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes",children:"https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes"})," \uFF09\uFF0C\u4E5F\u53EF\u4EE5\u624B\u52A8\u4E0B\u8F7D",(0,d.jsx)(n.code,{children:"run"}),"\u6587\u4EF6\u6765\u5B89\u88C5\u3002\u672C\u6587\u4EE5\u624B\u52A8\u4E0B\u8F7D",(0,d.jsx)(n.code,{children:"run"}),"\u6587\u4EF6\u6765\u5B89\u88C5\u4E3A\u4F8B\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u4E8E\u6DF1\u5EA6\u5B66\u4E60\u7A0B\u5E8F\uFF0C\u4E00\u822C\u90FD\u8981\u4F9D\u8D56 ",(0,d.jsx)(n.code,{children:"CUDA"})," \u73AF\u5883\uFF0C\u56E0\u6B64\u9700\u8981\u5728\u673A\u5668\u4E0A\u5B89\u88C5 ",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4E5F\u662F\u5230 ",(0,d.jsx)(n.a,{href:"https://developer.nvidia.com/cuda-toolkit-archive",children:"NVIDIA CUDA Toolkit \u4E0B\u8F7D"})," \u4E0B\u8F7D\u5BF9\u5E94\u7684\u5B89\u88C5\u5305\uFF0C\u9009\u62E9\u64CD\u4F5C\u7CFB\u7EDF\u548C\u5B89\u88C5\u65B9\u5F0F\u5373\u53EF"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(27629).Z+"",width:"2310",height:"1472"})}),"\n",(0,d.jsxs)(n.p,{children:["\u548C\u5B89\u88C5\u9A71\u52A8\u7C7B\u4F3C\uFF0C\u4E5F\u662F\u4E00\u4E2A",(0,d.jsx)(n.code,{children:".run"}),"\u6587\u4EF6\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u4E0B\u8F7D\u5B89\u88C5\u6587\u4EF6\nwget https://developer.download.nvidia.com/compute/cuda/12.2.0/local_installers/cuda_12.2.0_535.54.03_linux.run\n\n# \u5F00\u59CB\u5B89\u88C5\nsudo sh cuda_12.2.0_535.54.03_linux.run\n"})}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u4E4B\u524D\u5B89\u88C5\u8FC7\u9A71\u52A8\u4E86\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u518D\u5B89\u88C5\u9A71\u52A8\uFF0C\u4EC5\u5B89\u88C5",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u76F8\u5173\u7EC4\u4EF6\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5B89\u88C5\u5B8C\u6210\u540E\u8F93\u51FA\u5982\u4E0B\uFF1A"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"root@iZbp15lv2der847tlwkkd3Z:~# sudo sh cuda_12.2.0_535.54.03_linux.run\n===========\n= Summary =\n===========\nDriver:   Installed\nToolkit:  Installed in /usr/local/cuda-12.2/\nPlease make sure that\n -   PATH includes /usr/local/cuda-12.2/bin -   LD_LIBRARY_PATH includes /usr/local/cuda-12.2/lib64, or, add /usr/local/cuda-12.2/lib64 to /etc/ld.so.conf and run ldconfig as root\nTo uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-12.2/bin\nTo uninstall the NVIDIA Driver, run nvidia-uninstall\nLogfile is /var/log/cuda-installer.log\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u6839\u636E\u63D0\u793A\u914D\u7F6E\u4E0B",(0,d.jsx)(n.code,{children:"PATH"}),"\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u6DFB\u52A0 CUDA 12.2 \u5230 PATH\nexport PATH=/usr/local/cuda-12.2/bin:$PATH\n# \u6DFB\u52A0 CUDA 12.2 \u7684 lib64 \u5230 LD_LIBRARY_PATH\nexport LD_LIBRARY_PATH=/usr/local/cuda-12.2/lib64:$LD_LIBRARY_PATH\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u67E5\u770B\u7248\u672C\uFF0C\u786E\u8BA4\u5B89\u88C5\u6210\u529F\uFF1A"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"root@iZbp15lv2der847tlwkkd3Z:~# nvcc -V\nnvcc: NVIDIA (R) Cuda compiler driver\nCopyright (c) 2005-2023 NVIDIA Corporation\nBuilt on Tue_Jun_13_19:16:58_PDT_2023\nCuda compilation tools, release 12.2, V12.2.91\nBuild cuda_12.2.r12.2/compiler.32965470_0\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u6D4B\u8BD5",children:"\u6D4B\u8BD5"}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u4EEC\u4F7F\u7528\u4E00\u4E2A\u7B80\u5355\u7684",(0,d.jsx)(n.code,{children:"Pytorch"}),"\u7A0B\u5E8F\u6765\u68C0\u6D4B",(0,d.jsx)(n.code,{children:"GPU"}),"\u548C",(0,d.jsx)(n.code,{children:"CUDA"}),"\u662F\u5426\u6B63\u5E38\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u6574\u4E2A\u8C03\u7528\u94FE\u5927\u6982\u662F\u8FD9\u6837\u7684\uFF1A"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(10859).Z+"",width:"1198",height:"983"})}),"\n",(0,d.jsxs)(n.p,{children:["\u4F7F\u7528\u4E0B\u9762\u4EE3\u7801\u6765\u6D4B\u8BD5\u80FD\u591F\u6B63\u5E38\u4F7F\u7528\uFF0C ",(0,d.jsx)(n.code,{children:"check_cuda_pytorch.py"}),"\u5185\u5BB9\u5982\u4E0B\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:'import torch\n\ndef check_cuda_with_pytorch():\n    """\u68C0\u67E5 PyTorch CUDA \u73AF\u5883\u662F\u5426\u6B63\u5E38\u5DE5\u4F5C"""\n    try:\n        print("\u68C0\u67E5 PyTorch CUDA \u73AF\u5883:")\n        if torch.cuda.is_available():\n            print(f"CUDA \u8BBE\u5907\u53EF\u7528\uFF0C\u5F53\u524D CUDA \u7248\u672C\u662F: {torch.version.cuda}")\n            print(f"PyTorch \u7248\u672C\u662F: {torch.__version__}")\n            print(f"\u68C0\u6D4B\u5230 {torch.cuda.device_count()} \u4E2A CUDA \u8BBE\u5907\u3002")\n            for i in range(torch.cuda.device_count()):\n                print(f"\u8BBE\u5907 {i}: {torch.cuda.get_device_name(i)}")\n                print(f"\u8BBE\u5907 {i} \u7684\u663E\u5B58\u603B\u91CF: {torch.cuda.get_device_properties(i).total_memory / (1024 ** 3):.2f} GB")\n                print(f"\u8BBE\u5907 {i} \u7684\u663E\u5B58\u5F53\u524D\u4F7F\u7528\u91CF: {torch.cuda.memory_allocated(i) / (1024 ** 3):.2f} GB")\n                print(f"\u8BBE\u5907 {i} \u7684\u663E\u5B58\u6700\u5927\u4F7F\u7528\u91CF: {torch.cuda.memory_reserved(i) / (1024 ** 3):.2f} GB")\n        else:\n            print("CUDA \u8BBE\u5907\u4E0D\u53EF\u7528\u3002")\n    except Exception as e:\n        print(f"\u68C0\u67E5 PyTorch CUDA \u73AF\u5883\u65F6\u51FA\u73B0\u9519\u8BEF: {e}")\n\nif __name__ == "__main__":\n    check_cuda_with_pytorch()\n'})}),"\n",(0,d.jsxs)(n.p,{children:["\u5148\u5B89\u88C5\u4E0B",(0,d.jsx)(n.code,{children:"torch"}),"\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pip install torch\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u8FD0\u884C\u4E00\u4E0B\uFF1A"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"python3 check_cuda_pytorch.py\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6B63\u5E38\u8F93\u51FA\u5E94\u8BE5\u662F\u8FD9\u6837\u7684\uFF1A"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-text",children:"\u68C0\u67E5 PyTorch CUDA \u73AF\u5883:\nCUDA \u8BBE\u5907\u53EF\u7528\uFF0C\u5F53\u524D CUDA \u7248\u672C\u662F: 12.1\nPyTorch \u7248\u672C\u662F: 2.3.0+cu121\n\u68C0\u6D4B\u5230 1 \u4E2A CUDA \u8BBE\u5907\u3002\n\u8BBE\u5907 0: Tesla T4\n\u8BBE\u5907 0 \u7684\u663E\u5B58\u603B\u91CF: 14.75 GB\n\u8BBE\u5907 0 \u7684\u663E\u5B58\u5F53\u524D\u4F7F\u7528\u91CF: 0.00 GB\n\u8BBE\u5907 0 \u7684\u663E\u5B58\u6700\u5927\u4F7F\u7528\u91CF: 0.00 GB\n"})}),"\n",(0,d.jsx)(n.h2,{id:"3-docker-\u73AF\u5883",children:"3. Docker \u73AF\u5883"}),"\n",(0,d.jsxs)(n.p,{children:["\u4E0A\u4E00\u6B65\u4E2D\u6211\u4EEC\u5DF2\u7ECF\u5728\u88F8\u673A\u4E0A\u5B89\u88C5\u4E86",(0,d.jsx)(n.code,{children:"GPU Driver"}),"\u3001",(0,d.jsx)(n.code,{children:"CUDA Toolkit"})," \u7B49\u5DE5\u5177\uFF0C\u5B9E\u73B0\u4E86\u5728\u5BBF\u4E3B\u673A\u4E0A\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u73B0\u5728\u5E0C\u671B\u5728",(0,d.jsx)(n.code,{children:"Docker"}),"\u5BB9\u5668\u4E2D\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF0C\u9700\u8981\u600E\u4E48\u5904\u7406\u5462?"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4E3A\u4E86\u8BA9",(0,d.jsx)(n.code,{children:"Docker"}),"\u5BB9\u5668\u4E2D\u4E5F\u80FD\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF0C\u5927\u81F4\u6B65\u9AA4\u5982\u4E0B\uFF1A"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["1\uFF09\u5B89\u88C5 ",(0,d.jsx)(n.code,{children:"nvidia-container-toolkit"})," \u7EC4\u4EF6"]}),"\n",(0,d.jsxs)(n.li,{children:["2\uFF09",(0,d.jsx)(n.code,{children:"docker"})," \u914D\u7F6E\u4F7F\u7528 ",(0,d.jsx)(n.code,{children:"nvidia-runtime"})]}),"\n",(0,d.jsxs)(n.li,{children:["3\uFF09\u542F\u52A8\u5BB9\u5668\u65F6\u589E\u52A0 ",(0,d.jsx)(n.code,{children:"--gpu"})," \u53C2\u6570"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5B89\u88C5-nvidia-container-toolkit",children:"\u5B89\u88C5 nvidia-container-toolkit"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"NVIDIA Container Toolkit \u7684\u4E3B\u8981\u4F5C\u7528\u662F\u5C06 NVIDIA"})," ",(0,d.jsx)(n.strong,{children:"GPU"})," ",(0,d.jsx)(n.strong,{children:"\u8BBE\u5907\u6302\u8F7D\u5230\u5BB9\u5668\u4E2D\u3002"})]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u517C\u5BB9\u751F\u6001\u7CFB\u7EDF\u4E2D\u7684\u4EFB\u610F\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0C",(0,d.jsx)(n.code,{children:"docker"}),"\u3001",(0,d.jsx)(n.code,{children:"containerd"}),"\u3001",(0,d.jsx)(n.code,{children:"cri-o"})," \u7B49\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["NVIDIA \u5B98\u65B9\u5B89\u88C5\u6587\u6863\uFF1A",(0,d.jsx)(n.a,{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html",children:"nvidia-container-toolkit-install-guide"})]}),"\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u4E8E",(0,d.jsx)(n.code,{children:"Ubuntu"}),"\u7CFB\u7EDF\uFF0C\u5B89\u88C5\u547D\u4EE4\u5982\u4E0B\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# 1. Configure the production repository\ncurl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \\\n  && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \\\n    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \\\n    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list\n\n# Optionally, configure the repository to use experimental packages \nsed -i -e '/experimental/ s/^#//g' /etc/apt/sources.list.d/nvidia-container-toolkit.list\n\n# 2. Update the packages list from the repository\nsudo apt-get update\n\n# 3. Install the NVIDIA Container Toolkit packages\nsudo apt-get install -y nvidia-container-toolkit\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u914D\u7F6E\u4F7F\u7528\u8BE5-runtime",children:"\u914D\u7F6E\u4F7F\u7528\u8BE5 runtime"}),"\n",(0,d.jsxs)(n.p,{children:["\u652F\u6301",(0,d.jsx)(n.code,{children:"Docker"}),"\u3001",(0,d.jsx)(n.code,{children:"Containerd"}),"\u3001",(0,d.jsx)(n.code,{children:"CRI-O"}),"\u3001",(0,d.jsx)(n.code,{children:"Podman"}),"\u7B49",(0,d.jsx)(n.code,{children:"CRI"}),"\u3002"]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5177\u4F53\u89C1\u5B98\u65B9\u6587\u6863 ",(0,d.jsx)(n.a,{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#configuration",children:"container-toolkit#install-guide"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u8FD9\u91CC\u4EE5",(0,d.jsx)(n.code,{children:"Docker"}),"\u4E3A\u4F8B\u8FDB\u884C\u914D\u7F6E\uFF1A"]}),"\n",(0,d.jsxs)(n.p,{children:["\u65E7\u7248\u672C\u9700\u8981\u624B\u52A8\u5728 ",(0,d.jsx)(n.code,{children:"/etc/docker/daemon.json"})," \u4E2D\u589E\u52A0\u914D\u7F6E\uFF0C\u6307\u5B9A\u4F7F\u7528",(0,d.jsx)(n.code,{children:"nvidia"}),"\u7684 ",(0,d.jsx)(n.code,{children:"runtime"}),"\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'"runtimes": {\n    "nvidia": {\n        "args": [],\n        "path": "nvidia-container-runtime"\n    }\n}\n'})}),"\n",(0,d.jsxs)(n.p,{children:["\u65B0\u7248",(0,d.jsx)(n.code,{children:"toolkit"}),"\u5E26\u4E86\u4E00\u4E2A",(0,d.jsx)(n.code,{children:"nvidia-ctk"}),"\u5DE5\u5177\uFF0C\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u5373\u53EF\u4E00\u952E\u914D\u7F6E\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"sudo nvidia-ctk runtime configure --runtime=docker\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u7136\u540E\u91CD\u542F",(0,d.jsx)(n.code,{children:"Docker"}),"\u5373\u53EF"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u6D4B\u8BD5-1",children:"\u6D4B\u8BD5"}),"\n",(0,d.jsxs)(n.p,{children:["\u5B89\u88C5",(0,d.jsx)(n.code,{children:"nvidia-container-toolkit"})," \u540E\uFF0C\u6574\u4E2A\u8C03\u7528\u94FE\u5982\u4E0B\uFF1A"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(48371).Z+"",width:"569",height:"369"})}),"\n",(0,d.jsxs)(n.p,{children:["\u8C03\u7528\u94FE\u4ECE",(0,d.jsx)(n.code,{children:"containerd \u2013> runC"}),"\u53D8\u6210",(0,d.jsx)(n.code,{children:"containerd \u2013> nvidia-container-runtime \u2013> runC"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u7136\u540E",(0,d.jsx)(n.code,{children:"nvidia-container-runtime"})," \u5728\u4E2D\u95F4\u62E6\u622A\u4E86\u5BB9\u5668",(0,d.jsx)(n.code,{children:"spec"}),"\uFF0C\u5C31\u53EF\u4EE5\u628A",(0,d.jsx)(n.code,{children:"GPU"}),"\u76F8\u5173\u914D\u7F6E\u6DFB\u52A0\u8FDB\u53BB\uFF0C\u518D\u4F20\u7ED9",(0,d.jsx)(n.code,{children:"runC"}),"\u7684",(0,d.jsx)(n.code,{children:"spec"}),"\u91CC\u9762\u5C31\u5305\u542B",(0,d.jsx)(n.code,{children:"GPU"}),"\u4FE1\u606F\u4E86\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Docker"}),"\u73AF\u5883\u4E2D\u7684",(0,d.jsx)(n.code,{children:"CUDA"}),"\u8C03\u7528\u5927\u6982\u662F\u8FD9\u6837\u7684\uFF1A"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(41995).Z+"",width:"522",height:"369"})}),"\n",(0,d.jsxs)(n.p,{children:["\u4ECE\u56FE\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u8DD1\u5230\u5BB9\u5668\u91CC\u4E86\uFF0C\u56E0\u6B64\u5BBF\u4E3B\u673A\u4E0A\u4E0D\u9700\u8981\u518D\u5B89\u88C5",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u3002"]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u4F7F\u7528\u4E00\u4E2A\u5E26",(0,d.jsx)(n.code,{children:"CUDA Toolkit"}),"\u7684\u955C\u50CF\u5373\u53EF\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6700\u540E\u6211\u4EEC\u542F\u52A8\u4E00\u4E2A",(0,d.jsx)(n.code,{children:"Docker"}),"\u5BB9\u5668\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u5176\u4E2D\u547D\u4EE4\u4E2D\u589E\u52A0 ",(0,d.jsx)(n.code,{children:"--gpu"})," \u53C2\u6570\u6765\u6307\u5B9A\u8981\u5206\u914D\u7ED9\u5BB9\u5668\u7684 ",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"--gpu"})," \u53C2\u6570\u53EF\u9009\u503C\uFF1A"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"--gpus all"}),"\uFF1A\u8868\u793A\u5C06\u6240\u6709 GPU \u90FD\u5206\u914D\u7ED9\u8BE5\u5BB9\u5668"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'--gpus "device=<id>[,<id>...]"'}),"\uFF1A\u5BF9\u4E8E\u591A",(0,d.jsx)(n.code,{children:"GPU"}),"\u573A\u666F\uFF0C\u53EF\u4EE5\u901A\u8FC7",(0,d.jsx)(n.code,{children:"id"}),"\u6307\u5B9A\u5206\u914D\u7ED9\u5BB9\u5668\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF0C\u4F8B\u5982",(0,d.jsx)(n.code,{children:'\u2013gpu "device=0"'})," \u8868\u793A\u53EA\u5206\u914D",(0,d.jsx)(n.code,{children:"0"}),"\u53F7",(0,d.jsx)(n.code,{children:"GPU"}),"\u7ED9\u8BE5\u5BB9\u5668"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"GPU"}),"\u7F16\u53F7\u5219\u662F\u901A\u8FC7",(0,d.jsx)(n.code,{children:"nvidia-smi"})," \u547D\u4EE4\u8FDB\u884C\u67E5\u770B"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u8FD9\u91CC\u6211\u4EEC\u76F4\u63A5\u4F7F\u7528\u4E00\u4E2A\u5E26",(0,d.jsx)(n.code,{children:"cuda"}),"\u7684\u955C\u50CF\u6765\u6D4B\u8BD5\uFF0C\u542F\u52A8\u8BE5\u5BB9\u5668\u5E76\u6267\u884C",(0,d.jsx)(n.code,{children:"nvidia-smi"})," \u547D\u4EE4"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker run --rm --gpus all nvidia/cuda:12.0.1-runtime-ubuntu22.04 nvidia-smi\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u6B63\u5E38\u60C5\u51B5\u4E0B\u5E94\u8BE5\u662F\u53EF\u4EE5\u6253\u5370\u51FA\u5BB9\u5668\u4E2D\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u4FE1\u606F\u7684\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"4-k8s-\u73AF\u5883",children:"4. K8S \u73AF\u5883"}),"\n",(0,d.jsxs)(n.p,{children:["\u66F4\u8FDB\u4E00\u6B65\uFF0C\u5728",(0,d.jsx)(n.code,{children:"K8S"}),"\u73AF\u5883\u4E2D\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF0C\u5219\u9700\u8981\u5728\u96C6\u7FA4\u4E2D\u90E8\u7F72\u4EE5\u4E0B\u7EC4\u4EF6\uFF1A"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"gpu-device-plugin"})," \u7528\u4E8E\u7BA1\u7406",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF0C",(0,d.jsx)(n.code,{children:"device-plugin"})," \u4EE5",(0,d.jsx)(n.code,{children:"DaemonSet"}),"\u65B9\u5F0F\u8FD0\u884C\u5230\u96C6\u7FA4\u5404\u4E2A\u8282\u70B9\uFF0C\u4EE5\u611F\u77E5\u8282\u70B9\u4E0A\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\uFF0C\u4ECE\u800C\u8BA9",(0,d.jsx)(n.code,{children:"K8S"}),"\u80FD\u591F\u5BF9\u8282\u70B9\u4E0A\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\u8FDB\u884C\u7BA1\u7406\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"gpu-exporter"}),"\uFF1A\u7528\u4E8E\u76D1\u63A7",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5404\u7EC4\u4EF6\u5173\u7CFB\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"alt text",src:i(29020).Z+"",width:"742",height:"353"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5DE6\u56FE\u4E3A\u624B\u52A8\u5B89\u88C5\u7684\u573A\u666F\uFF0C\u53EA\u9700\u8981\u5728\u96C6\u7FA4\u4E2D\u5B89\u88C5",(0,d.jsx)(n.code,{children:"device-plugin"}),"\u548C\u76D1\u63A7\u5373\u53EF\u4F7F\u7528\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u53F3\u56FE\u4E3A\u4F7F\u7528",(0,d.jsx)(n.code,{children:"gpu-operotar"}),"\u5B89\u88C5\u573A\u666F\uFF0C\u672C\u7BC7\u6682\u65F6\u5FFD\u7565"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5927\u81F4\u5DE5\u4F5C\u6D41\u7A0B\u5982\u4E0B\uFF1A"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6BCF\u4E2A\u8282\u70B9\u7684",(0,d.jsx)(n.code,{children:"kubelet"}),"\u7EC4\u4EF6\u7EF4\u62A4\u8BE5\u8282\u70B9\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\u72B6\u6001\uFF08\u54EA\u4E9B\u5DF2\u7528\uFF0C\u54EA\u4E9B\u672A\u7528\uFF09\u5E76\u5B9A\u65F6\u62A5\u544A\u7ED9\u8C03\u5EA6\u5668\uFF0C\u8C03\u5EA6\u5668\u77E5\u9053\u6BCF\u4E00\u4E2A\u8282\u70B9\u6709\u591A\u5C11\u5F20",(0,d.jsx)(n.code,{children:"GPU"}),"\u5361\u53EF\u7528\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u8C03\u5EA6\u5668\u4E3A",(0,d.jsx)(n.code,{children:"pod"}),"\u9009\u62E9\u8282\u70B9\u65F6\uFF0C\u4ECE\u7B26\u5408\u6761\u4EF6\u7684\u8282\u70B9\u4E2D\u9009\u62E9\u4E00\u4E2A\u8282\u70B9\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5F53",(0,d.jsx)(n.code,{children:"pod"}),"\u8C03\u5EA6\u5230\u8282\u70B9\u4E0A\u540E\uFF0C",(0,d.jsx)(n.code,{children:"kubelet"}),"\u7EC4\u4EF6\u4E3A",(0,d.jsx)(n.code,{children:"pod"}),"\u5206\u914D",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907 ID\uFF0C\u5E76\u5C06\u8FD9\u4E9B ID \u4F5C\u4E3A\u53C2\u6570\u4F20\u9012\u7ED9",(0,d.jsx)(n.code,{children:"NVIDIA Device Plugin"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"NVIDIA Device Plugin"})," \u5C06\u5206\u914D\u7ED9\u8BE5",(0,d.jsx)(n.code,{children:"pod"}),"\u7684\u5BB9\u5668\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907 ID \u5199\u5165\u5230\u5BB9\u5668\u7684\u73AF\u5883\u53D8\u91CF",(0,d.jsx)(n.code,{children:"NVIDIA_VISIBLE_DEVICES"}),"\u4E2D\uFF0C\u7136\u540E\u5C06\u4FE1\u606F\u8FD4\u56DE\u7ED9",(0,d.jsx)(n.code,{children:"kubelet"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"kubelet"})," \u542F\u52A8\u5BB9\u5668\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"NVIDIA Container Toolkit"})," \u68C0\u6D4B\u5BB9\u5668\u7684",(0,d.jsx)(n.code,{children:"spec"}),"\u4E2D\u5B58\u5728\u73AF\u5883\u53D8\u91CF",(0,d.jsx)(n.code,{children:"NVIDIA_VISIBLE_DEVICES"}),"\uFF0C\u7136\u540E\u6839\u636E\u73AF\u5883\u53D8\u91CF\u7684\u503C\u5C06",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\u6302\u8F7D\u5230\u5BB9\u5668\u4E2D\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 Docker \u73AF\u5883\u6211\u4EEC\u5728\u542F\u52A8\u5BB9\u5668\u65F6\u901A\u8FC7 ",(0,d.jsx)(n.code,{children:"--gpu"})," \u53C2\u6570\u624B\u52A8\u6307\u5B9A\u5206\u914D\u7ED9\u5BB9\u5668\u7684 GPU\uFF0CK8S \u73AF\u5883\u5219\u7531 device-plugin \u81EA\u884C\u7BA1\u7406\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5B89\u88C5-device-plugin",children:"\u5B89\u88C5 device-plugin"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"device-plugin"}),"\u4E00\u822C\u7531\u5BF9\u5E94\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u5382\u5BB6\u63D0\u4F9B\uFF0C\u6BD4\u5982",(0,d.jsx)(n.code,{children:"NVIDIA"}),"\u7684 ",(0,d.jsx)(n.a,{href:"https://github.com/NVIDIA/K8S-device-plugin",children:"K8S-device-plugin"})]}),"\n",(0,d.jsxs)(n.p,{children:["\u5B89\u88C5\u5176\u5B9E\u5F88\u7B80\u5355\uFF0C\u5C06\u5BF9\u5E94\u7684",(0,d.jsx)(n.code,{children:"yaml"})," ",(0,d.jsx)(n.code,{children:"apply"}),"\u5230\u96C6\u7FA4\u5373\u53EF\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"kubectl create -f https://raw.githubusercontent.com/NVIDIA/K8S-device-plugin/v0.15.0/deployments/static/nvidia-device-plugin.yml\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5C31\u50CF\u8FD9\u6837"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"root@test:~# kgo get po -l app=nvidia-device-plugin-daemonset\nNAME                                   READY   STATUS    RESTARTS   AGE\nnvidia-device-plugin-daemonset-7nkjw   1/1     Running   0          10m\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"device-plugin"}),"\u542F\u52A8\u4E4B\u540E\uFF0C\u4F1A\u611F\u77E5\u8282\u70B9\u4E0A\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\u5E76\u4E0A\u62A5\u7ED9",(0,d.jsx)(n.code,{children:"kubelet"}),"\uFF0C\u6700\u7EC8\u7531",(0,d.jsx)(n.code,{children:"kubelet"}),"\u63D0\u4EA4\u5230",(0,d.jsx)(n.code,{children:"kube-apiserver"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u56E0\u6B64\u6211\u4EEC\u53EF\u4EE5\u5728",(0,d.jsx)(n.code,{children:"Node"}),"\u7684\u53EF\u5206\u914D\u8D44\u6E90\u4E2D\u770B\u5230",(0,d.jsx)(n.code,{children:"GPU"}),"\uFF0C\u5C31\u50CF\u8FD9\u6837\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"root@test:~# k describe node test|grep Capacity -A7\nCapacity:\n  cpu:                48  ephemeral-storage:  460364840Ki  hugepages-1Gi:      0  hugepages-2Mi:      0  memory:             98260824Ki  nvidia.com/gpu:     2  pods:               110\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C\u9664\u4E86\u5E38\u89C1\u7684",(0,d.jsx)(n.code,{children:"cpu"}),"\u3001",(0,d.jsx)(n.code,{children:"memory"}),"\u4E4B\u5916\uFF0C\u8FD8\u6709",(0,d.jsx)(n.code,{children:"nvidia.com/gpu"}),", \u8FD9\u4E2A\u5C31\u662F",(0,d.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\uFF0C\u6570\u91CF\u4E3A",(0,d.jsx)(n.code,{children:"2"}),"\u8BF4\u660E\u6211\u4EEC\u6709\u4E24\u5F20",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5B89\u88C5-gpu-\u76D1\u63A7",children:"\u5B89\u88C5 GPU \u76D1\u63A7"}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u6B64\u4E4B\u5916\uFF0C\u5982\u679C\u4F60\u9700\u8981\u76D1\u63A7\u96C6\u7FA4",(0,d.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\uFF0C\u4F60\u53EF\u80FD\u8FD8\u9700\u8981\u5B89\u88C5 ",(0,d.jsx)(n.a,{href:"https://github.com/NVIDIA/dcgm-exporter",children:"DCCM exporter"})," \u7ED3\u5408",(0,d.jsx)(n.code,{children:"Prometheus"}),"\u8F93\u51FA",(0,d.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u76D1\u63A7\u4FE1\u606F\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"helm repo add gpu-helm-charts https://nvidia.github.io/dcgm-exporter/helm-charts\nhelm repo update\nhelm install --generate-name gpu-helm-charts/dcgm-exporter\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u67E5\u770B",(0,d.jsx)(n.code,{children:"metrics"}),"\uFF1A"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'curl -sL http://127.0.0.1:8080/metrics\n# HELP DCGM_FI_DEV_SM_CLOCK SM clock frequency (in MHz).# TYPE DCGM_FI_DEV_SM_CLOCK gauge# HELP DCGM_FI_DEV_MEM_CLOCK Memory clock frequency (in MHz).# TYPE DCGM_FI_DEV_MEM_CLOCK gauge# HELP DCGM_FI_DEV_MEMORY_TEMP Memory temperature (in C).# TYPE DCGM_FI_DEV_MEMORY_TEMP gauge\n...\nDCGM_FI_DEV_SM_CLOCK{gpu="0", UUID="GPU-604ac76c-d9cf-fef3-62e9-d92044ab6e52",container="",namespace="",pod=""} 139\nDCGM_FI_DEV_MEM_CLOCK{gpu="0", UUID="GPU-604ac76c-d9cf-fef3-62e9-d92044ab6e52",container="",namespace="",pod=""} 405\nDCGM_FI_DEV_MEMORY_TEMP{gpu="0", UUID="GPU-604ac76c-d9cf-fef3-62e9-d92044ab6e52",container="",namespace="",pod=""} 9223372036854775794\n...\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u6D4B\u8BD5-2",children:"\u6D4B\u8BD5"}),"\n",(0,d.jsxs)(n.p,{children:["\u5728",(0,d.jsx)(n.code,{children:"K8S"}),"\u521B\u5EFA",(0,d.jsx)(n.code,{children:"Pod"}),"\u8981\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u5F88\u7B80\u5355\uFF0C\u548C",(0,d.jsx)(n.code,{children:"cpu"}),"\u3001",(0,d.jsx)(n.code,{children:"memory"}),"\u7B49\u5E38\u89C4\u8D44\u6E90\u4E00\u6837\uFF0C\u5728",(0,d.jsx)(n.code,{children:"resource"}),"\u4E2D\u7533\u8BF7\u5373\u53EF\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6BD4\u5982\uFF0C\u4E0B\u9762\u8FD9\u4E2A",(0,d.jsx)(n.code,{children:"yaml"}),"\u91CC\u9762\u6211\u4EEC\u5C31\u901A\u8FC7",(0,d.jsx)(n.code,{children:"resource.limits"}),"\u7533\u8BF7\u4E86\u8BE5",(0,d.jsx)(n.code,{children:"Pod"}),"\u8981\u4F7F\u7528",(0,d.jsx)(n.code,{children:"1"}),"\u4E2A",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: gpu-pod\nspec:\n  restartPolicy: Never\n  containers:\n    - name: cuda-container\n      image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda10.2\n      resources:\n        limits:\n          nvidia.com/gpu: 1 # requesting 1 GPU\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u8FD9\u6837",(0,d.jsx)(n.code,{children:"kueb-scheduler"}),"\u5728\u8C03\u5EA6\u8BE5",(0,d.jsx)(n.code,{children:"Pod"}),"\u65F6\u5C31\u4F1A\u8003\u8651\u5230\u8FD9\u4E2A\u60C5\u51B5\uFF0C\u5C06\u5176\u8C03\u5EA6\u5230\u6709",(0,d.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u7684\u8282\u70B9\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u542F\u52A8\u540E\uFF0C\u67E5\u770B\u65E5\u5FD7\uFF0C\u6B63\u5E38\u5E94\u8BE5\u4F1A\u6253\u5370 \u6D4B\u8BD5\u901A\u8FC7\u7684\u4FE1\u606F\u3002"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: gpu-pod\nspec:\n  restartPolicy: Never\n  containers:\n    - name: cuda-container\n      image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda10.2\n      resources:\n        limits:\n          nvidia.com/gpu: 1 # requesting 1 GPU\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u81F3\u6B64\uFF0C\u5728",(0,d.jsx)(n.code,{children:"K8S"}),"\u73AF\u5883\u4E2D\u4E5F\u53EF\u4EE5\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\u4E86\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"5-\u5C0F\u7ED3",children:"5. \u5C0F\u7ED3"}),"\n",(0,d.jsxs)(n.p,{children:["\u672C\u6587\u4E3B\u8981\u5206\u4EAB\u4E86\u5728\u88F8\u673A\u3001",(0,d.jsx)(n.code,{children:"Docker"}),"\u73AF\u5883\u3001",(0,d.jsx)(n.code,{children:"K8S"}),"\u73AF\u5883\u4E2D\u5982\u4F55\u4F7F\u7528",(0,d.jsx)(n.code,{children:"GPU"}),"\u3002"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u4E8E\u88F8\u673A\u73AF\u5883\uFF0C\u53EA\u9700\u8981\u5B89\u88C5\u5BF9\u5E94\u7684",(0,d.jsx)(n.code,{children:"GPU Driver"}),"\u5373\u53EF\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u5E94",(0,d.jsx)(n.code,{children:"Docker"}),"\u73AF\u5883\uFF0C\u9700\u8981\u989D\u5916\u5B89\u88C5 ",(0,d.jsx)(n.code,{children:"nvidia-container-toolkit"})," \u5E76\u914D\u7F6E",(0,d.jsx)(n.code,{children:"docker"}),"\u4F7F\u7528",(0,d.jsx)(n.code,{children:"nvidia runtime"}),"\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5BF9\u5E94",(0,d.jsx)(n.code,{children:"K8S"}),"\u73AF\u5883\uFF0C\u9700\u8981\u989D\u5916\u5B89\u88C5\u5BF9\u5E94\u7684 ",(0,d.jsx)(n.code,{children:"device-plugin"})," \u4F7F\u5F97",(0,d.jsx)(n.code,{children:"kubelet"}),"\u80FD\u591F\u611F\u77E5\u5230\u8282\u70B9\u4E0A\u7684",(0,d.jsx)(n.code,{children:"GPU"}),"\u8BBE\u5907\uFF0C\u4EE5\u4FBF",(0,d.jsx)(n.code,{children:"K8S"}),"\u80FD\u591F\u8FDB\u884C",(0,d.jsx)(n.code,{children:"GPU"}),"\u7BA1\u7406\u3002"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u73B0\u5728\u4E00\u822C\u90FD\u662F\u5728",(0,d.jsx)(n.code,{children:"K8S"}),"\u73AF\u5883\u4E2D\u4F7F\u7528\uFF0C\u4E3A\u4E86\u7B80\u5316\u5B89\u88C5\u6B65\u9AA4\uFF0C",(0,d.jsx)(n.code,{children:"NVIDIA"}),"\u4E5F\u63D0\u4F9B\u4E86 ",(0,d.jsx)(n.code,{children:"gpu-operator"}),"\u6765\u7B80\u5316\u5B89\u88C5\u90E8\u7F72\uFF0C\u8FD9\u91CC\u7684\u5B89\u88C5\u6B65\u9AA4\u4EC5\u4F9B\u53C2\u8003\u5B66\u4E60\u3002"]})]})}function a(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},82070:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-1-9f2224e0d9b75b941e75f886cf318ac4.png"},27629:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-2-2813229c1e60ea8800ae79ac91b6c866.png"},10859:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-3-b39b92caf317ad480f77b64e037b05c7.png"},48371:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-4-036167c19bbeb408c3cb0c93abdda176.png"},41995:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-5-1c4558d2263a7ee0a3f5e09233d3c2a1.png"},29020:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-6-7b35f60219f4194a195edaa171ef5172.png"},29666:function(e,n,i){i.d(n,{Z:function(){return c}});let c=i.p+"assets/images/image-e4debffc2e6e36f7ef32a0c48df490c7.png"},50065:function(e,n,i){i.d(n,{Z:function(){return l},a:function(){return r}});var c=i(67294);let d={},s=c.createContext(d);function r(e){let n=c.useContext(s);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);