"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["3786"],{78151:function(n,e,r){r.r(e),r.d(e,{metadata:()=>i,contentTitle:()=>c,default:()=>a,assets:()=>t,toc:()=>o,frontMatter:()=>l});var i=JSON.parse('{"id":"docs/AI\u6280\u672F/AI\u57FA\u7840\u67B6\u6784/HPC/Kubeflow Trainer/Kubeflow Trainer CRD\u914D\u7F6E\u683C\u5F0F\u8BE6\u89E3","title":"Kubeflow Trainer CRD\u914D\u7F6E\u683C\u5F0F\u8BE6\u89E3","description":"\u8BE6\u7EC6\u4ECB\u7ECDKubeflow Trainer\u7684\u4E09\u4E2A\u6838\u5FC3CRD\uFF08TrainJob\u3001TrainingRuntime\u3001ClusterTrainingRuntime\uFF09\u7684\u5B8C\u6574\u914D\u7F6E\u683C\u5F0F\uFF0C\u5305\u62EC\u6BCF\u4E2A\u914D\u7F6E\u9879\u7684\u6CE8\u91CA\u8BF4\u660E\u3001\u590D\u6742\u914D\u7F6E\u9879\u7684\u8868\u683C\u89E3\u91CA\u3001\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3\u7684\u4F7F\u7528\uFF0C\u4EE5\u53CA\u6700\u4F73\u5B9E\u8DF5\u6307\u5357","source":"@site/docs/docs/1000-AI\u6280\u672F/200-AI\u57FA\u7840\u67B6\u6784/550-HPC/100-Kubeflow Trainer/3000-Kubeflow Trainer CRD\u914D\u7F6E\u683C\u5F0F\u8BE6\u89E3.md","sourceDirName":"docs/1000-AI\u6280\u672F/200-AI\u57FA\u7840\u67B6\u6784/550-HPC/100-Kubeflow Trainer","slug":"/ai/kubeflow-trainer-crd-reference","permalink":"/ai/kubeflow-trainer-crd-reference","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3000,"frontMatter":{"slug":"/ai/kubeflow-trainer-crd-reference","title":"Kubeflow Trainer CRD\u914D\u7F6E\u683C\u5F0F\u8BE6\u89E3","hide_title":true,"keywords":["Kubeflow Trainer","TrainJob","TrainingRuntime","ClusterTrainingRuntime","CRD","Custom Resource Definition","\u5206\u5E03\u5F0F\u8BAD\u7EC3","PyTorch","DeepSpeed","MPI","YAML\u914D\u7F6E","Kubernetes","\u8BAD\u7EC3\u4EFB\u52A1","\u8FD0\u884C\u65F6\u6A21\u677F","Gang Scheduling","\u6570\u636E\u96C6\u521D\u59CB\u5316","\u6A21\u578B\u521D\u59CB\u5316","Pod\u6A21\u677F\u8986\u76D6","\u5F39\u6027\u8BAD\u7EC3","HPC"],"description":"\u8BE6\u7EC6\u4ECB\u7ECDKubeflow Trainer\u7684\u4E09\u4E2A\u6838\u5FC3CRD\uFF08TrainJob\u3001TrainingRuntime\u3001ClusterTrainingRuntime\uFF09\u7684\u5B8C\u6574\u914D\u7F6E\u683C\u5F0F\uFF0C\u5305\u62EC\u6BCF\u4E2A\u914D\u7F6E\u9879\u7684\u6CE8\u91CA\u8BF4\u660E\u3001\u590D\u6742\u914D\u7F6E\u9879\u7684\u8868\u683C\u89E3\u91CA\u3001\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3\u7684\u4F7F\u7528\uFF0C\u4EE5\u53CA\u6700\u4F73\u5B9E\u8DF5\u6307\u5357"},"sidebar":"mainSidebar","previous":{"title":"Kubeflow Trainer PyTorch\u5E76\u884C\u8BA1\u7B97","permalink":"/ai/kubeflow-trainer-pytorch-parallel-computing"},"next":{"title":"Kubeflow Trainer \u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528","permalink":"/ai/kubeflow-trainer-deploy-usage"}}'),d=r("85893"),s=r("50065");let l={slug:"/ai/kubeflow-trainer-crd-reference",title:"Kubeflow Trainer CRD\u914D\u7F6E\u683C\u5F0F\u8BE6\u89E3",hide_title:!0,keywords:["Kubeflow Trainer","TrainJob","TrainingRuntime","ClusterTrainingRuntime","CRD","Custom Resource Definition","\u5206\u5E03\u5F0F\u8BAD\u7EC3","PyTorch","DeepSpeed","MPI","YAML\u914D\u7F6E","Kubernetes","\u8BAD\u7EC3\u4EFB\u52A1","\u8FD0\u884C\u65F6\u6A21\u677F","Gang Scheduling","\u6570\u636E\u96C6\u521D\u59CB\u5316","\u6A21\u578B\u521D\u59CB\u5316","Pod\u6A21\u677F\u8986\u76D6","\u5F39\u6027\u8BAD\u7EC3","HPC"],description:"\u8BE6\u7EC6\u4ECB\u7ECDKubeflow Trainer\u7684\u4E09\u4E2A\u6838\u5FC3CRD\uFF08TrainJob\u3001TrainingRuntime\u3001ClusterTrainingRuntime\uFF09\u7684\u5B8C\u6574\u914D\u7F6E\u683C\u5F0F\uFF0C\u5305\u62EC\u6BCF\u4E2A\u914D\u7F6E\u9879\u7684\u6CE8\u91CA\u8BF4\u660E\u3001\u590D\u6742\u914D\u7F6E\u9879\u7684\u8868\u683C\u89E3\u91CA\u3001\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3\u7684\u4F7F\u7528\uFF0C\u4EE5\u53CA\u6700\u4F73\u5B9E\u8DF5\u6307\u5357"},c=void 0,t={},o=[{value:"\u6982\u8FF0",id:"\u6982\u8FF0",level:2},{value:"TrainJob",id:"trainjob",level:2},{value:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B",id:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B",level:3},{value:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E",id:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E",level:3},{value:"runtimeRef",id:"runtimeref",level:4},{value:"numProcPerNode",id:"numprocpernode",level:4},{value:"managedBy",id:"managedby",level:4},{value:"initializer\uFF08\u521D\u59CB\u5316\u5668\uFF09",id:"initializer\u521D\u59CB\u5316\u5668",level:4},{value:"dataset\uFF08\u6570\u636E\u96C6\u521D\u59CB\u5316\u5668\uFF09",id:"dataset\u6570\u636E\u96C6\u521D\u59CB\u5316\u5668",level:5},{value:"model\uFF08\u6A21\u578B\u521D\u59CB\u5316\u5668\uFF09",id:"model\u6A21\u578B\u521D\u59CB\u5316\u5668",level:5},{value:"\u521D\u59CB\u5316\u5668\u7684\u6267\u884C\u6D41\u7A0B",id:"\u521D\u59CB\u5316\u5668\u7684\u6267\u884C\u6D41\u7A0B",level:5},{value:"Status Conditions",id:"status-conditions",level:4},{value:"TrainingRuntime",id:"trainingruntime",level:2},{value:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B",id:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B-1",level:3},{value:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E",id:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E-1",level:3},{value:"mlPolicy",id:"mlpolicy",level:4},{value:"PyTorch \u5F39\u6027\u8BAD\u7EC3",id:"pytorch-\u5F39\u6027\u8BAD\u7EC3",level:4},{value:"MPI \u5B9E\u73B0\u7C7B\u578B",id:"mpi-\u5B9E\u73B0\u7C7B\u578B",level:4},{value:"\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3",id:"\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3",level:3},{value:"\u7CFB\u7EDF\u9884\u7559\u6807\u7B7E",id:"\u7CFB\u7EDF\u9884\u7559\u6807\u7B7E",level:4},{value:"\u6807\u7B7E\u4F7F\u7528\u8BF4\u660E",id:"\u6807\u7B7E\u4F7F\u7528\u8BF4\u660E",level:4},{value:"trainer.kubeflow.org/trainjob-ancestor-step",id:"trainerkubefloworgtrainjob-ancestor-step",level:5},{value:"trainer.kubeflow.org/framework",id:"trainerkubefloworgframework",level:5},{value:"trainer.kubeflow.org/support",id:"trainerkubefloworgsupport",level:5},{value:"\u7528\u6237\u81EA\u5B9A\u4E49\u6807\u7B7E\u548C\u6CE8\u89E3",id:"\u7528\u6237\u81EA\u5B9A\u4E49\u6807\u7B7E\u548C\u6CE8\u89E3",level:4},{value:"ClusterTrainingRuntime",id:"clustertrainingruntime",level:2},{value:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B",id:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B-2",level:3},{value:"\u96C6\u7FA4\u7EA7\u6570\u636E\u521D\u59CB\u5316\u8FD0\u884C\u65F6\u793A\u4F8B",id:"\u96C6\u7FA4\u7EA7\u6570\u636E\u521D\u59CB\u5316\u8FD0\u884C\u65F6\u793A\u4F8B",level:3},{value:"TrainingRuntime vs ClusterTrainingRuntime",id:"trainingruntime-vs-clustertrainingruntime",level:3},{value:"\u73AF\u5883\u53D8\u91CF\u6CE8\u5165",id:"\u73AF\u5883\u53D8\u91CF\u6CE8\u5165",level:2},{value:"PyTorch\u6846\u67B6\u73AF\u5883\u53D8\u91CF",id:"pytorch\u6846\u67B6\u73AF\u5883\u53D8\u91CF",level:3},{value:"PET_*\u7CFB\u5217\uFF08PyTorch Elastic Training\uFF09",id:"pet_\u7CFB\u5217pytorch-elastic-training",level:4},{value:"\u6807\u51C6\u5206\u5E03\u5F0F\u8BAD\u7EC3\u73AF\u5883\u53D8\u91CF",id:"\u6807\u51C6\u5206\u5E03\u5F0F\u8BAD\u7EC3\u73AF\u5883\u53D8\u91CF",level:4},{value:"OpenMPI\u6846\u67B6\u73AF\u5883\u53D8\u91CF",id:"openmpi\u6846\u67B6\u73AF\u5883\u53D8\u91CF",level:3},{value:"\u901A\u7528\u73AF\u5883\u53D8\u91CF",id:"\u901A\u7528\u73AF\u5883\u53D8\u91CF",level:3},{value:"\u4F7F\u7528\u793A\u4F8B",id:"\u4F7F\u7528\u793A\u4F8B",level:3},{value:"PyTorch\u8BAD\u7EC3\u811A\u672C\u793A\u4F8B",id:"pytorch\u8BAD\u7EC3\u811A\u672C\u793A\u4F8B",level:4},{value:"TrainingRuntime command\u914D\u7F6E\u793A\u4F8B",id:"trainingruntime-command\u914D\u7F6E\u793A\u4F8B",level:4},{value:"\u6700\u4F73\u5B9E\u8DF5",id:"\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"\u53C2\u8003\u8D44\u6599",id:"\u53C2\u8003\u8D44\u6599",level:2}];function h(n){let e={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.h2,{id:"\u6982\u8FF0",children:"\u6982\u8FF0"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u63D0\u4F9B\u4E86\u4E09\u4E2A\u6838\u5FC3\u7684",(0,d.jsx)(e.code,{children:"CRD\uFF08Custom Resource Definition\uFF09"}),"\u6765\u652F\u6301\u5206\u5E03\u5F0F\u8BAD\u7EC3\u4EFB\u52A1\u7684\u5B9A\u4E49\u548C\u6267\u884C\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"CRD\u540D\u79F0"}),(0,d.jsx)(e.th,{children:"\u4F5C\u7528\u57DF"}),(0,d.jsx)(e.th,{children:"\u4E3B\u8981\u4F5C\u7528"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"TrainJob"})}),(0,d.jsx)(e.td,{children:"\u547D\u540D\u7A7A\u95F4"}),(0,d.jsx)(e.td,{children:"\u5B9A\u4E49\u5177\u4F53\u7684\u8BAD\u7EC3\u4EFB\u52A1\uFF0C\u5305\u62EC\u8BAD\u7EC3\u7684\u914D\u7F6E\u53C2\u6570\u3001\u8D44\u6E90\u9700\u6C42\u3001\u6570\u636E\u96C6\u548C\u6A21\u578B\u521D\u59CB\u5316\u7B49"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"TrainingRuntime"})}),(0,d.jsx)(e.td,{children:"\u547D\u540D\u7A7A\u95F4"}),(0,d.jsxs)(e.td,{children:["\u547D\u540D\u7A7A\u95F4\u7EA7\u522B\u7684\u8BAD\u7EC3\u8FD0\u884C\u65F6\u6A21\u677F\uFF0C\u5B9A\u4E49\u4E86\u7279\u5B9A\u6846\u67B6\uFF08\u5982 ",(0,d.jsx)(e.code,{children:"PyTorch"}),"\u3001",(0,d.jsx)(e.code,{children:"DeepSpeed"}),"\uFF09\u7684\u6267\u884C\u73AF\u5883\uFF0C\u53EA\u80FD\u88AB\u540C\u4E00\u547D\u540D\u7A7A\u95F4\u7684",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u5F15\u7528"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"ClusterTrainingRuntime"})}),(0,d.jsx)(e.td,{children:"\u96C6\u7FA4"}),(0,d.jsxs)(e.td,{children:["\u96C6\u7FA4\u7EA7\u522B\u7684\u8BAD\u7EC3\u8FD0\u884C\u65F6\u6A21\u677F\uFF0C\u53EF\u4EE5\u88AB\u4EFB\u4F55\u547D\u540D\u7A7A\u95F4\u7684 ",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u5F15\u7528\uFF0C\u9002\u7528\u4E8E\u8DE8\u56E2\u961F\u5171\u4EAB\u7684\u6807\u51C6\u8FD0\u884C\u65F6\u914D\u7F6E"]})]})]})]}),"\n",(0,d.jsxs)(e.p,{children:["\u672C\u6587\u5C06\u8BE6\u7EC6\u4ECB\u7ECD\u8FD9\u4E09\u4E2A",(0,d.jsx)(e.code,{children:"CRD"}),"\u7684\u5B8C\u6574\u914D\u7F6E\u683C\u5F0F\uFF0C\u5E76\u5BF9\u6BCF\u4E2A\u914D\u7F6E\u9879\u8FDB\u884C\u8BF4\u660E\u3002"]}),"\n",(0,d.jsx)(e.h2,{id:"trainjob",children:"TrainJob"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"TrainJob"}),"\u662F\u7528\u6237\u521B\u5EFA\u5206\u5E03\u5F0F\u8BAD\u7EC3\u4EFB\u52A1\u7684\u6838\u5FC3",(0,d.jsx)(e.code,{children:"CRD"}),"\uFF0C\u5B83\u5B9A\u4E49\u4E86\u8BAD\u7EC3\u4EFB\u52A1\u7684\u6240\u6709\u914D\u7F6E\u53C2\u6570\u3002"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B",children:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: TrainJob\nmetadata:\n  # TrainJob \u7684\u540D\u79F0\uFF0C\u5FC5\u987B\u7B26\u5408 RFC 1035 DNS \u6807\u7B7E\u683C\u5F0F\uFF08\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u8FDE\u5B57\u7B26\uFF0C\u6700\u591A63\u4E2A\u5B57\u7B26\uFF09\n  name: pytorch-distributed-training\n  # TrainJob \u6240\u5728\u7684\u547D\u540D\u7A7A\u95F4\n  namespace: kubeflow\n  # \u53EF\u9009\u7684\u6807\u7B7E\n  labels:\n    app: training\n    framework: pytorch\n  # \u53EF\u9009\u7684\u6CE8\u89E3\n  annotations:\n    description: "PyTorch distributed training example"\nspec:\n  # \u5F15\u7528\u7684\u8BAD\u7EC3\u8FD0\u884C\u65F6\u914D\u7F6E\uFF08\u5FC5\u586B\uFF09\n  runtimeRef:\n    # \u8FD0\u884C\u65F6\u7684\u540D\u79F0\uFF08\u5FC5\u586B\uFF0C\u6700\u5C0F\u957F\u5EA6\u4E3A1\uFF09\n    name: torch-distributed\n    # \u8FD0\u884C\u65F6\u7684 API \u7EC4\uFF0C\u9ED8\u8BA4\u4E3A trainer.kubeflow.org\n    apiGroup: trainer.kubeflow.org\n    # \u8FD0\u884C\u65F6\u7684\u7C7B\u578B\uFF0C\u53EF\u9009\u503C\uFF1ATrainingRuntime \u6216 ClusterTrainingRuntime\n    # \u9ED8\u8BA4\u4E3A ClusterTrainingRuntime\n    kind: ClusterTrainingRuntime\n\n  # \u521D\u59CB\u5316\u5668\u914D\u7F6E\uFF0C\u7528\u4E8E\u6570\u636E\u96C6\u548C\u6A21\u578B\u7684\u521D\u59CB\u5316\uFF08\u53EF\u9009\uFF09\n  initializer:\n    # \u6570\u636E\u96C6\u521D\u59CB\u5316\u914D\u7F6E\n    dataset:\n      # \u6570\u636E\u96C6\u5B58\u50A8\u7684 URI\uFF0C\u652F\u6301\u5404\u79CD\u5B58\u50A8\u534F\u8BAE\uFF08\u5982 s3://\u3001gs://\u3001pvc:// \u7B49\uFF09\n      storageUri: s3://my-bucket/datasets/fashion-mnist\n      # \u73AF\u5883\u53D8\u91CF\u5217\u8868\uFF0C\u7528\u4E8E\u6570\u636E\u96C6\u521D\u59CB\u5316\u5BB9\u5668\n      env:\n        - name: AWS_REGION\n          value: us-west-2\n        - name: DATASET_FORMAT\n          value: pytorch\n      # Secret \u5F15\u7528\uFF0C\u5305\u542B\u8BBF\u95EE\u6570\u636E\u96C6\u7684\u51ED\u8BC1\n      # Secret \u5FC5\u987B\u5728 TrainJob \u6240\u5728\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u521B\u5EFA\n      secretRef:\n        name: s3-credentials\n\n    # \u9884\u8BAD\u7EC3\u6A21\u578B\u521D\u59CB\u5316\u914D\u7F6E\n    model:\n      # \u9884\u8BAD\u7EC3\u6A21\u578B\u5B58\u50A8\u7684 URI\n      storageUri: s3://my-bucket/models/pretrained-resnet\n      # \u73AF\u5883\u53D8\u91CF\u5217\u8868\uFF0C\u7528\u4E8E\u6A21\u578B\u521D\u59CB\u5316\u5BB9\u5668\n      env:\n        - name: MODEL_FORMAT\n          value: pytorch\n        - name: MODEL_VERSION\n          value: v1.0\n      # Secret \u5F15\u7528\uFF0C\u5305\u542B\u8BBF\u95EE\u6A21\u578B\u7684\u51ED\u8BC1\n      secretRef:\n        name: s3-credentials\n\n  # \u8BAD\u7EC3\u5668\u914D\u7F6E\uFF08\u53EF\u9009\uFF09\n  trainer:\n    # \u8BAD\u7EC3\u5BB9\u5668\u7684\u955C\u50CF\n    image: pytorch/pytorch:2.7.1-cuda12.8-cudnn9-runtime\n    # \u5BB9\u5668\u7684\u542F\u52A8\u547D\u4EE4\n    command:\n      - python\n      - /workspace/train.py\n    # \u5BB9\u5668\u7684\u53C2\u6570\n    args:\n      - --epochs=10\n      - --batch-size=64\n      - --learning-rate=0.001\n    # \u73AF\u5883\u53D8\u91CF\u5217\u8868\n    env:\n      - name: NCCL_DEBUG\n        value: INFO\n      - name: PYTORCH_CUDA_ALLOC_CONF\n        value: max_split_size_mb:512\n    # \u8BAD\u7EC3\u8282\u70B9\u6570\u91CF\n    numNodes: 4\n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8D44\u6E90\u914D\u7F6E\n    resourcesPerNode:\n      requests:\n        cpu: "4"\n        memory: 16Gi\n        nvidia.com/gpu: "1"\n      limits:\n        cpu: "8"\n        memory: 32Gi\n        nvidia.com/gpu: "1"\n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B/worker \u6570\u91CF\n    # \u5BF9\u4E8E PyTorch\uFF1A\u53EF\u4EE5\u8BBE\u7F6E\u4E3A auto\u3001cpu\u3001gpu \u6216\u6574\u6570\u503C\n    # \u5BF9\u4E8E MPI\uFF1A\u53EA\u80FD\u8BBE\u7F6E\u4E3A\u6574\u6570\u503C\n    numProcPerNode: auto\n\n  # \u5E94\u7528\u5230\u884D\u751F JobSet \u548C Jobs \u7684\u6807\u7B7E\uFF08\u53EF\u9009\uFF09\n  # \u8FD9\u4E9B\u6807\u7B7E\u4F1A\u4E0E TrainingRuntime \u4E2D\u7684\u6807\u7B7E\u5408\u5E76\n  # \u6CE8\u610F\uFF1A\u5F53\u5B58\u5728\u76F8\u540C\u952E\u65F6\uFF0CTrainJob \u4E2D\u7684\u6807\u7B7E\u503C\u4F1A\u8986\u76D6 TrainingRuntime \u4E2D\u7684\u6807\u7B7E\u503C\n  labels:\n    team: ml-team\n    project: image-classification\n\n  # \u5E94\u7528\u5230\u884D\u751F JobSet \u548C Jobs \u7684\u6CE8\u89E3\uFF08\u53EF\u9009\uFF09\n  # \u8FD9\u4E9B\u6CE8\u89E3\u4F1A\u4E0E TrainingRuntime \u4E2D\u7684\u6CE8\u89E3\u5408\u5E76\n  # \u6CE8\u610F\uFF1A\u5F53\u5B58\u5728\u76F8\u540C\u952E\u65F6\uFF0CTrainJob \u4E2D\u7684\u6CE8\u89E3\u503C\u4F1A\u8986\u76D6 TrainingRuntime \u4E2D\u7684\u6CE8\u89E3\u503C\n  annotations:\n    owner: john@example.com\n    cost-center: "1234"\n\n  # Pod \u6A21\u677F\u8986\u76D6\u914D\u7F6E\uFF0C\u7528\u4E8E\u81EA\u5B9A\u4E49\u7279\u5B9A Job \u7684 Pod \u914D\u7F6E\uFF08\u53EF\u9009\uFF09\n  podTemplateOverrides:\n    # \u53EF\u4EE5\u914D\u7F6E\u591A\u4E2A\u8986\u76D6\u89C4\u5219\uFF0C\u540E\u9762\u7684\u89C4\u5219\u4F1A\u8986\u76D6\u524D\u9762\u7684\u5B57\u6BB5\u503C\n    - targetJobs:\n        # \u76EE\u6807 Job \u540D\u79F0\u5217\u8868\n        - name: node\n      # Pod \u5143\u6570\u636E\u8986\u76D6\n      metadata:\n        labels:\n          custom-label: custom-value\n        annotations:\n          custom-annotation: custom-value\n      # Pod Spec \u8986\u76D6\n      spec:\n        # \u670D\u52A1\u8D26\u53F7\u540D\u79F0\n        serviceAccountName: training-sa\n        # \u8282\u70B9\u9009\u62E9\u5668\n        nodeSelector:\n          node-type: gpu-node\n          gpu-type: nvidia-a100\n        # \u4EB2\u548C\u6027\u914D\u7F6E\n        affinity:\n          nodeAffinity:\n            requiredDuringSchedulingIgnoredDuringExecution:\n              nodeSelectorTerms:\n                - matchExpressions:\n                    - key: gpu-type\n                      operator: In\n                      values:\n                        - nvidia-a100\n                        - nvidia-v100\n          podAntiAffinity:\n            preferredDuringSchedulingIgnoredDuringExecution:\n              - weight: 100\n                podAffinityTerm:\n                  labelSelector:\n                    matchExpressions:\n                      - key: app\n                        operator: In\n                        values:\n                          - training\n                  topologyKey: kubernetes.io/hostname\n        # \u5BB9\u5FCD\u5EA6\u914D\u7F6E\n        tolerations:\n          - key: nvidia.com/gpu\n            operator: Exists\n            effect: NoSchedule\n          - key: training-workload\n            operator: Equal\n            value: "true"\n            effect: NoSchedule\n        # \u5377\u914D\u7F6E\n        volumes:\n          - name: workspace\n            persistentVolumeClaim:\n              claimName: training-workspace-pvc\n          - name: shared-memory\n            emptyDir:\n              medium: Memory\n              sizeLimit: 8Gi\n        # \u521D\u59CB\u5316\u5BB9\u5668\u8986\u76D6\n        initContainers:\n          - name: setup\n            env:\n              - name: SETUP_MODE\n                value: distributed\n            volumeMounts:\n              - name: workspace\n                mountPath: /workspace\n        # \u5BB9\u5668\u8986\u76D6\n        containers:\n          - name: node\n            env:\n              - name: CUSTOM_ENV\n                value: custom-value\n            volumeMounts:\n              - name: workspace\n                mountPath: /workspace\n              - name: shared-memory\n                mountPath: /dev/shm\n        # \u8C03\u5EA6\u95E8\u63A7\uFF08\u7528\u4E8E Pod \u8C03\u5EA6\u5C31\u7EEA\u6027\u63A7\u5236\uFF09\n        schedulingGates:\n          - name: custom-gate\n        # \u955C\u50CF\u62C9\u53D6 Secret\n        imagePullSecrets:\n          - name: docker-registry-secret\n\n  # \u662F\u5426\u6682\u505C\u8FD0\u884C\u4E2D\u7684 TrainJob\uFF08\u53EF\u9009\uFF09\n  # \u9ED8\u8BA4\u4E3A false\n  suspend: false\n\n  # \u7BA1\u7406\u8005\u6807\u8BC6\uFF0C\u6307\u793A\u7531\u54EA\u4E2A\u63A7\u5236\u5668\u6216\u5B9E\u4F53\u7BA1\u7406\u6B64 TrainJob\uFF08\u53EF\u9009\uFF09\n  # \u53EF\u9009\u503C\uFF1A\n  # - trainer.kubeflow.org/trainjob-controller\uFF08\u9ED8\u8BA4\uFF0C\u7531\u5185\u7F6E\u63A7\u5236\u5668\u7BA1\u7406\uFF09\n  # - kueue.x-k8s.io/multikueue\uFF08\u59D4\u6258\u7ED9 Kueue \u7BA1\u7406\uFF09\n  # \u6B64\u5B57\u6BB5\u4E0D\u53EF\u53D8\n  managedBy: trainer.kubeflow.org/trainjob-controller\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E",children:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E"}),"\n",(0,d.jsx)(e.h4,{id:"runtimeref",children:"runtimeRef"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"runtimeRef"})," \u662F\u5FC5\u586B\u5B57\u6BB5\uFF0C\u7528\u4E8E\u5F15\u7528\u8BAD\u7EC3\u8FD0\u884C\u65F6\u914D\u7F6E\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u5B57\u6BB5"}),(0,d.jsx)(e.th,{children:"\u7C7B\u578B"}),(0,d.jsx)(e.th,{children:"\u5FC5\u586B"}),(0,d.jsx)(e.th,{children:"\u9ED8\u8BA4\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"name"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"string"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["\u8FD0\u884C\u65F6\u540D\u79F0\uFF0C\u6700\u5C0F\u957F\u5EA6\u4E3A",(0,d.jsx)(e.code,{children:"1"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"apiGroup"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"string"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"trainer.kubeflow.org"})}),(0,d.jsxs)(e.td,{children:["\u8FD0\u884C\u65F6\u7684",(0,d.jsx)(e.code,{children:"API"}),"\u7EC4"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"kind"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"string"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"ClusterTrainingRuntime"})}),(0,d.jsxs)(e.td,{children:["\u8FD0\u884C\u65F6\u7C7B\u578B\uFF0C\u53EF\u9009 ",(0,d.jsx)(e.code,{children:"TrainingRuntime"})," \u6216 ",(0,d.jsx)(e.code,{children:"ClusterTrainingRuntime"})]})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"numprocpernode",children:"numProcPerNode"}),"\n",(0,d.jsxs)(e.p,{children:["\u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B/",(0,d.jsx)(e.code,{children:"worker"}),"\u6570\u91CF\u914D\u7F6E\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u6846\u67B6"}),(0,d.jsx)(e.th,{children:"\u652F\u6301\u7684\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PyTorch"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"auto"}),"\u3001",(0,d.jsx)(e.code,{children:"cpu"}),"\u3001",(0,d.jsx)(e.code,{children:"gpu"}),"\u3001\u6574\u6570"]}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"auto"}),"\u8868\u793A\u81EA\u52A8\u68C0\u6D4B\uFF0C",(0,d.jsx)(e.code,{children:"cpu"}),"/",(0,d.jsx)(e.code,{children:"gpu"}),"\u8868\u793A\u4F7F\u7528\u6240\u6709 ",(0,d.jsx)(e.code,{children:"CPU"}),"/",(0,d.jsx)(e.code,{children:"GPU"}),"\uFF0C\u6574\u6570\u8868\u793A\u5177\u4F53\u8FDB\u7A0B\u6570"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MPI"})}),(0,d.jsx)(e.td,{children:"\u6574\u6570"}),(0,d.jsx)(e.td,{children:"\u53EA\u80FD\u8BBE\u7F6E\u5177\u4F53\u7684\u6574\u6570\u503C"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DeepSpeed"})}),(0,d.jsx)(e.td,{children:"\u6574\u6570"}),(0,d.jsx)(e.td,{children:"\u53EA\u80FD\u8BBE\u7F6E\u5177\u4F53\u7684\u6574\u6570\u503C"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"managedby",children:"managedBy"}),"\n",(0,d.jsxs)(e.p,{children:["\u63A7\u5236",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u7684\u7BA1\u7406\u8005\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"trainer.kubeflow.org/trainjob-controller"})}),(0,d.jsxs)(e.td,{children:["\u7531\u5185\u7F6E\u7684 ",(0,d.jsx)(e.code,{children:"TrainJob"})," \u63A7\u5236\u5668\u7BA1\u7406\uFF08\u9ED8\u8BA4\uFF09"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"kueue.x-k8s.io/multikueue"})}),(0,d.jsx)(e.td,{children:"\u59D4\u6258\u7ED9 Kueue \u8FDB\u884C\u7BA1\u7406\uFF0C\u652F\u6301\u591A\u96C6\u7FA4\u8C03\u5EA6"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"initializer\u521D\u59CB\u5316\u5668",children:"initializer\uFF08\u521D\u59CB\u5316\u5668\uFF09"}),"\n",(0,d.jsx)(e.p,{children:"\u521D\u59CB\u5316\u5668\u7528\u4E8E\u5728\u8BAD\u7EC3\u5F00\u59CB\u524D\u81EA\u52A8\u5B8C\u6210\u6570\u636E\u96C6\u548C\u9884\u8BAD\u7EC3\u6A21\u578B\u7684\u51C6\u5907\u5DE5\u4F5C\uFF0C\u6781\u5927\u7B80\u5316\u4E86\u8BAD\u7EC3\u4EFB\u52A1\u7684\u914D\u7F6E\u548C\u7BA1\u7406\u3002"}),"\n",(0,d.jsx)(e.h5,{id:"dataset\u6570\u636E\u96C6\u521D\u59CB\u5316\u5668",children:"dataset\uFF08\u6570\u636E\u96C6\u521D\u59CB\u5316\u5668\uFF09"}),"\n",(0,d.jsx)(e.p,{children:"\u6570\u636E\u96C6\u521D\u59CB\u5316\u5668\u7684\u4F5C\u7528\uFF1A"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u81EA\u52A8\u4E0B\u8F7D\u6570\u636E\u96C6"}),"\uFF1A\u4ECE\u5404\u79CD\u5B58\u50A8\u6E90\uFF08",(0,d.jsx)(e.code,{children:"S3"}),"\u3001",(0,d.jsx)(e.code,{children:"GCS"}),"\u3001",(0,d.jsx)(e.code,{children:"Hugging Face"}),"\u3001",(0,d.jsx)(e.code,{children:"PVC"})," \u7B49\uFF09\u81EA\u52A8\u4E0B\u8F7D\u8BAD\u7EC3\u6240\u9700\u7684\u6570\u636E\u96C6"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6570\u636E\u9884\u5904\u7406"}),"\uFF1A\u53EF\u4EE5\u5728\u521D\u59CB\u5316\u9636\u6BB5\u5BF9\u6570\u636E\u8FDB\u884C\u9884\u5904\u7406\u548C\u683C\u5F0F\u8F6C\u6362"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6570\u636E\u6301\u4E45\u5316"}),"\uFF1A\u5C06\u4E0B\u8F7D\u7684\u6570\u636E\u96C6\u5B58\u50A8\u5230\u5171\u4EAB\u5377\u4E2D\uFF0C\u4F9B\u6240\u6709\u8BAD\u7EC3\u8282\u70B9\u8BBF\u95EE"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u51ED\u8BC1\u7BA1\u7406"}),"\uFF1A\u901A\u8FC7",(0,d.jsx)(e.code,{children:"secretRef"}),"\u5B89\u5168\u5730\u7BA1\u7406\u8BBF\u95EE\u79C1\u6709\u6570\u636E\u96C6\u6240\u9700\u7684\u51ED\u8BC1"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u914D\u7F6E\u793A\u4F8B\uFF1A"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"initializer:\n  dataset:\n    # \u6570\u636E\u96C6 URI\uFF0C\u652F\u6301\u591A\u79CD\u534F\u8BAE\uFF1A\n    # - s3://bucket/path\uFF08AWS S3\uFF09\n    # - gs://bucket/path\uFF08Google Cloud Storage\uFF09\n    # - hf://dataset-name\uFF08Hugging Face\uFF09\n    # - pvc://pvc-name/path\uFF08Kubernetes PVC\uFF09\n    storageUri: s3://my-bucket/datasets/imagenet\n    env:\n      - name: AWS_REGION\n        value: us-west-2\n    secretRef:\n      name: s3-credentials  # \u5305\u542B AWS_ACCESS_KEY_ID \u548C AWS_SECRET_ACCESS_KEY\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u6570\u636E\u96C6\u521D\u59CB\u5316\u5B8C\u6210\u540E\uFF0C\u6570\u636E\u4F1A\u88AB\u6302\u8F7D\u5230\u8BAD\u7EC3\u5BB9\u5668\u7684",(0,d.jsx)(e.code,{children:"/workspace/dataset"}),"\u8DEF\u5F84\u3002"]}),"\n",(0,d.jsx)(e.h5,{id:"model\u6A21\u578B\u521D\u59CB\u5316\u5668",children:"model\uFF08\u6A21\u578B\u521D\u59CB\u5316\u5668\uFF09"}),"\n",(0,d.jsx)(e.p,{children:"\u6A21\u578B\u521D\u59CB\u5316\u5668\u7684\u4F5C\u7528\uFF1A"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u81EA\u52A8\u4E0B\u8F7D\u9884\u8BAD\u7EC3\u6A21\u578B"}),"\uFF1A\u4ECE\u6A21\u578B\u4ED3\u5E93\u4E0B\u8F7D\u9884\u8BAD\u7EC3\u6A21\u578B\u6743\u91CD"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6A21\u578B\u683C\u5F0F\u8F6C\u6362"}),"\uFF1A\u652F\u6301\u4E0D\u540C\u6846\u67B6\u95F4\u7684\u6A21\u578B\u683C\u5F0F\u8F6C\u6362"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6A21\u578B\u6301\u4E45\u5316"}),"\uFF1A\u5C06\u6A21\u578B\u6587\u4EF6\u5B58\u50A8\u5230\u5171\u4EAB\u5377\u4E2D"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7248\u672C\u7BA1\u7406"}),"\uFF1A\u53EF\u4EE5\u901A\u8FC7\u73AF\u5883\u53D8\u91CF\u6307\u5B9A\u5177\u4F53\u7684\u6A21\u578B\u7248\u672C"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u914D\u7F6E\u793A\u4F8B\uFF1A"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"initializer:\n  model:\n    # \u9884\u8BAD\u7EC3\u6A21\u578B URI\n    storageUri: hf://meta-llama/Llama-2-7b-hf\n    env:\n      - name: MODEL_VERSION\n        value: v1.0\n      - name: HUGGING_FACE_TOKEN\n        valueFrom:\n          secretKeyRef:\n            name: hf-token\n            key: token\n    secretRef:\n      name: hf-credentials\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u6A21\u578B\u521D\u59CB\u5316\u5B8C\u6210\u540E\uFF0C\u6A21\u578B\u6587\u4EF6\u4F1A\u88AB\u6302\u8F7D\u5230\u8BAD\u7EC3\u5BB9\u5668\u7684",(0,d.jsx)(e.code,{children:"/workspace/model"}),"\u8DEF\u5F84\u3002"]}),"\n",(0,d.jsx)(e.h5,{id:"\u521D\u59CB\u5316\u5668\u7684\u6267\u884C\u6D41\u7A0B",children:"\u521D\u59CB\u5316\u5668\u7684\u6267\u884C\u6D41\u7A0B"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"dataset-initializer Job"}),"\u9996\u5148\u542F\u52A8\uFF0C\u4E0B\u8F7D\u5E76\u51C6\u5907\u6570\u636E\u96C6"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"model-initializer Job"}),"\u968F\u540E\u542F\u52A8\uFF0C\u4E0B\u8F7D\u5E76\u51C6\u5907\u9884\u8BAD\u7EC3\u6A21\u578B"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4E24\u4E2A\u521D\u59CB\u5316",(0,d.jsx)(e.code,{children:"Job"}),"\u90FD\u6210\u529F\u5B8C\u6210\u540E\uFF0C",(0,d.jsx)(e.code,{children:"trainer Job"}),"\u624D\u4F1A\u542F\u52A8"]}),"\n",(0,d.jsxs)(e.li,{children:["\u8BAD\u7EC3\u5BB9\u5668\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE",(0,d.jsx)(e.code,{children:"/workspace/dataset"}),"\u548C",(0,d.jsx)(e.code,{children:"/workspace/model"}),"\u8DEF\u5F84\u4E0B\u7684\u6570\u636E\u548C\u6A21\u578B"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u8FD9\u79CD\u673A\u5236\u786E\u4FDD\u4E86\u8BAD\u7EC3\u4EFB\u52A1\u542F\u52A8\u65F6\u6240\u6709\u5FC5\u9700\u7684\u8D44\u6E90\u90FD\u5DF2\u5C31\u7EEA\uFF0C\u907F\u514D\u4E86\u8BAD\u7EC3\u8FC7\u7A0B\u4E2D\u7684\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"status-conditions",children:"Status Conditions"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"Type"}),(0,d.jsx)(e.th,{children:"Reason"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Suspended"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Suspended"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TrainJob"})," \u88AB\u6682\u505C"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Suspended"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Resumed"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TrainJob"})," \u4ECE\u6682\u505C\u72B6\u6001\u6062\u590D"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Failed"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"TrainingRuntimeNotSupported"})}),(0,d.jsxs)(e.td,{children:["\u5F15\u7528\u7684",(0,d.jsx)(e.code,{children:"TrainingRuntime"}),"\u4E0D\u53D7\u652F\u6301"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Complete"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"JobsCompleted"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TrainJob"})," \u6210\u529F\u5B8C\u6210"]})]})]})]}),"\n",(0,d.jsx)(e.h2,{id:"trainingruntime",children:"TrainingRuntime"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"TrainingRuntime"}),"\u662F\u547D\u540D\u7A7A\u95F4\u7EA7\u522B\u7684\u8BAD\u7EC3\u8FD0\u884C\u65F6\u6A21\u677F\uFF0C\u5B9A\u4E49\u4E86\u7279\u5B9A",(0,d.jsx)(e.code,{children:"ML"}),"\u6846\u67B6\u7684\u6267\u884C\u73AF\u5883\u3002\u5B83\u53EA\u80FD\u88AB\u540C\u4E00\u547D\u540D\u7A7A\u95F4\u4E2D\u7684",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u5F15\u7528\u3002"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B-1",children:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: TrainingRuntime\nmetadata:\n  # TrainingRuntime \u7684\u540D\u79F0\n  name: pytorch-distributed\n  # TrainingRuntime \u6240\u5728\u7684\u547D\u540D\u7A7A\u95F4\n  namespace: kubeflow\n  # \u6807\u7B7E\uFF0C\u901A\u5E38\u6807\u8BC6\u6846\u67B6\u7C7B\u578B\n  labels:\n    trainer.kubeflow.org/framework: pytorch\n    environment: production\nspec:\n  # ML \u7B56\u7565\u914D\u7F6E\uFF0C\u63D0\u4F9BML\u7279\u5B9A\u7684\u53C2\u6570\uFF08\u53EF\u9009\uFF09\n  mlPolicy:\n    # \u8BAD\u7EC3\u8282\u70B9\u6570\u91CF\uFF0C\u9ED8\u8BA4\u4E3A1\n    numNodes: 2\n    \n    # PyTorch\u8FD0\u884C\u65F6\u914D\u7F6E\n    torch:\n      # \u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B\u6570\u91CF\n      # \u652F\u6301\u7684\u503C\uFF1Aauto\uFF08\u81EA\u52A8\u68C0\u6D4B\uFF09\u3001cpu\uFF08CPU\u6570\u91CF\uFF09\u3001gpu\uFF08GPU\u6570\u91CF\uFF09\u6216\u6574\u6570\u503C\n      # \u9ED8\u8BA4\u4E3A auto\n      numProcPerNode: auto\n      \n      # PyTorch \u5F39\u6027\u8BAD\u7EC3\u7B56\u7565\uFF08\u53EF\u9009\uFF09\n      # \u6CE8\u610F\uFF1A\u5982\u679C\u914D\u7F6E\u4E86 elasticPolicy\uFF0C\u5219\u4E0D\u80FD\u540C\u65F6\u8BBE\u7F6E mlPolicy.numNodes\n      elasticPolicy:\n        # \u8BAD\u7EC3\u4EFB\u52A1\u53EF\u4EE5\u91CD\u542F\u7684\u6700\u5927\u6B21\u6570\n        # \u6B64\u503C\u4F1A\u63D2\u5165\u5230 torchrun \u7684 --max-restarts \u53C2\u6570\u4E2D\n        maxRestarts: 3\n        # \u53EF\u4EE5\u7F29\u51CF\u5230\u7684\u6700\u5C0F\u8282\u70B9\u6570\n        minNodes: 1\n        # \u53EF\u4EE5\u6269\u5C55\u5230\u7684\u6700\u5927\u8282\u70B9\u6570\n        maxNodes: 4\n        # \u7528\u4E8E\u8BA1\u7B97\u671F\u671B\u8282\u70B9\u6570\u7684\u6307\u6807\n        # \u5C06\u521B\u5EFA HPA \u6765\u6267\u884C\u81EA\u52A8\u7F29\u653E\n        metrics:\n          - type: Resource\n            resource:\n              name: cpu\n              target:\n                type: Utilization\n                averageUtilization: 80\n\n  # PodGroup \u7B56\u7565\u914D\u7F6E\uFF0C\u7528\u4E8E\u542F\u7528 gang-scheduling\uFF08\u53EF\u9009\uFF09\n  podGroupPolicy:\n    # \u4F7F\u7528 Kubernetes scheduler-plugins \u7684 coscheduling \u63D2\u4EF6\n    coscheduling:\n      # gang-scheduling \u7684\u6700\u5927\u8C03\u5EA6\u8D85\u65F6\u65F6\u95F4\uFF08\u79D2\uFF09\n      # \u5982\u679C\u4E3A 0\uFF0C\u5219\u4F7F\u7528\u9ED8\u8BA4\u503C\n      # \u9ED8\u8BA4\u4E3A 60 \u79D2\n      scheduleTimeoutSeconds: 120\n    \n    # \u6216\u8005\u4F7F\u7528 Volcano gang-scheduler\n    # \u6CE8\u610F\uFF1Acoscheduling \u548C volcano \u53EA\u80FD\u914D\u7F6E\u5176\u4E2D\u4E00\u4E2A\n    # volcano:\n    #   # \u7F51\u7EDC\u62D3\u6251\u914D\u7F6E\uFF0C\u4E0E\u7F51\u7EDC\u62D3\u6251\u7279\u6027\u548C hyperNode CRD \u914D\u5408\u4F7F\u7528\n    #   networkTopology:\n    #     # \u914D\u7F6E\u5177\u4F53\u7684\u7F51\u7EDC\u62D3\u6251\u7B56\u7565\n    #     # \u8BE6\u89C1 Volcano \u6587\u6863\n\n  # JobSet \u6A21\u677F\u914D\u7F6E\n  template:\n    # JobSet \u7684\u5143\u6570\u636E\n    metadata:\n      labels:\n        runtime: pytorch\n        version: v2.7\n      annotations:\n        description: PyTorch distributed training runtime\n    \n    # JobSet \u7684\u89C4\u8303\n    spec:\n      # \u590D\u5236\u7684 Job \u5217\u8868\n      replicatedJobs:\n        # \u4E3B\u8981\u7684\u8BAD\u7EC3\u8282\u70B9 Job\n        - name: node\n          # \u8BE5 Job \u7684\u526F\u672C\u6570\u91CF\uFF08\u8282\u70B9\u6570\u91CF\uFF09\n          # \u6CE8\u610F\uFF1A\u5B9E\u9645\u7684\u526F\u672C\u6570\u4F1A\u88AB mlPolicy.numNodes \u6216 TrainJob.trainer.numNodes \u8986\u76D6\n          replicas: 1\n          \n          # Job \u6A21\u677F\n          template:\n            metadata:\n              labels:\n                # \u6B64\u6807\u7B7E\u6807\u8BC6\u8FD9\u662F\u8BAD\u7EC3\u5668\u6B65\u9AA4\n                trainer.kubeflow.org/trainjob-ancestor-step: trainer\n            spec:\n              # Job \u5B8C\u6210\u6A21\u5F0F\n              # Indexed \u8868\u793A\u6BCF\u4E2A Pod \u90FD\u6709\u552F\u4E00\u7684\u7D22\u5F15\n              completionMode: Indexed\n              \n              # Job \u7684 Pod \u6A21\u677F\n              template:\n                spec:\n                  # \u6DFB\u52A0 initContainers\n                  initContainers:\n                    # \u793A\u4F8B\uFF1A\u73AF\u5883\u51C6\u5907\n                    - name: setup-env\n                      image: busybox:latest\n                      command:\n                        - sh\n                        - -c\n                        - |\n                          echo "Setting up environment..."\n                          mkdir -p /workspace/logs\n                          echo "Setup complete"\n                      volumeMounts:\n                        - name: workspace\n                          mountPath: /workspace\n\n                  # \u5BB9\u5668\u5217\u8868\n                  containers:\n                    - name: node\n                      # \u9ED8\u8BA4\u955C\u50CF\uFF0C\u4F1A\u88AB TrainJob.trainer.image \u8986\u76D6\n                      image: pytorch/pytorch:2.7.1-cuda12.8-cudnn9-runtime\n                      # \u9ED8\u8BA4\u547D\u4EE4\uFF0C\u4F1A\u88AB TrainJob.trainer.command \u8986\u76D6\n                      command:\n                        - torchrun\n                      # \u9ED8\u8BA4\u53C2\u6570\n                      args:\n                        - --nnodes=$(TRAINER_NNODES)\n                        - --nproc_per_node=$(TRAINER_NPROC_PER_NODE)\n                        - --node_rank=$(JOB_COMPLETION_INDEX)\n                        - --rdzv_backend=c10d\n                        - --rdzv_endpoint=$(TRAINER_NODE_0_HOSTNAME):29400\n                        - --rdzv_id=$(TRAINER_JOB_ID)\n                        - /workspace/train.py\n                      # \u73AF\u5883\u53D8\u91CF\n                      env:\n                        - name: LOGLEVEL\n                          value: INFO\n                        - name: NCCL_DEBUG\n                          value: INFO\n                      # \u8D44\u6E90\u914D\u7F6E\n                      resources:\n                        requests:\n                          cpu: "2"\n                          memory: 8Gi\n                        limits:\n                          cpu: "4"\n                          memory: 16Gi\n                      # \u5377\u6302\u8F7D\n                      volumeMounts:\n                        - name: workspace\n                          mountPath: /workspace\n                  \n                  # \u5377\u5B9A\u4E49\n                  volumes:\n                    - name: workspace\n                      emptyDir: {}\n                  \n                  # \u91CD\u542F\u7B56\u7565\n                  restartPolicy: OnFailure\n      \n      # \u5931\u8D25\u7B56\u7565\n      failurePolicy:\n        # \u5141\u8BB8\u7684\u6700\u5927\u91CD\u542F\u6B21\u6570\n        maxRestarts: 3\n      \n      # \u6210\u529F\u7B56\u7565\n      successPolicy:\n        # \u64CD\u4F5C\u7B26\uFF0C\u8868\u793A\u5982\u4F55\u5224\u65AD\u6210\u529F\n        # All \u8868\u793A\u6240\u6709\u76EE\u6807 Job \u90FD\u5FC5\u987B\u6210\u529F\n        operator: All\n        # \u76EE\u6807 Job \u5217\u8868\n        targetReplicatedJobs:\n          - node\n      \n      # \u7F51\u7EDC\u914D\u7F6E\n      network:\n        # \u662F\u5426\u53D1\u5E03\u672A\u5C31\u7EEA\u7684\u5730\u5740\n        # \u5BF9\u4E8E\u5206\u5E03\u5F0F\u8BAD\u7EC3\uFF0C\u901A\u5E38\u8BBE\u7F6E\u4E3A true\n        publishNotReadyAddresses: true\n        # \u662F\u5426\u542F\u7528 DNS \u4E3B\u673A\u540D\n        enableDNSHostnames: true\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E-1",children:"\u91CD\u8981\u5B57\u6BB5\u8BF4\u660E"}),"\n",(0,d.jsx)(e.h4,{id:"mlpolicy",children:"mlPolicy"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"ML"}),"\u7B56\u7565\u914D\u7F6E\u7684\u4E92\u65A5\u89C4\u5219\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u914D\u7F6E"}),(0,d.jsx)(e.th,{children:"\u4E92\u65A5\u89C4\u5219"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"numNodes"})}),(0,d.jsxs)(e.td,{children:["\u4E0D\u80FD\u4E0E ",(0,d.jsx)(e.code,{children:"torch.elasticPolicy"})," \u540C\u65F6\u4F7F\u7528"]}),(0,d.jsxs)(e.td,{children:["\u5F39\u6027\u8BAD\u7EC3\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"minNodes"}),"/",(0,d.jsx)(e.code,{children:"maxNodes"})," \u4EE3\u66FF\u56FA\u5B9A\u8282\u70B9\u6570"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"torch"})}),(0,d.jsxs)(e.td,{children:["\u4E0D\u80FD\u4E0E ",(0,d.jsx)(e.code,{children:"mpi"})," \u540C\u65F6\u4F7F\u7528"]}),(0,d.jsx)(e.td,{children:"\u53EA\u80FD\u914D\u7F6E\u4E00\u79CD\u8FD0\u884C\u65F6\u7B56\u7565"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"mpi"})}),(0,d.jsxs)(e.td,{children:["\u4E0D\u80FD\u4E0E ",(0,d.jsx)(e.code,{children:"torch"})," \u540C\u65F6\u4F7F\u7528"]}),(0,d.jsx)(e.td,{children:"\u53EA\u80FD\u914D\u7F6E\u4E00\u79CD\u8FD0\u884C\u65F6\u7B56\u7565"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"pytorch-\u5F39\u6027\u8BAD\u7EC3",children:"PyTorch \u5F39\u6027\u8BAD\u7EC3"}),"\n",(0,d.jsxs)(e.p,{children:["\u542F\u7528",(0,d.jsx)(e.code,{children:"PyTorch"}),"\u5F39\u6027\u8BAD\u7EC3\u65F6\u7684\u5173\u952E\u914D\u7F6E\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u5B57\u6BB5"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"maxRestarts"})}),(0,d.jsxs)(e.td,{children:["\u63D2\u5165\u5230 ",(0,d.jsx)(e.code,{children:"torchrun"})," \u7684 ",(0,d.jsx)(e.code,{children:"--max-restarts"})," \u53C2\u6570\u548C",(0,d.jsx)(e.code,{children:"Job"}),"\u7684 ",(0,d.jsx)(e.code,{children:".spec.failurePolicy.maxRestarts"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"minNodes"})}),(0,d.jsxs)(e.td,{children:["\u63D2\u5165\u5230 ",(0,d.jsx)(e.code,{children:"torchrun"})," \u7684 ",(0,d.jsx)(e.code,{children:"--nnodes"})," \u53C2\u6570\u7684\u6700\u5C0F\u503C"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"maxNodes"})}),(0,d.jsxs)(e.td,{children:["\u63D2\u5165\u5230 ",(0,d.jsx)(e.code,{children:"torchrun"})," \u7684 ",(0,d.jsx)(e.code,{children:"--nnodes"})," \u53C2\u6570\u7684\u6700\u5927\u503C"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"metrics"})}),(0,d.jsxs)(e.td,{children:["\u7528\u4E8E\u521B\u5EFA",(0,d.jsx)(e.code,{children:"HPA\uFF08Horizontal Pod Autoscaler\uFF09"}),"\u8FDB\u884C\u81EA\u52A8\u7F29\u653E"]})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"mpi-\u5B9E\u73B0\u7C7B\u578B",children:"MPI \u5B9E\u73B0\u7C7B\u578B"}),"\n",(0,d.jsxs)(e.p,{children:["\u652F\u6301\u7684",(0,d.jsx)(e.code,{children:"MPI"}),"\u5B9E\u73B0\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u7C7B\u578B"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"OpenMPI"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"Open MPI"})," \u5B9E\u73B0\uFF08\u9ED8\u8BA4\uFF09"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"Intel"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"Intel MPI"})," \u5B9E\u73B0"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MPICH"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"MPICH"})," \u5B9E\u73B0"]})]})]})]}),"\n",(0,d.jsx)(e.h3,{id:"\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3",children:"\u7279\u6B8A\u6807\u7B7E\u548C\u6CE8\u89E3"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u4F7F\u7528\u4E00\u4E9B\u7279\u6B8A\u7684\u6807\u7B7E\u548C\u6CE8\u89E3\u6765\u63A7\u5236\u8BAD\u7EC3\u4EFB\u52A1\u7684\u884C\u4E3A\u548C\u6807\u8BC6\u8D44\u6E90\u5173\u7CFB\u3002"]}),"\n",(0,d.jsx)(e.h4,{id:"\u7CFB\u7EDF\u9884\u7559\u6807\u7B7E",children:"\u7CFB\u7EDF\u9884\u7559\u6807\u7B7E"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u6807\u7B7E\u952E"}),(0,d.jsx)(e.th,{children:"\u53EF\u80FD\u7684\u503C"}),(0,d.jsx)(e.th,{children:"\u7528\u9014"}),(0,d.jsx)(e.th,{children:"\u5E94\u7528\u4F4D\u7F6E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"trainer.kubeflow.org/trainjob-ancestor-step"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"dataset-initializer"}),(0,d.jsx)("br",{}),(0,d.jsx)(e.code,{children:"model-initializer"}),(0,d.jsx)("br",{}),(0,d.jsx)(e.code,{children:"trainer"})]}),(0,d.jsxs)(e.td,{children:["\u6807\u8BC6",(0,d.jsx)(e.code,{children:"Pod"}),"\u6A21\u677F\u5728\u8BAD\u7EC3\u6D41\u7A0B\u4E2D\u7684\u89D2\u8272\uFF0C\u7528\u4E8E\u5173\u8054",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u7684\u4E0D\u540C\u914D\u7F6E\u9879\u4E0E",(0,d.jsx)(e.code,{children:"Runtime"}),"\u4E2D\u7684",(0,d.jsx)(e.code,{children:"Job"}),"\u6A21\u677F"]}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TrainingRuntime/ClusterTrainingRuntime"}),"\u7684",(0,d.jsx)(e.code,{children:"replicatedJobs[].template.labels"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"trainer.kubeflow.org/framework"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"torch"}),(0,d.jsx)("br",{}),(0,d.jsx)(e.code,{children:"deepspeed"}),(0,d.jsx)("br",{}),(0,d.jsx)(e.code,{children:"mpi"}),(0,d.jsx)("br",{}),(0,d.jsx)(e.code,{children:"mlx"}),(0,d.jsx)("br",{}),(0,d.jsx)(e.code,{children:"torchtune"})]}),(0,d.jsxs)(e.td,{children:["\u6807\u8BC6 ",(0,d.jsx)(e.code,{children:"Runtime"})," \u652F\u6301\u7684\u8BAD\u7EC3\u6846\u67B6\u7C7B\u578B"]}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TrainingRuntime/ClusterTrainingRuntime"})," \u7684 ",(0,d.jsx)(e.code,{children:"metadata.labels"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"trainer.kubeflow.org/support"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"deprecated"})}),(0,d.jsxs)(e.td,{children:["\u6807\u8BC6",(0,d.jsx)(e.code,{children:"Runtime"}),"\u7684\u652F\u6301\u72B6\u6001\uFF0C\u5F53\u503C\u4E3A ",(0,d.jsx)(e.code,{children:"deprecated"})," \u65F6\u4F1A\u5728\u521B\u5EFA ",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u65F6\u53D1\u51FA\u8B66\u544A"]}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TrainingRuntime/ClusterTrainingRuntime"})," \u7684 ",(0,d.jsx)(e.code,{children:"metadata.labels"})]})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"\u6807\u7B7E\u4F7F\u7528\u8BF4\u660E",children:"\u6807\u7B7E\u4F7F\u7528\u8BF4\u660E"}),"\n",(0,d.jsx)(e.h5,{id:"trainerkubefloworgtrainjob-ancestor-step",children:"trainer.kubeflow.org/trainjob-ancestor-step"}),"\n",(0,d.jsxs)(e.p,{children:["\u8FD9\u662F\u6700\u91CD\u8981\u7684\u7CFB\u7EDF\u6807\u7B7E\uFF0C\u7528\u4E8E\u5EFA\u7ACB",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u914D\u7F6E\u4E0E",(0,d.jsx)(e.code,{children:"Runtime"}),"\u4E2D",(0,d.jsx)(e.code,{children:"Job"}),"\u6A21\u677F\u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"dataset-initializer"}),"\uFF1A\u5E26\u6709\u6B64\u6807\u7B7E\u7684",(0,d.jsx)(e.code,{children:"Job"}),"\u6A21\u677F\u4F1A\u88AB",(0,d.jsx)(e.code,{children:"TrainJob.spec.initializer.dataset"}),"\u914D\u7F6E\u8986\u76D6"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"model-initializer"}),"\uFF1A\u5E26\u6709\u6B64\u6807\u7B7E\u7684",(0,d.jsx)(e.code,{children:"Job"}),"\u6A21\u677F\u4F1A\u88AB",(0,d.jsx)(e.code,{children:"TrainJob.spec.initializer.model"}),"\u914D\u7F6E\u8986\u76D6"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"trainer"}),"\uFF1A\u5E26\u6709\u6B64\u6807\u7B7E\u7684",(0,d.jsx)(e.code,{children:"Job"}),"\u6A21\u677F\u4F1A\u88AB",(0,d.jsx)(e.code,{children:"TrainJob.spec.trainer"}),"\u914D\u7F6E\u8986\u76D6"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u662F\u5426\u5FC5\u987B\u914D\u7F6E\uFF1A"})}),"\n",(0,d.jsxs)(e.p,{children:["\u8BE5\u6807\u7B7E\u5728",(0,d.jsx)(e.code,{children:"TrainingRuntime/ClusterTrainingRuntime"}),"\u7684",(0,d.jsx)(e.code,{children:"replicatedJobs"}),"\u4E2D",(0,d.jsx)(e.strong,{children:"\u4E0D\u662F\u5F3A\u5236\u8981\u6C42"}),"\u7684\uFF0C\u4F46\u901A\u5E38\u5E94\u8BE5\u8981\u914D\u7F6E\uFF0C\u4F46\u5177\u6709\u4EE5\u4E0B\u91CD\u8981\u4F5C\u7528\uFF1A"]}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u4E0D\u914D\u7F6E\u8BE5\u6807\u7B7E"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u8BE5",(0,d.jsx)(e.code,{children:"Job"}),"\u6A21\u677F\u5C06\u4E0D\u4F1A\u88AB",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u7684\u4EFB\u4F55\u914D\u7F6E\u9879\u8986\u76D6"]}),"\n",(0,d.jsxs)(e.li,{children:["\u9002\u7528\u4E8E\u8F85\u52A9\u6027\u7684",(0,d.jsx)(e.code,{children:"Job"}),"\uFF08\u5982\u65E5\u5FD7\u6536\u96C6\u3001\u76D1\u63A7\u7B49\uFF09\uFF0C\u8FD9\u4E9B",(0,d.jsx)(e.code,{children:"Job"}),"\u4E0D\u9700\u8981",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u7EA7\u522B\u7684\u5B9A\u5236"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"Job"}),"\u5C06\u5B8C\u5168\u6309\u7167",(0,d.jsx)(e.code,{children:"Runtime"}),"\u4E2D\u5B9A\u4E49\u7684\u914D\u7F6E\u8FD0\u884C"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsxs)(e.strong,{children:["\u914D\u7F6E ",(0,d.jsx)(e.code,{children:"trainer"})," \u503C"]}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5F3A\u70C8\u63A8\u8350"}),"\u4E3A\u4E3B\u8BAD\u7EC3\u8282\u70B9\u914D\u7F6E\u6B64\u6807\u7B7E"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5141\u8BB8\u7528\u6237\u901A\u8FC7",(0,d.jsx)(e.code,{children:"TrainJob.spec.trainer"}),"\u5B9A\u5236\u8BAD\u7EC3\u955C\u50CF\u3001\u547D\u4EE4\u3001\u53C2\u6570\u3001\u8D44\u6E90\u7B49"]}),"\n",(0,d.jsxs)(e.li,{children:["\u63D0\u4F9B\u4E86\u8BAD\u7EC3\u4EFB\u52A1\u7EA7\u522B\u7684\u7075\u6D3B\u6027\uFF0C\u662F",(0,d.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u7684\u6838\u5FC3\u529F\u80FD\u4E4B\u4E00"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4E0D\u914D\u7F6E\u6B64\u6807\u7B7E\u610F\u5473\u7740\u653E\u5F03\u4E86",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u7EA7\u522B\u7684\u8BAD\u7EC3\u914D\u7F6E\u80FD\u529B"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u914D\u7F6E\u521D\u59CB\u5316\u5668\u6807\u7B7E"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u9700\u8981\u6570\u636E\u96C6/\u6A21\u578B\u521D\u59CB\u5316\u529F\u80FD\uFF0C\u5FC5\u987B\u4E3A\u5BF9\u5E94\u7684",(0,d.jsx)(e.code,{children:"Job"}),"\u914D\u7F6E\u76F8\u5E94\u7684\u6807\u7B7E"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4E0D\u914D\u7F6E\u5219\u65E0\u6CD5\u4F7F\u7528",(0,d.jsx)(e.code,{children:"TrainJob.spec.initializer"}),"\u529F\u80FD"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\u793A\u4F8B\uFF1A"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"# \u63A8\u8350\u7684\u914D\u7F6E\u65B9\u5F0F\nspec:\n  template:\n    spec:\n      replicatedJobs:\n        # \u53EF\u9009\uFF1A\u6570\u636E\u96C6\u521D\u59CB\u5316 Job\n        - name: dataset-initializer\n          template:\n            metadata:\n              labels:\n                trainer.kubeflow.org/trainjob-ancestor-step: dataset-initializer\n        \n        # \u53EF\u9009\uFF1A\u6A21\u578B\u521D\u59CB\u5316 Job\n        - name: model-initializer\n          template:\n            metadata:\n              labels:\n                trainer.kubeflow.org/trainjob-ancestor-step: model-initializer\n        \n        # \u5F3A\u70C8\u63A8\u8350\uFF1A\u4E3B\u8BAD\u7EC3\u8282\u70B9\u5FC5\u987B\u914D\u7F6E\u6B64\u6807\u7B7E\n        - name: node\n          template:\n            metadata:\n              labels:\n                trainer.kubeflow.org/trainjob-ancestor-step: trainer  # \u63A8\u8350\u914D\u7F6E\n        \n        # \u53EF\u9009\uFF1A\u8F85\u52A9 Job \u53EF\u4EE5\u4E0D\u914D\u7F6E\u6B64\u6807\u7B7E\n        - name: monitoring\n          template:\n            metadata:\n              labels:\n                app: monitoring  # \u4E0D\u914D\u7F6E trainjob-ancestor-step\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u793A\u4F8B\uFF1A"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"# \u5728 TrainingRuntime \u4E2D\u5B9A\u4E49\nspec:\n  template:\n    spec:\n      replicatedJobs:\n        - name: dataset-initializer\n          template:\n            metadata:\n              labels:\n                # \u6B64\u6807\u7B7E\u6807\u8BC6\u8FD9\u662F\u6570\u636E\u96C6\u521D\u59CB\u5316\u6B65\u9AA4\n                trainer.kubeflow.org/trainjob-ancestor-step: dataset-initializer\n        - name: node\n          template:\n            metadata:\n              labels:\n                # \u6B64\u6807\u7B7E\u6807\u8BC6\u8FD9\u662F\u8BAD\u7EC3\u5668\u6B65\u9AA4\n                trainer.kubeflow.org/trainjob-ancestor-step: trainer\n"})}),"\n",(0,d.jsx)(e.h5,{id:"trainerkubefloworgframework",children:"trainer.kubeflow.org/framework"}),"\n",(0,d.jsxs)(e.p,{children:["\u7528\u4E8E\u6807\u8BC6",(0,d.jsx)(e.code,{children:"Runtime"}),"\u7684\u6846\u67B6\u7C7B\u578B\uFF0C\u4FBF\u4E8E\u7528\u6237\u7B5B\u9009\u548C\u7BA1\u7406\u3002"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6807\u7B7E\u4F5C\u7528\uFF1A"})}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8D44\u6E90\u5206\u7C7B\u548C\u7BA1\u7406"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5E2E\u52A9\u5E73\u53F0\u7BA1\u7406\u5458\u5BF9\u4E0D\u540C\u6846\u67B6\u7684",(0,d.jsx)(e.code,{children:"Runtime"}),"\u8FDB\u884C\u5206\u7C7B"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4FBF\u4E8E\u901A\u8FC7\u6807\u7B7E\u9009\u62E9\u5668\u67E5\u8BE2\u7279\u5B9A\u6846\u67B6\u7684",(0,d.jsx)(e.code,{children:"Runtime"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u652F\u6301\u5728",(0,d.jsx)(e.code,{children:"UI"}),"\u6216",(0,d.jsx)(e.code,{children:"CLI"}),"\u5DE5\u5177\u4E2D\u6309\u6846\u67B6\u7C7B\u578B\u8FC7\u6EE4\u548C\u5C55\u793A"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u7528\u6237\u4F53\u9A8C\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u7528\u6237\u53EF\u4EE5\u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"kubectl get clustertrainingruntimes -l trainer.kubeflow.org/framework=torch"})," \u5FEB\u901F\u67E5\u627E",(0,d.jsx)(e.code,{children:"PyTorch"}),"\u8BAD\u7EC3\u4EFB\u52A1\u6A21\u677F"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5728\u591A\u79DF\u6237\u73AF\u5883\u4E2D\uFF0C\u53EF\u4EE5\u57FA\u4E8E\u6846\u67B6\u7C7B\u578B\u5B9E\u73B0",(0,d.jsx)(e.code,{children:"RBAC"}),"\u6743\u9650\u63A7\u5236"]}),"\n",(0,d.jsx)(e.li,{children:"\u4FBF\u4E8E\u76D1\u63A7\u548C\u5BA1\u8BA1\u7279\u5B9A\u6846\u67B6\u7684\u4F7F\u7528\u60C5\u51B5"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u6587\u6863\u548C\u81EA\u52A8\u5316"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F5C\u4E3A",(0,d.jsx)(e.code,{children:"Runtime"}),"\u7684\u5143\u6570\u636E\uFF0C\u5E2E\u52A9\u751F\u6210\u6587\u6863\u548C\u4F7F\u7528\u6307\u5357"]}),"\n",(0,d.jsx)(e.li,{children:"\u652F\u6301\u81EA\u52A8\u5316\u5DE5\u5177\u6839\u636E\u6846\u67B6\u7C7B\u578B\u8FDB\u884C\u914D\u7F6E\u63A8\u8350"}),"\n",(0,d.jsxs)(e.li,{children:["\u4FBF\u4E8E\u96C6\u6210\u5230",(0,d.jsx)(e.code,{children:"CI/CD"}),"\u6D41\u7A0B\u4E2D\u8FDB\u884C\u6846\u67B6\u76F8\u5173\u7684\u6821\u9A8C"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u662F\u5426\u5FC5\u987B\u914D\u7F6E\uFF1A"})}),"\n",(0,d.jsxs)(e.p,{children:["\u8BE5\u6807\u7B7E",(0,d.jsx)(e.strong,{children:"\u4E0D\u662F\u5F3A\u5236\u8981\u6C42"}),"\u7684\uFF0C\u4F46",(0,d.jsx)(e.strong,{children:"\u5F3A\u70C8\u63A8\u8350"}),"\u914D\u7F6E\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u2705 ",(0,d.jsx)(e.strong,{children:"\u63A8\u8350\u914D\u7F6E"}),"\uFF1A\u53EF\u4EE5\u63D0\u4F9B\u66F4\u597D\u7684\u7528\u6237\u4F53\u9A8C\u548C\u7BA1\u7406\u4FBF\u5229\u6027"]}),"\n",(0,d.jsxs)(e.li,{children:["\u26A0\uFE0F ",(0,d.jsx)(e.strong,{children:"\u4E0D\u914D\u7F6E\u5F71\u54CD"}),"\uFF1A",(0,d.jsx)(e.code,{children:"Runtime"}),"\u529F\u80FD\u5B8C\u5168\u6B63\u5E38\uFF0C\u4F46\u4F1A\u5931\u53BB\u4E0A\u8FF0\u5206\u7C7B\u548C\u7B5B\u9009\u80FD\u529B"]}),"\n",(0,d.jsxs)(e.li,{children:["\uD83D\uDCDD ",(0,d.jsx)(e.strong,{children:"\u547D\u540D\u7EA6\u5B9A"}),"\uFF1A\u5EFA\u8BAE\u4F7F\u7528\u5B98\u65B9\u652F\u6301\u7684\u6846\u67B6\u540D\u79F0\uFF08",(0,d.jsx)(e.code,{children:"torch"}),"\u3001",(0,d.jsx)(e.code,{children:"deepspeed"}),"\u3001",(0,d.jsx)(e.code,{children:"mpi"}),"\u3001",(0,d.jsx)(e.code,{children:"mlx"}),"\u3001",(0,d.jsx)(e.code,{children:"torchtune"}),"\uFF09"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u652F\u6301\u7684\u6846\u67B6\u7C7B\u578B\uFF1A"})}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u6846\u67B6\u503C"}),(0,d.jsx)(e.th,{children:"\u5BF9\u5E94\u6846\u67B6"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"torch"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PyTorch"})}),(0,d.jsxs)(e.td,{children:["\u6807\u51C6 ",(0,d.jsx)(e.code,{children:"PyTorch"})," \u5206\u5E03\u5F0F\u8BAD\u7EC3"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"deepspeed"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DeepSpeed"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"Microsoft DeepSpeed"})," \u6846\u67B6"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"mpi"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MPI"})}),(0,d.jsxs)(e.td,{children:["\u57FA\u4E8E ",(0,d.jsx)(e.code,{children:"MPI"})," \u7684\u5206\u5E03\u5F0F\u8BAD\u7EC3"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"mlx"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MLX"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"Apple MLX"})," \u6846\u67B6"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"torchtune"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"TorchTune"})}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"PyTorch"})," \u5FAE\u8C03\u6846\u67B6"]})]})]})]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u4F7F\u7528\u793A\u4F8B\uFF1A"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"# \u793A\u4F8B1\uFF1APyTorch Runtime\napiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  name: torch-distributed\n  labels:\n    trainer.kubeflow.org/framework: torch  # \u6807\u8BC6\u4E3A PyTorch \u8FD0\u884C\u65F6\n\n# \u793A\u4F8B2\uFF1ADeepSpeed Runtime\napiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  name: deepspeed-distributed\n  labels:\n    trainer.kubeflow.org/framework: deepspeed  # \u6807\u8BC6\u4E3A DeepSpeed \u8FD0\u884C\u65F6\n\n# \u793A\u4F8B3\uFF1A\u67E5\u8BE2\u7279\u5B9A\u6846\u67B6\u7684 Runtime\n# kubectl get clustertrainingruntimes -l trainer.kubeflow.org/framework=torch\n"})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4E3A\u6240\u6709\u751F\u4EA7\u73AF\u5883\u7684",(0,d.jsx)(e.code,{children:"Runtime"}),"\u914D\u7F6E\u6B64\u6807\u7B7E"]}),"\n",(0,d.jsx)(e.li,{children:"\u4FDD\u6301\u6807\u7B7E\u503C\u7684\u4E00\u81F4\u6027\uFF0C\u907F\u514D\u4F7F\u7528\u81EA\u5B9A\u4E49\u503C"}),"\n",(0,d.jsx)(e.li,{children:"\u7ED3\u5408\u5176\u4ED6\u6807\u7B7E\uFF08\u5982\u7248\u672C\u3001\u73AF\u5883\uFF09\u5B9E\u73B0\u66F4\u7EC6\u7C92\u5EA6\u7684\u7BA1\u7406\uFF1A"}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"apiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  name: torch-distributed\n  labels:\n    trainer.kubeflow.org/framework: torch  # \u6807\u8BC6\u8FD9\u662F PyTorch \u8FD0\u884C\u65F6\n"})}),"\n",(0,d.jsx)(e.h5,{id:"trainerkubefloworgsupport",children:"trainer.kubeflow.org/support"}),"\n",(0,d.jsxs)(e.p,{children:["\u7528\u4E8E\u6807\u8BC6",(0,d.jsx)(e.code,{children:"Runtime"}),"\u7684\u5E9F\u5F03\u72B6\u6001\uFF1A"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"apiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  name: legacy-runtime\n  labels:\n    trainer.kubeflow.org/support: deprecated  # \u6807\u8BC6\u6B64\u8FD0\u884C\u65F6\u5DF2\u5E9F\u5F03\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5F53\u5F15\u7528\u5E26\u6709 ",(0,d.jsx)(e.code,{children:"deprecated"})," \u6807\u7B7E\u7684",(0,d.jsx)(e.code,{children:"Runtime"}),"\u65F6\uFF0C",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u521B\u5EFA\u65F6\u4F1A\u6536\u5230\u8B66\u544A\uFF0C\u63D0\u793A\u7528\u6237\u8BE5",(0,d.jsx)(e.code,{children:"Runtime"}),"\u5C06\u5728\u672A\u6765\u7248\u672C\u4E2D\u79FB\u9664\u3002\u8BE6\u89C1",(0,d.jsx)(e.a,{href:"https://www.kubeflow.org/docs/components/trainer/operator-guides/runtime/#runtime-deprecation-policy",children:"\u8FD0\u884C\u65F6\u5E9F\u5F03\u7B56\u7565"}),"\u3002"]}),"\n",(0,d.jsx)(e.h4,{id:"\u7528\u6237\u81EA\u5B9A\u4E49\u6807\u7B7E\u548C\u6CE8\u89E3",children:"\u7528\u6237\u81EA\u5B9A\u4E49\u6807\u7B7E\u548C\u6CE8\u89E3"}),"\n",(0,d.jsx)(e.p,{children:"\u9664\u4E86\u7CFB\u7EDF\u9884\u7559\u6807\u7B7E\u5916\uFF0C\u7528\u6237\u53EF\u4EE5\u5728\u4EE5\u4E0B\u4F4D\u7F6E\u6DFB\u52A0\u81EA\u5B9A\u4E49\u6807\u7B7E\u548C\u6CE8\u89E3\uFF1A"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"TrainJob.metadata.labels/annotations"}),"\uFF1A\u5E94\u7528",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u8D44\u6E90\u672C\u8EAB"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"TrainJob.spec.labels/annotations"}),"\uFF1A\u5E94\u7528\u4E8E\u884D\u751F\u7684",(0,d.jsx)(e.code,{children:"JobSet"}),"\u548C",(0,d.jsx)(e.code,{children:"Jobs"}),"\uFF0C\u4F1A\u4E0E",(0,d.jsx)(e.code,{children:"Runtime"}),"\u4E2D\u7684\u6807\u7B7E/\u6CE8\u89E3\u5408\u5E76"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"TrainJob.spec.podTemplateOverrides[].metadata.labels/annotations"}),"\uFF1A\u5E94\u7528\u4E8E\u7279\u5B9A",(0,d.jsx)(e.code,{children:"Job"}),"\u7684",(0,d.jsx)(e.code,{children:"Pod"}),"\u6A21\u677F"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u6807\u7B7E\u548C\u6CE8\u89E3\u7684\u5408\u5E76\u89C4\u5219\uFF1A"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"TrainJob"}),"\u4E2D\u5B9A\u4E49\u7684\u6807\u7B7E/\u6CE8\u89E3\u4F1A\u4E0E",(0,d.jsx)(e.code,{children:"Runtime"}),"\u4E2D\u7684\u6807\u7B7E/\u6CE8\u89E3\u5408\u5E76"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5F53\u5B58\u5728\u76F8\u540C\u7684\u952E\u65F6\uFF0C",(0,d.jsxs)(e.strong,{children:[(0,d.jsx)(e.code,{children:"TrainJob"}),"\u4E2D\u7684\u503C\u4F1A\u8986\u76D6",(0,d.jsx)(e.code,{children:"Runtime"}),"\u4E2D\u7684\u503C"]})]}),"\n",(0,d.jsxs)(e.li,{children:["\u8FD9\u79CD\u8BBE\u8BA1\u5141\u8BB8\u7528\u6237\u5728\u4E0D\u4FEE\u6539",(0,d.jsx)(e.code,{children:"Runtime"}),"\u7684\u60C5\u51B5\u4E0B\u4E3A\u7279\u5B9A\u8BAD\u7EC3\u4EFB\u52A1\u81EA\u5B9A\u4E49\u6807\u7B7E\u548C\u6CE8\u89E3"]}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"clustertrainingruntime",children:"ClusterTrainingRuntime"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"ClusterTrainingRuntime"}),"\u662F\u96C6\u7FA4\u7EA7\u522B\u7684\u8BAD\u7EC3\u8FD0\u884C\u65F6\u6A21\u677F\uFF0C\u53EF\u4EE5\u88AB\u4EFB\u4F55\u547D\u540D\u7A7A\u95F4\u4E2D\u7684",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u5F15\u7528\u3002\u5176\u914D\u7F6E\u683C\u5F0F\u4E0E",(0,d.jsx)(e.code,{children:"TrainingRuntime"}),"\u5B8C\u5168\u76F8\u540C\uFF0C\u552F\u4E00\u533A\u522B\u662F\u8D44\u6E90\u4F5C\u7528\u57DF\u3002"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B-2",children:"\u5B8C\u6574\u6A21\u677F\u793A\u4F8B"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  # ClusterTrainingRuntime \u7684\u540D\u79F0\uFF08\u96C6\u7FA4\u552F\u4E00\uFF09\n  name: torch-distributed\n  # \u6807\u7B7E\uFF0C\u6807\u8BC6\u6846\u67B6\u7C7B\u578B\n  labels:\n    trainer.kubeflow.org/framework: torch\n    version: v2.7\nspec:\n  # ML \u7B56\u7565\u914D\u7F6E\uFF08\u4E0E TrainingRuntime \u76F8\u540C\uFF09\n  mlPolicy:\n    numNodes: 1\n    torch:\n      numProcPerNode: auto\n\n  # PodGroup \u7B56\u7565\u914D\u7F6E\uFF08\u53EF\u9009\uFF09\n  podGroupPolicy:\n    # Volcano gang-scheduler \u914D\u7F6E\u793A\u4F8B\n    volcano:\n      # \u7F51\u7EDC\u62D3\u6251\u914D\u7F6E\uFF0C\u7528\u4E8E\u7F51\u7EDC\u611F\u77E5\u8C03\u5EA6\n      networkTopology:\n        # \u7F51\u7EDC\u62D3\u6251\u952E\uFF0C\u7528\u4E8E\u6807\u8BC6\u7F51\u7EDC\u57DF\n        # \u4F8B\u5982\uFF1Atopology.kubernetes.io/zone\n        topologyKey: topology.kubernetes.io/zone\n        # \u7F51\u7EDC\u7B56\u7565\uFF0C\u5B9A\u4E49 Pod \u5E94\u8BE5\u5982\u4F55\u5206\u5E03\n        # \u53EF\u9009\u503C\uFF1ABest-effort\uFF08\u5C3D\u529B\u800C\u4E3A\uFF09\u3001Strict\uFF08\u4E25\u683C\u6A21\u5F0F\uFF09\n        # Best-effort\uFF1A\u5C3D\u91CF\u5C06 Pod \u8C03\u5EA6\u5230\u540C\u4E00\u7F51\u7EDC\u57DF\uFF0C\u4F46\u4E0D\u5F3A\u5236\n        # Strict\uFF1A\u5FC5\u987B\u5C06\u6240\u6709 Pod \u8C03\u5EA6\u5230\u540C\u4E00\u7F51\u7EDC\u57DF\uFF0C\u5426\u5219\u8C03\u5EA6\u5931\u8D25\n        networkPolicy: Best-effort\n\n  # JobSet \u6A21\u677F\u914D\u7F6E\n  template:\n    metadata:\n      labels:\n        runtime-type: cluster-wide\n        framework: pytorch\n    \n    spec:\n      # \u590D\u5236\u7684 Job \u5217\u8868\n      replicatedJobs:\n        - name: node\n          replicas: 1\n          template:\n            metadata:\n              labels:\n                # \u6807\u8BC6\u8FD9\u662F\u8BAD\u7EC3\u5668\u6B65\u9AA4\n                trainer.kubeflow.org/trainjob-ancestor-step: trainer\n            spec:\n              # Job \u7684 Pod \u6A21\u677F\n              template:\n                spec:\n                  containers:\n                    - name: node\n                      # \u9ED8\u8BA4 PyTorch \u955C\u50CF\n                      image: pytorch/pytorch:2.7.1-cuda12.8-cudnn9-runtime\n                      # torchrun \u547D\u4EE4\u914D\u7F6E\n                      command:\n                        - torchrun\n                      args:\n                        - --nnodes=$(TRAINER_NNODES)\n                        - --nproc_per_node=$(TRAINER_NPROC_PER_NODE)\n                        - --node_rank=$(JOB_COMPLETION_INDEX)\n                        - --rdzv_backend=c10d\n                        - --rdzv_endpoint=$(TRAINER_NODE_0_HOSTNAME):29400\n                        - --rdzv_id=$(TRAINER_JOB_ID)\n                      # \u73AF\u5883\u53D8\u91CF\n                      env:\n                        - name: LOGLEVEL\n                          value: INFO\n                        - name: PYTHONUNBUFFERED\n                          value: "1"\n                        - name: NCCL_DEBUG\n                          value: INFO\n                        - name: TORCH_DISTRIBUTED_DEBUG\n                          value: INFO\n                      # \u8D44\u6E90\u8BF7\u6C42\u548C\u9650\u5236\n                      resources:\n                        requests:\n                          cpu: "4"\n                          memory: 16Gi\n                        limits:\n                          cpu: "8"\n                          memory: 32Gi\n                  \n                  # \u91CD\u542F\u7B56\u7565\n                  restartPolicy: OnFailure\n      \n      # \u5931\u8D25\u7B56\u7565\n      failurePolicy:\n        maxRestarts: 3\n      \n      # \u6210\u529F\u7B56\u7565\n      successPolicy:\n        operator: All\n        targetReplicatedJobs:\n          - node\n      \n      # \u7F51\u7EDC\u914D\u7F6E\n      network:\n        publishNotReadyAddresses: true\n        enableDNSHostnames: true\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u96C6\u7FA4\u7EA7\u6570\u636E\u521D\u59CB\u5316\u8FD0\u884C\u65F6\u793A\u4F8B",children:"\u96C6\u7FA4\u7EA7\u6570\u636E\u521D\u59CB\u5316\u8FD0\u884C\u65F6\u793A\u4F8B"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"apiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  name: torch-distributed-with-initializer\n  labels:\n    trainer.kubeflow.org/framework: torch\nspec:\n  mlPolicy:\n    numNodes: 1\n    torch:\n      numProcPerNode: auto\n\n  template:\n    spec:\n      replicatedJobs:\n        # \u6570\u636E\u96C6\u521D\u59CB\u5316 Job\n        - name: dataset-initializer\n          replicas: 1\n          template:\n            metadata:\n              labels:\n                trainer.kubeflow.org/trainjob-ancestor-step: dataset-initializer\n            spec:\n              template:\n                spec:\n                  containers:\n                    - name: dataset-initializer\n                      # \u6570\u636E\u96C6\u521D\u59CB\u5316\u955C\u50CF\n                      image: ghcr.io/kubeflow/trainer/storage-initializer\n                      # \u73AF\u5883\u53D8\u91CF\u4F1A\u88AB TrainJob.initializer.dataset.env \u5408\u5E76\n                      env:\n                        - name: STORAGE_TYPE\n                          value: s3\n                      # \u5377\u6302\u8F7D\n                      volumeMounts:\n                        - name: dataset\n                          mountPath: /mnt/dataset\n                  \n                  # \u5377\u5B9A\u4E49\n                  volumes:\n                    - name: dataset\n                      emptyDir: {}\n                  \n                  restartPolicy: OnFailure\n        \n        # \u6A21\u578B\u521D\u59CB\u5316 Job\n        - name: model-initializer\n          replicas: 1\n          template:\n            metadata:\n              labels:\n                trainer.kubeflow.org/trainjob-ancestor-step: model-initializer\n            spec:\n              template:\n                spec:\n                  containers:\n                    - name: model-initializer\n                      image: ghcr.io/kubeflow/trainer/storage-initializer\n                      env:\n                        - name: STORAGE_TYPE\n                          value: s3\n                      volumeMounts:\n                        - name: pretrained-model\n                          mountPath: /mnt/model\n                  \n                  volumes:\n                    - name: pretrained-model\n                      emptyDir: {}\n                  \n                  restartPolicy: OnFailure\n        \n        # \u8BAD\u7EC3\u8282\u70B9 Job\n        - name: node\n          replicas: 1\n          template:\n            metadata:\n              labels:\n                trainer.kubeflow.org/trainjob-ancestor-step: trainer\n            spec:\n              template:\n                spec:\n                  containers:\n                    - name: node\n                      image: pytorch/pytorch:2.7.1-cuda12.8-cudnn9-runtime\n                      command:\n                        - torchrun\n                      args:\n                        - --nnodes=$(TRAINER_NNODES)\n                        - --nproc_per_node=$(TRAINER_NPROC_PER_NODE)\n                        - --node_rank=$(JOB_COMPLETION_INDEX)\n                        - --rdzv_backend=c10d\n                        - --rdzv_endpoint=$(TRAINER_NODE_0_HOSTNAME):29400\n                        - --rdzv_id=$(TRAINER_JOB_ID)\n                        - /workspace/train.py\n                      # \u6302\u8F7D\u521D\u59CB\u5316\u7684\u6570\u636E\u96C6\u548C\u6A21\u578B\n                      volumeMounts:\n                        - name: dataset\n                          mountPath: /mnt/dataset\n                        - name: pretrained-model\n                          mountPath: /mnt/model\n                  \n                  volumes:\n                    - name: dataset\n                      emptyDir: {}\n                    - name: pretrained-model\n                      emptyDir: {}\n                  \n                  restartPolicy: OnFailure\n      \n      # \u6210\u529F\u7B56\u7565\uFF1A\u53EA\u8981\u8BAD\u7EC3\u8282\u70B9\u6210\u529F\u5373\u53EF\n      successPolicy:\n        operator: All\n        targetReplicatedJobs:\n          - node\n      \n      network:\n        publishNotReadyAddresses: true\n"})}),"\n",(0,d.jsx)(e.h3,{id:"trainingruntime-vs-clustertrainingruntime",children:"TrainingRuntime vs ClusterTrainingRuntime"}),"\n",(0,d.jsx)(e.p,{children:"\u4E24\u79CD\u8FD0\u884C\u65F6\u7684\u5BF9\u6BD4\uFF1A"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u7279\u6027"}),(0,d.jsx)(e.th,{children:"TrainingRuntime"}),(0,d.jsx)(e.th,{children:"ClusterTrainingRuntime"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u4F5C\u7528\u57DF"}),(0,d.jsx)(e.td,{children:"\u547D\u540D\u7A7A\u95F4\u7EA7\u522B"}),(0,d.jsx)(e.td,{children:"\u96C6\u7FA4\u7EA7\u522B"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u53EF\u89C1\u6027"}),(0,d.jsxs)(e.td,{children:["\u53EA\u80FD\u88AB\u540C\u4E00\u547D\u540D\u7A7A\u95F4\u7684",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u5F15\u7528"]}),(0,d.jsxs)(e.td,{children:["\u53EF\u4EE5\u88AB\u4EFB\u4F55\u547D\u540D\u7A7A\u95F4\u7684",(0,d.jsx)(e.code,{children:"TrainJob"}),"\u5F15\u7528"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u4F7F\u7528\u573A\u666F"}),(0,d.jsx)(e.td,{children:"\u56E2\u961F\u6216\u9879\u76EE\u7279\u5B9A\u7684\u8FD0\u884C\u65F6\u914D\u7F6E"}),(0,d.jsx)(e.td,{children:"\u8DE8\u56E2\u961F\u5171\u4EAB\u7684\u6807\u51C6\u8FD0\u884C\u65F6\u914D\u7F6E"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u6743\u9650\u8981\u6C42"}),(0,d.jsx)(e.td,{children:"\u547D\u540D\u7A7A\u95F4\u7EA7\u522B\u7684\u6743\u9650"}),(0,d.jsx)(e.td,{children:"\u96C6\u7FA4\u7EA7\u522B\u7684\u6743\u9650"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u914D\u7F6E\u683C\u5F0F"}),(0,d.jsx)(e.td,{children:"\u5B8C\u5168\u76F8\u540C"}),(0,d.jsx)(e.td,{children:"\u5B8C\u5168\u76F8\u540C"})]})]})]}),"\n",(0,d.jsx)(e.h2,{id:"\u73AF\u5883\u53D8\u91CF\u6CE8\u5165",children:"\u73AF\u5883\u53D8\u91CF\u6CE8\u5165"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u4F1A\u6839\u636E\u4F7F\u7528\u7684\u8BAD\u7EC3\u6846\u67B6\uFF0C\u4E3A\u8BAD\u7EC3\u5BB9\u5668\u81EA\u52A8\u6CE8\u5165\u76F8\u5E94\u7684\u73AF\u5883\u53D8\u91CF\u3002\u4E0D\u540C\u6846\u67B6\u4F7F\u7528\u7684\u73AF\u5883\u53D8\u91CF\u4E0D\u540C\u3002"]}),"\n",(0,d.jsx)(e.h3,{id:"pytorch\u6846\u67B6\u73AF\u5883\u53D8\u91CF",children:"PyTorch\u6846\u67B6\u73AF\u5883\u53D8\u91CF"}),"\n",(0,d.jsxs)(e.p,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"PyTorch"}),"\uFF08\u901A\u8FC7",(0,d.jsx)(e.code,{children:"torchrun"}),"\u542F\u52A8\uFF09\u65F6\uFF0C",(0,d.jsx)(e.code,{children:"Torch Plugin"}),"\u4F1A\u81EA\u52A8\u6CE8\u5165\u4EE5\u4E0B\u73AF\u5883\u53D8\u91CF\uFF1A"]}),"\n",(0,d.jsx)(e.h4,{id:"pet_\u7CFB\u5217pytorch-elastic-training",children:"PET_*\u7CFB\u5217\uFF08PyTorch Elastic Training\uFF09"}),"\n",(0,d.jsxs)(e.p,{children:["\u8FD9\u4E9B\u662F",(0,d.jsx)(e.code,{children:"torchrun"}),"\u4F7F\u7528\u7684\u6807\u51C6\u73AF\u5883\u53D8\u91CF\uFF0C\u7531",(0,d.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u81EA\u52A8\u6CE8\u5165\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u73AF\u5883\u53D8\u91CF"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"}),(0,d.jsx)(e.th,{children:"\u793A\u4F8B\u503C"}),(0,d.jsx)(e.th,{children:"\u6CE8\u5165\u6765\u6E90"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PET_NNODES"})}),(0,d.jsx)(e.td,{children:"\u8BAD\u7EC3\u8282\u70B9\u603B\u6570"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"2"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"spec.trainer.numNodes"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PET_NPROC_PER_NODE"})}),(0,d.jsx)(e.td,{children:"\u6BCF\u8282\u70B9\u8FDB\u7A0B\u6570"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"4"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"spec.mlPolicy.torch.numProcPerNode"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PET_NODE_RANK"})}),(0,d.jsx)(e.td,{children:"\u5F53\u524D\u8282\u70B9\u7F16\u53F7"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"0-1"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"JOB_COMPLETION_INDEX"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PET_MASTER_ADDR"})}),(0,d.jsx)(e.td,{children:"\u4E3B\u8282\u70B9\u5730\u5740"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"myjob-node-0-0.myjob"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"{trainjob-name}-node-0-0.{trainjob-name}"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PET_MASTER_PORT"})}),(0,d.jsx)(e.td,{children:"\u4E3B\u8282\u70B9\u7AEF\u53E3"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"29400"})}),(0,d.jsx)(e.td,{children:"\u56FA\u5B9A\u503C"})]})]})]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BF4\u660E"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"PET"}),"\u4EE3\u8868",(0,d.jsx)(e.code,{children:"PyTorch Elastic Training"}),"\uFF0C\u662F",(0,d.jsx)(e.code,{children:"torchrun"}),"\u7684\u6807\u51C6\u73AF\u5883\u53D8\u91CF\u524D\u7F00"]}),"\n",(0,d.jsxs)(e.li,{children:["\u8FD9\u4E9B\u53D8\u91CF\u5728",(0,d.jsx)(e.code,{children:"TrainingRuntime"}),"\u7684",(0,d.jsx)(e.code,{children:"command"}),"\u4E2D\u4F7F\u7528\uFF0C\u5982\uFF1A",(0,d.jsx)(e.code,{children:"torchrun --nproc_per_node=$(PET_NPROC_PER_NODE) ..."})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"PET_NODE_RANK"}),"\u901A\u8FC7",(0,d.jsx)(e.code,{children:"Kubernetes"}),"\u7684",(0,d.jsx)(e.code,{children:"fieldRef"}),"\u673A\u5236\u81EA\u52A8\u4ECE",(0,d.jsx)(e.code,{children:"JOB_COMPLETION_INDEX"}),"\u83B7\u53D6"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"\u6807\u51C6\u5206\u5E03\u5F0F\u8BAD\u7EC3\u73AF\u5883\u53D8\u91CF",children:"\u6807\u51C6\u5206\u5E03\u5F0F\u8BAD\u7EC3\u73AF\u5883\u53D8\u91CF"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.code,{children:"torchrun"}),"\u4F1A\u6839\u636E",(0,d.jsx)(e.code,{children:"PET_*"}),"\u53D8\u91CF\uFF0C\u4E3A\u6BCF\u4E2A\u8FDB\u7A0B\u8BBE\u7F6E\u4EE5\u4E0B\u6807\u51C6\u73AF\u5883\u53D8\u91CF\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u73AF\u5883\u53D8\u91CF"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"}),(0,d.jsx)(e.th,{children:"\u8BA1\u7B97\u65B9\u5F0F"}),(0,d.jsx)(e.th,{children:"\u793A\u4F8B\u503C"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"WORLD_SIZE"})}),(0,d.jsx)(e.td,{children:"\u603B\u8FDB\u7A0B\u6570"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"PET_NNODES \xd7 PET_NPROC_PER_NODE"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"8"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"RANK"})}),(0,d.jsx)(e.td,{children:"\u5168\u5C40\u8FDB\u7A0B\u7F16\u53F7"}),(0,d.jsx)(e.td,{children:"\u81EA\u52A8\u8BA1\u7B97"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"0-7"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"LOCAL_RANK"})}),(0,d.jsx)(e.td,{children:"\u672C\u5730\u8FDB\u7A0B\u7F16\u53F7"}),(0,d.jsx)(e.td,{children:"\u8282\u70B9\u5185\u8FDB\u7A0B\u7D22\u5F15"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"0-3"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MASTER_ADDR"})}),(0,d.jsx)(e.td,{children:"\u4E3B\u8282\u70B9\u5730\u5740"}),(0,d.jsxs)(e.td,{children:["\u7EE7\u627F",(0,d.jsx)(e.code,{children:"PET_MASTER_ADDR"})]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"myjob-node-0-0.myjob"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MASTER_PORT"})}),(0,d.jsx)(e.td,{children:"\u4E3B\u8282\u70B9\u7AEF\u53E3"}),(0,d.jsxs)(e.td,{children:["\u7EE7\u627F",(0,d.jsx)(e.code,{children:"PET_MASTER_PORT"})]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"29400"})})]})]})]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BF4\u660E"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u8FD9\u4E9B\u53D8\u91CF\u7531",(0,d.jsx)(e.code,{children:"torchrun"}),"\u81EA\u52A8\u8BBE\u7F6E\uFF0C\u65E0\u9700\u5728",(0,d.jsx)(e.code,{children:"TrainingRuntime"}),"\u4E2D\u914D\u7F6E"]}),"\n",(0,d.jsxs)(e.li,{children:["\u8BAD\u7EC3\u4EE3\u7801\u4E2D\u53EF\u76F4\u63A5\u4F7F\u7528",(0,d.jsx)(e.code,{children:"torch.distributed.get_rank()"}),"\u7B49",(0,d.jsx)(e.code,{children:"API"}),"\uFF0C\u6216\u901A\u8FC7",(0,d.jsx)(e.code,{children:"os.environ"}),"\u8BBF\u95EE"]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"openmpi\u6846\u67B6\u73AF\u5883\u53D8\u91CF",children:"OpenMPI\u6846\u67B6\u73AF\u5883\u53D8\u91CF"}),"\n",(0,d.jsxs)(e.p,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"OpenMPI"}),"\uFF08\u5982",(0,d.jsx)(e.code,{children:"DeepSpeed"}),"\uFF09\u65F6\uFF0C\u4F1A\u6CE8\u5165\u4EE5\u4E0B\u73AF\u5883\u53D8\u91CF\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u73AF\u5883\u53D8\u91CF"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"}),(0,d.jsx)(e.th,{children:"\u793A\u4F8B\u503C"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"OMPI_MCA_orte_default_hostfile"})}),(0,d.jsx)(e.td,{children:"\u4E3B\u673A\u5217\u8868\u6587\u4EF6\u8DEF\u5F84"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"/etc/mpi/hostfile"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"OMPI_MCA_plm_rsh_agent"})}),(0,d.jsx)(e.td,{children:"SSH\u4EE3\u7406\uFF08\u7981\u7528\uFF09"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"/usr/bin/false"})})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"OMPI_MCA_orte_keep_fqdn_hostnames"})}),(0,d.jsx)(e.td,{children:"\u4FDD\u6301\u5B8C\u6574\u4E3B\u673A\u540D"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"true"})})]})]})]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BF4\u660E"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u8FD9\u4E9B\u53D8\u91CF\u7528\u4E8E\u914D\u7F6E",(0,d.jsx)(e.code,{children:"OpenMPI"}),"\u8FD0\u884C\u65F6\u884C\u4E3A"]}),"\n",(0,d.jsxs)(e.li,{children:["\u901A\u5E38\u7531",(0,d.jsx)(e.code,{children:"ClusterTrainingRuntime"}),"\u7684\u5BB9\u5668\u6A21\u677F\u914D\u7F6E"]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u901A\u7528\u73AF\u5883\u53D8\u91CF",children:"\u901A\u7528\u73AF\u5883\u53D8\u91CF"}),"\n",(0,d.jsxs)(e.p,{children:["\u6240\u6709\u6846\u67B6\u90FD\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B",(0,d.jsx)(e.code,{children:"Kubernetes"}),"\u539F\u751F\u73AF\u5883\u53D8\u91CF\uFF1A"]}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u73AF\u5883\u53D8\u91CF"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"}),(0,d.jsx)(e.th,{children:"\u793A\u4F8B\u503C"})]})}),(0,d.jsx)(e.tbody,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"JOB_COMPLETION_INDEX"})}),(0,d.jsxs)(e.td,{children:["\u8282\u70B9\u7D22\u5F15\uFF08",(0,d.jsx)(e.code,{children:"0"}),"\u5F00\u59CB\uFF09"]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"0-1"})})]})})]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BF4\u660E"}),"\uFF1A"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u6B64\u53D8\u91CF\u6765\u81EA",(0,d.jsx)(e.code,{children:"Kubernetes Job"}),"\u7684\u7D22\u5F15\u673A\u5236\uFF0C\u8868\u793A\u5F53\u524D",(0,d.jsx)(e.code,{children:"Pod"}),"\u5728",(0,d.jsx)(e.code,{children:"Job"}),"\u4E2D\u7684\u5E8F\u53F7"]}),"\n",(0,d.jsx)(e.li,{children:"\u53EF\u7528\u4E8E\u83B7\u53D6\u8282\u70B9\u7F16\u53F7\u6216\u914D\u7F6E\u8282\u70B9\u7279\u5B9A\u884C\u4E3A"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u4F7F\u7528\u793A\u4F8B",children:"\u4F7F\u7528\u793A\u4F8B"}),"\n",(0,d.jsx)(e.h4,{id:"pytorch\u8BAD\u7EC3\u811A\u672C\u793A\u4F8B",children:"PyTorch\u8BAD\u7EC3\u811A\u672C\u793A\u4F8B"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"import os\nimport torch.distributed as dist\n\n# \u521D\u59CB\u5316\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4\uFF08torchrun\u4F1A\u81EA\u52A8\u8BBE\u7F6E\u6240\u9700\u73AF\u5883\u53D8\u91CF\uFF09\ndist.init_process_group(backend=\"nccl\")\n\n# \u83B7\u53D6\u5206\u5E03\u5F0F\u4FE1\u606F\nrank = dist.get_rank()           # \u7B49\u4EF7\u4E8E int(os.environ['RANK'])\nworld_size = dist.get_world_size()  # \u7B49\u4EF7\u4E8E int(os.environ['WORLD_SIZE'])\nlocal_rank = int(os.environ['LOCAL_RANK'])\nnode_rank = int(os.environ.get('JOB_COMPLETION_INDEX', 0))\n\nprint(f\"Node Rank: {node_rank}\")\nprint(f\"Global Rank: {rank}, World Size: {world_size}\")\nprint(f\"Local Rank: {local_rank}\")\n"})}),"\n",(0,d.jsx)(e.h4,{id:"trainingruntime-command\u914D\u7F6E\u793A\u4F8B",children:"TrainingRuntime command\u914D\u7F6E\u793A\u4F8B"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-yaml",children:"command:\n  - torchrun\n  - --nproc_per_node=$(PET_NPROC_PER_NODE) \n  - --nnodes=$(PET_NNODES)\n  - --node_rank=$(PET_NODE_RANK)\n  - --master_addr=$(PET_MASTER_ADDR)\n  - --master_port=$(PET_MASTER_PORT)\n  - /workspace/train.py\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u6700\u4F73\u5B9E\u8DF5",children:"\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u8D44\u6E90\u914D\u7F6E"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4E3A\u8BAD\u7EC3\u4EFB\u52A1\u8BBE\u7F6E\u5408\u7406\u7684\u8D44\u6E90\u8BF7\u6C42\uFF08",(0,d.jsx)(e.code,{children:"requests"}),"\uFF09\u548C\u9650\u5236\uFF08",(0,d.jsx)(e.code,{children:"limits"}),"\uFF09"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"GPU"}),"\u8D44\u6E90\u901A\u5E38\u8BBE\u7F6E\u76F8\u540C\u7684",(0,d.jsx)(e.code,{children:"requests"}),"\u548C",(0,d.jsx)(e.code,{children:"limits"})]}),"\n",(0,d.jsx)(e.li,{children:"\u4E3A\u9700\u8981\u5927\u91CF\u5185\u5B58\u7684\u64CD\u4F5C\uFF08\u5982\u6570\u636E\u52A0\u8F7D\uFF09\u9884\u7559\u8DB3\u591F\u7684\u5185\u5B58"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u5B58\u50A8\u914D\u7F6E"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"PVC"}),"\u6216\u5BF9\u8C61\u5B58\u50A8\uFF08",(0,d.jsx)(e.code,{children:"S3"}),"\u3001",(0,d.jsx)(e.code,{children:"GCS"}),"\uFF09\u6765\u6301\u4E45\u5316\u6570\u636E\u96C6\u548C\u6A21\u578B"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5BF9\u4E8E\u9700\u8981\u9AD8",(0,d.jsx)(e.code,{children:"I/O"}),"\u6027\u80FD\u7684\u573A\u666F\uFF0C\u8003\u8651\u4F7F\u7528",(0,d.jsx)(e.code,{children:"hostPath"}),"\u6216",(0,d.jsx)(e.code,{children:"local volume"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"emptyDir"}),"\uFF08",(0,d.jsx)(e.code,{children:"medium: Memory"}),"\uFF09\u4F5C\u4E3A\u5171\u4EAB\u5185\u5B58\uFF0C\u907F\u514D",(0,d.jsx)(e.code,{children:"/dev/shm"}),"\u4E0D\u8DB3"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u7F51\u7EDC\u914D\u7F6E"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u542F\u7528",(0,d.jsx)(e.code,{children:"publishNotReadyAddresses: true"}),"\u786E\u4FDD\u5206\u5E03\u5F0F\u8BAD\u7EC3\u7684\u7F51\u7EDC\u8FDE\u901A\u6027"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5BF9\u4E8E\u5927\u89C4\u6A21\u5206\u5E03\u5F0F\u8BAD\u7EC3\uFF0C\u8003\u8651\u4F7F\u7528\u9AD8\u901F\u7F51\u7EDC\uFF08\u5982",(0,d.jsx)(e.code,{children:"InfiniBand"}),"\uFF09"]}),"\n",(0,d.jsxs)(e.li,{children:["\u914D\u7F6E\u9002\u5F53\u7684\u7F51\u7EDC\u63D2\u4EF6\u548C",(0,d.jsx)(e.code,{children:"CNI"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u8C03\u5EA6\u7B56\u7565"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"gang-scheduling"}),"\uFF08",(0,d.jsx)(e.code,{children:"coscheduling"}),"\u6216",(0,d.jsx)(e.code,{children:"Volcano"}),"\uFF09\u786E\u4FDD\u6240\u6709\u8BAD\u7EC3\u8282\u70B9\u540C\u65F6\u542F\u52A8"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528\u8282\u70B9\u4EB2\u548C\u6027\u548C\u53CD\u4EB2\u548C\u6027\u63A7\u5236",(0,d.jsx)(e.code,{children:"Pod"}),"\u5206\u5E03"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5BF9\u4E8E",(0,d.jsx)(e.code,{children:"GPU"}),"\u8BAD\u7EC3\uFF0C\u4F7F\u7528\u8282\u70B9\u9009\u62E9\u5668\u786E\u4FDD",(0,d.jsx)(e.code,{children:"Pod"}),"\u8C03\u5EA6\u5230",(0,d.jsx)(e.code,{children:"GPU"}),"\u8282\u70B9"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u5BB9\u9519\u914D\u7F6E"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u8BBE\u7F6E\u5408\u7406\u7684",(0,d.jsx)(e.code,{children:"maxRestarts"}),"\u503C\uFF0C\u907F\u514D\u65E0\u9650\u91CD\u8BD5"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"checkpoint"}),"\u673A\u5236\u5B9A\u671F\u4FDD\u5B58\u8BAD\u7EC3\u72B6\u6001"]}),"\n",(0,d.jsxs)(e.li,{children:["\u914D\u7F6E\u5065\u5EB7\u68C0\u67E5\uFF08",(0,d.jsx)(e.code,{children:"readinessProbe"}),"\u3001",(0,d.jsx)(e.code,{children:"livenessProbe"}),"\uFF09"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u8FD0\u884C\u65F6\u9009\u62E9"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"ClusterTrainingRuntime"}),"\u5B9A\u4E49\u7EC4\u7EC7\u7EA7\u522B\u7684\u6807\u51C6\u8FD0\u884C\u65F6"]}),"\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528",(0,d.jsx)(e.code,{children:"TrainingRuntime"}),"\u4E3A\u7279\u5B9A\u56E2\u961F\u6216\u9879\u76EE\u5B9A\u5236\u8FD0\u884C\u65F6"]}),"\n",(0,d.jsx)(e.li,{children:"\u4FDD\u6301\u8FD0\u884C\u65F6\u914D\u7F6E\u7684\u7248\u672C\u5316\u7BA1\u7406"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"\u53C2\u8003\u8D44\u6599",children:"\u53C2\u8003\u8D44\u6599"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://www.kubeflow.org/docs/components/trainer/",children:"Kubeflow Trainer \u5B98\u65B9\u6587\u6863"})}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://github.com/kubeflow/trainer",children:"Kubeflow Trainer GitHub \u4ED3\u5E93"})}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://pytorch.org/tutorials/intermediate/ddp_tutorial.html",children:"PyTorch Distributed \u6587\u6863"})}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://volcano.sh/zh/docs/network_topology_aware_scheduling/",children:"Volcano \u7F51\u7EDC\u62D3\u6251\u8C03\u5EA6"})}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://github.com/kubernetes-sigs/jobset",children:"Kubernetes JobSet"})}),"\n"]})]})}function a(n={}){let{wrapper:e}={...(0,s.a)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(h,{...n})}):h(n)}},50065:function(n,e,r){r.d(e,{Z:function(){return c},a:function(){return l}});var i=r(67294);let d={},s=i.createContext(d);function l(n){let e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:l(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);