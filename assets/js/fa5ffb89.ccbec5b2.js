"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["8681"],{12466:function(e,n,o){o.r(n),o.d(n,{metadata:()=>c,contentTitle:()=>i,default:()=>h,assets:()=>a,toc:()=>r,frontMatter:()=>d});var c=JSON.parse('{"id":"docs/\u4E91\u539F\u751F/Volcano/Volcano\u4F7F\u7528\u793A\u4F8B","title":"Volcano\u4F7F\u7528\u793A\u4F8B","description":"\u672C\u6587\u901A\u8FC7\u5B9E\u9645\u793A\u4F8B\u5C55\u793A\u5982\u4F55\u4F7F\u7528Volcano\u8C03\u5EA6\u5668\u63A7\u5236Kubernetes\u8D44\u6E90\u4F7F\u7528\uFF0C\u5305\u62EC\u9650\u5236Deployment\u7684CPU\u4F7F\u7528\u548C\u914D\u7F6EJob\u7684\u5E76\u53D1\u6267\u884C\uFF0C\u8BE6\u7EC6\u4ECB\u7ECD\u4E86Volcano\u961F\u5217\u3001\u7B56\u7565\u548C\u4EFB\u52A1\u751F\u547D\u5468\u671F\u7BA1\u7406\u7684\u5B9E\u9645\u5E94\u7528\u3002","source":"@site/docs/docs/3000-\u4E91\u539F\u751F/2-Volcano/2000-Volcano\u4F7F\u7528\u793A\u4F8B.md","sourceDirName":"docs/3000-\u4E91\u539F\u751F/2-Volcano","slug":"/cloud-native/volcano-examples","permalink":"/cloud-native/volcano-examples","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2000,"frontMatter":{"slug":"/cloud-native/volcano-examples","title":"Volcano\u4F7F\u7528\u793A\u4F8B","hide_title":true,"keywords":["Volcano","Kubernetes","\u8C03\u5EA6\u5668","\u8D44\u6E90\u7BA1\u7406","Gang Scheduling","Queue","PodGroup","Job","Deployment","\u8D44\u6E90\u9650\u5236","\u5E76\u53D1\u63A7\u5236"],"description":"\u672C\u6587\u901A\u8FC7\u5B9E\u9645\u793A\u4F8B\u5C55\u793A\u5982\u4F55\u4F7F\u7528Volcano\u8C03\u5EA6\u5668\u63A7\u5236Kubernetes\u8D44\u6E90\u4F7F\u7528\uFF0C\u5305\u62EC\u9650\u5236Deployment\u7684CPU\u4F7F\u7528\u548C\u914D\u7F6EJob\u7684\u5E76\u53D1\u6267\u884C\uFF0C\u8BE6\u7EC6\u4ECB\u7ECD\u4E86Volcano\u961F\u5217\u3001\u7B56\u7565\u548C\u4EFB\u52A1\u751F\u547D\u5468\u671F\u7BA1\u7406\u7684\u5B9E\u9645\u5E94\u7528\u3002"},"sidebar":"mainSidebar","previous":{"title":"Volcano\u4ECB\u7ECD","permalink":"/cloud-native/volcano-introduction"},"next":{"title":"Volcano\u6CE8\u89E3\u4ECB\u7ECD","permalink":"/cloud-native/volcano-annotations"}}'),l=o("85893"),s=o("50065");let d={slug:"/cloud-native/volcano-examples",title:"Volcano\u4F7F\u7528\u793A\u4F8B",hide_title:!0,keywords:["Volcano","Kubernetes","\u8C03\u5EA6\u5668","\u8D44\u6E90\u7BA1\u7406","Gang Scheduling","Queue","PodGroup","Job","Deployment","\u8D44\u6E90\u9650\u5236","\u5E76\u53D1\u63A7\u5236"],description:"\u672C\u6587\u901A\u8FC7\u5B9E\u9645\u793A\u4F8B\u5C55\u793A\u5982\u4F55\u4F7F\u7528Volcano\u8C03\u5EA6\u5668\u63A7\u5236Kubernetes\u8D44\u6E90\u4F7F\u7528\uFF0C\u5305\u62EC\u9650\u5236Deployment\u7684CPU\u4F7F\u7528\u548C\u914D\u7F6EJob\u7684\u5E76\u53D1\u6267\u884C\uFF0C\u8BE6\u7EC6\u4ECB\u7ECD\u4E86Volcano\u961F\u5217\u3001\u7B56\u7565\u548C\u4EFB\u52A1\u751F\u547D\u5468\u671F\u7BA1\u7406\u7684\u5B9E\u9645\u5E94\u7528\u3002"},i=void 0,a={},r=[{value:"\u914D\u7F6E Deployment \u4F7F\u7528 Volcano \u63A7\u5236\u8D44\u6E90\u4F7F\u7528",id:"\u914D\u7F6E-deployment-\u4F7F\u7528-volcano-\u63A7\u5236\u8D44\u6E90\u4F7F\u7528",level:2},{value:"\u914D\u7F6EJob\u4F7F\u7528Volcano\u9650\u6D41\u5E76\u53D1\u6267\u884C",id:"\u914D\u7F6Ejob\u4F7F\u7528volcano\u9650\u6D41\u5E76\u53D1\u6267\u884C",level:2}];function t(e){let n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\u914D\u7F6E-deployment-\u4F7F\u7528-volcano-\u63A7\u5236\u8D44\u6E90\u4F7F\u7528",children:"\u914D\u7F6E Deployment \u4F7F\u7528 Volcano \u63A7\u5236\u8D44\u6E90\u4F7F\u7528"}),"\n",(0,l.jsxs)(n.p,{children:["\u8FD9\u91CC\u4E3E\u4E00\u4E2A\u793A\u4F8B\uFF0C\u9650\u5236",(0,l.jsx)(n.code,{children:"Deployment"}),"\u6700\u591A\u4EC5\u80FD\u4F7F\u7528 2 \u6838 CPU\u3002"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u521B\u5EFA\u961F\u5217"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:" apiVersion: scheduling.volcano.sh/v1beta1\n kind: Queue\n metadata:\n   name: my-node-queue\n spec:\n   weight: 1\n   reclaimable: false\n   capability:\n     cpu: 2\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u521B\u5EFA\u4E00\u4E2A\u4EC5\u6709 2 \u6838 CPU\u3001\u5E76\u4E14\u7ED1\u5B9A\u5230\u8282\u70B9\u7EC4",(0,l.jsx)(n.code,{children:"my-node-group"}),"\u7684\u961F\u5217\u3002\u8FD9\u91CC\u7684",(0,l.jsx)(n.code,{children:"weight"}),"\u8868\u793A\u96C6\u7FA4\u8D44\u6E90\u5212\u5206\u4E2D\u6240\u5360\u7684\u76F8\u5BF9\u6BD4\u91CD\uFF0C\u662F\u8F6F\u7EA6\u675F;",(0,l.jsx)(n.code,{children:"reclaimable"}),"\u8868\u793A\u662F\u5426\u5141\u8BB8\u88AB\u56DE\u6536\uFF0C\u7531",(0,l.jsx)(n.code,{children:"weight"}),"\u6765\u51B3\u5B9A;",(0,l.jsx)(n.code,{children:"capability"}),"\u8868\u793A\u961F\u5217\u7684\u8D44\u6E90\u9650\u5236\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u521B\u5EFA",(0,l.jsx)(n.code,{children:"Deployment"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:" apiVersion: apps/v1\n kind: Deployment\n metadata:\n   name: ubuntu-with-volcano\n   labels:\n     app: demo\n spec:\n   replicas: 1\n   selector:\n     matchLabels:\n       app: demo\n   template:\n     metadata:\n       labels:\n         app: demo\n     spec:\n       schedulerName: volcano\n       containers:\n         - name: demo\n           image: shaowenchen/demo-ubuntu\n           resources:\n             requests:\n               cpu: 1\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5C06",(0,l.jsx)(n.code,{children:"schedulerName"}),"\u8BBE\u7F6E\u4E3A",(0,l.jsx)(n.code,{children:"volcano\uFF0C\u8868\u793A\u4F7F\u7528``Volcano"}),"\u8C03\u5EA6\u5668\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u67E5\u770B",(0,l.jsx)(n.code,{children:"Pod"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:" $ kubectl get pods -l app=demo\n NAME                                  READY   STATUS    RESTARTS   AGE\n ubuntu-with-volcano-97c94f9fb-bfgrh   1/1     Running   0          6m24s\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u6269\u5BB9",(0,l.jsx)(n.code,{children:"Deployment"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:" $ kubectl scale deployment/ubuntu-with-volcano --replicas=3\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6B64\u65F6\uFF0C\u4E09\u4E2A Pod \u53EA\u6709\u4E24\u4E2A\u5904\u4E8E Running \u72B6\u6001\uFF0C\u56E0\u4E3A Volcano \u9650\u5236\u4E86 Deployment \u6700\u591A\u4EC5\u80FD\u4F7F\u7528 2c CPU\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:" $ kubectl get pods -l app=demo\n\n NAME                                  READY   STATUS    RESTARTS   AGE\n ubuntu-with-volcano-97c94f9fb-25nb7   1/1     Running   0          27s\n ubuntu-with-volcano-97c94f9fb-6fd64   0/1     Pending   0          27s\n ubuntu-with-volcano-97c94f9fb-bfgrh   1/1     Running   0          7m31s\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u914D\u7F6Ejob\u4F7F\u7528volcano\u9650\u6D41\u5E76\u53D1\u6267\u884C",children:"\u914D\u7F6EJob\u4F7F\u7528Volcano\u9650\u6D41\u5E76\u53D1\u6267\u884C"}),"\n",(0,l.jsxs)(n.p,{children:["\u8FD9\u91CC\u521B\u5EFA\u4E00\u4E2A",(0,l.jsx)(n.code,{children:"Job"}),"\u5E76\u4E14\u8981\u6C42\u81F3\u5C11 3 \u4E2A",(0,l.jsx)(n.code,{children:"Pod"}),"\u4E00\u8D77\u8FD0\u884C\u7684",(0,l.jsx)(n.code,{children:"Job\u3002"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u76F4\u63A5\u4F7F\u7528",(0,l.jsx)(n.code,{children:"Kubernetes batch/v1"}),"\u4E2D\u7684",(0,l.jsx)(n.code,{children:"Job"}),"\uFF0C\u914D\u7F6E",(0,l.jsx)(n.code,{children:"completions"}),"\u548C",(0,l.jsx)(n.code,{children:"parallelism"}),"\uFF0C\u4E5F\u53EF\u4EE5\u5B9E\u73B0\u8FD9\u4E2A\u9700\u6C42\u3002\u4F46",(0,l.jsx)(n.code,{children:"Volcano"}),"\u63D0\u4F9B\u7684",(0,l.jsx)(n.code,{children:"Queue"}),"\u53EF\u4EE5\u63A7\u5236\u8D44\u6E90\u4F7F\u7528\u3001",(0,l.jsx)(n.code,{children:"Policy"}),"\u53EF\u4EE5\u63A7\u5236",(0,l.jsx)(n.code,{children:"Task"}),"\u7684\u751F\u547D\u5468\u671F\u7B56\u7565\uFF0C\u80FD\u66F4\u7CBE\u51C6\u63A7\u5236",(0,l.jsx)(n.code,{children:"Job"}),"\u7684\u6267\u884C\u3002"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u521B\u5EFA",(0,l.jsx)(n.code,{children:"Job"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:' apiVersion: batch.volcano.sh/v1alpha1\n kind: Job\n metadata:\n   name: my-job\n spec:\n   minAvailable: 3\n   schedulerName: volcano\n   queue: default\n   policies:\n     - event: PodEvicted\n       action: RestartJob\n   tasks:\n     - replicas: 30\n       name: demo\n       policies:\n       - event: TaskCompleted\n         action: CompleteJob\n       template:\n         spec:\n           containers:\n             - image: ubuntu\n               name: demo\n               command: ["sleep", "5"]\n               resources:\n                 requests:\n                   cpu: 20\n           restartPolicy: Never\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5176\u4E2D:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"policies:\n  - event: PodEvicted\n    action: RestartJob\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u8868\u793A\u5982\u679C",(0,l.jsx)(n.code,{children:"Pod"}),"\u88AB",(0,l.jsx)(n.code,{children:"Evict"}),"\u4E86\uFF0C\u5C31\u91CD\u542F",(0,l.jsx)(n.code,{children:"Job"}),"\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"policies:\n  - event: TaskCompleted\n    action: CompleteJob\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u8868\u793A\u5982\u679C",(0,l.jsx)(n.code,{children:"Task"}),"\u5B8C\u6210\u4E86\uFF0C\u5C31\u5B8C\u6210",(0,l.jsx)(n.code,{children:"Job"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u901A\u8FC7",(0,l.jsx)(n.code,{children:"Event"}),"\u548C",(0,l.jsx)(n.code,{children:"Action"}),"\uFF0C\u53EF\u4EE5\u63A7\u5236",(0,l.jsx)(n.code,{children:"Job"}),"\u7684\u72B6\u6001\u548C\u884C\u4E3A\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u67E5\u770B",(0,l.jsx)(n.code,{children:"Pod"}),"\u521B\u5EFA\u60C5\u51B5"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"$ kubectl get pod\n\nNAME                            READY   STATUS    RESTARTS   AGE\nmy-job-demo-0                   1/1     Running   0          7s\nmy-job-demo-1                   1/1     Running   0          7s\nmy-job-demo-10                  0/1     Pending   0          7s\n...\nmy-job-demo-2                   1/1     Running   0          7s\n...\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u7531\u4E8E\u6211\u8BBE\u7F6E\u4E86",(0,l.jsx)(n.code,{children:"Pod"}),"\u7684",(0,l.jsx)(n.code,{children:"CPU Request"}),"\u4E3A 20\uFF0C\u96C6\u7FA4\u4E0A\u6CA1\u6709\u8DB3\u591F\u7684\u8D44\u6E90\uFF0C\u6240\u4EE5 30 \u4E2A",(0,l.jsx)(n.code,{children:"Pod"}),"\u6BCF\u6B21\u53EA\u80FD\u8FD0\u884C 3 \u4E2A\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u6267\u884C\u5B8C\u6210\u4E4B\u540E\uFF0C",(0,l.jsx)(n.code,{children:"Pod"}),"\u4E0D\u4F1A\u88AB\u5220\u9664\u800C\u662F\u5904\u4E8E",(0,l.jsx)(n.code,{children:"Completed"}),"\u72B6\u6001\u3002\u7531\u4E8E",(0,l.jsx)(n.code,{children:"Pod"}),"\u7684",(0,l.jsx)(n.code,{children:"ownerReferences"}),"\u662F",(0,l.jsx)(n.code,{children:"Job"}),"\uFF0C\u5982\u679C\u5220\u9664",(0,l.jsx)(n.code,{children:"Job"}),"\uFF0C",(0,l.jsx)(n.code,{children:"Pod"}),"\u4E5F\u4F1A\u88AB\u5220\u9664\u3002"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},50065:function(e,n,o){o.d(n,{Z:function(){return i},a:function(){return d}});var c=o(67294);let l={},s=c.createContext(l);function d(e){let n=c.useContext(s);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);