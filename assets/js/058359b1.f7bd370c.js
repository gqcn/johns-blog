"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["4041"],{78836:function(n,e,r){r.r(e),r.d(e,{metadata:()=>i,contentTitle:()=>c,default:()=>h,assets:()=>o,toc:()=>t,frontMatter:()=>d});var i=JSON.parse('{"id":"docs/AI\u6280\u672F/AI\u57FA\u7840\u67B6\u6784/\u5F00\u53D1\u8BAD\u7EC3/Kubeflow Trainer/Kubeflow Trainer \u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528","title":"Kubeflow Trainer \u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528","description":"\u8BE6\u7EC6\u4ECB\u7ECDKubeflow Trainer\u7684\u771F\u5B9E\u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528\u8FC7\u7A0B\uFF0C\u57FA\u4E8ECPU\u7684PyTorch\u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B\uFF0C\u5305\u62ECConfigMap\u3001HostPath\u3001\u955C\u50CF\u6784\u5EFA\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u7684\u5B8C\u6574\u5B9E\u8DF5\u6307\u5357","source":"@site/docs/docs/1000-AI\u6280\u672F/200-AI\u57FA\u7840\u67B6\u6784/500-\u5F00\u53D1\u8BAD\u7EC3/100-Kubeflow Trainer/4000-Kubeflow Trainer \u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528.md","sourceDirName":"docs/1000-AI\u6280\u672F/200-AI\u57FA\u7840\u67B6\u6784/500-\u5F00\u53D1\u8BAD\u7EC3/100-Kubeflow Trainer","slug":"/ai/kubeflow-trainer-deploy-usage","permalink":"/ai/kubeflow-trainer-deploy-usage","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4000,"frontMatter":{"slug":"/ai/kubeflow-trainer-deploy-usage","title":"Kubeflow Trainer \u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528","hide_title":true,"keywords":["kubeflow","trainer","pytorch","\u5206\u5E03\u5F0F\u8BAD\u7EC3","kubernetes","hpc","cpu\u8BAD\u7EC3","configmap","hostpath","docker"],"description":"\u8BE6\u7EC6\u4ECB\u7ECDKubeflow Trainer\u7684\u771F\u5B9E\u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528\u8FC7\u7A0B\uFF0C\u57FA\u4E8ECPU\u7684PyTorch\u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B\uFF0C\u5305\u62ECConfigMap\u3001HostPath\u3001\u955C\u50CF\u6784\u5EFA\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u7684\u5B8C\u6574\u5B9E\u8DF5\u6307\u5357"},"sidebar":"mainSidebar","previous":{"title":"Kubeflow Trainer CRD\u914D\u7F6E\u683C\u5F0F\u8BE6\u89E3","permalink":"/ai/kubeflow-trainer-crd-reference"},"next":{"title":"\u5F00\u53D1\u8BAD\u7EC3\u5E73\u53F0\u6982\u8FF0","permalink":"/ai/hpc-development-training-platform"}}'),l=r("85893"),s=r("50065");let d={slug:"/ai/kubeflow-trainer-deploy-usage",title:"Kubeflow Trainer \u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528",hide_title:!0,keywords:["kubeflow","trainer","pytorch","\u5206\u5E03\u5F0F\u8BAD\u7EC3","kubernetes","hpc","cpu\u8BAD\u7EC3","configmap","hostpath","docker"],description:"\u8BE6\u7EC6\u4ECB\u7ECDKubeflow Trainer\u7684\u771F\u5B9E\u5B89\u88C5\u3001\u90E8\u7F72\u53CA\u4F7F\u7528\u8FC7\u7A0B\uFF0C\u57FA\u4E8ECPU\u7684PyTorch\u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B\uFF0C\u5305\u62ECConfigMap\u3001HostPath\u3001\u955C\u50CF\u6784\u5EFA\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u7684\u5B8C\u6574\u5B9E\u8DF5\u6307\u5357"},c=void 0,o={},t=[{value:"\u7B80\u4ECB",id:"\u7B80\u4ECB",level:2},{value:"\u5B89\u88C5\u90E8\u7F72",id:"\u5B89\u88C5\u90E8\u7F72",level:2},{value:"\u524D\u7F6E\u6761\u4EF6",id:"\u524D\u7F6E\u6761\u4EF6",level:3},{value:"\u65B9\u5F0F\u4E00\uFF1AHelm \u90E8\u7F72\uFF08\u63A8\u8350\uFF09",id:"\u65B9\u5F0F\u4E00helm-\u90E8\u7F72\u63A8\u8350",level:3},{value:"\u62C9\u53D6 Chart \u5230\u672C\u5730",id:"\u62C9\u53D6-chart-\u5230\u672C\u5730",level:4},{value:"\u90E8\u7F72 Kubeflow Trainer",id:"\u90E8\u7F72-kubeflow-trainer",level:4},{value:"\u9A8C\u8BC1\u90E8\u7F72\u7ED3\u679C",id:"\u9A8C\u8BC1\u90E8\u7F72\u7ED3\u679C",level:4},{value:"\u65B9\u5F0F\u4E8C\uFF1Akubectl \u90E8\u7F72",id:"\u65B9\u5F0F\u4E8Ckubectl-\u90E8\u7F72",level:3},{value:"\u9A8C\u8BC1 API \u8D44\u6E90",id:"\u9A8C\u8BC1-api-\u8D44\u6E90",level:3},{value:"Training Runtimes \u914D\u7F6E",id:"training-runtimes-\u914D\u7F6E",level:2},{value:"\u4EC0\u4E48\u662FTraining Runtimes\uFF1F",id:"\u4EC0\u4E48\u662Ftraining-runtimes",level:3},{value:"Training Runtimes\u5E38\u7528\u6A21\u677F",id:"training-runtimes\u5E38\u7528\u6A21\u677F",level:3},{value:"\u521B\u5EFAClusterTrainingRuntime",id:"\u521B\u5EFAclustertrainingruntime",level:3},{value:"PyTorch \u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B",id:"pytorch-\u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B",level:2},{value:"\u8BAD\u7EC3\u811A\u672C\u8BF4\u660E",id:"\u8BAD\u7EC3\u811A\u672C\u8BF4\u660E",level:3},{value:"\u672C\u5730\u6D4B\u8BD5",id:"\u672C\u5730\u6D4B\u8BD5",level:3},{value:"\u90E8\u7F72\u65B9\u5F0F\u4E00\uFF1AConfigMap \u6302\u8F7D\u811A\u672C",id:"\u90E8\u7F72\u65B9\u5F0F\u4E00configmap-\u6302\u8F7D\u811A\u672C",level:2},{value:"\u65B9\u6848\u8BF4\u660E",id:"\u65B9\u6848\u8BF4\u660E",level:3},{value:"\u90E8\u7F72\u6B65\u9AA4",id:"\u90E8\u7F72\u6B65\u9AA4",level:3},{value:"\u521B\u5EFA ConfigMap",id:"\u521B\u5EFA-configmap",level:4},{value:"\u521B\u5EFA TrainJob",id:"\u521B\u5EFA-trainjob",level:4},{value:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001",id:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001",level:4},{value:"\u9884\u671F\u8F93\u51FA",id:"\u9884\u671F\u8F93\u51FA",level:4},{value:"\u6E05\u7406\u8D44\u6E90",id:"\u6E05\u7406\u8D44\u6E90",level:4},{value:"\u90E8\u7F72\u65B9\u5F0F\u4E8C\uFF1AHostPath \u6302\u8F7D\u811A\u672C",id:"\u90E8\u7F72\u65B9\u5F0F\u4E8Chostpath-\u6302\u8F7D\u811A\u672C",level:2},{value:"\u65B9\u6848\u8BF4\u660E",id:"\u65B9\u6848\u8BF4\u660E-1",level:3},{value:"\u90E8\u7F72\u6B65\u9AA4",id:"\u90E8\u7F72\u6B65\u9AA4-1",level:3},{value:"\u51C6\u5907\u5BBF\u4E3B\u673A\u76EE\u5F55",id:"\u51C6\u5907\u5BBF\u4E3B\u673A\u76EE\u5F55",level:4},{value:"\u521B\u5EFA TrainJob",id:"\u521B\u5EFA-trainjob-1",level:4},{value:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001",id:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001-1",level:4},{value:"\u52A8\u6001\u66F4\u65B0\u811A\u672C",id:"\u52A8\u6001\u66F4\u65B0\u811A\u672C",level:4},{value:"\u6E05\u7406\u8D44\u6E90",id:"\u6E05\u7406\u8D44\u6E90-1",level:4},{value:"\u90E8\u7F72\u65B9\u5F0F\u4E09\uFF1A\u955C\u50CF\u6784\u5EFA\u65B9\u5F0F\uFF08\u63A8\u8350\uFF09",id:"\u90E8\u7F72\u65B9\u5F0F\u4E09\u955C\u50CF\u6784\u5EFA\u65B9\u5F0F\u63A8\u8350",level:2},{value:"\u65B9\u6848\u8BF4\u660E",id:"\u65B9\u6848\u8BF4\u660E-2",level:3},{value:"\u90E8\u7F72\u6B65\u9AA4",id:"\u90E8\u7F72\u6B65\u9AA4-2",level:3},{value:"\u521B\u5EFA Dockerfile",id:"\u521B\u5EFA-dockerfile",level:4},{value:"\u6784\u5EFA\u955C\u50CF",id:"\u6784\u5EFA\u955C\u50CF",level:4},{value:"\u63A8\u9001\u955C\u50CF\u5230\u4ED3\u5E93\uFF08\u53EF\u9009\uFF09",id:"\u63A8\u9001\u955C\u50CF\u5230\u4ED3\u5E93\u53EF\u9009",level:4},{value:"\u521B\u5EFA TrainJob",id:"\u521B\u5EFA-trainjob-2",level:4},{value:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001",id:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001-2",level:4},{value:"\u66F4\u65B0\u8BAD\u7EC3\u811A\u672C",id:"\u66F4\u65B0\u8BAD\u7EC3\u811A\u672C",level:4},{value:"\u6E05\u7406\u8D44\u6E90",id:"\u6E05\u7406\u8D44\u6E90-2",level:4},{value:"\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u5BF9\u6BD4",id:"\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u5BF9\u6BD4",level:2},{value:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",id:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",level:2},{value:"Pod Pending",id:"pod-pending",level:3},{value:"ConfigMap Not Found",id:"configmap-not-found",level:3},{value:"HostPath \u6587\u4EF6\u4E0D\u5B58\u5728",id:"hostpath-\u6587\u4EF6\u4E0D\u5B58\u5728",level:3},{value:"\u8BAD\u7EC3\u4EFB\u52A1\u5361\u4F4F\u4E0D\u542F\u52A8",id:"\u8BAD\u7EC3\u4EFB\u52A1\u5361\u4F4F\u4E0D\u542F\u52A8",level:3},{value:"API \u7248\u672C\u9519\u8BEF",id:"api-\u7248\u672C\u9519\u8BEF",level:3},{value:"\u6700\u4F73\u5B9E\u8DF5",id:"\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"\u8D44\u6E90\u914D\u7F6E",id:"\u8D44\u6E90\u914D\u7F6E",level:3},{value:"\u76D1\u63A7\u548C\u65E5\u5FD7",id:"\u76D1\u63A7\u548C\u65E5\u5FD7",level:3},{value:"\u4EFB\u52A1\u5BB9\u9519",id:"\u4EFB\u52A1\u5BB9\u9519",level:3},{value:"\u5F39\u6027\u8BAD\u7EC3",id:"\u5F39\u6027\u8BAD\u7EC3",level:3},{value:"GPU \u8BAD\u7EC3\u914D\u7F6E",id:"gpu-\u8BAD\u7EC3\u914D\u7F6E",level:3},{value:"\u53C2\u8003\u8D44\u6599",id:"\u53C2\u8003\u8D44\u6599",level:2}];function a(n){let e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h2,{id:"\u7B80\u4ECB",children:"\u7B80\u4ECB"}),"\n",(0,l.jsxs)(e.p,{children:["\u672C\u6587\u5C06\u4ECB\u7ECD\u5982\u4F55\u5728",(0,l.jsx)(e.code,{children:"Kubernetes"}),"\u96C6\u7FA4\u4E2D\u5B89\u88C5\u548C\u90E8\u7F72",(0,l.jsx)(e.code,{children:"Kubeflow Trainer"}),"\uFF0C\u5E76\u901A\u8FC7\u771F\u5B9E\u7684\u57FA\u4E8E",(0,l.jsx)(e.code,{children:"CPU"}),"\u7684",(0,l.jsx)(e.code,{children:"PyTorch"}),"\u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B\uFF0C\u8BE6\u7EC6\u6F14\u793A\u4E09\u79CD\u4E0D\u540C\u7684\u8BAD\u7EC3\u4EFB\u52A1\u90E8\u7F72\u4F7F\u7528\u65B9\u5F0F\u3002"]}),"\n",(0,l.jsx)(e.p,{children:"\u672C\u6587\u57FA\u4E8E\u4EE5\u4E0B\u73AF\u5883\u8FDB\u884C\u5B9E\u8DF5\uFF1A"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7EC4\u4EF6"}),(0,l.jsx)(e.th,{children:"\u7248\u672C"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u64CD\u4F5C\u7CFB\u7EDF"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"MacOS M4"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Kubernetes"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"1.27.3"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Kubeflow Trainer"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"v2.1.0"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"PyTorch"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"2.4.1"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Python"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"3.10+"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u8BAD\u7EC3\u8BBE\u5907"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"CPU"})})]})]})]}),"\n",(0,l.jsx)(e.admonition,{title:"\u8BF4\u660E",type:"info",children:(0,l.jsxs)(e.p,{children:["\u867D\u7136\u672C\u6587\u4F7F\u7528",(0,l.jsx)(e.code,{children:"CPU"}),"\u8FDB\u884C\u8BAD\u7EC3\u6F14\u793A\uFF0C\u4F46\u6240\u6709\u65B9\u6CD5\u540C\u6837\u9002\u7528\u4E8E",(0,l.jsx)(e.code,{children:"GPU"}),"\u8BAD\u7EC3\u573A\u666F\uFF0C\u53EA\u9700\u8C03\u6574\u76F8\u5E94\u7684\u8D44\u6E90\u914D\u7F6E\u5373\u53EF\u3002"]})}),"\n",(0,l.jsx)(e.h2,{id:"\u5B89\u88C5\u90E8\u7F72",children:"\u5B89\u88C5\u90E8\u7F72"}),"\n",(0,l.jsx)(e.h3,{id:"\u524D\u7F6E\u6761\u4EF6",children:"\u524D\u7F6E\u6761\u4EF6"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u5F00\u59CB\u5B89\u88C5\u4E4B\u524D\uFF0C\u8BF7\u786E\u4FDD\uFF1A"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5DF2\u5B89\u88C5\u5E76\u914D\u7F6E",(0,l.jsx)(e.code,{children:"Kubernetes"}),"\u96C6\u7FA4\uFF08\u7248\u672C >= ",(0,l.jsx)(e.code,{children:"1.27"}),"\uFF09"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5DF2\u5B89\u88C5",(0,l.jsx)(e.code,{children:"kubectl"}),"\u547D\u4EE4\u884C\u5DE5\u5177"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5DF2\u5B89\u88C5",(0,l.jsx)(e.code,{children:"Helm"}),"\uFF08\u7248\u672C >= ",(0,l.jsx)(e.code,{children:"3.0"}),"\uFF09"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u96C6\u7FA4\u6709\u8DB3\u591F\u7684",(0,l.jsx)(e.code,{children:"CPU/\u5185\u5B58"}),"\u8D44\u6E90\u7528\u4E8E\u8BAD\u7EC3\u4EFB\u52A1"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u65B9\u5F0F\u4E00helm-\u90E8\u7F72\u63A8\u8350",children:"\u65B9\u5F0F\u4E00\uFF1AHelm \u90E8\u7F72\uFF08\u63A8\u8350\uFF09"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"Helm"}),"\u662F\u6700\u7B80\u5355\u548C\u63A8\u8350\u7684\u90E8\u7F72\u65B9\u5F0F\uFF0C\u53EF\u4EE5\u65B9\u4FBF\u5730\u7BA1\u7406",(0,l.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u7684\u751F\u547D\u5468\u671F\u3002"]}),"\n",(0,l.jsx)(e.h4,{id:"\u62C9\u53D6-chart-\u5230\u672C\u5730",children:"\u62C9\u53D6 Chart \u5230\u672C\u5730"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"helm pull oci://ghcr.io/kubeflow/charts/kubeflow-trainer --version 2.1.0 --untar\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u90E8\u7F72-kubeflow-trainer",children:"\u90E8\u7F72 Kubeflow Trainer"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"helm install kubeflow-trainer ./kubeflow-trainer -n kubeflow-system --create-namespace\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u9A8C\u8BC1\u90E8\u7F72\u7ED3\u679C",children:"\u9A8C\u8BC1\u90E8\u7F72\u7ED3\u679C"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl get pods -n kubeflow-system\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u9884\u671F\u8F93\u51FA\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"NAME                                                   READY   STATUS    RESTARTS   AGE\njobset-controller-5b77f7f78-q6ftq                      1/1     Running   0          9m53s\nkubeflow-trainer-controller-manager-56c44969b8-7mghh   1/1     Running   0          9m53s\n"})}),"\n",(0,l.jsx)(e.admonition,{title:"\u63D0\u793A",type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"jobset-controller"}),"\uFF1A\u8D1F\u8D23\u7BA1\u7406",(0,l.jsx)(e.code,{children:"JobSet CRD"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"kubeflow-trainer-controller-manager"}),"\uFF1A\u8D1F\u8D23\u7BA1\u7406",(0,l.jsx)(e.code,{children:"TrainJob"}),"\u3001",(0,l.jsx)(e.code,{children:"TrainingRuntime"}),"\u7B49\u8BAD\u7EC3\u76F8\u5173\u8D44\u6E90"]}),"\n"]})}),"\n",(0,l.jsx)(e.h3,{id:"\u65B9\u5F0F\u4E8Ckubectl-\u90E8\u7F72",children:"\u65B9\u5F0F\u4E8C\uFF1Akubectl \u90E8\u7F72"}),"\n",(0,l.jsxs)(e.p,{children:["\u5982\u679C\u4E0D\u4F7F\u7528",(0,l.jsx)(e.code,{children:"Helm"}),"\uFF0C\u4E5F\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7",(0,l.jsx)(e.code,{children:"kubectl"}),"\u90E8\u7F72\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'export VERSION=v2.1.0\nkubectl apply --server-side -k "https://github.com/kubeflow/trainer.git/manifests/overlays/manager?ref=${VERSION}"\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u9A8C\u8BC1-api-\u8D44\u6E90",children:"\u9A8C\u8BC1 API \u8D44\u6E90"}),"\n",(0,l.jsxs)(e.p,{children:["\u90E8\u7F72\u5B8C\u6210\u540E\uFF0C\u9A8C\u8BC1",(0,l.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u63D0\u4F9B\u7684",(0,l.jsx)(e.code,{children:"API"}),"\u8D44\u6E90\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl api-resources | grep trainer\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u9884\u671F\u8F93\u51FA\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-text",children:"NAME                          SHORTNAMES   APIVERSION                      NAMESPACED   KIND\nclustertrainingruntimes       ctr          trainer.kubeflow.org/v1alpha1   false        ClusterTrainingRuntime\ntrainingruntimes              tr           trainer.kubeflow.org/v1alpha1   true         TrainingRuntime\ntrainjobs                     tj           trainer.kubeflow.org/v1alpha1   true         TrainJob\n"})}),"\n",(0,l.jsx)(e.h2,{id:"training-runtimes-\u914D\u7F6E",children:"Training Runtimes \u914D\u7F6E"}),"\n",(0,l.jsx)(e.h3,{id:"\u4EC0\u4E48\u662Ftraining-runtimes",children:"\u4EC0\u4E48\u662FTraining Runtimes\uFF1F"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"Training Runtimes"}),"\u662F",(0,l.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u7684\u4E0A\u5C42\u589E\u5F3A\u7EC4\u4EF6\uFF0C\u7528\u4E8E\u6807\u51C6\u5316\u8BAD\u7EC3\u73AF\u5883\u914D\u7F6E\u3002\u5B83\u7684\u6838\u5FC3\u4EF7\u503C\u5728\u4E8E\uFF1A"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u529F\u80FD"}),(0,l.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u6807\u51C6\u5316\u8BAD\u7EC3\u73AF\u5883"})}),(0,l.jsxs)(e.td,{children:["\u9884\u5B9A\u4E49\u8BAD\u7EC3\u8FD0\u884C\u65F6\uFF08\u5982",(0,l.jsx)(e.code,{children:"pytorch-2.1-cpu"}),"\u3001",(0,l.jsx)(e.code,{children:"tensorflow-2.15-gpu"}),"\uFF09\uFF0C\u63D0\u4EA4\u4EFB\u52A1\u65F6\u76F4\u63A5\u5F15\u7528"]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u591A\u6846\u67B6\u9002\u914D"})}),(0,l.jsxs)(e.td,{children:["\u652F\u6301\u4E0D\u540C\u6846\u67B6\uFF08",(0,l.jsx)(e.code,{children:"PyTorch/TensorFlow/MXNet"}),"\uFF09\u3001\u4E0D\u540C\u7248\u672C\u3001\u4E0D\u540C\u786C\u4EF6\uFF08",(0,l.jsx)(e.code,{children:"CPU/GPU"}),"\uFF09"]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u7B80\u5316\u4EFB\u52A1\u63D0\u4EA4"})}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"TrainJob"}),"\u53EA\u9700\u6307\u5B9A",(0,l.jsx)(e.code,{children:"runtimeRef"}),"\u5373\u53EF\u590D\u7528\u914D\u7F6E\uFF0C\u65E0\u9700\u91CD\u590D\u5B9A\u4E49"]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u589E\u5F3A\u7684\u8D44\u6E90\u8C03\u5EA6"})}),(0,l.jsxs)(e.td,{children:["\u652F\u6301\u66F4\u7CBE\u7EC6\u7684\u8D44\u6E90\u8C03\u5EA6\u7B56\u7565\uFF08\u5982",(0,l.jsx)(e.code,{children:"GPU"}),"\u5206\u7247\u3001\u8282\u70B9\u4EB2\u548C\u6027\uFF09\u548C\u4EFB\u52A1\u5BB9\u9519\u673A\u5236"]})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"training-runtimes\u5E38\u7528\u6A21\u677F",children:"Training Runtimes\u5E38\u7528\u6A21\u677F"}),"\n",(0,l.jsxs)(e.p,{children:["\u901A\u8FC7\u4EE5\u4E0B\u65B9\u5F0F\u5B89\u88C5\u793E\u533A\u63D0\u4F9B\u7684",(0,l.jsx)(e.code,{children:"Training Runtimes"}),"\u5E38\u7528\u6A21\u677F\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'export VERSION=v2.1.0\nkubectl apply --server-side -k "https://github.com/kubeflow/trainer.git/manifests/overlays/manager?ref=${VERSION}"\n'})}),"\n",(0,l.jsx)(e.admonition,{title:"\u4F7F\u7528\u5EFA\u8BAE",type:"info",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u57FA\u7840\u5206\u5E03\u5F0F\u8BAD\u7EC3"}),"\uFF1A\u4EC5\u9700",(0,l.jsx)(e.code,{children:"TrainJob/PyTorchJob/TFJob"}),"\uFF0C\u73B0\u6709\u7EC4\u4EF6\u5DF2\u6EE1\u8DB3\u9700\u6C42"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7075\u6D3B\u8BAD\u7EC3\u73AF\u5883\u7BA1\u7406"}),"\uFF1A\u9700\u8981\u591A\u6846\u67B6\u9002\u914D\u3001\u8D44\u6E90\u8C03\u5EA6\u4F18\u5316\uFF0C\u5EFA\u8BAE\u5B89\u88C5",(0,l.jsx)(e.code,{children:"Training Runtimes"})]}),"\n"]})}),"\n",(0,l.jsx)(e.h3,{id:"\u521B\u5EFAclustertrainingruntime",children:"\u521B\u5EFAClusterTrainingRuntime"}),"\n",(0,l.jsxs)(e.p,{children:["\u4E0B\u9762\u521B\u5EFA\u4E00\u4E2A\u7528\u4E8E",(0,l.jsx)(e.code,{children:"PyTorch CPU"}),"\u8BAD\u7EC3\u7684\u81EA\u5B9A\u4E49\u8FD0\u884C\u65F6\u6A21\u677F\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: ClusterTrainingRuntime\nmetadata:\n  name: training-runtime-demo\n  labels:\n    # \u6307\u5B9A\u8BAD\u7EC3\u6846\u67B6\u7C7B\u578B\u4E3A PyTorch\n    trainer.kubeflow.org/framework: torch\nspec:\n  # ML\u7B56\u7565\u914D\u7F6E\uFF1A\u5B9A\u4E49\u5206\u5E03\u5F0F\u8BAD\u7EC3\u7684\u57FA\u7840\u53C2\u6570\n  mlPolicy:\n    # ClusterTrainingRuntime \u6A21\u677F\u4E2D\u7684\u9ED8\u8BA4\u8282\u70B9\u6570\uFF08\u4F1A\u88AB TrainJob \u4E2D\u7684 numNodes \u8986\u76D6\uFF09\n    numNodes: 1\n    # PyTorch \u6846\u67B6\u4E13\u7528\u914D\u7F6E\n    torch:\n      # \u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B\u6570\n      # auto: \u81EA\u52A8\u68C0\u6D4B\uFF08\u901A\u5E38\u7B49\u4E8E GPU/CPU \u6838\u5FC3\u6570\uFF09\n      # \u4E5F\u53EF\u4EE5\u8BBE\u7F6E\u5177\u4F53\u6570\u5B57\u5982 2\u30014 \u7B49\n      numProcPerNode: auto\n  \n  # JobSet \u6A21\u677F\u914D\u7F6E\n  template:\n    spec:\n      replicatedJobs:\n      # \u4E0D\u80FD\u968F\u610F\u4FEE\u6539\u8BE5\u540D\u79F0\n      # Kubeflow Trainer\u5728\u751F\u6210PET_MASTER_ADDR\u73AF\u5883\u53D8\u91CF\u65F6\u786C\u7F16\u7801\u4F7F\u7528\u4E86node\n      - name: node\n        template:\n          metadata:\n            labels:\n              # trainjob-ancestor-step: \u6807\u8BC6\u8BE5 Job \u5728\u8BAD\u7EC3\u6D41\u7A0B\u4E2D\u7684\u89D2\u8272\n              # trainer: \u8868\u793A\u8FD9\u662F\u8BAD\u7EC3\u4EFB\u52A1\u7684\u4E3B\u6267\u884C\u5668\n              trainer.kubeflow.org/trainjob-ancestor-step: trainer\n          spec:\n            # \u8C03\u8BD5\u914D\u7F6E\uFF1A\u51CF\u5C11\u91CD\u8BD5\u6B21\u6570\uFF0C\u5FEB\u901F\u5931\u8D25\n            backoffLimit: 2\n            # \u8C03\u8BD5\u914D\u7F6E\uFF1A\u5931\u8D25\u540E\u4FDD\u7559 Pod 30\u5206\u949F\u4EE5\u4FBF\u67E5\u770B\u65E5\u5FD7\n            ttlSecondsAfterFinished: 1800\n            template:\n              spec:\n                # \u8C03\u8BD5\u914D\u7F6E\uFF1A\u5931\u8D25\u540E\u4E0D\u81EA\u52A8\u91CD\u542F\uFF0C\u4FDD\u7559\u73B0\u573A\n                restartPolicy: Never\n                containers:\n                # \u5F53Job\u6A21\u677F\u6807\u7B7E\u4E3A trainer.kubeflow.org/trainjob-ancestor-step: trainer \u65F6\n                # \u5FC5\u987B\u5305\u542B\u540D\u4E3A node \u7684\u5BB9\u5668\n                - name: node\n                  image: pytorch/pytorch:2.4.1-cuda11.8-cudnn9-runtime\n                  # \u4F7F\u7528 torchrun \u542F\u52A8\u5206\u5E03\u5F0F\u8BAD\u7EC3\n                  # Kubeflow Trainer \u4F1A\u81EA\u52A8\u6CE8\u5165 PET_* \u73AF\u5883\u53D8\u91CF\n                  command:\n                    - torchrun\n                    - --nproc_per_node=$(PET_NPROC_PER_NODE)\n                    - --nnodes=$(PET_NNODES)\n                    - --node_rank=$(PET_NODE_RANK)\n                    - --master_addr=$(PET_MASTER_ADDR)\n                    - --master_port=$(PET_MASTER_PORT)\n                    - /workspace/pytorch-demo.py\n                  env:\n                  - name: PYTHONUNBUFFERED\n                    value: "1"\n'})}),"\n",(0,l.jsx)(e.p,{children:"\u5E94\u7528\u914D\u7F6E\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl apply -f training-runtime-demo.yaml\n"})}),"\n",(0,l.jsxs)(e.admonition,{title:"\u5173\u952E\u73AF\u5883\u53D8\u91CF\u8BF4\u660E",type:"tip",children:[(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u4F1A\u81EA\u52A8\u4E3A\u8BAD\u7EC3",(0,l.jsx)(e.code,{children:"Pod"}),"\u6CE8\u5165\u4EE5\u4E0B\u73AF\u5883\u53D8\u91CF\uFF1A"]}),(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u73AF\u5883\u53D8\u91CF"}),(0,l.jsx)(e.th,{children:"\u8BF4\u660E"}),(0,l.jsx)(e.th,{children:"\u793A\u4F8B\u503C"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"PET_NNODES"})}),(0,l.jsx)(e.td,{children:"\u8BAD\u7EC3\u8282\u70B9\u603B\u6570"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"2"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"PET_NPROC_PER_NODE"})}),(0,l.jsx)(e.td,{children:"\u6BCF\u8282\u70B9\u8FDB\u7A0B\u6570"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"2"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"PET_NODE_RANK"})}),(0,l.jsx)(e.td,{children:"\u5F53\u524D\u8282\u70B9\u7F16\u53F7\uFF080\u5F00\u59CB\uFF09"}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"0"}),", ",(0,l.jsx)(e.code,{children:"1"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"PET_MASTER_ADDR"})}),(0,l.jsx)(e.td,{children:"\u4E3B\u8282\u70B9\u5730\u5740"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"trainjob-demo-node-0-0.trainjob-demo"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"PET_MASTER_PORT"})}),(0,l.jsx)(e.td,{children:"\u4E3B\u8282\u70B9\u7AEF\u53E3"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"29500"})})]})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"pytorch-\u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B",children:"PyTorch \u5206\u5E03\u5F0F\u8BAD\u7EC3\u6848\u4F8B"}),"\n",(0,l.jsx)(e.h3,{id:"\u8BAD\u7EC3\u811A\u672C\u8BF4\u660E",children:"\u8BAD\u7EC3\u811A\u672C\u8BF4\u660E"}),"\n",(0,l.jsxs)(e.p,{children:["\u6211\u4EEC\u4F7F\u7528\u4E00\u4E2A\u7B80\u5355\u7684",(0,l.jsx)(e.code,{children:"PyTorch"}),"\u5206\u5E03\u5F0F\u8BAD\u7EC3\u811A\u672C\u6765\u6F14\u793A\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u3002\u8BE5\u811A\u672C\u5B9E\u73B0\u4E86\u4E00\u4E2A\u7B80\u5355\u7684\u7EBF\u6027\u56DE\u5F52\u6A21\u578B\u8BAD\u7EC3\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:'import os\nimport torch\nimport torch.nn as nn\nimport torch.optim as optim\nimport torch.distributed as dist\nfrom torch.utils.data import Dataset, DataLoader\nfrom torch.utils.data.distributed import DistributedSampler\n\n# ====================== 1. \u5B9A\u4E49\u7B80\u5355\u7684\u6570\u636E\u96C6\u548C\u6A21\u578B ======================\nclass SimpleDataset(Dataset):\n    """\u7B80\u5355\u7684\u6570\u636E\u96C6\uFF1A\u8F93\u5165\u662F\u968F\u673A\u6570\uFF0C\u6807\u7B7E\u662F\u8F93\u5165\u76842\u500D\uFF08\u7B80\u5355\u56DE\u5F52\u4EFB\u52A1\uFF09"""\n    def __init__(self, size=100):\n        self.data = torch.randn(size, 1)  # \u8F93\u5165\uFF1A(size, 1)\n        self.labels = self.data * 2 + 0.1 * torch.randn_like(self.data)  # \u6807\u7B7E\uFF1A2x + \u566A\u58F0\n\n    def __len__(self):\n        return len(self.data)\n\n    def __getitem__(self, idx):\n        return self.data[idx], self.labels[idx]\n\nclass SimpleModel(nn.Module):\n    """\u7B80\u5355\u7684\u7EBF\u6027\u6A21\u578B\uFF1Ay = wx + b"""\n    def __init__(self):\n        super(SimpleModel, self).__init__()\n        self.linear = nn.Linear(1, 1)\n\n    def forward(self, x):\n        return self.linear(x)\n\n# ====================== 2. \u521D\u59CB\u5316\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4 ======================\ndef init_distributed():\n    """\n    \u521D\u59CB\u5316\u5206\u5E03\u5F0F\u73AF\u5883\uFF08CPU + gloo\u540E\u7AEF\uFF09\n    \n    Kubeflow Trainer \u4F1A\u81EA\u52A8\u8BBE\u7F6E\u4EE5\u4E0B\u73AF\u5883\u53D8\u91CF\uFF1A\n    - RANK: \u5168\u5C40\u8FDB\u7A0B\u6392\u540D\uFF08\u7531 torchrun \u8BBE\u7F6E\uFF09\n    - WORLD_SIZE: \u603B\u8FDB\u7A0B\u6570\uFF08\u7531 torchrun \u8BBE\u7F6E\uFF09\n    - LOCAL_RANK: \u8282\u70B9\u5185\u8FDB\u7A0B\u6392\u540D\uFF08\u7531 torchrun \u8BBE\u7F6E\uFF09\n    - MASTER_ADDR: \u4E3B\u8282\u70B9\u5730\u5740\uFF08\u7531 torchrun \u8BBE\u7F6E\uFF09\n    - MASTER_PORT: \u4E3B\u8282\u70B9\u7AEF\u53E3\uFF08\u7531 torchrun \u8BBE\u7F6E\uFF09\n    """\n    # \u4ECE\u73AF\u5883\u53D8\u91CF\u4E2D\u83B7\u53D6\u5206\u5E03\u5F0F\u8BAD\u7EC3\u53C2\u6570\uFF08torchrun \u8BBE\u7F6E\u7684\u6807\u51C6\u73AF\u5883\u53D8\u91CF\uFF09\n    rank = int(os.environ.get("RANK", 0))\n    world_size = int(os.environ.get("WORLD_SIZE", 1))\n    local_rank = int(os.environ.get("LOCAL_RANK", 0))\n    \n    print(f"[\u521D\u59CB\u5316] RANK={rank}, WORLD_SIZE={world_size}, LOCAL_RANK={local_rank}")\n    print(f"[\u521D\u59CB\u5316] MASTER_ADDR={os.environ.get(\'MASTER_ADDR\', \'N/A\')}")\n    print(f"[\u521D\u59CB\u5316] MASTER_PORT={os.environ.get(\'MASTER_PORT\', \'N/A\')}")\n    \n    # \u521D\u59CB\u5316\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4\n    # \u4F7F\u7528 gloo \u540E\u7AEF\uFF08CPU\u4E13\u7528\uFF09\uFF0C\u81EA\u52A8\u4ECE\u73AF\u5883\u53D8\u91CF\u8BFB\u53D6\u914D\u7F6E\n    dist.init_process_group(backend="gloo")\n    \n    print(f"[\u521D\u59CB\u5316\u5B8C\u6210] \u6210\u529F\u521D\u59CB\u5316\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4")\n\n    return rank, world_size, local_rank\n\n# ====================== 3. \u6838\u5FC3\u8BAD\u7EC3\u51FD\u6570 ======================\ndef train():\n    print("=" * 60)\n    print("\u5F00\u59CB PyTorch \u5206\u5E03\u5F0F\u8BAD\u7EC3\uFF08Kubeflow Trainer \u7248\u672C\uFF09")\n    print("=" * 60)\n    \n    # \u521D\u59CB\u5316\u5206\u5E03\u5F0F\u73AF\u5883\n    rank, world_size, local_rank = init_distributed()\n\n    # \u8BBE\u7F6E\u5F53\u524D\u8FDB\u7A0B\u7684\u8BBE\u5907\uFF08CPU\uFF09\n    device = torch.device("cpu")\n\n    # 1. \u6784\u5EFA\u6570\u636E\u96C6\u548C\u5206\u5E03\u5F0F\u91C7\u6837\u5668\uFF08\u6838\u5FC3\uFF1A\u5C06\u6570\u636E\u5206\u53D1\u7ED9\u4E0D\u540C\u8FDB\u7A0B\uFF09\n    dataset = SimpleDataset(size=100)\n    # DistributedSampler\uFF1A\u4FDD\u8BC1\u4E0D\u540C\u8FDB\u7A0B\u8BFB\u53D6\u4E0D\u540C\u7684\u6570\u636E\u5206\u7247\n    sampler = DistributedSampler(dataset, num_replicas=world_size, rank=rank)\n    dataloader = DataLoader(\n        dataset,\n        batch_size=10,\n        sampler=sampler,  # \u5FC5\u987B\u7528\u5206\u5E03\u5F0F\u91C7\u6837\u5668\uFF0C\u66FF\u4EE3shuffle\n        num_workers=0  # \u7B80\u5316demo\uFF0C\u5173\u95ED\u591A\u7EBF\u7A0B\n    )\n\n    # 2. \u6784\u5EFA\u6A21\u578B\u5E76\u5305\u88C5\u4E3A\u5206\u5E03\u5F0F\u6570\u636E\u5E76\u884C\uFF08DDP\uFF09\n    model = SimpleModel()\n    # DDP\uFF1A\u81EA\u52A8\u5904\u7406\u53C2\u6570\u540C\u6B65\u3001\u68AF\u5EA6\u805A\u5408\n    model = nn.parallel.DistributedDataParallel(model, device_ids=None)  # CPU\u8BAD\u7EC3\uFF0Cdevice_ids\u8BBE\u4E3ANone\n\n    # 3. \u5B9A\u4E49\u635F\u5931\u51FD\u6570\u548C\u4F18\u5316\u5668\n    criterion = nn.MSELoss()\n    optimizer = optim.SGD(model.parameters(), lr=0.01)\n\n    # 4. \u8BAD\u7EC3\u5FAA\u73AF\n    epochs = 5\n    print(f"\\n[Rank {rank}] \u5F00\u59CB\u8BAD\u7EC3\uFF0C\u5171 {epochs} \u4E2A epoch")\n    print("-" * 60)\n    \n    for epoch in range(epochs):\n        # \u6BCF\u4E2Aepoch\u5F00\u59CB\u524D\uFF0C\u66F4\u65B0\u91C7\u6837\u5668\u7684epoch\uFF08\u4FDD\u8BC1\u5206\u5E03\u5F0F\u6570\u636E\u6253\u4E71\u7684\u4E00\u81F4\u6027\uFF09\n        sampler.set_epoch(epoch)\n        model.train()\n        total_loss = 0.0\n\n        for batch_idx, (data, labels) in enumerate(dataloader):\n            # \u5C06\u6570\u636E\u79FB\u52A8\u5230\u8BBE\u5907\n            data, labels = data.to(device), labels.to(device)\n            \n            # \u524D\u5411\u4F20\u64AD\n            outputs = model(data)\n            loss = criterion(outputs, labels)\n\n            # \u53CD\u5411\u4F20\u64AD\u548C\u4F18\u5316\n            optimizer.zero_grad()\n            loss.backward()\n            optimizer.step()\n\n            total_loss += loss.item()\n\n        # \u53EA\u5728\u4E3B\u8FDB\u7A0B\uFF08rank=0\uFF09\u6253\u5370\u8BAD\u7EC3\u4FE1\u606F\n        if rank == 0:\n            avg_loss = total_loss / len(dataloader)\n            print(f"Epoch [{epoch+1}/{epochs}], Average Loss: {avg_loss:.4f}")\n\n    print("-" * 60)\n    print(f"[Rank {rank}] \u8BAD\u7EC3\u5B8C\u6210\uFF01")\n    \n    # \u5728\u4E3B\u8FDB\u7A0B\u6253\u5370\u6700\u7EC8\u7684\u6A21\u578B\u53C2\u6570\n    if rank == 0:\n        print("\\n" + "=" * 60)\n        print("\u6700\u7EC8\u6A21\u578B\u53C2\u6570:")\n        for name, param in model.named_parameters():\n            print(f"  {name}: {param.data}")\n        print("=" * 60)\n\n    # \u6E05\u7406\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4\n    dist.destroy_process_group()\n    print(f"[Rank {rank}] \u8FDB\u7A0B\u7EC4\u5DF2\u9500\u6BC1")\n\nif __name__ == "__main__":\n    train()\n'})}),"\n",(0,l.jsx)(e.admonition,{title:"\u4EE3\u7801\u5173\u952E\u70B9",type:"tip",children:(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u5E03\u5F0F\u521D\u59CB\u5316"}),"\uFF1A\u4F7F\u7528",(0,l.jsx)(e.code,{children:'dist.init_process_group(backend="gloo")'}),"\u521D\u59CB\u5316\u5206\u5E03\u5F0F\u73AF\u5883\uFF0C",(0,l.jsx)(e.code,{children:"CPU"}),"\u8BAD\u7EC3\u4F7F\u7528",(0,l.jsx)(e.code,{children:"gloo"}),"\u540E\u7AEF"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6570\u636E\u5E76\u884C"}),"\uFF1A\u4F7F\u7528",(0,l.jsx)(e.code,{children:"DistributedSampler"}),"\u786E\u4FDD\u4E0D\u540C\u8FDB\u7A0B\u8BFB\u53D6\u4E0D\u540C\u7684\u6570\u636E\u5206\u7247"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6A21\u578B\u5E76\u884C"}),"\uFF1A\u4F7F\u7528",(0,l.jsx)(e.code,{children:"DistributedDataParallel"}),"\u5305\u88C5\u6A21\u578B\uFF0C\u81EA\u52A8\u5904\u7406\u68AF\u5EA6\u805A\u5408"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u73AF\u5883\u53D8\u91CF"}),"\uFF1A",(0,l.jsx)(e.code,{children:"Kubeflow Trainer"}),"\u4F1A\u81EA\u52A8\u8BBE\u7F6E\u6240\u6709\u5FC5\u8981\u7684\u73AF\u5883\u53D8\u91CF\uFF08",(0,l.jsx)(e.code,{children:"RANK"}),"\u3001",(0,l.jsx)(e.code,{children:"WORLD_SIZE"}),"\u3001",(0,l.jsx)(e.code,{children:"MASTER_ADDR"}),"\u7B49\uFF09"]}),"\n"]})}),"\n",(0,l.jsx)(e.h3,{id:"\u672C\u5730\u6D4B\u8BD5",children:"\u672C\u5730\u6D4B\u8BD5"}),"\n",(0,l.jsxs)(e.p,{children:["\u5728\u63D0\u4EA4\u5230",(0,l.jsx)(e.code,{children:"Kubernetes"}),"\u4E4B\u524D\uFF0C\u53EF\u4EE5\u5148\u5728\u672C\u5730\u6D4B\u8BD5\u811A\u672C\u662F\u5426\u6B63\u5E38\u8FD0\u884C\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u542F\u52A82\u4E2ACPU\u8FDB\u7A0B\u6A21\u62DF\u5206\u5E03\u5F0F\u8BAD\u7EC3\uFF08world_size=2\uFF09\ntorchrun --nproc_per_node=2 --master_port=23456 pytorch-demo.py\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u9884\u671F\u8F93\u51FA\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"[\u521D\u59CB\u5316] RANK=0, WORLD_SIZE=2, LOCAL_RANK=0\n[\u521D\u59CB\u5316\u5B8C\u6210] \u6210\u529F\u521D\u59CB\u5316\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4\n[Rank 0] \u5F00\u59CB\u8BAD\u7EC3\uFF0C\u5171 5 \u4E2A epoch\n------------------------------------------------------------\nEpoch [1/5], Average Loss: 0.0234\nEpoch [2/5], Average Loss: 0.0189\nEpoch [3/5], Average Loss: 0.0156\nEpoch [4/5], Average Loss: 0.0128\nEpoch [5/5], Average Loss: 0.0103\n------------------------------------------------------------\n[Rank 0] \u8BAD\u7EC3\u5B8C\u6210\uFF01\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u90E8\u7F72\u65B9\u5F0F\u4E00configmap-\u6302\u8F7D\u811A\u672C",children:"\u90E8\u7F72\u65B9\u5F0F\u4E00\uFF1AConfigMap \u6302\u8F7D\u811A\u672C"}),"\n",(0,l.jsx)(e.h3,{id:"\u65B9\u6848\u8BF4\u660E",children:"\u65B9\u6848\u8BF4\u660E"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"ConfigMap"}),"\u65B9\u5F0F\u9002\u5408\u5FEB\u901F\u5F00\u53D1\u548C\u6D4B\u8BD5\u573A\u666F\uFF0C\u5C06\u8BAD\u7EC3\u811A\u672C\u5B58\u50A8\u5728",(0,l.jsx)(e.code,{children:"ConfigMap"}),"\u4E2D\uFF0C\u7136\u540E\u6302\u8F7D\u5230\u8BAD\u7EC3",(0,l.jsx)(e.code,{children:"Pod"}),"\u4E2D\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5FEB\u901F\u8FED\u4EE3\uFF1A\u4FEE\u6539\u811A\u672C\u53EA\u9700\u66F4\u65B0",(0,l.jsx)(e.code,{children:"ConfigMap"})]}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u65E0\u9700\u6784\u5EFA\u955C\u50CF\uFF1A\u907F\u514D\u955C\u50CF\u6784\u5EFA\u548C\u63A8\u9001\u7684\u5F00\u9500"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u9002\u5408\u8C03\u8BD5\uFF1A\u5FEB\u901F\u9A8C\u8BC1\u8BAD\u7EC3\u903B\u8F91"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u274C \u6587\u4EF6\u5927\u5C0F\u9650\u5236\uFF1A",(0,l.jsx)(e.code,{children:"ConfigMap"}),"\u6700\u5927",(0,l.jsx)(e.code,{children:"1MB"})]}),"\n",(0,l.jsx)(e.li,{children:"\u274C \u4E0D\u9002\u5408\u751F\u4EA7\uFF1A\u7F3A\u5C11\u7248\u672C\u63A7\u5236\u548C\u56DE\u6EDA\u80FD\u529B"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u90E8\u7F72\u6B65\u9AA4",children:"\u90E8\u7F72\u6B65\u9AA4"}),"\n",(0,l.jsx)(e.h4,{id:"\u521B\u5EFA-configmap",children:"\u521B\u5EFA ConfigMap"}),"\n",(0,l.jsxs)(e.p,{children:["\u5C06\u8BAD\u7EC3\u811A\u672C\u6253\u5305\u5230",(0,l.jsx)(e.code,{children:"ConfigMap"}),"\u4E2D\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl create configmap pytorch-demo-script --from-file=pytorch-demo.py\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u9A8C\u8BC1",(0,l.jsx)(e.code,{children:"ConfigMap"}),"\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl get configmap pytorch-demo-script\nkubectl describe configmap pytorch-demo-script\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u521B\u5EFA-trainjob",children:"\u521B\u5EFA TrainJob"}),"\n",(0,l.jsxs)(e.p,{children:["\u521B\u5EFA",(0,l.jsx)(e.code,{children:"trainjob-demo-with-configmap.yaml"}),"\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: TrainJob\nmetadata:\n  name: trainjob-demo-with-configmap\nspec:\n  # \u5F15\u7528\u524D\u9762\u5B9A\u4E49\u7684 ClusterTrainingRuntime\n  runtimeRef:\n    kind: ClusterTrainingRuntime\n    name: training-runtime-demo\n  \n  # \u8BAD\u7EC3\u5668\u914D\u7F6E\n  trainer:\n    # \u8BAD\u7EC3\u8282\u70B9\u6570\u91CF\n    numNodes: 2\n    \n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B\u6570\n    numProcPerNode: 2\n    \n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8D44\u6E90\u914D\u7F6E\n    resourcesPerNode:\n      requests:\n        cpu: "1"\n        memory: "2Gi"\n      limits:\n        cpu: "1"\n        memory: "2Gi"\n\n  # Pod \u6A21\u677F\u8986\u76D6\u914D\u7F6E - \u7528\u4E8E\u6302\u8F7D ConfigMap\n  podTemplateOverrides:\n    - targetJobs:\n        - name: node\n      spec:\n        containers:\n          - name: node\n            volumeMounts:\n              - name: training-script\n                mountPath: /workspace\n        volumes:\n          - name: training-script\n            configMap:\n              name: pytorch-demo-script\n'})}),"\n",(0,l.jsx)(e.p,{children:"\u5E94\u7528\u914D\u7F6E\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl apply -f trainjob-demo-with-configmap.yaml\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001",children:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u67E5\u770B TrainJob \u72B6\u6001\nkubectl get trainjob trainjob-demo-with-configmap\n\n# \u67E5\u770B Pod \u72B6\u6001\nkubectl get pods -l training.kubeflow.org/job-name=trainjob-demo-with-configmap\n\n# \u67E5\u770B\u8BAD\u7EC3\u65E5\u5FD7\nkubectl logs -l training.kubeflow.org/job-name=trainjob-demo-with-configmap -f\n\n# \u67E5\u770B\u8BE6\u7EC6\u4FE1\u606F\nkubectl describe trainjob trainjob-demo-with-configmap\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u9884\u671F\u8F93\u51FA",children:"\u9884\u671F\u8F93\u51FA"}),"\n",(0,l.jsxs)(e.p,{children:["\u4ECE\u4EFB\u4E00\u8BAD\u7EC3",(0,l.jsx)(e.code,{children:"Pod"}),"\u7684\u65E5\u5FD7\u4E2D\uFF0C\u4F60\u5E94\u8BE5\u770B\u5230\u7C7B\u4F3C\u7684\u8F93\u51FA\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"[\u521D\u59CB\u5316] RANK=0, WORLD_SIZE=4, LOCAL_RANK=0\n[\u521D\u59CB\u5316] MASTER_ADDR=trainjob-demo-with-configmap-node-0-0.trainjob-demo-with-configmap\n[\u521D\u59CB\u5316] MASTER_PORT=29500\n[\u521D\u59CB\u5316\u5B8C\u6210] \u6210\u529F\u521D\u59CB\u5316\u5206\u5E03\u5F0F\u8FDB\u7A0B\u7EC4\n[Rank 0] \u5F00\u59CB\u8BAD\u7EC3\uFF0C\u5171 5 \u4E2A epoch\n------------------------------------------------------------\nEpoch [1/5], Average Loss: 0.0234\nEpoch [2/5], Average Loss: 0.0189\nEpoch [3/5], Average Loss: 0.0156\nEpoch [4/5], Average Loss: 0.0128\nEpoch [5/5], Average Loss: 0.0103\n------------------------------------------------------------\n[Rank 0] \u8BAD\u7EC3\u5B8C\u6210\uFF01\n"})}),"\n",(0,l.jsx)(e.admonition,{title:"\u5206\u5E03\u5F0F\u8BAD\u7EC3\u9A8C\u8BC1",type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u67E5\u770B",(0,l.jsx)(e.code,{children:"WORLD_SIZE"}),"\u786E\u8BA4\u603B\u8FDB\u7A0B\u6570\uFF1A",(0,l.jsx)(e.code,{children:"2\u8282\u70B9 \xd7 2\u8FDB\u7A0B/\u8282\u70B9 = 4\u8FDB\u7A0B"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u67E5\u770B",(0,l.jsx)(e.code,{children:"RANK"}),"\u786E\u8BA4\u8FDB\u7A0B\u7F16\u53F7\uFF1A",(0,l.jsx)(e.code,{children:"0, 1, 2, 3"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u67E5\u770B",(0,l.jsx)(e.code,{children:"MASTER_ADDR"}),"\u786E\u8BA4\u4E3B\u8282\u70B9\u5730\u5740"]}),"\n"]})}),"\n",(0,l.jsx)(e.h4,{id:"\u6E05\u7406\u8D44\u6E90",children:"\u6E05\u7406\u8D44\u6E90"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl delete trainjob trainjob-demo-with-configmap\nkubectl delete configmap pytorch-demo-script\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u90E8\u7F72\u65B9\u5F0F\u4E8Chostpath-\u6302\u8F7D\u811A\u672C",children:"\u90E8\u7F72\u65B9\u5F0F\u4E8C\uFF1AHostPath \u6302\u8F7D\u811A\u672C"}),"\n",(0,l.jsx)(e.h3,{id:"\u65B9\u6848\u8BF4\u660E-1",children:"\u65B9\u6848\u8BF4\u660E"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"HostPath"}),"\u65B9\u5F0F\u5C06\u5BBF\u4E3B\u673A\u76EE\u5F55\u6302\u8F7D\u5230\u8BAD\u7EC3",(0,l.jsx)(e.code,{children:"Pod"}),"\u4E2D\uFF0C\u9002\u5408\u8BAD\u7EC3\u811A\u672C\u9891\u7E41\u53D8\u66F4\u7684\u573A\u666F\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u2705 \u65E0\u9700\u91CD\u5EFA\uFF1A\u76F4\u63A5\u4FEE\u6539\u5BBF\u4E3B\u673A\u6587\u4EF6\uFF0C",(0,l.jsx)(e.code,{children:"Pod"}),"\u91CD\u542F\u5373\u53EF\u751F\u6548"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5927\u6587\u4EF6\u652F\u6301\uFF1A\u4E0D\u53D7",(0,l.jsx)(e.code,{children:"ConfigMap"}),"\u5927\u5C0F\u9650\u5236"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5171\u4EAB\u5B58\u50A8\uFF1A\u591A\u4E2A",(0,l.jsx)(e.code,{children:"Pod"}),"\u53EF\u4EE5\u5171\u4EAB\u76F8\u540C\u7684\u811A\u672C\u548C\u6570\u636E"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u274C \u8282\u70B9\u4F9D\u8D56\uFF1A\u9700\u8981\u786E\u4FDD\u6240\u6709\u8282\u70B9\u90FD\u6709\u76F8\u540C\u8DEF\u5F84\u7684\u6587\u4EF6\uFF08\u53EF\u4EE5\u4F7F\u7528\u4E91\u76D8\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u274C \u5B89\u5168\u98CE\u9669\uFF1A\u76F4\u63A5\u8BBF\u95EE\u5BBF\u4E3B\u673A\u6587\u4EF6\u7CFB\u7EDF"}),"\n",(0,l.jsx)(e.li,{children:"\u274C \u4E0D\u9002\u5408\u751F\u4EA7\uFF1A\u7F3A\u5C11\u9694\u79BB\u548C\u7248\u672C\u63A7\u5236"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u90E8\u7F72\u6B65\u9AA4-1",children:"\u90E8\u7F72\u6B65\u9AA4"}),"\n",(0,l.jsx)(e.h4,{id:"\u51C6\u5907\u5BBF\u4E3B\u673A\u76EE\u5F55",children:"\u51C6\u5907\u5BBF\u4E3B\u673A\u76EE\u5F55"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u6240\u6709\u8BAD\u7EC3\u8282\u70B9\u4E0A\u521B\u5EFA\u76F8\u540C\u7684\u76EE\u5F55\u7ED3\u6784\u5E76\u653E\u7F6E\u811A\u672C\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u5728\u6BCF\u4E2A\u8282\u70B9\u4E0A\u6267\u884C\nsudo mkdir -p /data/kubeflow-training/scripts\nsudo cp pytorch-demo.py /data/kubeflow-training/scripts/\nsudo chmod -R 755 /data/kubeflow-training/scripts\n"})}),"\n",(0,l.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"warning",children:(0,l.jsxs)(e.p,{children:["\u4F7F\u7528",(0,l.jsx)(e.code,{children:"HostPath"}),"\u65F6\uFF0C\u5FC5\u987B\u786E\u4FDD\u811A\u672C\u6587\u4EF6\u5728\u6240\u6709\u53EF\u80FD\u8C03\u5EA6\u8BAD\u7EC3",(0,l.jsx)(e.code,{children:"Pod"}),"\u7684\u8282\u70B9\u4E0A\u90FD\u5B58\u5728\uFF0C\u4E14\u8DEF\u5F84\u5B8C\u5168\u4E00\u81F4\u3002"]})}),"\n",(0,l.jsx)(e.h4,{id:"\u521B\u5EFA-trainjob-1",children:"\u521B\u5EFA TrainJob"}),"\n",(0,l.jsxs)(e.p,{children:["\u521B\u5EFA",(0,l.jsx)(e.code,{children:"trainjob-demo-with-hostpath.yaml"}),"\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: TrainJob\nmetadata:\n  name: trainjob-demo-with-hostpath\nspec:\n  # \u5F15\u7528\u524D\u9762\u5B9A\u4E49\u7684 ClusterTrainingRuntime\n  runtimeRef:\n    kind: ClusterTrainingRuntime\n    name: training-runtime-demo\n  \n  # \u8BAD\u7EC3\u5668\u914D\u7F6E\n  trainer:\n    # \u8BAD\u7EC3\u8282\u70B9\u6570\u91CF\n    numNodes: 2\n    \n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B\u6570\n    numProcPerNode: 2\n    \n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8D44\u6E90\u914D\u7F6E\n    resourcesPerNode:\n      requests:\n        cpu: "1"\n        memory: "2Gi"\n      limits:\n        cpu: "1"\n        memory: "2Gi"\n\n  # Pod \u6A21\u677F\u8986\u76D6\u914D\u7F6E - \u7528\u4E8E\u6302\u8F7D HostPath\n  podTemplateOverrides:\n    - targetJobs:\n        - name: node\n      spec:\n        containers:\n          - name: node\n            volumeMounts:\n              - name: training-script\n                mountPath: /workspace\n                readOnly: true\n        volumes:\n          - name: training-script\n            # \u4F7F\u7528 HostPath \u6302\u8F7D\u5BBF\u4E3B\u673A\u76EE\u5F55\n            hostPath:\n              # \u5BBF\u4E3B\u673A\u4E0A\u7684\u811A\u672C\u76EE\u5F55\u8DEF\u5F84\n              path: /data/kubeflow-training/scripts\n              type: Directory\n'})}),"\n",(0,l.jsx)(e.p,{children:"\u5E94\u7528\u914D\u7F6E\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl apply -f trainjob-demo-with-hostpath.yaml\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001-1",children:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u67E5\u770B TrainJob \u72B6\u6001\nkubectl get trainjob trainjob-demo-with-hostpath\n\n# \u67E5\u770B Pod \u72B6\u6001\nkubectl get pods -l training.kubeflow.org/job-name=trainjob-demo-with-hostpath\n\n# \u67E5\u770B\u8BAD\u7EC3\u65E5\u5FD7\nkubectl logs -l training.kubeflow.org/job-name=trainjob-demo-with-hostpath -f\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u52A8\u6001\u66F4\u65B0\u811A\u672C",children:"\u52A8\u6001\u66F4\u65B0\u811A\u672C"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"HostPath"}),"\u7684\u4F18\u52BF\u5728\u4E8E\u53EF\u4EE5\u52A8\u6001\u66F4\u65B0\u811A\u672C\u800C\u65E0\u9700\u91CD\u5EFA\u955C\u50CF\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u4FEE\u6539\u5BBF\u4E3B\u673A\u4E0A\u7684\u811A\u672C\nsudo vi /data/kubeflow-training/scripts/pytorch-demo.py\n\n# \u5220\u9664\u73B0\u6709\u7684 TrainJob\uFF08\u4F1A\u89E6\u53D1 Pod \u91CD\u542F\uFF09\nkubectl delete trainjob trainjob-demo-with-hostpath\n\n# \u91CD\u65B0\u521B\u5EFA TrainJob\uFF08Pod \u4F1A\u8BFB\u53D6\u6700\u65B0\u7684\u811A\u672C\uFF09\nkubectl apply -f trainjob-demo-with-hostpath.yaml\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u6E05\u7406\u8D44\u6E90-1",children:"\u6E05\u7406\u8D44\u6E90"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl delete trainjob trainjob-demo-with-hostpath\n\n# \u6E05\u7406\u5BBF\u4E3B\u673A\u6587\u4EF6\uFF08\u53EF\u9009\uFF09\nsudo rm -rf /data/kubeflow-training/scripts\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u90E8\u7F72\u65B9\u5F0F\u4E09\u955C\u50CF\u6784\u5EFA\u65B9\u5F0F\u63A8\u8350",children:"\u90E8\u7F72\u65B9\u5F0F\u4E09\uFF1A\u955C\u50CF\u6784\u5EFA\u65B9\u5F0F\uFF08\u63A8\u8350\uFF09"}),"\n",(0,l.jsx)(e.h3,{id:"\u65B9\u6848\u8BF4\u660E-2",children:"\u65B9\u6848\u8BF4\u660E"}),"\n",(0,l.jsxs)(e.p,{children:["\u955C\u50CF\u6784\u5EFA\u65B9\u5F0F\u662F\u751F\u4EA7\u73AF\u5883\u7684\u63A8\u8350\u65B9\u5F0F\uFF0C\u5C06\u8BAD\u7EC3\u811A\u672C\u6253\u5305\u5230",(0,l.jsx)(e.code,{children:"Docker"}),"\u955C\u50CF\u4E2D\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u2705 \u751F\u4EA7\u5C31\u7EEA\uFF1A\u5B8C\u6574\u7684\u7248\u672C\u63A7\u5236\u548C\u56DE\u6EDA\u80FD\u529B"}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u53EF\u79FB\u690D\u6027\uFF1A\u955C\u50CF\u53EF\u4EE5\u5728\u4EFB\u4F55",(0,l.jsx)(e.code,{children:"Kubernetes"}),"\u96C6\u7FA4\u4E2D\u8FD0\u884C"]}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u4F9D\u8D56\u7BA1\u7406\uFF1A\u53EF\u4EE5\u5728\u955C\u50CF\u4E2D\u9884\u88C5\u6240\u6709\u4F9D\u8D56"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u5B89\u5168\u9694\u79BB\uFF1A\u4E0D\u4F9D\u8D56\u5BBF\u4E3B\u673A\u6587\u4EF6\u7CFB\u7EDF"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u274C \u6784\u5EFA\u5F00\u9500\uFF1A\u6BCF\u6B21\u4FEE\u6539\u90FD\u9700\u8981\u91CD\u65B0\u6784\u5EFA\u548C\u63A8\u9001\u955C\u50CF"}),"\n",(0,l.jsx)(e.li,{children:"\u274C \u5B58\u50A8\u6210\u672C\uFF1A\u9700\u8981\u955C\u50CF\u4ED3\u5E93\u5B58\u50A8\u7A7A\u95F4"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u90E8\u7F72\u6B65\u9AA4-2",children:"\u90E8\u7F72\u6B65\u9AA4"}),"\n",(0,l.jsx)(e.h4,{id:"\u521B\u5EFA-dockerfile",children:"\u521B\u5EFA Dockerfile"}),"\n",(0,l.jsxs)(e.p,{children:["\u521B\u5EFA",(0,l.jsx)(e.code,{children:"Dockerfile"}),"\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-dockerfile",children:"FROM --platform=linux/amd64 pytorch/pytorch:2.4.1-cuda11.8-cudnn9-runtime\n\n# \u8BBE\u7F6E\u5DE5\u4F5C\u76EE\u5F55\nWORKDIR /workspace\n\n# \u590D\u5236\u8BAD\u7EC3\u811A\u672C\nCOPY pytorch-demo.py /workspace/pytorch-demo.py\n\n# \u8BBE\u7F6EPython\u4E0D\u7F13\u51B2\u8F93\u51FA\uFF08\u4FBF\u4E8E\u67E5\u770B\u65E5\u5FD7\uFF09\nENV PYTHONUNBUFFERED=1\n"})}),"\n",(0,l.jsx)(e.admonition,{title:"\u955C\u50CF\u8BF4\u660E",type:"info",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u57FA\u7840\u955C\u50CF\uFF1A\u4F7F\u7528\u5B98\u65B9",(0,l.jsx)(e.code,{children:"PyTorch"}),"\u955C\u50CF\uFF0C\u5DF2\u5305\u542B",(0,l.jsx)(e.code,{children:"PyTorch"}),"\u548C\u5E38\u7528\u4F9D\u8D56"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5E73\u53F0\u6307\u5B9A\uFF1A",(0,l.jsx)(e.code,{children:"--platform=linux/amd64"}),"\u786E\u4FDD\u955C\u50CF\u517C\u5BB9\u6027\uFF08\u7279\u522B\u662F\u5728",(0,l.jsx)(e.code,{children:"Apple Silicon"}),"\u4E0A\u6784\u5EFA\u65F6\uFF09"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5DE5\u4F5C\u76EE\u5F55\uFF1A\u5C06\u811A\u672C\u653E\u5728",(0,l.jsx)(e.code,{children:"/workspace"}),"\u76EE\u5F55\uFF0C\u4E0E\u524D\u9762\u7684\u914D\u7F6E\u4FDD\u6301\u4E00\u81F4"]}),"\n"]})}),"\n",(0,l.jsx)(e.h4,{id:"\u6784\u5EFA\u955C\u50CF",children:"\u6784\u5EFA\u955C\u50CF"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"docker buildx build --load --platform linux/amd64 -t pytorch-demo:latest .\n"})}),"\n",(0,l.jsx)(e.admonition,{title:"\u6784\u5EFA\u9009\u9879\u8BF4\u660E",type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"--load"}),"\uFF1A\u6784\u5EFA\u5B8C\u6210\u540E\u52A0\u8F7D\u5230\u672C\u5730",(0,l.jsx)(e.code,{children:"Docker"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"--platform linux/amd64"}),"\uFF1A\u6307\u5B9A\u76EE\u6807\u5E73\u53F0\u4E3A",(0,l.jsx)(e.code,{children:"amd64"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"-t pytorch-demo:latest"}),"\uFF1A\u6307\u5B9A\u955C\u50CF\u6807\u7B7E"]}),"\n"]})}),"\n",(0,l.jsx)(e.p,{children:"\u9A8C\u8BC1\u955C\u50CF\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"docker images | grep pytorch-demo\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u63A8\u9001\u955C\u50CF\u5230\u4ED3\u5E93\u53EF\u9009",children:"\u63A8\u9001\u955C\u50CF\u5230\u4ED3\u5E93\uFF08\u53EF\u9009\uFF09"}),"\n",(0,l.jsx)(e.p,{children:"\u5982\u679C\u662F\u591A\u8282\u70B9\u96C6\u7FA4\uFF0C\u9700\u8981\u5C06\u955C\u50CF\u63A8\u9001\u5230\u955C\u50CF\u4ED3\u5E93\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u6807\u8BB0\u955C\u50CF\ndocker tag pytorch-demo:latest your-registry/pytorch-demo:latest\n\n# \u63A8\u9001\u5230\u955C\u50CF\u4ED3\u5E93\ndocker push your-registry/pytorch-demo:latest\n"})}),"\n",(0,l.jsxs)(e.admonition,{title:"\u672C\u5730\u6D4B\u8BD5",type:"info",children:[(0,l.jsxs)(e.p,{children:["\u5982\u679C\u4F7F\u7528\u5355\u8282\u70B9\u96C6\u7FA4\uFF08\u5982",(0,l.jsx)(e.code,{children:"Kind"}),"\u3001",(0,l.jsx)(e.code,{children:"Minikube"}),"\uFF09\uFF0C\u53EF\u4EE5\u5C06\u955C\u50CF\u76F4\u63A5\u52A0\u8F7D\u5230\u96C6\u7FA4\uFF1A"]}),(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# Kind \u793A\u4F8B\nkind load docker-image pytorch-demo:latest\n\n# Minikube \u793A\u4F8B\nminikube image load pytorch-demo:latest\n"})})]}),"\n",(0,l.jsx)(e.h4,{id:"\u521B\u5EFA-trainjob-2",children:"\u521B\u5EFA TrainJob"}),"\n",(0,l.jsxs)(e.p,{children:["\u521B\u5EFA",(0,l.jsx)(e.code,{children:"trainjob-demo-with-image.yaml"}),"\uFF1A"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'apiVersion: trainer.kubeflow.org/v1alpha1\nkind: TrainJob\nmetadata:\n  name: trainjob-demo-with-image\nspec:\n  # \u5F15\u7528\u524D\u9762\u5B9A\u4E49\u7684 ClusterTrainingRuntime\n  runtimeRef:\n    kind: ClusterTrainingRuntime\n    name: training-runtime-demo\n  \n  # \u8BAD\u7EC3\u5668\u914D\u7F6E\n  trainer:\n    # \u5BB9\u5668\u955C\u50CF\uFF08\u4F1A\u8986\u76D6 runtime \u4E2D\u7684\u955C\u50CF\uFF09\n    image: pytorch-demo:latest\n\n    # \u8BAD\u7EC3\u8282\u70B9\u6570\u91CF\n    numNodes: 2\n    \n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B\u6570\n    numProcPerNode: 2\n    \n    # \u6BCF\u4E2A\u8282\u70B9\u7684\u8D44\u6E90\u914D\u7F6E\n    resourcesPerNode:\n      requests:\n        cpu: "1"\n        memory: "2Gi"\n      limits:\n        cpu: "1"\n        memory: "2Gi"\n'})}),"\n",(0,l.jsx)(e.admonition,{title:"\u955C\u50CF\u8986\u76D6",type:"tip",children:(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"trainer.image"}),"\u5B57\u6BB5\u4F1A\u8986\u76D6",(0,l.jsx)(e.code,{children:"ClusterTrainingRuntime"}),"\u4E2D\u5B9A\u4E49\u7684\u955C\u50CF\uFF0C\u56E0\u6B64\u4E0D\u9700\u8981\u4FEE\u6539",(0,l.jsx)(e.code,{children:"runtime"}),"\u914D\u7F6E\u3002"]})}),"\n",(0,l.jsx)(e.p,{children:"\u5E94\u7528\u914D\u7F6E\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl apply -f trainjob-demo-with-image.yaml\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001-2",children:"\u67E5\u770B\u8BAD\u7EC3\u72B6\u6001"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u67E5\u770B TrainJob \u72B6\u6001\nkubectl get trainjob trainjob-demo-with-image\n\n# \u67E5\u770B Pod \u72B6\u6001\nkubectl get pods -l training.kubeflow.org/job-name=trainjob-demo-with-image\n\n# \u67E5\u770B\u8BAD\u7EC3\u65E5\u5FD7\nkubectl logs -l training.kubeflow.org/job-name=trainjob-demo-with-image -f\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u66F4\u65B0\u8BAD\u7EC3\u811A\u672C",children:"\u66F4\u65B0\u8BAD\u7EC3\u811A\u672C"}),"\n",(0,l.jsx)(e.p,{children:"\u5F53\u9700\u8981\u66F4\u65B0\u8BAD\u7EC3\u811A\u672C\u65F6\uFF1A"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# 1. \u4FEE\u6539\u811A\u672C\nvi pytorch-demo.py\n\n# 2. \u91CD\u65B0\u6784\u5EFA\u955C\u50CF\uFF08\u4F7F\u7528\u65B0\u7684\u7248\u672C\u6807\u7B7E\uFF09\ndocker buildx build --load --platform linux/amd64 -t pytorch-demo:v1.1 .\n\n# 3. \u66F4\u65B0 TrainJob \u914D\u7F6E\u4E2D\u7684\u955C\u50CF\u7248\u672C\n# \u4FEE\u6539 trainjob-demo-with-image.yaml \u4E2D\u7684 image: pytorch-demo:v1.1\n\n# 4. \u91CD\u65B0\u90E8\u7F72\nkubectl delete trainjob trainjob-demo-with-image\nkubectl apply -f trainjob-demo-with-image.yaml\n"})}),"\n",(0,l.jsx)(e.admonition,{title:"\u7248\u672C\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4F7F\u7528\u8BED\u4E49\u5316\u7248\u672C\u53F7\uFF1A",(0,l.jsx)(e.code,{children:"v1.0.0"}),"\u3001",(0,l.jsx)(e.code,{children:"v1.1.0"}),"\u7B49"]}),"\n",(0,l.jsxs)(e.li,{children:["\u907F\u514D\u4F7F\u7528",(0,l.jsx)(e.code,{children:"latest"}),"\u6807\u7B7E\uFF08\u9664\u975E\u662F\u5F00\u53D1\u6D4B\u8BD5\u73AF\u5883\uFF09"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5728",(0,l.jsx)(e.code,{children:"Git"}),"\u4E2D\u4E3A\u6BCF\u4E2A\u955C\u50CF\u7248\u672C\u6253",(0,l.jsx)(e.code,{children:"tag"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u4F7F\u7528",(0,l.jsx)(e.code,{children:"CI/CD"}),"\u81EA\u52A8\u5316\u955C\u50CF\u6784\u5EFA\u548C\u63A8\u9001\u6D41\u7A0B"]}),"\n"]})}),"\n",(0,l.jsx)(e.h4,{id:"\u6E05\u7406\u8D44\u6E90-2",children:"\u6E05\u7406\u8D44\u6E90"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl delete trainjob trainjob-demo-with-image\n\n# \u6E05\u7406\u672C\u5730\u955C\u50CF\uFF08\u53EF\u9009\uFF09\ndocker rmi pytorch-demo:latest\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u5BF9\u6BD4",children:"\u4E09\u79CD\u90E8\u7F72\u65B9\u5F0F\u5BF9\u6BD4"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u5BF9\u6BD4\u7EF4\u5EA6"}),(0,l.jsx)(e.th,{children:"ConfigMap"}),(0,l.jsx)(e.th,{children:"HostPath"}),(0,l.jsx)(e.th,{children:"\u955C\u50CF\u6784\u5EFA"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F"})}),(0,l.jsx)(e.td,{children:"\u5FEB\u901F\u5F00\u53D1\u3001\u5C0F\u811A\u672C\u6D4B\u8BD5"}),(0,l.jsx)(e.td,{children:"\u9891\u7E41\u4FEE\u6539\u3001\u672C\u5730\u5F00\u53D1"}),(0,l.jsx)(e.td,{children:"\u751F\u4EA7\u73AF\u5883\u3001\u591A\u96C6\u7FA4\u90E8\u7F72"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u66F4\u65B0\u901F\u5EA6"})}),(0,l.jsx)(e.td,{children:"\u26A1 \u5FEB\uFF08\u66F4\u65B0ConfigMap\uFF09"}),(0,l.jsx)(e.td,{children:"\u26A1\u26A1 \u6700\u5FEB\uFF08\u4FEE\u6539\u6587\u4EF6\uFF09"}),(0,l.jsx)(e.td,{children:"\uD83D\uDC22 \u6162\uFF08\u91CD\u65B0\u6784\u5EFA\u955C\u50CF\uFF09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u7248\u672C\u63A7\u5236"})}),(0,l.jsx)(e.td,{children:"\u274C \u4E0D\u652F\u6301"}),(0,l.jsx)(e.td,{children:"\u274C \u4E0D\u652F\u6301"}),(0,l.jsx)(e.td,{children:"\u2705 \u5B8C\u6574\u652F\u6301"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u4F9D\u8D56\u7BA1\u7406"})}),(0,l.jsx)(e.td,{children:"\u274C \u9700\u57FA\u7840\u955C\u50CF\u5305\u542B"}),(0,l.jsx)(e.td,{children:"\u274C \u9700\u57FA\u7840\u955C\u50CF\u5305\u542B"}),(0,l.jsx)(e.td,{children:"\u2705 \u53EF\u81EA\u5B9A\u4E49\u5B89\u88C5"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u6587\u4EF6\u5927\u5C0F\u9650\u5236"})}),(0,l.jsx)(e.td,{children:"\u26A0\uFE0F 1MB"}),(0,l.jsx)(e.td,{children:"\u2705 \u65E0\u9650\u5236"}),(0,l.jsx)(e.td,{children:"\u2705 \u65E0\u9650\u5236"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u591A\u8282\u70B9\u540C\u6B65"})}),(0,l.jsx)(e.td,{children:"\u2705 \u81EA\u52A8\u540C\u6B65"}),(0,l.jsx)(e.td,{children:"\u274C \u9700\u624B\u52A8\u540C\u6B65"}),(0,l.jsx)(e.td,{children:"\u2705 \u81EA\u52A8\u540C\u6B65"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u5B89\u5168\u6027"})}),(0,l.jsx)(e.td,{children:"\u2705 \u8F83\u597D"}),(0,l.jsx)(e.td,{children:"\u26A0\uFE0F \u8F83\u5DEE"}),(0,l.jsx)(e.td,{children:"\u2705 \u6700\u597D"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u53EF\u79FB\u690D\u6027"})}),(0,l.jsx)(e.td,{children:"\u26A1 \u4E2D\u7B49"}),(0,l.jsx)(e.td,{children:"\u274C \u5DEE"}),(0,l.jsx)(e.td,{children:"\u2705 \u6700\u597D"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"\u751F\u4EA7\u5C31\u7EEA"})}),(0,l.jsx)(e.td,{children:"\u274C"}),(0,l.jsx)(e.td,{children:"\u274C"}),(0,l.jsx)(e.td,{children:"\u2705"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",children:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5"}),"\n",(0,l.jsx)(e.h3,{id:"pod-pending",children:"Pod Pending"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u9898\u63CF\u8FF0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\ntrainjob-demo-node-0-0-xxxxx          0/1     Pending   0          5m\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6392\u67E5\u6B65\u9AA4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u67E5\u770B Pod \u8BE6\u60C5\nkubectl describe pod <pod-name>\n\n# \u5E38\u89C1\u539F\u56E0\uFF1A\n# 1. \u8D44\u6E90\u4E0D\u8DB3\uFF1AInsufficient cpu/memory\n# 2. \u8282\u70B9\u4E0D\u53EF\u8C03\u5EA6\uFF1ANode Unschedulable\n# 3. \u955C\u50CF\u62C9\u53D6\u5931\u8D25\uFF1AImagePullBackOff\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'# 1. \u964D\u4F4E\u8D44\u6E90\u8BF7\u6C42\nresourcesPerNode:\n  requests:\n    cpu: "500m"    # \u964D\u4F4E\u5230500\u6BEB\u6838\n    memory: "1Gi"  # \u964D\u4F4E\u52301GB\n\n# 2. \u68C0\u67E5\u8282\u70B9\u72B6\u6001\nkubectl get nodes\nkubectl describe node <node-name>\n\n# 3. \u4F7F\u7528\u672C\u5730\u955C\u50CF\uFF08\u5F00\u53D1\u73AF\u5883\uFF09\nimagePullPolicy: Never  # \u6DFB\u52A0\u5230\u5BB9\u5668\u914D\u7F6E\u4E2D\n'})}),"\n",(0,l.jsx)(e.h3,{id:"configmap-not-found",children:"ConfigMap Not Found"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u9898\u63CF\u8FF0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'Error: configmaps "pytorch-demo-script" not found\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# 1. \u786E\u8BA4 ConfigMap \u662F\u5426\u5B58\u5728\nkubectl get configmap\n\n# 2. \u786E\u8BA4\u547D\u540D\u7A7A\u95F4\u662F\u5426\u6B63\u786E\nkubectl get configmap -n <namespace>\n\n# 3. \u91CD\u65B0\u521B\u5EFA ConfigMap\nkubectl create configmap pytorch-demo-script --from-file=pytorch-demo.py\n"})}),"\n",(0,l.jsx)(e.h3,{id:"hostpath-\u6587\u4EF6\u4E0D\u5B58\u5728",children:"HostPath \u6587\u4EF6\u4E0D\u5B58\u5728"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u9898\u63CF\u8FF0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"Error: failed to start container: stat /data/kubeflow-training/scripts: no such file or directory\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# 1. \u767B\u5F55\u5230\u8BAD\u7EC3 Pod \u8C03\u5EA6\u7684\u8282\u70B9\nkubectl get pod <pod-name> -o wide  # \u67E5\u770B NODE \u5217\n\n# 2. \u5728\u8BE5\u8282\u70B9\u4E0A\u521B\u5EFA\u76EE\u5F55\u5E76\u590D\u5236\u6587\u4EF6\nssh <node>\nsudo mkdir -p /data/kubeflow-training/scripts\nsudo cp pytorch-demo.py /data/kubeflow-training/scripts/\nsudo chmod -R 755 /data/kubeflow-training/scripts\n\n# 3. \u5BF9\u6240\u6709\u53EF\u80FD\u7684\u8BAD\u7EC3\u8282\u70B9\u91CD\u590D\u4E0A\u8FF0\u6B65\u9AA4\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u8BAD\u7EC3\u4EFB\u52A1\u5361\u4F4F\u4E0D\u542F\u52A8",children:"\u8BAD\u7EC3\u4EFB\u52A1\u5361\u4F4F\u4E0D\u542F\u52A8"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u95EE\u9898\u63CF\u8FF0\uFF1A"}),"\n\u6240\u6709",(0,l.jsx)(e.code,{children:"Pod"}),"\u90FD\u5904\u4E8E",(0,l.jsx)(e.code,{children:"Running"}),"\u72B6\u6001\uFF0C\u4F46\u8BAD\u7EC3\u65E5\u5FD7\u6CA1\u6709\u8F93\u51FA\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6392\u67E5\u6B65\u9AA4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# 1. \u67E5\u770B\u6240\u6709 Pod \u7684\u65E5\u5FD7\nkubectl logs -l training.kubeflow.org/job-name=<trainjob-name> --all-containers\n\n# 2. \u68C0\u67E5\u73AF\u5883\u53D8\u91CF\u662F\u5426\u6B63\u786E\u6CE8\u5165\nkubectl exec <pod-name> -- env | grep PET_\n\n# 3. \u68C0\u67E5\u7F51\u7EDC\u8FDE\u901A\u6027\nkubectl exec <pod-name> -- ping <master-pod-ip>\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E38\u89C1\u539F\u56E0\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4E3B\u8282\u70B9\u5730\u5740",(0,l.jsx)(e.code,{children:"MASTER_ADDR"}),"\u4E0D\u6B63\u786E"]}),"\n",(0,l.jsxs)(e.li,{children:["\u7AEF\u53E3",(0,l.jsx)(e.code,{children:"29500"}),"\u88AB\u5360\u7528\u6216\u65E0\u6CD5\u8BBF\u95EE"]}),"\n",(0,l.jsxs)(e.li,{children:["\u9632\u706B\u5899\u89C4\u5219\u963B\u6B62\u4E86",(0,l.jsx)(e.code,{children:"Pod"}),"\u95F4\u901A\u4FE1"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'# 1. \u68C0\u67E5 ClusterTrainingRuntime \u914D\u7F6E\n# \u786E\u4FDD replicatedJobs \u540D\u79F0\u4E3A "node"\nreplicatedJobs:\n- name: node  # \u5FC5\u987B\u662F "node"\n\n# 2. \u68C0\u67E5\u7AEF\u53E3\u914D\u7F6E\n# \u5982\u679C\u7AEF\u53E3\u51B2\u7A81\uFF0C\u53EF\u4EE5\u4FEE\u6539\u9ED8\u8BA4\u7AEF\u53E3\nenv:\n- name: MASTER_PORT\n  value: "29501"  # \u4F7F\u7528\u4E0D\u540C\u7684\u7AEF\u53E3\n'})}),"\n",(0,l.jsx)(e.h3,{id:"api-\u7248\u672C\u9519\u8BEF",children:"API \u7248\u672C\u9519\u8BEF"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u9898\u63CF\u8FF0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'error: unable to recognize "trainjob.yaml": no matches for kind "TrainJob" in version "trainer.kubeflow.org/v2alpha1"\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# 1. \u786E\u8BA4\u96C6\u7FA4\u652F\u6301\u7684 API \u7248\u672C\nkubectl api-resources | grep trainjob\n\n# 2. \u4F7F\u7528\u6B63\u786E\u7684 API \u7248\u672C\napiVersion: trainer.kubeflow.org/v1alpha1  # \u800C\u4E0D\u662F v2alpha1\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u6700\u4F73\u5B9E\u8DF5",children:"\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,l.jsx)(e.h3,{id:"\u8D44\u6E90\u914D\u7F6E",children:"\u8D44\u6E90\u914D\u7F6E"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'# \u751F\u4EA7\u73AF\u5883\u63A8\u8350\u914D\u7F6E\ntrainer:\n  numNodes: 4\n  numProcPerNode: 8\n  resourcesPerNode:\n    requests:\n      cpu: "16"\n      memory: "64Gi"\n      nvidia.com/gpu: 4  # GPU\u8BAD\u7EC3\n    limits:\n      cpu: "16"\n      memory: "64Gi"\n      nvidia.com/gpu: 4\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u76D1\u63A7\u548C\u65E5\u5FD7",children:"\u76D1\u63A7\u548C\u65E5\u5FD7"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'# \u6DFB\u52A0\u5230 ClusterTrainingRuntime \u7684\u5BB9\u5668\u914D\u7F6E\u4E2D\nenv:\n# \u65E5\u5FD7\u914D\u7F6E\n- name: PYTHONUNBUFFERED\n  value: "1"\n- name: LOGLEVEL\n  value: "INFO"\n\n# Prometheus \u76D1\u63A7\uFF08\u5982\u679C\u4F7F\u7528\uFF09\n- name: PROMETHEUS_PUSHGATEWAY\n  value: "http://prometheus-pushgateway:9091"\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u4EFB\u52A1\u5BB9\u9519",children:"\u4EFB\u52A1\u5BB9\u9519"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# \u5728 ClusterTrainingRuntime \u4E2D\u914D\u7F6E\nspec:\n  template:\n    spec:\n      replicatedJobs:\n      - name: node\n        template:\n          spec:\n            # \u5931\u8D25\u91CD\u8BD5\u6B21\u6570\n            backoffLimit: 3\n            # \u4EFB\u52A1\u5B8C\u6210\u540E\u4FDD\u7559\u65F6\u95F4\n            ttlSecondsAfterFinished: 3600\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u5F39\u6027\u8BAD\u7EC3",children:"\u5F39\u6027\u8BAD\u7EC3"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# \u652F\u6301\u52A8\u6001\u6269\u7F29\u5BB9\uFF08PyTorch Elastic\uFF09\nspec:\n  mlPolicy:\n    numNodes: 4\n    torch:\n      numProcPerNode: auto\n      # \u542F\u7528\u5F39\u6027\u8BAD\u7EC3\n      elasticPolicy:\n        minNodes: 2       # \u6700\u5C11\u8282\u70B9\u6570\n        maxNodes: 8       # \u6700\u591A\u8282\u70B9\u6570\n        maxRestarts: 3    # \u6700\u5927\u91CD\u542F\u6B21\u6570\n"})}),"\n",(0,l.jsx)(e.h3,{id:"gpu-\u8BAD\u7EC3\u914D\u7F6E",children:"GPU \u8BAD\u7EC3\u914D\u7F6E"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'# GPU \u8BAD\u7EC3\u793A\u4F8B\nspec:\n  mlPolicy:\n    torch:\n      numProcPerNode: gpu  # \u81EA\u52A8\u68C0\u6D4B GPU \u6570\u91CF\n  template:\n    spec:\n      replicatedJobs:\n      - name: node\n        template:\n          spec:\n            template:\n              spec:\n                containers:\n                - name: node\n                  resources:\n                    limits:\n                      nvidia.com/gpu: 4  # \u6BCF\u8282\u70B94\u4E2AGPU\n                  # GPU\u8BAD\u7EC3\u4F7F\u7528NCCL\u540E\u7AEF\n                  env:\n                  - name: NCCL_DEBUG\n                    value: "INFO"\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u53C2\u8003\u8D44\u6599",children:"\u53C2\u8003\u8D44\u6599"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.kubeflow.org/docs/components/trainer/",children:"Kubeflow Trainer \u5B98\u65B9\u6587\u6863"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/kubeflow/trainer",children:"Kubeflow Trainer GitHub"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pytorch.org/tutorials/intermediate/ddp_tutorial.html",children:"PyTorch \u5206\u5E03\u5F0F\u8BAD\u7EC3\u6559\u7A0B"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pytorch.org/docs/stable/elastic/run.html",children:"torchrun \u6587\u6863"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://kubernetes.io/docs/concepts/configuration/configmap/",children:"Kubernetes ConfigMap"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://kubernetes.io/docs/concepts/storage/volumes/#hostpath",children:"Kubernetes HostPath"})}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,s.a)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},50065:function(n,e,r){r.d(e,{Z:function(){return c},a:function(){return d}});var i=r(67294);let l={},s=i.createContext(l);function d(n){let e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);