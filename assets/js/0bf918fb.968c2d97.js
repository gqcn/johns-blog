"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["5996"],{77131:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,contentTitle:()=>s,default:()=>k,assets:()=>a,toc:()=>u,frontMatter:()=>i});var t=JSON.parse('{"id":"docs/\u4E91\u539F\u751F/Kubernetes/Kubernetes\u4F7F\u7528\u7B14\u8BB0/Kubernetes\u751F\u6210Bearer Token","title":"Kubernetes\u751F\u6210Bearer Token","description":"\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u4ECE\u73B0\u6709\u7684admin\u6743\u9650kubeconfig\u6587\u4EF6\u751F\u6210\u53EF\u7528\u4E8EBearer Token\u9A8C\u8BC1\u7684\u5185\u5BB9\u3002\u5305\u62EC\u521B\u5EFAServiceAccount\u3001\u7ED1\u5B9ARBAC\u6743\u9650\u3001\u63D0\u53D6Token\u3001\u751F\u6210\u65B0kubeconfig\u6587\u4EF6\u7B49\u5B8C\u6574\u6D41\u7A0B\uFF0C\u4EE5\u53CA\u4F7F\u7528curl\u548Ckubectl\u8FDB\u884C\u9A8C\u8BC1\u7684\u65B9\u6CD5\u3002","source":"@site/docs/docs/2000-\u4E91\u539F\u751F/200-Kubernetes/100-Kubernetes\u4F7F\u7528\u7B14\u8BB0/3000-Kubernetes\u751F\u6210Bearer Token.md","sourceDirName":"docs/2000-\u4E91\u539F\u751F/200-Kubernetes/100-Kubernetes\u4F7F\u7528\u7B14\u8BB0","slug":"/cloud-native/kubernetes-generate-bearer-token","permalink":"/cloud-native/kubernetes-generate-bearer-token","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3000,"frontMatter":{"slug":"/cloud-native/kubernetes-generate-bearer-token","title":"Kubernetes\u751F\u6210Bearer Token","hide_title":true,"keywords":["Kubernetes","Bearer Token","ServiceAccount","kubeconfig","\u8BA4\u8BC1","\u6388\u6743","RBAC","ClusterRole","ClusterRoleBinding","Secret","Token\u8BA4\u8BC1","API\u8BBF\u95EE","\u96C6\u7FA4\u7BA1\u7406","\u6743\u9650\u7BA1\u7406","kubectl","cluster-admin","CA\u8BC1\u4E66","API Server","\u957F\u671FToken","\u5B89\u5168\u8BA4\u8BC1"],"description":"\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u4ECE\u73B0\u6709\u7684admin\u6743\u9650kubeconfig\u6587\u4EF6\u751F\u6210\u53EF\u7528\u4E8EBearer Token\u9A8C\u8BC1\u7684\u5185\u5BB9\u3002\u5305\u62EC\u521B\u5EFAServiceAccount\u3001\u7ED1\u5B9ARBAC\u6743\u9650\u3001\u63D0\u53D6Token\u3001\u751F\u6210\u65B0kubeconfig\u6587\u4EF6\u7B49\u5B8C\u6574\u6D41\u7A0B\uFF0C\u4EE5\u53CA\u4F7F\u7528curl\u548Ckubectl\u8FDB\u884C\u9A8C\u8BC1\u7684\u65B9\u6CD5\u3002"},"sidebar":"mainSidebar","previous":{"title":"Kubernetes kustomize","permalink":"/cloud-native/kubernetes-kustomize"},"next":{"title":"Kubernetes\u5BA1\u8BA1\u65E5\u5FD7\u5F00\u542F\u4E0E\u67E5\u770B","permalink":"/cloud-native/kubernetes-audit-log"}}'),o=r("85893"),c=r("50065");let i={slug:"/cloud-native/kubernetes-generate-bearer-token",title:"Kubernetes\u751F\u6210Bearer Token",hide_title:!0,keywords:["Kubernetes","Bearer Token","ServiceAccount","kubeconfig","\u8BA4\u8BC1","\u6388\u6743","RBAC","ClusterRole","ClusterRoleBinding","Secret","Token\u8BA4\u8BC1","API\u8BBF\u95EE","\u96C6\u7FA4\u7BA1\u7406","\u6743\u9650\u7BA1\u7406","kubectl","cluster-admin","CA\u8BC1\u4E66","API Server","\u957F\u671FToken","\u5B89\u5168\u8BA4\u8BC1"],description:"\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u4ECE\u73B0\u6709\u7684admin\u6743\u9650kubeconfig\u6587\u4EF6\u751F\u6210\u53EF\u7528\u4E8EBearer Token\u9A8C\u8BC1\u7684\u5185\u5BB9\u3002\u5305\u62EC\u521B\u5EFAServiceAccount\u3001\u7ED1\u5B9ARBAC\u6743\u9650\u3001\u63D0\u53D6Token\u3001\u751F\u6210\u65B0kubeconfig\u6587\u4EF6\u7B49\u5B8C\u6574\u6D41\u7A0B\uFF0C\u4EE5\u53CA\u4F7F\u7528curl\u548Ckubectl\u8FDB\u884C\u9A8C\u8BC1\u7684\u65B9\u6CD5\u3002"},s=void 0,a={},u=[{value:"\u521B\u5EFAServiceAccount\u548C\u76F8\u5173\u8D44\u6E90",id:"\u521B\u5EFAserviceaccount\u548C\u76F8\u5173\u8D44\u6E90",level:2},{value:"\u5E94\u7528\u914D\u7F6E\u5E76\u83B7\u53D6Token",id:"\u5E94\u7528\u914D\u7F6E\u5E76\u83B7\u53D6token",level:2},{value:"\u751F\u6210\u65B0\u7684kubeconfig\u6587\u4EF6",id:"\u751F\u6210\u65B0\u7684kubeconfig\u6587\u4EF6",level:2},{value:"\u9A8C\u8BC1\u751F\u6210\u7684Bearer Token kubeconfig",id:"\u9A8C\u8BC1\u751F\u6210\u7684bearer-token-kubeconfig",level:2},{value:"\u4F7F\u7528curl\u9A8C\u8BC1Bearer Token",id:"\u4F7F\u7528curl\u9A8C\u8BC1bearer-token",level:2}];function l(e){let n={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,c.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["\u4EE5\u4E0B\u901A\u8FC7\u73B0\u6709\u7684",(0,o.jsx)(n.code,{children:"admin"}),"\u6743\u9650",(0,o.jsx)(n.code,{children:"kubeconfig"}),"\u6587\u4EF6\u751F\u6210\u53EF\u7528\u4E8E",(0,o.jsx)(n.code,{children:"Bearer Token"}),"\u9A8C\u8BC1\u7684\u5185\u5BB9\u3002"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["\u4EE5\u4E0B\u65B9\u5F0F\u751F\u6210\u7684",(0,o.jsx)(n.code,{children:"Bearer Token"}),"\u662F\u957F\u671F\u6709\u6548\u7684\uFF0C\u8BF7\u59A5\u5584\u4FDD\u7BA1\u3002"]})}),"\n",(0,o.jsx)(n.h2,{id:"\u521B\u5EFAserviceaccount\u548C\u76F8\u5173\u8D44\u6E90",children:"\u521B\u5EFAServiceAccount\u548C\u76F8\u5173\u8D44\u6E90"}),"\n",(0,o.jsxs)(n.p,{children:["\u5176\u4E2D\u7684\u547D\u540D\u7A7A\u95F4",(0,o.jsx)(n.code,{children:"kube-system"}),"\u53EF\u6839\u636E\u9700\u8981\u8C03\u6574\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# serviceaccount.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-token-user\n  namespace: kube-system\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: admin-token-user-secret\n  namespace: kube-system\n  annotations:\n    kubernetes.io/service-account.name: admin-token-user\ntype: kubernetes.io/service-account-token\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-token-user-binding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-token-user\n  namespace: kube-system\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5E94\u7528\u914D\u7F6E\u5E76\u83B7\u53D6token",children:"\u5E94\u7528\u914D\u7F6E\u5E76\u83B7\u53D6Token"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u5E94\u7528\u914D\u7F6E\nkubectl apply -f serviceaccount.yaml\n\n# \u83B7\u53D6Token\nTOKEN=$(kubectl get secret admin-token-user-secret -n kube-system -o jsonpath='{.data.token}' | base64 -d)\n\n# \u83B7\u53D6\u96C6\u7FA4CA\u8BC1\u4E66\nCA_CERT=$(kubectl get secret admin-token-user-secret -n kube-system -o jsonpath='{.data.ca\\.crt}')\n\n# \u83B7\u53D6API Server\u5730\u5740\uFF08\u4ECE\u73B0\u6709kubeconfig\u4E2D\u63D0\u53D6\uFF09\nAPI_SERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')\n\necho \"Token: $TOKEN\"\necho \"API Server: $API_SERVER\"\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u751F\u6210\u65B0\u7684kubeconfig\u6587\u4EF6",children:"\u751F\u6210\u65B0\u7684kubeconfig\u6587\u4EF6"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u521B\u5EFA\u65B0\u7684kubeconfig\u6587\u4EF6\ncat > kubeconfig-bearer-token.yaml << EOF\napiVersion: v1\nkind: Config\nclusters:\n- cluster:\n    certificate-authority-data: $CA_CERT\n    server: $API_SERVER\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    user: admin-token-user\n  name: admin-token-user@kubernetes\ncurrent-context: admin-token-user@kubernetes\nusers:\n- name: admin-token-user\n  user:\n    token: $TOKEN\nEOF\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u9A8C\u8BC1\u751F\u6210\u7684bearer-token-kubeconfig",children:"\u9A8C\u8BC1\u751F\u6210\u7684Bearer Token kubeconfig"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# \u4F7F\u7528\u65B0\u7684kubeconfig\u6D4B\u8BD5\u8FDE\u63A5\nexport KUBECONFIG=kubeconfig-bearer-token.yaml\n\n# \u6D4B\u8BD5\u96C6\u7FA4\u8BBF\u95EE\nkubectl cluster-info\n\n# \u6D4B\u8BD5\u6743\u9650\nkubectl auth can-i "*" "*" --all-namespaces\n\n# \u6D4B\u8BD5\u83B7\u53D6\u8282\u70B9\u4FE1\u606F\nkubectl get nodes\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u4F7F\u7528curl\u9A8C\u8BC1bearer-token",children:"\u4F7F\u7528curl\u9A8C\u8BC1Bearer Token"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl -k -H "Authorization: Bearer $TOKEN" \\\n     -H "Content-Type: application/json" \\\n     $API_SERVER/api/v1/nodes\n'})})]})}function k(e={}){let{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},50065:function(e,n,r){r.d(n,{Z:function(){return s},a:function(){return i}});var t=r(67294);let o={},c=t.createContext(o);function i(e){let n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);