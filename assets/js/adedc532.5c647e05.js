"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["103"],{34121:function(e,n,i){i.r(n),i.d(n,{metadata:()=>o,contentTitle:()=>a,default:()=>u,assets:()=>s,toc:()=>l,frontMatter:()=>t});var o=JSON.parse('{"id":"docs/\u4E91\u539F\u751F/\u4F7F\u7528Kubernetes Kind\u642D\u5EFAAI\u7B97\u529B\u6D4B\u8BD5\u96C6\u7FA4","title":"\u4F7F\u7528Kubernetes Kind\u6A21\u62DFAI\u7B97\u529B\u6D4B\u8BD5\u96C6\u7FA4","description":"\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\u5982\u4F55\u4F7F\u7528Kind\u5DE5\u5177\u5FEB\u901F\u642D\u5EFA\u6A21\u62DFAI\u7B97\u529B\u573A\u666F\u7684Kubernetes\u672C\u5730\u6D4B\u8BD5\u96C6\u7FA4\uFF0C\u5E76\u5B89\u88C5Volcano\u8C03\u5EA6\u5668\u8FDB\u884C\u8D44\u6E90\u7BA1\u7406\u3002\u9002\u7528\u4E8E\u9700\u8981\u5728\u672C\u5730\u73AF\u5883\u4E2D\u6D4B\u8BD5AI\u8BAD\u7EC3\u4EFB\u52A1\u8C03\u5EA6\u548C\u8D44\u6E90\u62A2\u5360\u673A\u5236\u7684\u5F00\u53D1\u8005\u3002","source":"@site/docs/docs/2000-\u4E91\u539F\u751F/4000-\u4F7F\u7528Kubernetes Kind\u642D\u5EFAAI\u7B97\u529B\u6D4B\u8BD5\u96C6\u7FA4.md","sourceDirName":"docs/2000-\u4E91\u539F\u751F","slug":"/cloud-native/kubernettes-kind-mock-ai-test-cluster","permalink":"/cloud-native/kubernettes-kind-mock-ai-test-cluster","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4000,"frontMatter":{"slug":"/cloud-native/kubernettes-kind-mock-ai-test-cluster","title":"\u4F7F\u7528Kubernetes Kind\u6A21\u62DFAI\u7B97\u529B\u6D4B\u8BD5\u96C6\u7FA4","hide_title":true,"keywords":["Kubernetes","Kind","Volcano","AI\u7B97\u529B","\u8D44\u6E90\u8C03\u5EA6","\u6D4B\u8BD5\u96C6\u7FA4","Docker","k8s","\u4E91\u539F\u751F","\u9AD8\u6027\u80FD\u8BA1\u7B97"],"description":"\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\u5982\u4F55\u4F7F\u7528Kind\u5DE5\u5177\u5FEB\u901F\u642D\u5EFA\u6A21\u62DFAI\u7B97\u529B\u573A\u666F\u7684Kubernetes\u672C\u5730\u6D4B\u8BD5\u96C6\u7FA4\uFF0C\u5E76\u5B89\u88C5Volcano\u8C03\u5EA6\u5668\u8FDB\u884C\u8D44\u6E90\u7BA1\u7406\u3002\u9002\u7528\u4E8E\u9700\u8981\u5728\u672C\u5730\u73AF\u5883\u4E2D\u6D4B\u8BD5AI\u8BAD\u7EC3\u4EFB\u52A1\u8C03\u5EA6\u548C\u8D44\u6E90\u62A2\u5360\u673A\u5236\u7684\u5F00\u53D1\u8005\u3002"},"sidebar":"mainSidebar","previous":{"title":"Volcano\u5C42\u7EA7\u961F\u5217\u914D\u7F6E\u5F15\u53D1\u7684\u8C03\u5EA6\u5668\u7CFB\u7EDF\u6027\u6545\u969C\u95EE\u9898","permalink":"/cloud-native/volcano-hierarchy-queue-scheduling-issue"},"next":{"title":"\u65E5\u5E38\u7B14\u8BB0","permalink":"/notes"}}'),r=i("85893"),c=i("50065");let t={slug:"/cloud-native/kubernettes-kind-mock-ai-test-cluster",title:"\u4F7F\u7528Kubernetes Kind\u6A21\u62DFAI\u7B97\u529B\u6D4B\u8BD5\u96C6\u7FA4",hide_title:!0,keywords:["Kubernetes","Kind","Volcano","AI\u7B97\u529B","\u8D44\u6E90\u8C03\u5EA6","\u6D4B\u8BD5\u96C6\u7FA4","Docker","k8s","\u4E91\u539F\u751F","\u9AD8\u6027\u80FD\u8BA1\u7B97"],description:"\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\u5982\u4F55\u4F7F\u7528Kind\u5DE5\u5177\u5FEB\u901F\u642D\u5EFA\u6A21\u62DFAI\u7B97\u529B\u573A\u666F\u7684Kubernetes\u672C\u5730\u6D4B\u8BD5\u96C6\u7FA4\uFF0C\u5E76\u5B89\u88C5Volcano\u8C03\u5EA6\u5668\u8FDB\u884C\u8D44\u6E90\u7BA1\u7406\u3002\u9002\u7528\u4E8E\u9700\u8981\u5728\u672C\u5730\u73AF\u5883\u4E2D\u6D4B\u8BD5AI\u8BAD\u7EC3\u4EFB\u52A1\u8C03\u5EA6\u548C\u8D44\u6E90\u62A2\u5360\u673A\u5236\u7684\u5F00\u53D1\u8005\u3002"},a=void 0,s={},l=[{value:"\u521B\u5EFA\u6D4B\u8BD5\u96C6\u7FA4",id:"\u521B\u5EFA\u6D4B\u8BD5\u96C6\u7FA4",level:2},{value:"\u521B\u5EFA Kind \u914D\u7F6E\u6587\u4EF6",id:"\u521B\u5EFA-kind-\u914D\u7F6E\u6587\u4EF6",level:3},{value:"\u6267\u884C\u96C6\u7FA4\u521B\u5EFA",id:"\u6267\u884C\u96C6\u7FA4\u521B\u5EFA",level:3},{value:"\u5B89\u88C5 Volcano",id:"\u5B89\u88C5-volcano",level:2},{value:"\u5E38\u89C1\u95EE\u9898\u89E3\u51B3",id:"\u5E38\u89C1\u95EE\u9898\u89E3\u51B3",level:3},{value:"\u672C\u5730VPN\u73AF\u5883\u53D8\u91CF\u4EE3\u7406\u5F15\u8D77Kind\u62C9\u53D6\u955C\u50CF\u5931\u8D25",id:"\u672C\u5730vpn\u73AF\u5883\u53D8\u91CF\u4EE3\u7406\u5F15\u8D77kind\u62C9\u53D6\u955C\u50CF\u5931\u8D25",level:4},{value:"\u6A21\u62DFNFD&amp;GFD\u6807\u7B7E",id:"\u6A21\u62DFnfdgfd\u6807\u7B7E",level:2},{value:"\u6A21\u62DF\u6807\u7B7E\u811A\u672C",id:"\u6A21\u62DF\u6807\u7B7E\u811A\u672C",level:3},{value:"\u6267\u884C\u6807\u7B7E\u811A\u672C",id:"\u6267\u884C\u6807\u7B7E\u811A\u672C",level:3},{value:"\u9A8C\u8BC1\u6267\u884C\u7ED3\u679C",id:"\u9A8C\u8BC1\u6267\u884C\u7ED3\u679C",level:3},{value:"\u6A21\u62DFGPU\u8D44\u6E90\u7C7B\u578B",id:"\u6A21\u62DFgpu\u8D44\u6E90\u7C7B\u578B",level:2},{value:"\u6A21\u62DFGPU\u8D44\u6E90\u811A\u672C",id:"\u6A21\u62DFgpu\u8D44\u6E90\u811A\u672C",level:3},{value:"\u6267\u884CGPU\u8D44\u6E90\u811A\u672C",id:"\u6267\u884Cgpu\u8D44\u6E90\u811A\u672C",level:3},{value:"\u9A8C\u8BC1GPU\u8D44\u6E90\u7ED3\u679C",id:"\u9A8C\u8BC1gpu\u8D44\u6E90\u7ED3\u679C",level:3},{value:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217",id:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217",level:2},{value:"\u6D4B\u8BD5\u961F\u5217YAML",id:"\u6D4B\u8BD5\u961F\u5217yaml",level:3},{value:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217",id:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217-1",level:3},{value:"\u67E5\u770B\u521B\u5EFA\u961F\u5217",id:"\u67E5\u770B\u521B\u5EFA\u961F\u5217",level:3},{value:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1",id:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1",level:2},{value:"\u6D4B\u8BD5\u4EFB\u52A1YAML",id:"\u6D4B\u8BD5\u4EFB\u52A1yaml",level:3},{value:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1",id:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1-1",level:3},{value:"\u67E5\u770B\u6D4B\u8BD5\u4EFB\u52A1",id:"\u67E5\u770B\u6D4B\u8BD5\u4EFB\u52A1",level:3}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",...(0,c.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["\u5728\u5F00\u53D1\u548C\u6D4B\u8BD5",(0,r.jsx)(n.code,{children:"AI"}),"\u5E94\u7528\u65F6\uFF0C\u6211\u4EEC\u5E38\u9700\u8981\u4E00\u4E2A\u80FD\u6A21\u62DF\u751F\u4EA7\u73AF\u5883\u7684\u672C\u5730",(0,r.jsx)(n.code,{children:"Kubernetes"}),"\u96C6\u7FA4\u3002\u7279\u522B\u662F\u5BF9\u4E8E",(0,r.jsx)(n.code,{children:"AI"}),"\u8BAD\u7EC3\u4EFB\u52A1\uFF0C\u9700\u8981\u6D4B\u8BD5\u4E0D\u540C\u7C7B\u578B\u7684",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u8C03\u5EA6\u548C\u62A2\u5360\u673A\u5236\u3002",(0,r.jsx)(n.code,{children:"Kind"}),"\uFF08",(0,r.jsx)(n.code,{children:"Kubernetes IN Docker"}),"\uFF09\u662F\u4E00\u4E2A\u4F7F\u7528",(0,r.jsx)(n.code,{children:"Docker"}),"\u5BB9\u5668\u4F5C\u4E3A\u8282\u70B9\u8FD0\u884C",(0,r.jsx)(n.code,{children:"Kubernetes"}),"\u96C6\u7FA4\u7684\u5DE5\u5177\uFF0C\u975E\u5E38\u9002\u5408\u5728\u672C\u5730\u5FEB\u901F\u642D\u5EFA\u6D4B\u8BD5\u73AF\u5883\u3002\u7ED3\u5408",(0,r.jsx)(n.code,{children:"Volcano"}),"\u8C03\u5EA6\u5668\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5B9E\u73B0\u5BF9",(0,r.jsx)(n.code,{children:"AI"}),"\u8BAD\u7EC3\u4EFB\u52A1\u7684\u9AD8\u7EA7\u8C03\u5EA6\u548C\u8D44\u6E90\u7BA1\u7406\u3002"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u672C\u6587\u4F7F\u7528",(0,r.jsx)(n.code,{children:"Kind v0.27.0"}),"\u3001",(0,r.jsx)(n.code,{children:"Volcano v1.11.2"}),"\u3001",(0,r.jsx)(n.code,{children:"Kubernetes v1.32.2"}),"\u7248\u672C\u3002\n\u57FA\u4E8E",(0,r.jsx)(n.code,{children:"MacOS 15.3.2"}),"\uFF0C",(0,r.jsx)(n.code,{children:"apple m4"}),"\u82AF\u7247\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u521B\u5EFA\u6D4B\u8BD5\u96C6\u7FA4",children:"\u521B\u5EFA\u6D4B\u8BD5\u96C6\u7FA4"}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\uFF0C\u6211\u4EEC\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u5177\u6709\u591A\u4E2A\u8282\u70B9\u7684",(0,r.jsx)(n.code,{children:"Kubernetes"}),"\u96C6\u7FA4\uFF0C\u5176\u4E2D\u5305\u542B\u4E00\u4E2A\u63A7\u5236\u5E73\u9762\u8282\u70B9\u548C\u591A\u4E2A\u6A21\u62DF",(0,r.jsx)(n.code,{children:"GPU"}),"\u7684\u5DE5\u4F5C\u8282\u70B9\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u521B\u5EFA-kind-\u914D\u7F6E\u6587\u4EF6",children:"\u521B\u5EFA Kind \u914D\u7F6E\u6587\u4EF6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="kind-config.yaml"',children:"kind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\nname: ai-cluster\nnodes:\n  # \u63A7\u5236\u5E73\u9762\u8282\u70B9\n  - role: control-plane\n  \n  # GPU\u5DE5\u4F5C\u8282\u70B91 - \u6A21\u62DFNVIDIA A100 GPU\u8282\u70B9\n  - role: worker\n    labels:\n      gpu-type: nvidia-a100\n  \n  # GPU\u5DE5\u4F5C\u8282\u70B92 - \u6A21\u62DFNVIDIA V100 GPU\u8282\u70B9\n  - role: worker\n    labels:\n      gpu-type: nvidia-v100\n  \n  # GPU\u5DE5\u4F5C\u8282\u70B93 - \u6A21\u62DFNVIDIA T4 GPU\u8282\u70B9\n  - role: worker\n    labels:\n      gpu-type: nvidia-t4\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6267\u884C\u96C6\u7FA4\u521B\u5EFA",children:"\u6267\u884C\u96C6\u7FA4\u521B\u5EFA"}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kind create cluster --config kind-config.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884C\u540E\u8F93\u51FA\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'% kind create cluster --config kind.yaml\nCreating cluster "ai-cluster" ...\n \u2713 Ensuring node image (kindest/node:v1.32.2) \uD83D\uDDBC \n \u2713 Preparing nodes \uD83D\uDCE6 \uD83D\uDCE6 \uD83D\uDCE6 \uD83D\uDCE6  \n \u2713 Writing configuration \uD83D\uDCDC \n \u2713 Starting control-plane \uD83D\uDD79\uFE0F \n \u2713 Installing CNI \uD83D\uDD0C \n \u2713 Installing StorageClass \uD83D\uDCBE \n \u2713 Joining worker nodes \uD83D\uDE9C \nSet kubectl context to "kind-ai-cluster"\nYou can now use your cluster with:\n\nkubectl cluster-info --context kind-ai-cluster\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5B89\u88C5-volcano",children:"\u5B89\u88C5 Volcano"}),"\n",(0,r.jsxs)(n.p,{children:["\u96C6\u7FA4\u521B\u5EFA\u6210\u529F\u540E\uFF0C\u6211\u4EEC\u9700\u8981\u5B89\u88C5",(0,r.jsx)(n.code,{children:"Volcano"}),"\u8C03\u5EA6\u5668\u3002",(0,r.jsx)(n.code,{children:"Volcano"}),"\u662F\u4E00\u4E2A\u4E3A\u9AD8\u6027\u80FD\u8BA1\u7B97\u548CAI/ML\u5DE5\u4F5C\u8D1F\u8F7D\u4F18\u5316\u7684",(0,r.jsx)(n.code,{children:"Kubernetes"}),"\u539F\u751F\u6279\u5904\u7406\u7CFB\u7EDF\uFF0C\u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684\u8C03\u5EA6\u7B56\u7565\u548C\u8D44\u6E90\u7BA1\u7406\u529F\u80FD\u3002\u6211\u4EEC\u5C06\u4F7F\u7528",(0,r.jsx)(n.code,{children:"Helm"}),"\u6765\u5B89\u88C5",(0,r.jsx)(n.code,{children:"Volcano"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.p,{children:["\u53C2\u8003\u5B98\u65B9\u6587\u6863\uFF1A",(0,r.jsx)(n.a,{href:"https://volcano.sh/en/docs/v1-11-0/installation/",children:"https://volcano.sh/en/docs/v1-11-0/installation/"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u6DFB\u52A0Volcano Helm\u4ED3\u5E93\nhelm repo add volcano-sh https://volcano-sh.github.io/helm-charts\n\n# \u66F4\u65B0\u4ED3\u5E93\nhelm repo update\n\n# \u5B89\u88C5Volcano\nhelm install volcano volcano-sh/volcano -n volcano-system --create-namespace\n\n# \u67E5\u770B\u5B89\u88C5\u7ED3\u679C\nkubectl get all -n volcano-system\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6700\u7EC8\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"% kubectl get all -n volcano-system\nNAME                                       READY   STATUS    RESTARTS   AGE\npod/volcano-admission-784ff9c4f-vx6sp      1/1     Running   0          3m48s\npod/volcano-controllers-555c955d58-69j4k   1/1     Running   0          3m48s\npod/volcano-scheduler-9b977dd77-hdqjz      1/1     Running   0          3m48s\n\nNAME                                  TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\nservice/volcano-admission-service     ClusterIP   10.96.62.159   <none>        443/TCP    3m48s\nservice/volcano-controllers-service   ClusterIP   10.96.243.25   <none>        8081/TCP   3m48s\nservice/volcano-scheduler-service     ClusterIP   10.96.34.86    <none>        8080/TCP   3m48s\n\nNAME                                  READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/volcano-admission     1/1     1            1           3m48s\ndeployment.apps/volcano-controllers   1/1     1            1           3m48s\ndeployment.apps/volcano-scheduler     1/1     1            1           3m48s\n\nNAME                                             DESIRED   CURRENT   READY   AGE\nreplicaset.apps/volcano-admission-784ff9c4f      1         1         1       3m48s\nreplicaset.apps/volcano-controllers-555c955d58   1         1         1       3m48s\nreplicaset.apps/volcano-scheduler-9b977dd77      1         1         1       3m48s\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5E38\u89C1\u95EE\u9898\u89E3\u51B3",children:"\u5E38\u89C1\u95EE\u9898\u89E3\u51B3"}),"\n",(0,r.jsx)(n.h4,{id:"\u672C\u5730vpn\u73AF\u5883\u53D8\u91CF\u4EE3\u7406\u5F15\u8D77kind\u62C9\u53D6\u955C\u50CF\u5931\u8D25",children:"\u672C\u5730VPN\u73AF\u5883\u53D8\u91CF\u4EE3\u7406\u5F15\u8D77Kind\u62C9\u53D6\u955C\u50CF\u5931\u8D25"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679C\u672C\u5730\u6709\u542F\u7528",(0,r.jsx)(n.code,{children:"VPN"}),"\u7684\u73AF\u5883\u53D8\u91CF\u4EE3\u7406\uFF0C\u6BD4\u5982\u4F7F\u7528\u4E86\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u90A3\u4E48\u5728\u521B\u5EFA",(0,r.jsx)(n.code,{children:"Pod"}),"\u7684\u65F6\u5019\u4F1A\u62A5\u9519\uFF1A",(0,r.jsx)(n.code,{children:"proxyconnect tcp: dial tcp 127.0.0.1:7890: connect: connection refused"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'% kubectl get pod -A\nNAMESPACE            NAME                                               READY   STATUS         RESTARTS   AGE\nkube-system          coredns-668d6bf9bc-4s2tl                           1/1     Running        0          2m1s\nkube-system          coredns-668d6bf9bc-gl4c6                           1/1     Running        0          2m1s\nkube-system          etcd-ai-cluster-control-plane                      1/1     Running        0          2m8s\nkube-system          kindnet-7m28t                                      1/1     Running        0          2m\nkube-system          kindnet-d6fjg                                      1/1     Running        0          2m\nkube-system          kindnet-f597l                                      1/1     Running        0          2m1s\nkube-system          kindnet-lmrjr                                      1/1     Running        0          2m\nkube-system          kube-apiserver-ai-cluster-control-plane            1/1     Running        0          2m8s\nkube-system          kube-controller-manager-ai-cluster-control-plane   1/1     Running        0          2m7s\nkube-system          kube-proxy-746fp                                   1/1     Running        0          2m\nkube-system          kube-proxy-fxqj9                                   1/1     Running        0          2m\nkube-system          kube-proxy-m5j7t                                   1/1     Running        0          2m\nkube-system          kube-proxy-xl887                                   1/1     Running        0          2m1s\nkube-system          kube-scheduler-ai-cluster-control-plane            1/1     Running        0          2m8s\nlocal-path-storage   local-path-provisioner-7dc846544d-h9kxl            1/1     Running        0          2m1s\nvolcano-system       volcano-admission-init-lj7t6                       0/1     ErrImagePull   0          96s\n\n% kubectl describe pod -n volcano-system volcano-admission-init-lj7t6\n\n...\n\nEvents:\n  Type     Reason     Age                   From               Message\n  ----     ------     ----                  ----               -------\n  Normal   Scheduled  2m52s                 default-scheduler  Successfully assigned volcano-system/volcano-admission-init-lj7t6 to ai-cluster-worker3\n  Normal   BackOff    16s (x10 over 2m51s)  kubelet            Back-off pulling image "docker.io/volcanosh/vc-webhook-manager:v1.11.2"\n  Warning  Failed     16s (x10 over 2m51s)  kubelet            Error: ImagePullBackOff\n  Normal   Pulling    3s (x5 over 2m51s)    kubelet            Pulling image "docker.io/volcanosh/vc-webhook-manager:v1.11.2"\n  Warning  Failed     3s (x5 over 2m51s)    kubelet            Failed to pull image "docker.io/volcanosh/vc-webhook-manager:v1.11.2": failed to pull and unpack image "docker.io/volcanosh/vc-webhook-manager:v1.11.2": failed to resolve reference "docker.io/volcanosh/vc-webhook-manager:v1.11.2": failed to do request: Head "https://registry-1.docker.io/v2/volcanosh/vc-webhook-manager/manifests/v1.11.2": proxyconnect tcp: dial tcp 127.0.0.1:7890: connect: connection refused\n  Warning  Failed     3s (x5 over 2m51s)    kubelet            Error: ErrImagePull\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u8FD9\u662F\u56E0\u4E3A\u5728\u521B\u5EFA",(0,r.jsx)(n.code,{children:"Kind"}),"\u96C6\u7FA4\u7684\u65F6\u5019\u4F1A\u5C06\u5F53\u524D\u7684\u73AF\u5883\u53D8\u91CF\u5168\u90E8\u590D\u5236\u5230\u96C6\u7FA4\u4E2D\uFF0C\u7279\u522B\u662F\u62C9\u53D6\u955C\u50CF\u65F6\u3002\u89E3\u51B3\u8FD9\u4E2A\u65B9\u6CD5\u662F\u65B0\u5F00\u4E0D\u5E26\u4EE3\u7406\u73AF\u5883\u53D8\u91CF\u7684\u7EC8\u7AEF\uFF0C\u5220\u9664\u96C6\u7FA4\u540E\u518D\u65B0\u5EFA\u96C6\u7FA4\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6A21\u62DFnfdgfd\u6807\u7B7E",children:"\u6A21\u62DFNFD&GFD\u6807\u7B7E"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Volcano"}),"\u5B89\u88C5\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u9700\u8981\u6A21\u62DF\u8282\u70B9\u7279\u5F81\u53D1\u73B0\uFF08",(0,r.jsx)(n.code,{children:"Node Feature Discovery"}),"\uFF0C",(0,r.jsx)(n.code,{children:"NFD"}),"\uFF09\u548C",(0,r.jsx)(n.code,{children:"GPU"}),"\u7279\u5F81\u53D1\u73B0\uFF08",(0,r.jsx)(n.code,{children:"GPU Feature Discovery"}),"\uFF0C",(0,r.jsx)(n.code,{children:"GFD"}),"\uFF09\u7684\u6807\u7B7E\u3002\u5728\u771F\u5B9E\u96C6\u7FA4\u4E2D\uFF0C\u8FD9\u4E9B\u6807\u7B7E\u4F1A\u7531",(0,r.jsx)(n.code,{children:"NFD"}),"\u548C",(0,r.jsx)(n.code,{children:"GFD"}),"\u81EA\u52A8\u53D1\u73B0\u5E76\u6DFB\u52A0\u5230\u8282\u70B9\u4E0A\uFF0C\u4F46\u5728\u6211\u4EEC\u7684\u6A21\u62DF\u73AF\u5883\u4E2D\uFF0C\u9700\u8981\u624B\u52A8\u6DFB\u52A0\u8FD9\u4E9B\u6807\u7B7E\u3002\u8FD9\u4E9B\u6807\u7B7E\u5C06\u7528\u4E8E\u8BA9\u8C03\u5EA6\u5668\u8BC6\u522B\u4E0D\u540C\u8282\u70B9\u7684\u786C\u4EF6\u7279\u6027\uFF0C\u4FBF\u4E8E\u8FDB\u884C\u7CBE\u51C6\u8C03\u5EA6\uFF1A"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5173\u4E8E",(0,r.jsx)(n.code,{children:"NFD&GFD"}),"\u7684\u4ECB\u7ECD\u8BF7\u53C2\u8003\u6211\u53E6\u4E00\u7BC7\u6587\u7AE0\uFF1A",(0,r.jsx)(n.a,{href:"/ai/nfd-gfd",children:"NFD&GFD\u6280\u672F\u4ECB\u7ECD"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u6A21\u62DF\u6807\u7B7E\u811A\u672C",children:"\u6A21\u62DF\u6807\u7B7E\u811A\u672C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",metastring:'title="kind-label.sh"',children:'#!/bin/sh\n\n# \u8BBE\u7F6E\u989C\u8272\u8F93\u51FA\nGREEN=\'\\033[0;32m\'\nYELLOW=\'\\033[1;33m\'\nNC=\'\\033[0m\' # No Color\n\necho "${GREEN}\u5F00\u59CB\u4E3AKind\u96C6\u7FA4\u8282\u70B9\u6DFB\u52A0NFD\u548CGFD\u6807\u7B7E...${NC}"\n\n# \u786E\u4FDD\u811A\u672C\u6709\u6267\u884C\u6743\u9650\nchmod +x "$0"\n\n# \u68C0\u67E5kubectl\u662F\u5426\u53EF\u7528\nif ! command -v kubectl &> /dev/null; then\n    echo "\u9519\u8BEF: kubectl\u547D\u4EE4\u672A\u627E\u5230\uFF0C\u8BF7\u786E\u4FDD\u5DF2\u5B89\u88C5kubectl\u5E76\u914D\u7F6E\u6B63\u786E"\n    exit 1\nfi\n\n# \u68C0\u67E5\u96C6\u7FA4\u8FDE\u63A5\nif ! kubectl cluster-info &> /dev/null; then\n    echo "\u9519\u8BEF: \u65E0\u6CD5\u8FDE\u63A5\u5230Kubernetes\u96C6\u7FA4\uFF0C\u8BF7\u786E\u4FDD\u96C6\u7FA4\u5DF2\u542F\u52A8"\n    exit 1\nfi\n\n# \u7B49\u5F85\u6240\u6709\u8282\u70B9\u5C31\u7EEA\necho "\u7B49\u5F85\u6240\u6709\u8282\u70B9\u5C31\u7EEA..."\nkubectl wait --for=condition=Ready nodes --all --timeout=300s\n\n# \u83B7\u53D6\u5DE5\u4F5C\u8282\u70B9\u5217\u8868\nWORKER_NODES=($(kubectl get nodes --no-headers | grep -v control-plane | awk \'{print $1}\'))\n\nif [ ${#WORKER_NODES[@]} -ne 3 ]; then\n    echo "\u8B66\u544A: \u9884\u671F\u67093\u4E2A\u5DE5\u4F5C\u8282\u70B9\uFF0C\u4F46\u5B9E\u9645\u627E\u5230 ${#WORKER_NODES[@]} \u4E2A"\nfi\n\necho "${YELLOW}\u627E\u5230\u4EE5\u4E0B\u5DE5\u4F5C\u8282\u70B9:${NC}"\nfor node in "${WORKER_NODES[@]}"; do\n    echo " - $node"\ndone\n\n# \u4E3A\u6BCF\u4E2A\u8282\u70B9\u6DFB\u52A0\u6807\u7B7E\n# \u5982\u679C\u6CA1\u6709\u8DB3\u591F\u7684\u5DE5\u4F5C\u8282\u70B9\uFF0C\u5219\u9000\u51FA\nif [ ${#WORKER_NODES[@]} -lt 3 ]; then\n    echo "${YELLOW}\u9519\u8BEF: \u9700\u8981\u81F3\u5C113\u4E2A\u5DE5\u4F5C\u8282\u70B9\uFF0C\u4F46\u53EA\u627E\u5230 ${#WORKER_NODES[@]} \u4E2A${NC}"\n    exit 1\nfi\n\n# \u8282\u70B91: \u6A21\u62DFA100 GPU\u8282\u70B9\necho "${GREEN}\u4E3A\u8282\u70B9 ${WORKER_NODES[0]} \u6DFB\u52A0NFD\u548CGFD\u6807\u7B7E (A100 GPU)...${NC}"\n\n# NFD\u6807\u7B7E - CPU\u76F8\u5173\nkubectl label node ${WORKER_NODES[0]} \\\n    feature.node.kubernetes.io/cpu-model.vendor_id=GenuineIntel \\\n    feature.node.kubernetes.io/cpu-model.family=6 \\\n    feature.node.kubernetes.io/cpu-model.id=85 \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX2=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX512F=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AMXBF16=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AMXINT8=true \\\n    feature.node.kubernetes.io/cpu-hardware_multithreading=true \\\n    feature.node.kubernetes.io/cpu-pstate.status=active \\\n    feature.node.kubernetes.io/cpu-pstate.turbo=true \\\n    feature.node.kubernetes.io/cpu-pstate.scaling_governor=performance \\\n    feature.node.kubernetes.io/cpu-cstate.enabled=true \\\n    --overwrite\n\n# NFD\u6807\u7B7E - \u5185\u6838\u76F8\u5173\nkubectl label node ${WORKER_NODES[0]} \\\n    feature.node.kubernetes.io/kernel-version.full=5.15.0-76-generic \\\n    feature.node.kubernetes.io/kernel-version.major=5 \\\n    feature.node.kubernetes.io/kernel-version.minor=15 \\\n    feature.node.kubernetes.io/kernel-version.revision=0 \\\n    --overwrite\n\n# NFD\u6807\u7B7E - \u5185\u5B58\u76F8\u5173\nkubectl label node ${WORKER_NODES[0]} \\\n    feature.node.kubernetes.io/memory-numa=true \\\n    feature.node.kubernetes.io/memory-nv.present=true \\\n    --overwrite\n\n# NFD\u6807\u7B7E - PCI\u8BBE\u5907\u76F8\u5173 (NVIDIA GPU)\nkubectl label node ${WORKER_NODES[0]} \\\n    feature.node.kubernetes.io/pci-10de.present=true \\\n    feature.node.kubernetes.io/pci-10de.device-10de.model-name=NVIDIA_A100-SXM4-80GB \\\n    --overwrite\n\n# GFD\u6807\u7B7E - NVIDIA GPU\u76F8\u5173\nkubectl label node ${WORKER_NODES[0]} \\\n    nvidia.com/gpu.present=true \\\n    nvidia.com/gpu.count=8 \\\n    nvidia.com/gpu.product=A100-SXM4-80GB \\\n    nvidia.com/gpu.family=ampere \\\n    nvidia.com/gpu.compute.major=8 \\\n    nvidia.com/gpu.compute.minor=0 \\\n    nvidia.com/gpu.machine=NVIDIA_A100-SXM4-80GB \\\n    nvidia.com/gpu.memory=81920 \\\n    nvidia.com/gpu.clock=1410 \\\n    nvidia.com/gpu.driver.major=535 \\\n    nvidia.com/gpu.driver.minor=104 \\\n    nvidia.com/gpu.driver.rev=05 \\\n    nvidia.com/gpu.cuda.major=12 \\\n    nvidia.com/gpu.cuda.minor=2 \\\n    nvidia.com/gpu.cuda.patch=0 \\\n    nvidia.com/mig.capable=true \\\n    nvidia.com/mps.capable=true \\\n    nvidia.com/gpu.multiprocessors=108 \\\n    nvidia.com/gpu.slices.ci=1 \\\n    nvidia.com/gpu.slices.gi=1 \\\n    nvidia.com/gpu.slices.mem=1 \\\n    nvidia.com/gpu.max-instances=7 \\\n    nvidia.com/gpu.virtualization=false \\\n    --overwrite\n\n# \u8282\u70B92: \u6A21\u62DFV100 GPU\u8282\u70B9\necho "${GREEN}\u4E3A\u8282\u70B9 ${WORKER_NODES[1]} \u6DFB\u52A0NFD\u548CGFD\u6807\u7B7E (V100 GPU)...${NC}"\n\n# NFD\u6807\u7B7E - CPU\u76F8\u5173\nkubectl label node ${WORKER_NODES[1]} \\\n    feature.node.kubernetes.io/cpu-model.vendor_id=GenuineIntel \\\n    feature.node.kubernetes.io/cpu-model.family=6 \\\n    feature.node.kubernetes.io/cpu-model.id=85 \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX2=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX512F=true \\\n    feature.node.kubernetes.io/cpu-hardware_multithreading=true \\\n    feature.node.kubernetes.io/cpu-pstate.status=active \\\n    feature.node.kubernetes.io/cpu-pstate.turbo=true \\\n    feature.node.kubernetes.io/cpu-pstate.scaling_governor=performance \\\n    feature.node.kubernetes.io/cpu-cstate.enabled=true \\\n    --overwrite\n\n# NFD\u6807\u7B7E - \u5185\u6838\u76F8\u5173\nkubectl label node ${WORKER_NODES[1]} \\\n    feature.node.kubernetes.io/kernel-version.full=5.15.0-76-generic \\\n    feature.node.kubernetes.io/kernel-version.major=5 \\\n    feature.node.kubernetes.io/kernel-version.minor=15 \\\n    feature.node.kubernetes.io/kernel-version.revision=0 \\\n    --overwrite\n\n# NFD\u6807\u7B7E - \u5185\u5B58\u76F8\u5173\nkubectl label node ${WORKER_NODES[1]} \\\n    feature.node.kubernetes.io/memory-numa=true \\\n    --overwrite\n\n# NFD\u6807\u7B7E - PCI\u8BBE\u5907\u76F8\u5173 (NVIDIA GPU)\nkubectl label node ${WORKER_NODES[1]} \\\n    feature.node.kubernetes.io/pci-10de.present=true \\\n    feature.node.kubernetes.io/pci-10de.device-10de.model-name=NVIDIA_V100-SXM2-32GB \\\n    --overwrite\n\n# GFD\u6807\u7B7E - NVIDIA GPU\u76F8\u5173\nkubectl label node ${WORKER_NODES[1]} \\\n    nvidia.com/gpu.present=true \\\n    nvidia.com/gpu.count=4 \\\n    nvidia.com/gpu.product=V100-SXM2-32GB \\\n    nvidia.com/gpu.family=volta \\\n    nvidia.com/gpu.compute.major=7 \\\n    nvidia.com/gpu.compute.minor=0 \\\n    nvidia.com/gpu.machine=NVIDIA_V100-SXM2-32GB \\\n    nvidia.com/gpu.memory=32768 \\\n    nvidia.com/gpu.clock=1530 \\\n    nvidia.com/gpu.driver.major=535 \\\n    nvidia.com/gpu.driver.minor=104 \\\n    nvidia.com/gpu.driver.rev=05 \\\n    nvidia.com/gpu.cuda.major=12 \\\n    nvidia.com/gpu.cuda.minor=0 \\\n    nvidia.com/gpu.cuda.patch=0 \\\n    nvidia.com/mig.capable=false \\\n    nvidia.com/mps.capable=true \\\n    nvidia.com/gpu.multiprocessors=80 \\\n    nvidia.com/gpu.virtualization=false \\\n    --overwrite\n\n# \u8282\u70B93: \u6A21\u62DFT4 GPU\u8282\u70B9\necho "${GREEN}\u4E3A\u8282\u70B9 ${WORKER_NODES[2]} \u6DFB\u52A0NFD\u548CGFD\u6807\u7B7E (T4 GPU)...${NC}"\n\n# NFD\u6807\u7B7E - CPU\u76F8\u5173\nkubectl label node ${WORKER_NODES[2]} \\\n    feature.node.kubernetes.io/cpu-model.vendor_id=GenuineIntel \\\n    feature.node.kubernetes.io/cpu-model.family=6 \\\n    feature.node.kubernetes.io/cpu-model.id=85 \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX=true \\\n    feature.node.kubernetes.io/cpu-cpuid.AVX2=true \\\n    feature.node.kubernetes.io/cpu-hardware_multithreading=true \\\n    feature.node.kubernetes.io/cpu-pstate.status=active \\\n    feature.node.kubernetes.io/cpu-pstate.turbo=true \\\n    feature.node.kubernetes.io/cpu-pstate.scaling_governor=performance \\\n    feature.node.kubernetes.io/cpu-cstate.enabled=true \\\n    --overwrite\n\n# NFD\u6807\u7B7E - \u5185\u6838\u76F8\u5173\nkubectl label node ${WORKER_NODES[2]} \\\n    feature.node.kubernetes.io/kernel-version.full=5.15.0-76-generic \\\n    feature.node.kubernetes.io/kernel-version.major=5 \\\n    feature.node.kubernetes.io/kernel-version.minor=15 \\\n    feature.node.kubernetes.io/kernel-version.revision=0 \\\n    --overwrite\n\n# NFD\u6807\u7B7E - \u5185\u5B58\u76F8\u5173\nkubectl label node ${WORKER_NODES[2]} \\\n    feature.node.kubernetes.io/memory-numa=false \\\n    --overwrite\n\n# NFD\u6807\u7B7E - PCI\u8BBE\u5907\u76F8\u5173 (NVIDIA GPU)\nkubectl label node ${WORKER_NODES[2]} \\\n    feature.node.kubernetes.io/pci-10de.present=true \\\n    feature.node.kubernetes.io/pci-10de.device-10de.model-name=NVIDIA_T4 \\\n    --overwrite\n\n# GFD\u6807\u7B7E - NVIDIA GPU\u76F8\u5173\nkubectl label node ${WORKER_NODES[2]} \\\n    nvidia.com/gpu.present=true \\\n    nvidia.com/gpu.count=2 \\\n    nvidia.com/gpu.product=T4 \\\n    nvidia.com/gpu.family=turing \\\n    nvidia.com/gpu.compute.major=7 \\\n    nvidia.com/gpu.compute.minor=5 \\\n    nvidia.com/gpu.machine=NVIDIA_T4 \\\n    nvidia.com/gpu.memory=16384 \\\n    nvidia.com/gpu.clock=1590 \\\n    nvidia.com/gpu.driver.major=535 \\\n    nvidia.com/gpu.driver.minor=104 \\\n    nvidia.com/gpu.driver.rev=05 \\\n    nvidia.com/gpu.cuda.major=11 \\\n    nvidia.com/gpu.cuda.minor=8 \\\n    nvidia.com/gpu.cuda.patch=0 \\\n    nvidia.com/mig.capable=false \\\n    nvidia.com/mps.capable=true \\\n    nvidia.com/gpu.multiprocessors=40 \\\n    nvidia.com/gpu.virtualization=false \\\n    --overwrite\n\necho "${GREEN}\u6240\u6709\u8282\u70B9\u6807\u7B7E\u6DFB\u52A0\u5B8C\u6210!${NC}"\necho "${YELLOW}\u9A8C\u8BC1\u8282\u70B9\u6807\u7B7E:${NC}"\n\n# \u9A8C\u8BC1\u6807\u7B7E\nfor node in "${WORKER_NODES[@]}"; do\n    echo "${GREEN}\u8282\u70B9 $node \u7684NFD\u6807\u7B7E:${NC}"\n    kubectl get node $node -o json | jq -r \'.metadata.labels | with_entries(select(.key | startswith("feature.node.kubernetes.io"))) | to_entries | .[] | "\\(.key)=\\(.value)"\'\n    \n    echo "${GREEN}\u8282\u70B9 $node \u7684GFD\u6807\u7B7E:${NC}"\n    kubectl get node $node -o json | jq -r \'.metadata.labels | with_entries(select(.key | startswith("nvidia.com"))) | to_entries | .[] | "\\(.key)=\\(.value)"\'\n    \n    echo ""\ndone\n\necho "${GREEN}\u811A\u672C\u6267\u884C\u5B8C\u6210!${NC}"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u6267\u884C\u6807\u7B7E\u811A\u672C",children:"\u6267\u884C\u6807\u7B7E\u811A\u672C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./kind-label.sh\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u9A8C\u8BC1\u6267\u884C\u7ED3\u679C",children:"\u9A8C\u8BC1\u6267\u884C\u7ED3\u679C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl describe node ai-cluster-worker\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"alt text",src:i(89551).Z+"",width:"2634",height:"1648"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6A21\u62DFgpu\u8D44\u6E90\u7C7B\u578B",children:"\u6A21\u62DFGPU\u8D44\u6E90\u7C7B\u578B"}),"\n",(0,r.jsxs)(n.p,{children:["\u6DFB\u52A0\u8282\u70B9\u6807\u7B7E\u540E\uFF0C\u6211\u4EEC\u8FD8\u9700\u8981\u6A21\u62DF\u8282\u70B9\u4E0A\u7684",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u3002\u5728\u771F\u5B9E\u96C6\u7FA4\u4E2D\uFF0C",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u4F1A\u7531",(0,r.jsx)(n.code,{children:"NVIDIA"}),"\u8BBE\u5907\u63D2\u4EF6\u81EA\u52A8\u6CE8\u518C\uFF0C\u4F46\u5728\u6211\u4EEC\u7684\u6A21\u62DF\u73AF\u5883\u4E2D\uFF0C\u9700\u8981\u624B\u52A8\u6DFB\u52A0\u8FD9\u4E9B\u8D44\u6E90\u3002\u6211\u4EEC\u5C06\u4E3A\u4E0D\u540C\u8282\u70B9\u6DFB\u52A0\u4E0D\u540C\u6570\u91CF\u548C\u7C7B\u578B\u7684",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\uFF1A"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4E3A\u8282\u70B9\u6A21\u62DF",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u7C7B\u578B\uFF0C\u8FD9\u91CC\u6A21\u62DF\u7684\u662F",(0,r.jsx)(n.code,{children:"NVIDIA"}),"\u7684\u5361\uFF0C\u56E0\u6B64\u9700\u8981\u52A0\u4E0A",(0,r.jsx)(n.code,{children:"nvidia.com/gpu"}),"\u7684\u8D44\u6E90\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u6A21\u62DFgpu\u8D44\u6E90\u811A\u672C",children:"\u6A21\u62DFGPU\u8D44\u6E90\u811A\u672C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",metastring:'title="add-gpu-resources.sh"',children:'#!/bin/sh\n\n# \u8BBE\u7F6E\u989C\u8272\u8F93\u51FA\nGREEN=\'\\033[0;32m\'\nYELLOW=\'\\033[1;33m\'\nNC=\'\\033[0m\' # No Color\n\necho "${GREEN}\u5F00\u59CB\u4E3AKind\u96C6\u7FA4\u8282\u70B9\u6DFB\u52A0\u6A21\u62DFGPU\u8D44\u6E90...${NC}"\n\n# \u83B7\u53D6\u5DE5\u4F5C\u8282\u70B9\u5217\u8868\nWORKER_NODES=($(kubectl get nodes --no-headers | grep -v control-plane | awk \'{print $1}\'))\n\nif [ ${#WORKER_NODES[@]} -lt 3 ]; then\n    echo "${YELLOW}\u8B66\u544A: \u9884\u671F\u67093\u4E2A\u5DE5\u4F5C\u8282\u70B9\uFF0C\u4F46\u5B9E\u9645\u627E\u5230 ${#WORKER_NODES[@]} \u4E2A${NC}"\nfi\n\necho "${YELLOW}\u627E\u5230\u4EE5\u4E0B\u5DE5\u4F5C\u8282\u70B9:${NC}"\nfor node in "${WORKER_NODES[@]}"; do\n    echo " - $node"\ndone\n\n# \u4F7F\u7528kubectl patch\u547D\u4EE4\u76F4\u63A5\u4FEE\u6539\u8282\u70B9\u8D44\u6E90\n\n# \u4E3A\u7B2C\u4E00\u4E2A\u8282\u70B9\u6DFB\u52A08\u4E2AA100 GPU\necho "${GREEN}\u4E3A\u8282\u70B9 ${WORKER_NODES[0]} \u6DFB\u52A08\u4E2A\u6A21\u62DFA100 GPU...${NC}"\n\n# \u4F7F\u7528kubectl patch\u547D\u4EE4\u4FEE\u6539\u8282\u70B9\u8D44\u6E90\nkubectl get node ${WORKER_NODES[0]} -o json | jq \'.status.capacity["nvidia.com/gpu"]="8" | .status.allocatable["nvidia.com/gpu"]="8"\' | kubectl replace --raw /api/v1/nodes/${WORKER_NODES[0]}/status -f -\n\n# \u4E3A\u7B2C\u4E8C\u4E2A\u8282\u70B9\u6DFB\u52A04\u4E2AV100 GPU\necho "${GREEN}\u4E3A\u8282\u70B9 ${WORKER_NODES[1]} \u6DFB\u52A04\u4E2A\u6A21\u62DFV100 GPU...${NC}"\nkubectl get node ${WORKER_NODES[1]} -o json | jq \'.status.capacity["nvidia.com/gpu"]="4" | .status.allocatable["nvidia.com/gpu"]="4"\' | kubectl replace --raw /api/v1/nodes/${WORKER_NODES[1]}/status -f -\n\n# \u4E3A\u7B2C\u4E09\u4E2A\u8282\u70B9\u6DFB\u52A02\u4E2AT4 GPU\necho "${GREEN}\u4E3A\u8282\u70B9 ${WORKER_NODES[2]} \u6DFB\u52A02\u4E2A\u6A21\u62DFT4 GPU...${NC}"\nkubectl get node ${WORKER_NODES[2]} -o json | jq \'.status.capacity["nvidia.com/gpu"]="2" | .status.allocatable["nvidia.com/gpu"]="2"\' | kubectl replace --raw /api/v1/nodes/${WORKER_NODES[2]}/status -f -\n\n# \u9A8C\u8BC1GPU\u8D44\u6E90\u662F\u5426\u6DFB\u52A0\u6210\u529F\necho "${GREEN}\u9A8C\u8BC1\u8282\u70B9GPU\u8D44\u6E90:${NC}"\nkubectl get nodes -o=custom-columns=NAME:.metadata.name,GPU:.status.capacity.\\\'nvidia\\.com/gpu\\\'\n\necho "${GREEN}\u6A21\u62DFGPU\u8D44\u6E90\u6DFB\u52A0\u5B8C\u6210!${NC}"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u6267\u884Cgpu\u8D44\u6E90\u811A\u672C",children:"\u6267\u884CGPU\u8D44\u6E90\u811A\u672C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./add-gpu-resources.sh\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u9A8C\u8BC1gpu\u8D44\u6E90\u7ED3\u679C",children:"\u9A8C\u8BC1GPU\u8D44\u6E90\u7ED3\u679C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl describe node ai-cluster-worker\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"alt text",src:i(84690).Z+"",width:"3238",height:"1304"})}),"\n",(0,r.jsx)(n.h2,{id:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217",children:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217"}),"\n",(0,r.jsxs)(n.p,{children:["\u73B0\u5728\u6211\u4EEC\u7684\u96C6\u7FA4\u5DF2\u7ECF\u6709\u4E86\u6A21\u62DF\u7684",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u548C\u8282\u70B9\u6807\u7B7E\uFF0C\u63A5\u4E0B\u6765\u9700\u8981\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217\u3002\u5728",(0,r.jsx)(n.code,{children:"Volcano"}),"\u4E2D\uFF0C",(0,r.jsx)(n.code,{children:"\u961F\u5217"}),"\uFF08",(0,r.jsx)(n.code,{children:"Queue"}),"\uFF09\u662F\u8D44\u6E90\u7BA1\u7406\u7684\u91CD\u8981\u6982\u5FF5\uFF0C\u7528\u4E8E\u5B9E\u73B0\u591A\u79DF\u6237\u8D44\u6E90\u9694\u79BB\u548C\u4F18\u5148\u7EA7\u7BA1\u7406\u3002\u6211\u4EEC\u5C06\u521B\u5EFA\u4E0D\u540C\u4F18\u5148\u7EA7\u548C\u8D44\u6E90\u914D\u989D\u7684\u961F\u5217\uFF1A"]}),"\n",(0,r.jsx)(n.h3,{id:"\u6D4B\u8BD5\u961F\u5217yaml",children:"\u6D4B\u8BD5\u961F\u5217YAML"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="test-queue.yaml"',children:"apiVersion: scheduling.volcano.sh/v1beta1\nkind: Queue\nmetadata:\n  name: default\nspec:\n  weight: 1\n  reclaimable: false\n---\napiVersion: scheduling.volcano.sh/v1beta1\nkind: Queue\nmetadata:\n  name: high-priority\nspec:\n  weight: 10\n  capability:\n    cpu: 100\n    memory: 100Gi\n    nvidia.com/gpu: 8\n  reclaimable: true\n---\napiVersion: scheduling.volcano.sh/v1beta1\nkind: Queue\nmetadata:\n  name: ai-training\nspec:\n  weight: 5\n  capability:\n    cpu: 50\n    memory: 50Gi\n    nvidia.com/gpu: 4\n  reclaimable: true\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217-1",children:"\u521B\u5EFA\u6D4B\u8BD5\u961F\u5217"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% kubectl apply -f test-queue.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u67E5\u770B\u521B\u5EFA\u961F\u5217",children:"\u67E5\u770B\u521B\u5EFA\u961F\u5217"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% kubectl get queue\nNAME            AGE\nai-training     11s\ndefault         4m9s\nhigh-priority   11s\nroot            4m9s\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1",children:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1"}),"\n",(0,r.jsxs)(n.p,{children:["\u961F\u5217\u521B\u5EFA\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1\u6765\u9A8C\u8BC1\u6211\u4EEC\u7684\u8BBE\u7F6E\u3002\u6211\u4EEC\u5C06\u521B\u5EFA\u4E00\u4E2A\u8BF7\u6C42",(0,r.jsx)(n.code,{children:"GPU"}),"\u8D44\u6E90\u7684",(0,r.jsx)(n.code,{children:"Volcano Job"}),"\uFF0C\u5E76\u6307\u5B9A\u5176\u8FD0\u884C\u5728\u6211\u4EEC\u521B\u5EFA\u7684\u9AD8\u4F18\u5148\u7EA7\u961F\u5217\u4E2D\u3002\u8FD9\u4E2A\u4EFB\u52A1\u5C06\u4F7F\u7528\u8282\u70B9\u9009\u62E9\u5668\u6765\u9009\u62E9\u6709",(0,r.jsx)(n.code,{children:"NVIDIA GPU"}),"\u7684\u8282\u70B9\uFF1A"]}),"\n",(0,r.jsx)(n.h3,{id:"\u6D4B\u8BD5\u4EFB\u52A1yaml",children:"\u6D4B\u8BD5\u4EFB\u52A1YAML"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="test-job.yaml"',children:'apiVersion: batch.volcano.sh/v1alpha1\nkind: Job\nmetadata:\n  name: gpu-test-job\nspec:\n  minAvailable: 1\n  schedulerName: volcano\n  queue: high-priority\n  policies:\n    - event: PodEvicted\n      action: RestartJob\n  maxRetry: 1\n  tasks:\n    - replicas: 1\n      name: gpu-test\n      template:\n        spec:\n          containers:\n            - name: gpu-test-container\n              image: alpine:latest\n              command:\n                - sh\n                - -c\n                - "nvidia-smi || echo \'No GPU found, but scheduled to GPU node\' && sleep 300"\n              resources:\n                limits:\n                  cpu: 1\n                  memory: 1Gi\n                  nvidia.com/gpu: 1\n                requests:\n                  cpu: 500m\n                  memory: 512Mi\n                  nvidia.com/gpu: 1\n          restartPolicy: Never\n          nodeSelector:\n            feature.node.kubernetes.io/pci-10de.present: "true"  # \u9009\u62E9\u6709NVIDIA GPU\u7684\u8282\u70B9\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1-1",children:"\u521B\u5EFA\u6D4B\u8BD5\u4EFB\u52A1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% kubectl apply -f test-job.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u67E5\u770B\u6D4B\u8BD5\u4EFB\u52A1",children:"\u67E5\u770B\u6D4B\u8BD5\u4EFB\u52A1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% k get vcjob -A\nNAMESPACE   NAME           STATUS    MINAVAILABLE   RUNNINGS   AGE\ndefault     gpu-test-job   Running   1              1          47s\n"})})]})}function u(e={}){let{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},84690:function(e,n,i){i.d(n,{Z:function(){return o}});let o=i.p+"assets/images/image-1-173183f4d2810743494735eb4cd2bd04.png"},89551:function(e,n,i){i.d(n,{Z:function(){return o}});let o=i.p+"assets/images/image-156f16d841e8d758072bf125850d0a83.png"},50065:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return t}});var o=i(67294);let r={},c=o.createContext(r);function t(e){let n=o.useContext(c);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);