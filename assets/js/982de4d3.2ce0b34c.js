"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["7506"],{94725:function(e,n,s){s.r(n),s.d(n,{metadata:()=>l,contentTitle:()=>c,default:()=>h,assets:()=>a,toc:()=>t,frontMatter:()=>d});var l=JSON.parse('{"id":"docs/\u4E91\u539F\u751F/Kubernetes/Kubernetes PVC\u6301\u4E45\u5316\u5B58\u50A8","title":"Kubernetes PVC\u6301\u4E45\u5316\u5B58\u50A8","description":"\u6DF1\u5165\u89E3\u6790Kubernetes\u6301\u4E45\u5316\u5B58\u50A8\u673A\u5236PVC\uFF08PersistentVolumeClaim\uFF09\u548CPV\uFF08PersistentVolume\uFF09\u7684\u5B8C\u6574\u4F7F\u7528\u6307\u5357\u3002\u8BE6\u7EC6\u8BB2\u89E3PVC\u7684\u6982\u5FF5\u3001\u751F\u547D\u5468\u671F\u3001\u8BBF\u95EE\u6A21\u5F0F\u4EE5\u53CA\u4E0EPod\u7684\u5173\u7CFB\u3002\u6DB5\u76D6\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAENFS\u3001CIFS\u3001iSCSI\u7684\u914D\u7F6E\u65B9\u6CD5\u548C\u4F7F\u7528\u793A\u4F8B\uFF0C\u5C55\u793A\u5982\u4F55\u5728Kubernetes\u4E2D\u6302\u8F7D\u7F51\u76D8\u3002\u4ECB\u7ECDStorageClass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94\u7684\u5B9E\u73B0\u539F\u7406\u548C\u914D\u7F6E\u65B9\u6848\uFF0C\u63D0\u4F9BDeployment\u548CStatefulSet\u4F7F\u7528PVC\u7684\u5B8C\u6574\u793A\u4F8B\u3002\u9002\u7528\u4E8E\u9700\u8981\u6570\u636E\u6301\u4E45\u5316\u3001\u6709\u72B6\u6001\u5E94\u7528\u90E8\u7F72\u7684\u573A\u666F\uFF0C\u52A9\u529B\u5B9E\u73B0\u7075\u6D3B\u7684\u5B58\u50A8\u7BA1\u7406\u548C\u6570\u636E\u4FDD\u62A4\u3002","source":"@site/docs/docs/2000-\u4E91\u539F\u751F/200-Kubernetes/4500-Kubernetes PVC\u6301\u4E45\u5316\u5B58\u50A8.md","sourceDirName":"docs/2000-\u4E91\u539F\u751F/200-Kubernetes","slug":"/cloud-native/kubernetes-pvc-persistent-volume","permalink":"/cloud-native/kubernetes-pvc-persistent-volume","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4500,"frontMatter":{"slug":"/cloud-native/kubernetes-pvc-persistent-volume","title":"Kubernetes PVC\u6301\u4E45\u5316\u5B58\u50A8","hide_title":true,"keywords":["Kubernetes","PVC","PersistentVolumeClaim","PV","PersistentVolume","StorageClass","\u5B58\u50A8\u7C7B","\u6301\u4E45\u5316\u5B58\u50A8","\u7F51\u7EDC\u5B58\u50A8","NFS","CIFS","iSCSI","\u52A8\u6001\u5B58\u50A8","\u9759\u6001\u5B58\u50A8","\u5B58\u50A8\u7F16\u6392","StatefulSet","Deployment","\u6570\u636E\u6301\u4E45\u5316","\u5377\u6302\u8F7D","\u7F51\u76D8\u6302\u8F7D"],"description":"\u6DF1\u5165\u89E3\u6790Kubernetes\u6301\u4E45\u5316\u5B58\u50A8\u673A\u5236PVC\uFF08PersistentVolumeClaim\uFF09\u548CPV\uFF08PersistentVolume\uFF09\u7684\u5B8C\u6574\u4F7F\u7528\u6307\u5357\u3002\u8BE6\u7EC6\u8BB2\u89E3PVC\u7684\u6982\u5FF5\u3001\u751F\u547D\u5468\u671F\u3001\u8BBF\u95EE\u6A21\u5F0F\u4EE5\u53CA\u4E0EPod\u7684\u5173\u7CFB\u3002\u6DB5\u76D6\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAENFS\u3001CIFS\u3001iSCSI\u7684\u914D\u7F6E\u65B9\u6CD5\u548C\u4F7F\u7528\u793A\u4F8B\uFF0C\u5C55\u793A\u5982\u4F55\u5728Kubernetes\u4E2D\u6302\u8F7D\u7F51\u76D8\u3002\u4ECB\u7ECDStorageClass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94\u7684\u5B9E\u73B0\u539F\u7406\u548C\u914D\u7F6E\u65B9\u6848\uFF0C\u63D0\u4F9BDeployment\u548CStatefulSet\u4F7F\u7528PVC\u7684\u5B8C\u6574\u793A\u4F8B\u3002\u9002\u7528\u4E8E\u9700\u8981\u6570\u636E\u6301\u4E45\u5316\u3001\u6709\u72B6\u6001\u5E94\u7528\u90E8\u7F72\u7684\u573A\u666F\uFF0C\u52A9\u529B\u5B9E\u73B0\u7075\u6D3B\u7684\u5B58\u50A8\u7BA1\u7406\u548C\u6570\u636E\u4FDD\u62A4\u3002"},"sidebar":"mainSidebar","previous":{"title":"Kubernetes RuntimeClass","permalink":"/cloud-native/kubernetes-runtimeclass"},"next":{"title":"Kubernetes CPU&NUMA\u4EB2\u548C\u6027\u8C03\u5EA6","permalink":"/cloud-native/kubernetes-cpu-numa-affinity"}}'),i=s("85893"),r=s("50065");let d={slug:"/cloud-native/kubernetes-pvc-persistent-volume",title:"Kubernetes PVC\u6301\u4E45\u5316\u5B58\u50A8",hide_title:!0,keywords:["Kubernetes","PVC","PersistentVolumeClaim","PV","PersistentVolume","StorageClass","\u5B58\u50A8\u7C7B","\u6301\u4E45\u5316\u5B58\u50A8","\u7F51\u7EDC\u5B58\u50A8","NFS","CIFS","iSCSI","\u52A8\u6001\u5B58\u50A8","\u9759\u6001\u5B58\u50A8","\u5B58\u50A8\u7F16\u6392","StatefulSet","Deployment","\u6570\u636E\u6301\u4E45\u5316","\u5377\u6302\u8F7D","\u7F51\u76D8\u6302\u8F7D"],description:"\u6DF1\u5165\u89E3\u6790Kubernetes\u6301\u4E45\u5316\u5B58\u50A8\u673A\u5236PVC\uFF08PersistentVolumeClaim\uFF09\u548CPV\uFF08PersistentVolume\uFF09\u7684\u5B8C\u6574\u4F7F\u7528\u6307\u5357\u3002\u8BE6\u7EC6\u8BB2\u89E3PVC\u7684\u6982\u5FF5\u3001\u751F\u547D\u5468\u671F\u3001\u8BBF\u95EE\u6A21\u5F0F\u4EE5\u53CA\u4E0EPod\u7684\u5173\u7CFB\u3002\u6DB5\u76D6\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAENFS\u3001CIFS\u3001iSCSI\u7684\u914D\u7F6E\u65B9\u6CD5\u548C\u4F7F\u7528\u793A\u4F8B\uFF0C\u5C55\u793A\u5982\u4F55\u5728Kubernetes\u4E2D\u6302\u8F7D\u7F51\u76D8\u3002\u4ECB\u7ECDStorageClass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94\u7684\u5B9E\u73B0\u539F\u7406\u548C\u914D\u7F6E\u65B9\u6848\uFF0C\u63D0\u4F9BDeployment\u548CStatefulSet\u4F7F\u7528PVC\u7684\u5B8C\u6574\u793A\u4F8B\u3002\u9002\u7528\u4E8E\u9700\u8981\u6570\u636E\u6301\u4E45\u5316\u3001\u6709\u72B6\u6001\u5E94\u7528\u90E8\u7F72\u7684\u573A\u666F\uFF0C\u52A9\u529B\u5B9E\u73B0\u7075\u6D3B\u7684\u5B58\u50A8\u7BA1\u7406\u548C\u6570\u636E\u4FDD\u62A4\u3002"},c=void 0,a={},t=[{value:"\u524D\u8A00",id:"\u524D\u8A00",level:2},{value:"PVC\u662F\u4EC0\u4E48\uFF1F",id:"pvc\u662F\u4EC0\u4E48",level:2},{value:"Kubernetes\u5B58\u50A8\u67B6\u6784",id:"kubernetes\u5B58\u50A8\u67B6\u6784",level:3},{value:"PVC\u89E3\u51B3\u4E86\u4EC0\u4E48\u95EE\u9898\uFF1F",id:"pvc\u89E3\u51B3\u4E86\u4EC0\u4E48\u95EE\u9898",level:3},{value:"\u75DB\u70B9\u6848\u4F8B1\uFF1A\u5B58\u50A8\u914D\u7F6E\u4E0E\u5E94\u7528\u8026\u5408",id:"\u75DB\u70B9\u6848\u4F8B1\u5B58\u50A8\u914D\u7F6E\u4E0E\u5E94\u7528\u8026\u5408",level:4},{value:"\u75DB\u70B9\u6848\u4F8B2\uFF1A\u5B58\u50A8\u8D44\u6E90\u7684\u590D\u7528\u548C\u7BA1\u7406",id:"\u75DB\u70B9\u6848\u4F8B2\u5B58\u50A8\u8D44\u6E90\u7684\u590D\u7528\u548C\u7BA1\u7406",level:4},{value:"\u75DB\u70B9\u6848\u4F8B3\uFF1A\u6709\u72B6\u6001\u5E94\u7528\u7684\u90E8\u7F72",id:"\u75DB\u70B9\u6848\u4F8B3\u6709\u72B6\u6001\u5E94\u7528\u7684\u90E8\u7F72",level:4},{value:"PVC\u57FA\u7840\u4F7F\u7528",id:"pvc\u57FA\u7840\u4F7F\u7528",level:2},{value:"\u8BBF\u95EE\u6A21\u5F0F",id:"\u8BBF\u95EE\u6A21\u5F0F",level:3},{value:"\u7B80\u5355\u7684Pod\u4F7F\u7528PVC\u793A\u4F8B",id:"\u7B80\u5355\u7684pod\u4F7F\u7528pvc\u793A\u4F8B",level:3},{value:"1. \u521B\u5EFAPersistentVolume",id:"1-\u521B\u5EFApersistentvolume",level:4},{value:"2. \u521B\u5EFAPersistentVolumeClaim",id:"2-\u521B\u5EFApersistentvolumeclaim",level:4},{value:"3. \u5728Pod\u4E2D\u4F7F\u7528PVC",id:"3-\u5728pod\u4E2D\u4F7F\u7528pvc",level:4},{value:"4. \u9A8C\u8BC1\u5B58\u50A8\u6302\u8F7D",id:"4-\u9A8C\u8BC1\u5B58\u50A8\u6302\u8F7D",level:4},{value:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u4E0E\u4F7F\u7528",id:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u4E0E\u4F7F\u7528",level:2},{value:"NFS\u534F\u8BAE",id:"nfs\u534F\u8BAE",level:3},{value:"NFS\u670D\u52A1\u7AEF\u914D\u7F6E",id:"nfs\u670D\u52A1\u7AEF\u914D\u7F6E",level:4},{value:"\u76F4\u63A5\u4F7F\u7528NFS\u5377",id:"\u76F4\u63A5\u4F7F\u7528nfs\u5377",level:4},{value:"\u901A\u8FC7PV/PVC\u4F7F\u7528NFS",id:"\u901A\u8FC7pvpvc\u4F7F\u7528nfs",level:4},{value:"CIFS/SMB\u534F\u8BAE",id:"cifssmb\u534F\u8BAE",level:3},{value:"\u4F7F\u7528CIFS\u5377\u793A\u4F8B",id:"\u4F7F\u7528cifs\u5377\u793A\u4F8B",level:4},{value:"iSCSI\u534F\u8BAE",id:"iscsi\u534F\u8BAE",level:3},{value:"iSCSI\u5B58\u50A8\u793A\u4F8B",id:"iscsi\u5B58\u50A8\u793A\u4F8B",level:4},{value:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u5BF9\u6BD4",id:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u5BF9\u6BD4",level:3},{value:"StorageClass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94",id:"storageclass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94",level:2},{value:"StorageClass\u5DE5\u4F5C\u539F\u7406",id:"storageclass\u5DE5\u4F5C\u539F\u7406",level:3},{value:"NFS\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94",id:"nfs\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94",level:3},{value:"1. \u90E8\u7F72NFS Provisioner",id:"1-\u90E8\u7F72nfs-provisioner",level:4},{value:"2. \u521B\u5EFAStorageClass",id:"2-\u521B\u5EFAstorageclass",level:4},{value:"3. \u4F7F\u7528\u52A8\u6001\u4F9B\u5E94\u521B\u5EFAPVC",id:"3-\u4F7F\u7528\u52A8\u6001\u4F9B\u5E94\u521B\u5EFApvc",level:4},{value:"\u4E91\u5B58\u50A8\u52A8\u6001\u4F9B\u5E94",id:"\u4E91\u5B58\u50A8\u52A8\u6001\u4F9B\u5E94",level:3},{value:"StorageClass\u53C2\u6570\u8BE6\u89E3",id:"storageclass\u53C2\u6570\u8BE6\u89E3",level:3},{value:"Deployment\u4F7F\u7528PVC",id:"deployment\u4F7F\u7528pvc",level:2},{value:"\u573A\u666F1\uFF1A\u5171\u4EAB\u5B58\u50A8\uFF08ReadWriteMany\uFF09",id:"\u573A\u666F1\u5171\u4EAB\u5B58\u50A8readwritemany",level:3},{value:"\u573A\u666F2\uFF1A\u72EC\u7ACB\u5B58\u50A8\uFF08ReadWriteOnce\uFF09",id:"\u573A\u666F2\u72EC\u7ACB\u5B58\u50A8readwriteonce",level:3},{value:"StatefulSet\u4F7F\u7528PVC",id:"statefulset\u4F7F\u7528pvc",level:2},{value:"StatefulSet\u7684\u5B58\u50A8\u7279\u6027",id:"statefulset\u7684\u5B58\u50A8\u7279\u6027",level:3},{value:"MySQL\u96C6\u7FA4\u793A\u4F8B",id:"mysql\u96C6\u7FA4\u793A\u4F8B",level:3},{value:"Redis\u96C6\u7FA4\u793A\u4F8B",id:"redis\u96C6\u7FA4\u793A\u4F8B",level:3},{value:"PostgreSQL\u96C6\u7FA4\u793A\u4F8B",id:"postgresql\u96C6\u7FA4\u793A\u4F8B",level:3},{value:"\u5B58\u50A8\u6700\u4F73\u5B9E\u8DF5",id:"\u5B58\u50A8\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"1. \u9009\u62E9\u5408\u9002\u7684\u8BBF\u95EE\u6A21\u5F0F",id:"1-\u9009\u62E9\u5408\u9002\u7684\u8BBF\u95EE\u6A21\u5F0F",level:3},{value:"2. \u5408\u7406\u8BBE\u7F6E\u56DE\u6536\u7B56\u7565",id:"2-\u5408\u7406\u8BBE\u7F6E\u56DE\u6536\u7B56\u7565",level:3},{value:"3. \u4F7F\u7528StorageClass\u5206\u7C7B\u7BA1\u7406",id:"3-\u4F7F\u7528storageclass\u5206\u7C7B\u7BA1\u7406",level:3},{value:"4. \u542F\u7528\u5B58\u50A8\u6269\u5BB9",id:"4-\u542F\u7528\u5B58\u50A8\u6269\u5BB9",level:3},{value:"5. \u4F7F\u7528volumeBindingMode\u4F18\u5316\u8C03\u5EA6",id:"5-\u4F7F\u7528volumebindingmode\u4F18\u5316\u8C03\u5EA6",level:3},{value:"6. \u76D1\u63A7\u5B58\u50A8\u4F7F\u7528\u60C5\u51B5",id:"6-\u76D1\u63A7\u5B58\u50A8\u4F7F\u7528\u60C5\u51B5",level:3},{value:"7. \u6570\u636E\u5907\u4EFD\u7B56\u7565",id:"7-\u6570\u636E\u5907\u4EFD\u7B56\u7565",level:3},{value:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",id:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",level:2},{value:"1. PVC\u4E00\u76F4\u5904\u4E8EPending\u72B6\u6001",id:"1-pvc\u4E00\u76F4\u5904\u4E8Epending\u72B6\u6001",level:3},{value:"2. Pod\u65E0\u6CD5\u6302\u8F7DPVC",id:"2-pod\u65E0\u6CD5\u6302\u8F7Dpvc",level:3},{value:"3. \u5B58\u50A8\u6027\u80FD\u95EE\u9898",id:"3-\u5B58\u50A8\u6027\u80FD\u95EE\u9898",level:3},{value:"4. \u5220\u9664Namespace\u65F6PVC\u65E0\u6CD5\u5220\u9664",id:"4-\u5220\u9664namespace\u65F6pvc\u65E0\u6CD5\u5220\u9664",level:3},{value:"\u603B\u7ED3",id:"\u603B\u7ED3",level:2}];function o(e){let n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\u524D\u8A00",children:"\u524D\u8A00"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u96C6\u7FA4\u4E2D\uFF0C\u5BB9\u5668\u7684\u5B58\u50A8\u9ED8\u8BA4\u662F\u4E34\u65F6\u7684\uFF0C\u5F53",(0,i.jsx)(n.code,{children:"Pod"}),"\u91CD\u542F\u6216\u5220\u9664\u65F6\uFF0C\u5BB9\u5668\u5185\u7684\u6570\u636E\u4F1A\u4E22\u5931\u3002\u5BF9\u4E8E\u6570\u636E\u5E93\u3001\u65E5\u5FD7\u7CFB\u7EDF\u3001\u6587\u4EF6\u5B58\u50A8\u7B49\u9700\u8981\u6301\u4E45\u5316\u6570\u636E\u7684\u5E94\u7528\u573A\u666F\uFF0C\u6211\u4EEC\u9700\u8981\u4F7F\u7528",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u63D0\u4F9B\u7684\u6301\u4E45\u5316\u5B58\u50A8\u673A\u5236\u3002",(0,i.jsx)(n.code,{children:"PersistentVolumeClaim"}),"\uFF08",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF09\u662F",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u5B58\u50A8\u67B6\u6784\u4E2D\u7684\u6838\u5FC3\u62BD\u8C61\uFF0C\u5B83\u5C06\u5B58\u50A8\u7684\u4F7F\u7528\u8005\uFF08",(0,i.jsx)(n.code,{children:"Pod"}),"\uFF09\u548C\u5B58\u50A8\u7684\u63D0\u4F9B\u8005\uFF08",(0,i.jsx)(n.code,{children:"PersistentVolume"}),"\uFF09\u89E3\u8026\uFF0C\u4F7F\u5F97\u5E94\u7528\u5F00\u53D1\u8005\u65E0\u9700\u5173\u5FC3\u5E95\u5C42\u5B58\u50A8\u7684\u5177\u4F53\u5B9E\u73B0\u7EC6\u8282\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"pvc\u662F\u4EC0\u4E48",children:"PVC\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"PersistentVolumeClaim"}),"\uFF08",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF09\u662F\u7528\u6237\u5BF9\u5B58\u50A8\u8D44\u6E90\u7684\u8BF7\u6C42\u58F0\u660E\u3002\u5B83\u7C7B\u4F3C\u4E8E",(0,i.jsx)(n.code,{children:"Pod"}),"\u5BF9\u8BA1\u7B97\u8D44\u6E90\uFF08",(0,i.jsx)(n.code,{children:"CPU"}),"\u3001\u5185\u5B58\uFF09\u7684\u8BF7\u6C42\uFF0C\u4F46",(0,i.jsx)(n.code,{children:"PVC"}),"\u8BF7\u6C42\u7684\u662F\u5B58\u50A8\u8D44\u6E90\u3002\u901A\u8FC7",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF0C\u7528\u6237\u53EF\u4EE5\u58F0\u660E\u6240\u9700\u7684\u5B58\u50A8\u5927\u5C0F\u3001\u8BBF\u95EE\u6A21\u5F0F\u7B49\u9700\u6C42\uFF0C\u800C\u65E0\u9700\u5173\u5FC3\u5B58\u50A8\u7684\u5177\u4F53\u5B9E\u73B0\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes\u5B58\u50A8\u67B6\u6784",children:"Kubernetes\u5B58\u50A8\u67B6\u6784"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u7684\u5B58\u50A8\u7CFB\u7EDF\u7531\u4E09\u4E2A\u6838\u5FC3\u6982\u5FF5\u7EC4\u6210\uFF1A"]}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n  A[Pod] --\x3e|\u4F7F\u7528| B[PVC]\n  B --\x3e|\u7ED1\u5B9A| C[PV]\n  C --\x3e|\u6307\u5411| D[\u5B9E\u9645\u5B58\u50A8<br/>NFS/iSCSI/\u4E91\u76D8\u7B49]\n  E[StorageClass] --\x3e|\u52A8\u6001\u521B\u5EFA| C"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u6982\u5FF5"}),(0,i.jsx)(n.th,{children:"\u8BF4\u660E"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PV (PersistentVolume)"})})}),(0,i.jsxs)(n.td,{children:["\u96C6\u7FA4\u4E2D\u7684\u4E00\u5757\u5B58\u50A8\u8D44\u6E90\uFF0C\u7531\u7BA1\u7406\u5458\u624B\u52A8\u521B\u5EFA\u6216\u901A\u8FC7",(0,i.jsx)(n.code,{children:"StorageClass"}),"\u52A8\u6001\u521B\u5EFA\u3002",(0,i.jsx)(n.code,{children:"PV"}),"\u662F\u96C6\u7FA4\u7EA7\u522B\u7684\u8D44\u6E90\uFF0C\u72EC\u7ACB\u4E8E",(0,i.jsx)(n.code,{children:"Pod"}),"\u7684\u751F\u547D\u5468\u671F\u3002"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PVC (PersistentVolumeClaim)"})})}),(0,i.jsxs)(n.td,{children:["\u7528\u6237\u5BF9\u5B58\u50A8\u8D44\u6E90\u7684\u7533\u8BF7\u3002",(0,i.jsx)(n.code,{children:"PVC"}),"\u4F1A\u81EA\u52A8\u7ED1\u5B9A\u5230\u6EE1\u8DB3\u6761\u4EF6\u7684",(0,i.jsx)(n.code,{children:"PV"}),"\u4E0A\u3002"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"StorageClass"})})}),(0,i.jsxs)(n.td,{children:["\u5B9A\u4E49\u4E86\u5B58\u50A8\u7684\u7C7B\u522B\u548C\u52A8\u6001\u4F9B\u5E94\u7684\u53C2\u6570\uFF0C\u5141\u8BB8\u7528\u6237\u5728\u521B\u5EFA",(0,i.jsx)(n.code,{children:"PVC"}),"\u65F6\u81EA\u52A8\u521B\u5EFA\u5BF9\u5E94\u7684",(0,i.jsx)(n.code,{children:"PV"}),"\u3002"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"pvc\u89E3\u51B3\u4E86\u4EC0\u4E48\u95EE\u9898",children:"PVC\u89E3\u51B3\u4E86\u4EC0\u4E48\u95EE\u9898\uFF1F"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u4F20\u7EDF\u5BB9\u5668\u90E8\u7F72\u4E2D\uFF0C\u76F4\u63A5\u4F7F\u7528",(0,i.jsx)(n.code,{children:"volume"}),"\u6302\u8F7D\u5B58\u50A8\u5B58\u5728\u4EE5\u4E0B\u95EE\u9898\uFF1A"]}),"\n",(0,i.jsx)(n.h4,{id:"\u75DB\u70B9\u6848\u4F8B1\u5B58\u50A8\u914D\u7F6E\u4E0E\u5E94\u7528\u8026\u5408",children:"\u75DB\u70B9\u6848\u4F8B1\uFF1A\u5B58\u50A8\u914D\u7F6E\u4E0E\u5E94\u7528\u8026\u5408"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u573A\u666F"}),"\uFF1A\u67D0\u56E2\u961F\u5F00\u53D1\u4E86\u4E00\u4E2A\u5FAE\u670D\u52A1\u5E94\u7528\uFF0C\u9700\u8981\u5728\u5F00\u53D1\u3001\u6D4B\u8BD5\u3001\u751F\u4EA7\u73AF\u5883\u5206\u522B\u90E8\u7F72\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95EE\u9898"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4E0D\u540C\u73AF\u5883\u4F7F\u7528\u4E0D\u540C\u7684\u5B58\u50A8\u540E\u7AEF\uFF08\u5F00\u53D1\u7528\u672C\u5730\u5B58\u50A8\uFF0C\u6D4B\u8BD5\u7528",(0,i.jsx)(n.code,{children:"NFS"}),"\uFF0C\u751F\u4EA7\u7528\u4E91\u5B58\u50A8\uFF09"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6BCF\u4E2A\u73AF\u5883\u90FD\u9700\u8981\u4FEE\u6539",(0,i.jsx)(n.code,{children:"Pod"}),"\u914D\u7F6E\u4E2D\u7684",(0,i.jsx)(n.code,{children:"volume"}),"\u5B9A\u4E49"]}),"\n",(0,i.jsx)(n.li,{children:"\u5E94\u7528\u5F00\u53D1\u8005\u9700\u8981\u4E86\u89E3\u6BCF\u4E2A\u73AF\u5883\u7684\u5B58\u50A8\u7EC6\u8282"}),"\n",(0,i.jsx)(n.li,{children:"\u8FC1\u79FB\u73AF\u5883\u65F6\u9700\u8981\u5927\u91CF\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"PVC"}),"\u62BD\u8C61\u5B58\u50A8\u9700\u6C42\uFF0C\u5E94\u7528\u53EA\u58F0\u660E\u9700\u8981",(0,i.jsx)(n.code,{children:"10Gi"}),"\u5B58\u50A8\u548C\u8BFB\u5199\u6A21\u5F0F"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4E0D\u540C\u73AF\u5883\u7684\u96C6\u7FA4\u7BA1\u7406\u5458\u914D\u7F6E\u5404\u81EA\u7684",(0,i.jsx)(n.code,{children:"StorageClass"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u5E94\u7528\u914D\u7F6E\u5728\u5404\u73AF\u5883\u4FDD\u6301\u4E00\u81F4\uFF0C\u5B58\u50A8\u540E\u7AEF\u7531",(0,i.jsx)(n.code,{children:"PVC"}),"\u81EA\u52A8\u9002\u914D"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u75DB\u70B9\u6848\u4F8B2\u5B58\u50A8\u8D44\u6E90\u7684\u590D\u7528\u548C\u7BA1\u7406",children:"\u75DB\u70B9\u6848\u4F8B2\uFF1A\u5B58\u50A8\u8D44\u6E90\u7684\u590D\u7528\u548C\u7BA1\u7406"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u573A\u666F"}),"\uFF1A\u8FD0\u7EF4\u56E2\u961F\u9700\u8981\u7BA1\u7406\u5927\u91CF\u7684\u5B58\u50A8\u8D44\u6E90\uFF0C\u591A\u4E2A\u5E94\u7528\u5171\u4EAB\u5B58\u50A8\u7CFB\u7EDF\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95EE\u9898"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u624B\u52A8\u4E3A\u6BCF\u4E2A\u5E94\u7528\u5206\u914D\u5B58\u50A8\u7A7A\u95F4\uFF0C\u7BA1\u7406\u590D\u6742"}),"\n",(0,i.jsx)(n.li,{children:"\u5B58\u50A8\u7A7A\u95F4\u96BE\u4EE5\u590D\u7528\uFF0C\u5220\u9664\u5E94\u7528\u540E\u5B58\u50A8\u8D44\u6E90\u95F2\u7F6E"}),"\n",(0,i.jsx)(n.li,{children:"\u7F3A\u4E4F\u7EDF\u4E00\u7684\u5B58\u50A8\u914D\u989D\u548C\u6743\u9650\u7BA1\u7406"}),"\n",(0,i.jsxs)(n.li,{children:["\u5B58\u50A8\u6269\u5BB9\u9700\u8981\u4FEE\u6539\u6BCF\u4E2A\u4F7F\u7528\u5B58\u50A8\u7684",(0,i.jsx)(n.code,{children:"Pod"}),"\u914D\u7F6E"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"PV"}),"\u6C60\u7BA1\u7406\u5B58\u50A8\u8D44\u6E90\uFF0C\u652F\u6301\u52A8\u6001\u5206\u914D\u548C\u56DE\u6536"]}),"\n",(0,i.jsxs)(n.li,{children:["\u901A\u8FC7",(0,i.jsx)(n.code,{children:"PVC"}),"\u7684\u751F\u547D\u5468\u671F\u7BA1\u7406\u5B9E\u73B0\u5B58\u50A8\u7684\u81EA\u52A8\u56DE\u6536\u6216\u4FDD\u7559"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"StorageClass"}),"\u5B9E\u73B0\u5B58\u50A8\u914D\u989D\u3001\u6027\u80FD\u7B49\u7EA7\u7684\u5206\u7C7B\u7BA1\u7406"]}),"\n",(0,i.jsxs)(n.li,{children:["\u652F\u6301",(0,i.jsx)(n.code,{children:"PVC"}),"\u6269\u5BB9\uFF0C\u65E0\u9700\u4FEE\u6539",(0,i.jsx)(n.code,{children:"Pod"}),"\u914D\u7F6E"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u75DB\u70B9\u6848\u4F8B3\u6709\u72B6\u6001\u5E94\u7528\u7684\u90E8\u7F72",children:"\u75DB\u70B9\u6848\u4F8B3\uFF1A\u6709\u72B6\u6001\u5E94\u7528\u7684\u90E8\u7F72"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u573A\u666F"}),"\uFF1A\u90E8\u7F72",(0,i.jsx)(n.code,{children:"MySQL"}),"\u6570\u636E\u5E93\u96C6\u7FA4\uFF0C\u6BCF\u4E2A\u5B9E\u4F8B\u9700\u8981\u72EC\u7ACB\u7684\u6301\u4E45\u5316\u5B58\u50A8\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u95EE\u9898"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6BCF\u4E2A\u6570\u636E\u5E93\u5B9E\u4F8B\u9700\u8981\u72EC\u7ACB\u4E14\u6301\u4E45\u7684\u6570\u636E\u76EE\u5F55"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pod"}),"\u91CD\u542F\u540E\u5FC5\u987B\u7ED1\u5B9A\u5230\u539F\u6765\u7684\u5B58\u50A8\uFF0C\u907F\u514D\u6570\u636E\u4E22\u5931"]}),"\n",(0,i.jsx)(n.li,{children:"\u6570\u636E\u5E93\u6269\u5BB9\u65F6\u9700\u8981\u81EA\u52A8\u521B\u5EFA\u65B0\u7684\u5B58\u50A8\u5377"}),"\n",(0,i.jsx)(n.li,{children:"\u5220\u9664\u6570\u636E\u5E93\u5B9E\u4F8B\u65F6\u9700\u8981\u4FDD\u7559\u6570\u636E\u4EE5\u4FBF\u6062\u590D"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"StatefulSet"}),"\u914D\u5408",(0,i.jsx)(n.code,{children:"volumeClaimTemplates"}),"\u81EA\u52A8\u4E3A\u6BCF\u4E2A\u526F\u672C\u521B\u5EFA",(0,i.jsx)(n.code,{children:"PVC"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PVC"}),"\u4E0E",(0,i.jsx)(n.code,{children:"Pod"}),"\u540D\u79F0\u7ED1\u5B9A\uFF0C\u4FDD\u8BC1\u91CD\u542F\u540E\u5B58\u50A8\u7684\u4E00\u81F4\u6027"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StorageClass"}),"\u7684",(0,i.jsx)(n.code,{children:"reclaimPolicy"}),"\u8BBE\u7F6E\u4E3A",(0,i.jsx)(n.code,{children:"Retain"}),"\u4FDD\u7559\u6570\u636E"]}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301\u6570\u636E\u5E93\u96C6\u7FA4\u7684\u5F39\u6027\u4F38\u7F29"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pvc\u57FA\u7840\u4F7F\u7528",children:"PVC\u57FA\u7840\u4F7F\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"\u8BBF\u95EE\u6A21\u5F0F",children:"\u8BBF\u95EE\u6A21\u5F0F"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"PVC"}),"\u652F\u6301\u4EE5\u4E0B\u8BBF\u95EE\u6A21\u5F0F\uFF08",(0,i.jsx)(n.code,{children:"AccessModes"}),"\uFF09\uFF1A"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u8BBF\u95EE\u6A21\u5F0F"}),(0,i.jsx)(n.th,{children:"\u7F29\u5199"}),(0,i.jsx)(n.th,{children:"\u8BF4\u660E"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReadWriteOnce"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWO"})}),(0,i.jsx)(n.td,{children:"\u5377\u53EF\u4EE5\u88AB\u5355\u4E2A\u8282\u70B9\u4EE5\u8BFB\u5199\u65B9\u5F0F\u6302\u8F7D\u3002\u6700\u5E38\u89C1\uFF0C\u9002\u7528\u4E8E\u5927\u591A\u6570\u5757\u5B58\u50A8\u3002"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReadOnlyMany"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ROX"})}),(0,i.jsx)(n.td,{children:"\u5377\u53EF\u4EE5\u88AB\u591A\u4E2A\u8282\u70B9\u4EE5\u53EA\u8BFB\u65B9\u5F0F\u6302\u8F7D\u3002\u9002\u7528\u4E8E\u5171\u4EAB\u914D\u7F6E\u6587\u4EF6\u3001\u9759\u6001\u8D44\u6E90\u7B49\u573A\u666F\u3002"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReadWriteMany"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWX"})}),(0,i.jsxs)(n.td,{children:["\u5377\u53EF\u4EE5\u88AB\u591A\u4E2A\u8282\u70B9\u4EE5\u8BFB\u5199\u65B9\u5F0F\u6302\u8F7D\u3002\u9700\u8981\u5B58\u50A8\u7CFB\u7EDF\u652F\u6301\uFF0C\u5982",(0,i.jsx)(n.code,{children:"NFS"}),"\u3001",(0,i.jsx)(n.code,{children:"CephFS"}),"\u7B49\u3002"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReadWriteOncePod"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWOP"})}),(0,i.jsxs)(n.td,{children:["\u5377\u53EA\u80FD\u88AB\u5355\u4E2A",(0,i.jsx)(n.code,{children:"Pod"}),"\u4EE5\u8BFB\u5199\u65B9\u5F0F\u6302\u8F7D\uFF08",(0,i.jsx)(n.code,{children:"Kubernetes 1.22+"}),"\u7279\u6027\uFF09\u3002"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u7B80\u5355\u7684pod\u4F7F\u7528pvc\u793A\u4F8B",children:"\u7B80\u5355\u7684Pod\u4F7F\u7528PVC\u793A\u4F8B"}),"\n",(0,i.jsxs)(n.p,{children:["\u4EE5\u4E0B\u662F\u521B\u5EFA",(0,i.jsx)(n.code,{children:"PVC"}),"\u5E76\u5728",(0,i.jsx)(n.code,{children:"Pod"}),"\u4E2D\u4F7F\u7528\u7684\u57FA\u672C\u793A\u4F8B\uFF1A"]}),"\n",(0,i.jsx)(n.h4,{id:"1-\u521B\u5EFApersistentvolume",children:"1. \u521B\u5EFAPersistentVolume"}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\u521B\u5EFA\u4E00\u4E2A",(0,i.jsx)(n.code,{children:"PV"}),"\uFF08\u5728\u4F7F\u7528\u52A8\u6001\u4F9B\u5E94\u524D\uFF0C\u901A\u5E38\u9700\u8981\u7BA1\u7406\u5458\u9884\u5148\u521B\u5EFA\uFF09\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-local-storage\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: local-storage # \u53EF\u9009\n  hostPath:\n    path: /data/k8s-storage\n    type: DirectoryOrCreate\n"})}),"\n",(0,i.jsx)(n.h4,{id:"2-\u521B\u5EFApersistentvolumeclaim",children:"2. \u521B\u5EFAPersistentVolumeClaim"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u88AB",(0,i.jsx)(n.code,{children:"Pod/Deployment"}),"\u4F7F\u7528\u524D\uFF0C\u7528\u6237\u9700\u8981\u521B\u5EFA\u5BF9\u5E94\u7684",(0,i.jsx)(n.code,{children:"PVC"}),"\u7533\u8BF7\u5B58\u50A8\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc-app-data\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n  storageClassName: local-storage\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8BF4\u660E\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"accessModes"}),"\uFF1A\u5FC5\u987B\u4E0E\u53EF\u7528",(0,i.jsx)(n.code,{children:"PV"}),"\u7684\u8BBF\u95EE\u6A21\u5F0F\u5339\u914D"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resources.requests.storage"}),"\uFF1A\u8BF7\u6C42\u7684\u5B58\u50A8\u7A7A\u95F4\u5927\u5C0F"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"storageClassName"}),"\uFF1A\u6307\u5B9A\u5B58\u50A8\u7C7B\uFF0C\u5982\u679C\u4E0D\u6307\u5B9A\u5219\u4F7F\u7528\u9ED8\u8BA4",(0,i.jsx)(n.code,{children:"StorageClass"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"3-\u5728pod\u4E2D\u4F7F\u7528pvc",children:"3. \u5728Pod\u4E2D\u4F7F\u7528PVC"}),"\n",(0,i.jsxs)(n.p,{children:["\u521B\u5EFA",(0,i.jsx)(n.code,{children:"Pod"}),"\u5E76\u6302\u8F7D",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: app-with-storage\n  namespace: default\nspec:\n  containers:\n  - name: app\n    image: nginx:latest\n    volumeMounts:\n    - name: data-volume\n      mountPath: /usr/share/nginx/html\n  volumes:\n  - name: data-volume\n    persistentVolumeClaim:\n      claimName: pvc-app-data\n"})}),"\n",(0,i.jsx)(n.h4,{id:"4-\u9A8C\u8BC1\u5B58\u50A8\u6302\u8F7D",children:"4. \u9A8C\u8BC1\u5B58\u50A8\u6302\u8F7D"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67E5\u770BPVC\u72B6\u6001\nkubectl get pvc pvc-app-data\n\n# \u8F93\u51FA\u793A\u4F8B\n# NAME           STATUS   VOLUME              CAPACITY   ACCESS MODES   STORAGECLASS    AGE\n# pvc-app-data   Bound    pv-local-storage    10Gi       RWO            local-storage   2m\n\n# \u8FDB\u5165Pod\u9A8C\u8BC1\u6302\u8F7D\nkubectl exec -it app-with-storage -- df -h /usr/share/nginx/html\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u4E0E\u4F7F\u7528",children:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u4E0E\u4F7F\u7528"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u652F\u6301\u591A\u79CD\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\uFF0C\u53EF\u4EE5\u5C06\u8FDC\u7A0B\u5B58\u50A8\u6302\u8F7D\u5230",(0,i.jsx)(n.code,{children:"Pod"}),"\u4E2D\u3002\u4EE5\u4E0B\u4ECB\u7ECD\u5E38\u89C1\u7684\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u53CA\u5176\u4F7F\u7528\u65B9\u5F0F\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"nfs\u534F\u8BAE",children:"NFS\u534F\u8BAE"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NFS"}),"\uFF08",(0,i.jsx)(n.code,{children:"Network File System"}),"\uFF09\u662F\u6700\u5E38\u7528\u7684\u7F51\u7EDC\u6587\u4EF6\u7CFB\u7EDF\u534F\u8BAE\uFF0C\u652F\u6301",(0,i.jsx)(n.code,{children:"ReadWriteMany"}),"\u8BBF\u95EE\u6A21\u5F0F\uFF0C\u5141\u8BB8\u591A\u4E2A",(0,i.jsx)(n.code,{children:"Pod"}),"\u540C\u65F6\u8BFB\u5199\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"nfs\u670D\u52A1\u7AEF\u914D\u7F6E",children:"NFS\u670D\u52A1\u7AEF\u914D\u7F6E"}),"\n",(0,i.jsxs)(n.p,{children:["\u5047\u8BBE\u4F60\u5DF2\u7ECF\u6709\u4E00\u4E2A",(0,i.jsx)(n.code,{children:"NFS"}),"\u670D\u52A1\u5668",(0,i.jsx)(n.code,{children:"nfs.team.local"}),"\uFF0C\u5BFC\u51FA\u76EE\u5F55\u4E3A",(0,i.jsx)(n.code,{children:"/hpc"}),"\u3002\u5982\u679C\u9700\u8981\u642D\u5EFA",(0,i.jsx)(n.code,{children:"NFS"}),"\u670D\u52A1\u5668\uFF0C\u53EF\u4EE5\u53C2\u8003\u4EE5\u4E0B\u6B65\u9AA4\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5728NFS\u670D\u52A1\u5668\u4E0A\u5B89\u88C5nfs-server\uFF08Ubuntu/Debian\uFF09\napt-get update\napt-get install -y nfs-kernel-server\n\n# \u521B\u5EFA\u5171\u4EAB\u76EE\u5F55\nmkdir -p /data/nfs-share\nchmod 777 /data/nfs-share\n\n# \u914D\u7F6ENFS\u5BFC\u51FA\ncat >> /etc/exports <<EOF\n/data/nfs-share *(rw,sync,no_subtree_check,no_root_squash)\nEOF\n\n# \u91CD\u542FNFS\u670D\u52A1\nexportfs -ra\nsystemctl restart nfs-kernel-server\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u76F4\u63A5\u4F7F\u7528nfs\u5377",children:"\u76F4\u63A5\u4F7F\u7528NFS\u5377"}),"\n",(0,i.jsxs)(n.p,{children:["\u6700\u7B80\u5355\u7684\u65B9\u5F0F\u662F\u76F4\u63A5\u5728",(0,i.jsx)(n.code,{children:"Pod"}),"\u4E2D\u5B9A\u4E49",(0,i.jsx)(n.code,{children:"NFS"}),"\u5377\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nfs-pod-direct\nspec:\n  containers:\n  - name: app\n    image: nginx:latest\n    volumeMounts:\n    - name: nfs-volume\n      mountPath: /data/hpc\n  volumes:\n  - name: nfs-volume\n    nfs:\n      server: nfs.team.local\n      path: /hpc\n      readOnly: false\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u901A\u8FC7pvpvc\u4F7F\u7528nfs",children:"\u901A\u8FC7PV/PVC\u4F7F\u7528NFS"}),"\n",(0,i.jsxs)(n.p,{children:["\u63A8\u8350\u7684\u65B9\u5F0F\u662F\u901A\u8FC7",(0,i.jsx)(n.code,{children:"PV"}),"\u548C",(0,i.jsx)(n.code,{children:"PVC"}),"\u4F7F\u7528",(0,i.jsx)(n.code,{children:"NFS"}),"\u5B58\u50A8\uFF1A"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. \u521B\u5EFANFS PersistentVolume\uFF1A"})}),"\n",(0,i.jsxs)(n.admonition,{title:"\u63D0\u793A",type:"note",children:[(0,i.jsxs)(n.p,{children:["\u7C7B\u4F3C\u7684",(0,i.jsx)(n.code,{children:"mount"}),"\u547D\u4EE4\u4E3A\uFF1A"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo mount -t nfs -o rw,relatime,vers=3,rsize=1048576,wsize=1048576,hard,nolock,proto=tcp nfs.team.local:/hpc /data/hpc\n"})})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-nfs-hpc\nspec:\n  capacity:\n    storage: 100Gi\n  accessModes:\n    - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: nfs-storage\n  mountOptions:\n    - vers=3\n    - rsize=1048576\n    - wsize=1048576\n    - hard\n    - nolock\n    - proto=tcp\n  nfs:\n    server: nfs.team.local\n    path: /hpc\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8BF4\u660E\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mountOptions"}),"\uFF1A\u5BF9\u5E94\u547D\u4EE4",(0,i.jsx)(n.code,{children:"mount -o"}),"\u7684\u53C2\u6570","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"vers=3"}),"\uFF1A\u4F7F\u7528",(0,i.jsx)(n.code,{children:"NFSv3"}),"\u534F\u8BAE"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rsize=1048576"}),"\uFF1A\u8BFB\u7F13\u51B2\u533A\u5927\u5C0F\u4E3A",(0,i.jsx)(n.code,{children:"1MB"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wsize=1048576"}),"\uFF1A\u5199\u7F13\u51B2\u533A\u5927\u5C0F\u4E3A",(0,i.jsx)(n.code,{children:"1MB"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hard"}),"\uFF1A\u786C\u6302\u8F7D\uFF0C\u7F51\u7EDC\u4E2D\u65AD\u65F6\u4F1A\u91CD\u8BD5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"nolock"}),"\uFF1A\u4E0D\u4F7F\u7528",(0,i.jsx)(n.code,{children:"NFS"}),"\u6587\u4EF6\u9501"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"proto=tcp"}),"\uFF1A\u4F7F\u7528",(0,i.jsx)(n.code,{children:"TCP"}),"\u534F\u8BAE"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. \u521B\u5EFAPVC\uFF1A"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc-nfs-hpc\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 50Gi\n  storageClassName: nfs-storage\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. \u5728Deployment\u4E2D\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-app-with-nfs\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-app\n  template:\n    metadata:\n      labels:\n        app: web-app\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n        volumeMounts:\n        - name: shared-data\n          mountPath: /usr/share/nginx/html\n      volumes:\n      - name: shared-data\n        persistentVolumeClaim:\n          claimName: pvc-nfs-hpc\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7531\u4E8E",(0,i.jsx)(n.code,{children:"NFS"}),"\u652F\u6301",(0,i.jsx)(n.code,{children:"ReadWriteMany"}),"\uFF0C\u8FD9\u4E2A",(0,i.jsx)(n.code,{children:"Deployment"}),"\u7684",(0,i.jsx)(n.code,{children:"3"}),"\u4E2A\u526F\u672C\u53EF\u4EE5\u540C\u65F6\u8BFB\u5199\u540C\u4E00\u4E2A\u5B58\u50A8\u5377\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"cifssmb\u534F\u8BAE",children:"CIFS/SMB\u534F\u8BAE"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"CIFS"}),"\uFF08",(0,i.jsx)(n.code,{children:"Common Internet File System"}),"\uFF09\u4E5F\u79F0\u4E3A",(0,i.jsx)(n.code,{children:"SMB"}),"\uFF08",(0,i.jsx)(n.code,{children:"Server Message Block"}),"\uFF09\uFF0C\u4E3B\u8981\u7528\u4E8E",(0,i.jsx)(n.code,{children:"Windows"}),"\u6587\u4EF6\u5171\u4EAB\uFF0C\u4E5F\u53EF\u4EE5\u5728",(0,i.jsx)(n.code,{children:"Linux"}),"\u7CFB\u7EDF\u4E2D\u4F7F\u7528\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"\u4F7F\u7528cifs\u5377\u793A\u4F8B",children:"\u4F7F\u7528CIFS\u5377\u793A\u4F8B"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-cifs-share\nspec:\n  capacity:\n    storage: 50Gi\n  accessModes:\n    - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: cifs-storage\n  mountOptions:\n    - vers=3.0\n    - dir_mode=0777\n    - file_mode=0777\n  csi:\n    driver: smb.csi.k8s.io\n    volumeHandle: smb-server.example.com/share\n    volumeAttributes:\n      source: "//smb-server.example.com/share"\n    nodeStageSecretRef:\n      name: cifs-secret\n      namespace: default\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: cifs-secret\n  namespace: default\ntype: Opaque\nstringData:\n  username: "myuser"\n  password: "mypassword"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u4ECE",(0,i.jsx)(n.code,{children:"Kubernetes 1.26"}),"\u5F00\u59CB\uFF0C\u5185\u7F6E\u7684",(0,i.jsx)(n.code,{children:"CIFS"}),"\u5377\u63D2\u4EF6\u5DF2\u88AB\u5E9F\u5F03\uFF0C\u63A8\u8350\u4F7F\u7528",(0,i.jsx)(n.code,{children:"CSI"}),"\u9A71\u52A8\uFF08\u5982",(0,i.jsx)(n.code,{children:"csi-driver-smb"}),"\uFF09\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"iscsi\u534F\u8BAE",children:"iSCSI\u534F\u8BAE"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"iSCSI"}),"\uFF08",(0,i.jsx)(n.code,{children:"Internet Small Computer System Interface"}),"\uFF09\u662F\u57FA\u4E8E",(0,i.jsx)(n.code,{children:"TCP/IP"}),"\u7684\u5757\u5B58\u50A8\u534F\u8BAE\uFF0C\u5C06",(0,i.jsx)(n.code,{children:"SCSI"}),"\u547D\u4EE4\u5C01\u88C5\u5728",(0,i.jsx)(n.code,{children:"IP"}),"\u5305\u4E2D\u4F20\u8F93\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"iscsi\u5B58\u50A8\u793A\u4F8B",children:"iSCSI\u5B58\u50A8\u793A\u4F8B"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-iscsi-storage\nspec:\n  capacity:\n    storage: 20Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: iscsi-storage\n  iscsi:\n    targetPortal: 192.168.1.100:3260\n    iqn: iqn.2021-01.com.example:storage.target01\n    lun: 0\n    fsType: ext4\n    readOnly: false\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8BF4\u660E\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"targetPortal"}),"\uFF1A",(0,i.jsx)(n.code,{children:"iSCSI Target"}),"\u7684",(0,i.jsx)(n.code,{children:"IP"}),"\u5730\u5740\u548C\u7AEF\u53E3"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"iqn"}),"\uFF1A",(0,i.jsx)(n.code,{children:"iSCSI"}),"\u9650\u5B9A\u540D\u79F0\uFF0C\u6807\u8BC6\u5B58\u50A8\u76EE\u6807"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"lun"}),"\uFF1A\u903B\u8F91\u5355\u5143\u53F7"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fsType"}),"\uFF1A\u6587\u4EF6\u7CFB\u7EDF\u7C7B\u578B"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u4F7F\u7528",(0,i.jsx)(n.code,{children:"iSCSI"}),"\u524D\uFF0C\u9700\u8981\u5728",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u8282\u70B9\u4E0A\u5B89\u88C5",(0,i.jsx)(n.code,{children:"iscsi-initiator-utils"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# CentOS/RHEL\nyum install -y iscsi-initiator-utils\n\n# Ubuntu/Debian  \napt-get install -y open-iscsi\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u5BF9\u6BD4",children:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE\u5BF9\u6BD4"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u534F\u8BAE"}),(0,i.jsx)(n.th,{children:"\u7C7B\u578B"}),(0,i.jsx)(n.th,{children:"\u8BBF\u95EE\u6A21\u5F0F"}),(0,i.jsx)(n.th,{children:"\u6027\u80FD"}),(0,i.jsx)(n.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"NFS"})})}),(0,i.jsx)(n.td,{children:"\u6587\u4EF6\u7CFB\u7EDF"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWX"})}),(0,i.jsx)(n.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(n.td,{children:"\u5171\u4EAB\u6587\u4EF6\u5B58\u50A8\u3001\u65E5\u5FD7\u6536\u96C6\u3001\u9759\u6001\u8D44\u6E90"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"CIFS/SMB"})})}),(0,i.jsx)(n.td,{children:"\u6587\u4EF6\u7CFB\u7EDF"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWX"})}),(0,i.jsx)(n.td,{children:"\u4E2D\u7B49"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Windows"}),"\u73AF\u5883\u3001\u529E\u516C\u6587\u4EF6\u5171\u4EAB"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"iSCSI"})})}),(0,i.jsx)(n.td,{children:"\u5757\u5B58\u50A8"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWO"})}),(0,i.jsx)(n.td,{children:"\u9AD8"}),(0,i.jsx)(n.td,{children:"\u6570\u636E\u5E93\u3001\u9AD8\u6027\u80FD\u5E94\u7528"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Ceph RBD"})})}),(0,i.jsx)(n.td,{children:"\u5757\u5B58\u50A8"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWO"})}),(0,i.jsx)(n.td,{children:"\u9AD8"}),(0,i.jsx)(n.td,{children:"\u4E91\u539F\u751F\u5B58\u50A8\u3001\u5927\u89C4\u6A21\u96C6\u7FA4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"CephFS"})})}),(0,i.jsx)(n.td,{children:"\u6587\u4EF6\u7CFB\u7EDF"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RWX"})}),(0,i.jsx)(n.td,{children:"\u4E2D\u9AD8"}),(0,i.jsx)(n.td,{children:"\u5206\u5E03\u5F0F\u6587\u4EF6\u5B58\u50A8"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"storageclass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94",children:"StorageClass\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"StorageClass"}),"\u63D0\u4F9B\u4E86\u4E00\u79CD\u63CF\u8FF0\u5B58\u50A8\u7C7B\u522B\u7684\u65B9\u5F0F\uFF0C\u5141\u8BB8\u7BA1\u7406\u5458\u5B9A\u4E49\u4E0D\u540C\u7C7B\u578B\u7684\u5B58\u50A8\u670D\u52A1\u3002\u4F7F\u7528",(0,i.jsx)(n.code,{children:"StorageClass"}),"\u53EF\u4EE5\u5B9E\u73B0\u5B58\u50A8\u7684\u52A8\u6001\u4F9B\u5E94\uFF0C\u5F53\u7528\u6237\u521B\u5EFA",(0,i.jsx)(n.code,{children:"PVC"}),"\u65F6\u81EA\u52A8\u521B\u5EFA\u5BF9\u5E94\u7684",(0,i.jsx)(n.code,{children:"PV"}),"\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"storageclass\u5DE5\u4F5C\u539F\u7406",children:"StorageClass\u5DE5\u4F5C\u539F\u7406"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User as \u7528\u6237\n    participant PVC as PersistentVolumeClaim\n    participant SC as StorageClass\n    participant Provisioner as \u5B58\u50A8\u4F9B\u5E94\u5668\n    participant PV as PersistentVolume\n    participant Storage as \u5B9E\u9645\u5B58\u50A8\u7CFB\u7EDF\n    \n    User->>PVC: 1. \u521B\u5EFAPVC\u8BF7\u6C42\u5B58\u50A8\n    PVC->>SC: 2. \u6307\u5B9AStorageClass\n    SC->>Provisioner: 3. \u89E6\u53D1\u52A8\u6001\u4F9B\u5E94\u5668\n    Provisioner->>Storage: 4. \u5728\u5B58\u50A8\u7CFB\u7EDF\u521B\u5EFA\u5377\n    Storage--\x3e>Provisioner: 5. \u8FD4\u56DE\u5377\u4FE1\u606F\n    Provisioner->>PV: 6. \u521B\u5EFAPV\u5BF9\u8C61\n    PV->>PVC: 7. \u7ED1\u5B9APVC\u5230PV\n    PVC--\x3e>User: 8. PVC\u5C31\u7EEA\u53EF\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"nfs\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94",children:"NFS\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NFS"}),"\u672C\u8EAB\u4E0D\u652F\u6301\u52A8\u6001\u4F9B\u5E94\uFF0C\u9700\u8981\u4F7F\u7528\u5916\u90E8\u4F9B\u5E94\u5668\uFF08\u5982",(0,i.jsx)(n.code,{children:"nfs-subdir-external-provisioner"}),"\uFF09\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"1-\u90E8\u7F72nfs-provisioner",children:"1. \u90E8\u7F72NFS Provisioner"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: [""]\n    resources: ["persistentvolumes"]\n    verbs: ["get", "list", "watch", "create", "delete"]\n  - apiGroups: [""]\n    resources: ["persistentvolumeclaims"]\n    verbs: ["get", "list", "watch", "update"]\n  - apiGroups: ["storage.k8s.io"]\n    resources: ["storageclasses"]\n    verbs: ["get", "list", "watch"]\n  - apiGroups: [""]\n    resources: ["events"]\n    verbs: ["create", "update", "patch"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nfs-client-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      app: nfs-client-provisioner\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n      - name: nfs-client-provisioner\n        image: registry.k8s.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2\n        volumeMounts:\n        - name: nfs-client-root\n          mountPath: /persistentvolumes\n        env:\n        - name: PROVISIONER_NAME\n          value: k8s-sigs.io/nfs-subdir-external-provisioner\n        - name: NFS_SERVER\n          value: nfs.team.local\n        - name: NFS_PATH\n          value: /hpc\n      volumes:\n      - name: nfs-client-root\n        nfs:\n          server: nfs.team.local\n          path: /hpc\n'})}),"\n",(0,i.jsx)(n.h4,{id:"2-\u521B\u5EFAstorageclass",children:"2. \u521B\u5EFAStorageClass"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: nfs-client\n  annotations:\n    storageclass.kubernetes.io/is-default-class: "true"\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner\nparameters:\n  archiveOnDelete: "true"\n  pathPattern: "${.PVC.namespace}-${.PVC.name}"\nmountOptions:\n  - vers=3\n  - rsize=1048576\n  - wsize=1048576\n  - hard\n  - nolock\n  - proto=tcp\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8BF4\u660E\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"provisioner"}),"\uFF1A\u4F9B\u5E94\u5668\u540D\u79F0\uFF0C\u5FC5\u987B\u4E0E",(0,i.jsx)(n.code,{children:"Deployment"}),"\u4E2D\u7684",(0,i.jsx)(n.code,{children:"PROVISIONER_NAME"}),"\u4E00\u81F4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"parameters.archiveOnDelete"}),"\uFF1A\u5220\u9664",(0,i.jsx)(n.code,{children:"PVC"}),"\u65F6\u662F\u5426\u5F52\u6863\u6570\u636E"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"parameters.pathPattern"}),"\uFF1A\u5B50\u76EE\u5F55\u547D\u540D\u6A21\u5F0F"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"reclaimPolicy"}),"\uFF1A\u56DE\u6536\u7B56\u7565\uFF0C",(0,i.jsx)(n.code,{children:"Delete"}),"\u6216",(0,i.jsx)(n.code,{children:"Retain"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"volumeBindingMode"}),"\uFF1A\u7ED1\u5B9A\u6A21\u5F0F\uFF0C",(0,i.jsx)(n.code,{children:"Immediate"}),"\uFF08\u7ACB\u5373\u7ED1\u5B9A\uFF09\u6216",(0,i.jsx)(n.code,{children:"WaitForFirstConsumer"}),"\uFF08\u7B49\u5F85\u9996\u6B21\u4F7F\u7528\uFF09"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"3-\u4F7F\u7528\u52A8\u6001\u4F9B\u5E94\u521B\u5EFApvc",children:"3. \u4F7F\u7528\u52A8\u6001\u4F9B\u5E94\u521B\u5EFAPVC"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc-nfs-dynamic\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: nfs-client\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6B64\u65F6\u65E0\u9700\u624B\u52A8\u521B\u5EFA",(0,i.jsx)(n.code,{children:"PV"}),"\uFF0C",(0,i.jsx)(n.code,{children:"nfs-client-provisioner"}),"\u4F1A\u81EA\u52A8\u521B\u5EFA\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u4E91\u5B58\u50A8\u52A8\u6001\u4F9B\u5E94",children:"\u4E91\u5B58\u50A8\u52A8\u6001\u4F9B\u5E94"}),"\n",(0,i.jsxs)(n.p,{children:["\u4E91\u670D\u52A1\u5546\u901A\u5E38\u63D0\u4F9B\u4E86",(0,i.jsx)(n.code,{children:"CSI"}),"\u9A71\u52A8\u652F\u6301\u52A8\u6001\u4F9B\u5E94\uFF0C\u4EE5\u963F\u91CC\u4E91\u4E3A\u4F8B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: alicloud-disk-ssd\nprovisioner: diskplugin.csi.alibabacloud.com\nparameters:\n  type: cloud_ssd\n  regionId: cn-hangzhou\n  zoneId: cn-hangzhou-b\n  fsType: ext4\nreclaimPolicy: Delete\nallowVolumeExpansion: true\nvolumeBindingMode: WaitForFirstConsumer\n"})}),"\n",(0,i.jsx)(n.h3,{id:"storageclass\u53C2\u6570\u8BE6\u89E3",children:"StorageClass\u53C2\u6570\u8BE6\u89E3"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u53C2\u6570"}),(0,i.jsx)(n.th,{children:"\u8BF4\u660E"}),(0,i.jsx)(n.th,{children:"\u53EF\u9009\u503C"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"provisioner"})}),(0,i.jsx)(n.td,{children:"\u5B58\u50A8\u4F9B\u5E94\u5668"}),(0,i.jsx)(n.td,{children:"\u5185\u7F6E\u6216\u5916\u90E8\u4F9B\u5E94\u5668\u540D\u79F0"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"parameters"})}),(0,i.jsx)(n.td,{children:"\u4F9B\u5E94\u5668\u7279\u5B9A\u53C2\u6570"}),(0,i.jsx)(n.td,{children:"\u4F9D\u4F9B\u5E94\u5668\u800C\u5B9A"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"reclaimPolicy"})}),(0,i.jsx)(n.td,{children:"\u56DE\u6536\u7B56\u7565"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Delete"}),"\uFF08\u5220\u9664\uFF09\u3001",(0,i.jsx)(n.code,{children:"Retain"}),"\uFF08\u4FDD\u7559\uFF09"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"allowVolumeExpansion"})}),(0,i.jsx)(n.td,{children:"\u662F\u5426\u5141\u8BB8\u6269\u5BB9"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"true"}),"\u3001",(0,i.jsx)(n.code,{children:"false"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"volumeBindingMode"})}),(0,i.jsx)(n.td,{children:"\u7ED1\u5B9A\u6A21\u5F0F"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Immediate"}),"\u3001",(0,i.jsx)(n.code,{children:"WaitForFirstConsumer"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"mountOptions"})}),(0,i.jsx)(n.td,{children:"\u6302\u8F7D\u9009\u9879"}),(0,i.jsx)(n.td,{children:"\u6587\u4EF6\u7CFB\u7EDF\u6302\u8F7D\u53C2\u6570"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"deployment\u4F7F\u7528pvc",children:"Deployment\u4F7F\u7528PVC"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Deployment"}),"\u9002\u7528\u4E8E\u65E0\u72B6\u6001\u5E94\u7528\uFF0C\u6240\u6709\u526F\u672C\u5171\u4EAB\u540C\u4E00\u4E2A",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF08\u9700\u8981\u5B58\u50A8\u652F\u6301",(0,i.jsx)(n.code,{children:"ReadWriteMany"}),"\uFF09\u6216\u6BCF\u4E2A\u526F\u672C\u4F7F\u7528\u72EC\u7ACB\u7684",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF08",(0,i.jsx)(n.code,{children:"ReadWriteOnce"}),"\uFF09\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u573A\u666F1\u5171\u4EAB\u5B58\u50A8readwritemany",children:"\u573A\u666F1\uFF1A\u5171\u4EAB\u5B58\u50A8\uFF08ReadWriteMany\uFF09"}),"\n",(0,i.jsx)(n.p,{children:"\u591A\u4E2A\u526F\u672C\u5171\u4EAB\u540C\u4E00\u4EFD\u6570\u636E\uFF0C\u9002\u5408\u9759\u6001\u8D44\u6E90\u670D\u52A1\u5668\u3001\u65E5\u5FD7\u6536\u96C6\u7B49\u573A\u666F\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: shared-pvc\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 20Gi\n  storageClassName: nfs-client\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.25\n        ports:\n        - containerPort: 80\n        volumeMounts:\n        - name: html-data\n          mountPath: /usr/share/nginx/html\n      volumes:\n      - name: html-data\n        persistentVolumeClaim:\n          claimName: shared-pvc\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u573A\u666F2\u72EC\u7ACB\u5B58\u50A8readwriteonce",children:"\u573A\u666F2\uFF1A\u72EC\u7ACB\u5B58\u50A8\uFF08ReadWriteOnce\uFF09"}),"\n",(0,i.jsxs)(n.p,{children:["\u6BCF\u4E2A\u526F\u672C\u9700\u8981\u72EC\u7ACB\u5B58\u50A8\uFF0C\u4F46\u4F7F\u7528",(0,i.jsx)(n.code,{children:"Deployment"}),"\u7BA1\u7406\u3002\u9700\u8981\u4E3A\u6BCF\u4E2A\u526F\u672C\u521B\u5EFA\u72EC\u7ACB\u7684",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# \u9700\u8981\u624B\u52A8\u521B\u5EFA\u591A\u4E2APVC\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: app-pvc-0\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: local-storage\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: app-pvc-1\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: local-storage\n---\n# \u4F7F\u7528\u4E0D\u540C\u7684Deployment\u5206\u522B\u6302\u8F7D\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: app-instance-0\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: myapp\n      instance: "0"\n  template:\n    metadata:\n      labels:\n        app: myapp\n        instance: "0"\n    spec:\n      containers:\n      - name: app\n        image: myapp:latest\n        volumeMounts:\n        - name: data\n          mountPath: /data\n      volumes:\n      - name: data\n        persistentVolumeClaim:\n          claimName: app-pvc-0\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6CE8\u610F\uFF1A\u5BF9\u4E8E\u9700\u8981\u72EC\u7ACB\u5B58\u50A8\u7684\u6709\u72B6\u6001\u5E94\u7528\uFF0C\u63A8\u8350\u4F7F\u7528",(0,i.jsx)(n.code,{children:"StatefulSet"}),"\u800C\u4E0D\u662F",(0,i.jsx)(n.code,{children:"Deployment"}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"statefulset\u4F7F\u7528pvc",children:"StatefulSet\u4F7F\u7528PVC"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"StatefulSet"}),"\u4E13\u4E3A\u6709\u72B6\u6001\u5E94\u7528\u8BBE\u8BA1\uFF0C\u63D0\u4F9B\u4E86",(0,i.jsx)(n.code,{children:"volumeClaimTemplates"}),"\u7279\u6027\uFF0C\u53EF\u4EE5\u4E3A\u6BCF\u4E2A\u526F\u672C\u81EA\u52A8\u521B\u5EFA\u72EC\u7ACB\u7684",(0,i.jsx)(n.code,{children:"PVC"}),"\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"statefulset\u7684\u5B58\u50A8\u7279\u6027",children:"StatefulSet\u7684\u5B58\u50A8\u7279\u6027"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7A33\u5B9A\u7684\u5B58\u50A8\u6807\u8BC6"}),"\uFF1A\u6BCF\u4E2A",(0,i.jsx)(n.code,{children:"Pod"}),"\u7684",(0,i.jsx)(n.code,{children:"PVC"}),"\u540D\u79F0\u56FA\u5B9A\u4E3A",(0,i.jsx)(n.code,{children:"<volumeClaimTemplate\u540D\u79F0>-<StatefulSet\u540D\u79F0>-<\u5E8F\u53F7>"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u987A\u5E8F\u521B\u5EFA\u548C\u5220\u9664"}),"\uFF1A",(0,i.jsx)(n.code,{children:"Pod"}),"\u548C",(0,i.jsx)(n.code,{children:"PVC"}),"\u6309\u5E8F\u53F7\u987A\u5E8F\u521B\u5EFA"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6301\u4E45\u5316\u4FDD\u7559"}),"\uFF1A\u5220\u9664",(0,i.jsx)(n.code,{children:"StatefulSet"}),"\u65F6\u9ED8\u8BA4\u4E0D\u4F1A\u5220\u9664",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF0C\u6570\u636E\u5F97\u4EE5\u4FDD\u7559"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6269\u7F29\u5BB9\u652F\u6301"}),"\uFF1A\u6269\u5BB9\u65F6\u81EA\u52A8\u521B\u5EFA\u65B0\u7684",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF0C\u7F29\u5BB9\u65F6\u4FDD\u7559",(0,i.jsx)(n.code,{children:"PVC"}),"\u4F9B\u540E\u7EED\u6062\u590D\u4F7F\u7528"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"mysql\u96C6\u7FA4\u793A\u4F8B",children:"MySQL\u96C6\u7FA4\u793A\u4F8B"}),"\n",(0,i.jsxs)(n.p,{children:["\u4EE5\u4E0B\u662F\u4E00\u4E2A\u4F7F\u7528",(0,i.jsx)(n.code,{children:"StatefulSet"}),"\u90E8\u7F72",(0,i.jsx)(n.code,{children:"MySQL"}),"\u96C6\u7FA4\u7684\u5B8C\u6574\u793A\u4F8B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: mysql\n  namespace: default\n  labels:\n    app: mysql\nspec:\n  ports:\n  - port: 3306\n    name: mysql\n  clusterIP: None\n  selector:\n    app: mysql\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\n  namespace: default\nspec:\n  serviceName: mysql\n  replicas: 3\n  selector:\n    matchLabels:\n      app: mysql\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      containers:\n      - name: mysql\n        image: mysql:8.0\n        ports:\n        - containerPort: 3306\n          name: mysql\n        env:\n        - name: MYSQL_ROOT_PASSWORD\n          value: "MySecurePassword123"\n        - name: MYSQL_DATABASE\n          value: "myapp"\n        volumeMounts:\n        - name: mysql-data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: mysql-conf\n          mountPath: /etc/mysql/conf.d\n      volumes:\n      - name: mysql-conf\n        configMap:\n          name: mysql-config\n  volumeClaimTemplates:\n  - metadata:\n      name: mysql-data\n    spec:\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: 50Gi\n      storageClassName: nfs-client\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: mysql-config\n  namespace: default\ndata:\n  my.cnf: |\n    [mysqld]\n    default-storage-engine=INNODB\n    character-set-server=utf8mb4\n    max_connections=1000\n    innodb_buffer_pool_size=1G\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u90E8\u7F72\u540E\u4F1A\u521B\u5EFA3\u4E2A",(0,i.jsx)(n.code,{children:"Pod"}),"\u548C3\u4E2A",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pod"}),"\uFF1A",(0,i.jsx)(n.code,{children:"mysql-0"}),"\u3001",(0,i.jsx)(n.code,{children:"mysql-1"}),"\u3001",(0,i.jsx)(n.code,{children:"mysql-2"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PVC"}),"\uFF1A",(0,i.jsx)(n.code,{children:"mysql-data-mysql-0"}),"\u3001",(0,i.jsx)(n.code,{children:"mysql-data-mysql-1"}),"\u3001",(0,i.jsx)(n.code,{children:"mysql-data-mysql-2"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u6BCF\u4E2A",(0,i.jsx)(n.code,{children:"MySQL"}),"\u5B9E\u4F8B\u90FD\u6709\u72EC\u7ACB\u7684\u6301\u4E45\u5316\u5B58\u50A8\uFF0C\u5373\u4F7F",(0,i.jsx)(n.code,{children:"Pod"}),"\u91CD\u542F\u4E5F\u80FD\u4FDD\u7559\u6570\u636E\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u96C6\u7FA4\u793A\u4F8B",children:"Redis\u96C6\u7FA4\u793A\u4F8B"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: redis-config\n  namespace: default\ndata:\n  redis.conf: |\n    port 6379\n    cluster-enabled yes\n    cluster-config-file /data/nodes.conf\n    cluster-node-timeout 5000\n    appendonly yes\n    dir /data\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-cluster\n  namespace: default\nspec:\n  ports:\n  - port: 6379\n    targetPort: 6379\n    name: client\n  - port: 16379\n    targetPort: 16379\n    name: gossip\n  clusterIP: None\n  selector:\n    app: redis-cluster\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: redis-cluster\n  namespace: default\nspec:\n  serviceName: redis-cluster\n  replicas: 6\n  selector:\n    matchLabels:\n      app: redis-cluster\n  template:\n    metadata:\n      labels:\n        app: redis-cluster\n    spec:\n      containers:\n      - name: redis\n        image: redis:7.0-alpine\n        ports:\n        - containerPort: 6379\n          name: client\n        - containerPort: 16379\n          name: gossip\n        command:\n        - redis-server\n        args:\n        - /conf/redis.conf\n        volumeMounts:\n        - name: redis-data\n          mountPath: /data\n        - name: redis-conf\n          mountPath: /conf\n      volumes:\n      - name: redis-conf\n        configMap:\n          name: redis-config\n  volumeClaimTemplates:\n  - metadata:\n      name: redis-data\n    spec:\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: 20Gi\n      storageClassName: nfs-client\n"})}),"\n",(0,i.jsx)(n.h3,{id:"postgresql\u96C6\u7FA4\u793A\u4F8B",children:"PostgreSQL\u96C6\u7FA4\u793A\u4F8B"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: postgres\n  namespace: default\nspec:\n  ports:\n  - port: 5432\n    name: postgres\n  clusterIP: None\n  selector:\n    app: postgres\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: postgres\n  namespace: default\nspec:\n  serviceName: postgres\n  replicas: 3\n  selector:\n    matchLabels:\n      app: postgres\n  template:\n    metadata:\n      labels:\n        app: postgres\n    spec:\n      containers:\n      - name: postgres\n        image: postgres:15-alpine\n        ports:\n        - containerPort: 5432\n          name: postgres\n        env:\n        - name: POSTGRES_PASSWORD\n          value: "SecurePassword456"\n        - name: POSTGRES_DB\n          value: "myapp"\n        - name: PGDATA\n          value: /var/lib/postgresql/data/pgdata\n        volumeMounts:\n        - name: postgres-data\n          mountPath: /var/lib/postgresql/data\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n          limits:\n            cpu: 1000m\n            memory: 2Gi\n  volumeClaimTemplates:\n  - metadata:\n      name: postgres-data\n    spec:\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: 100Gi\n      storageClassName: nfs-client\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5B58\u50A8\u6700\u4F73\u5B9E\u8DF5",children:"\u5B58\u50A8\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u9009\u62E9\u5408\u9002\u7684\u8BBF\u95EE\u6A21\u5F0F",children:"1. \u9009\u62E9\u5408\u9002\u7684\u8BBF\u95EE\u6A21\u5F0F"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RWO\uFF08ReadWriteOnce\uFF09"}),"\uFF1A\u9002\u7528\u4E8E\u6570\u636E\u5E93\u3001\u5757\u5B58\u50A8\uFF0C\u5355\u8282\u70B9\u8BFB\u5199"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ROX\uFF08ReadOnlyMany\uFF09"}),"\uFF1A\u9002\u7528\u4E8E\u914D\u7F6E\u6587\u4EF6\u3001\u9759\u6001\u8D44\u6E90\u7684\u5206\u53D1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RWX\uFF08ReadWriteMany\uFF09"}),"\uFF1A\u9002\u7528\u4E8E\u5171\u4EAB\u6587\u4EF6\u7CFB\u7EDF\u3001\u591A\u8282\u70B9\u534F\u4F5C"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-\u5408\u7406\u8BBE\u7F6E\u56DE\u6536\u7B56\u7565",children:"2. \u5408\u7406\u8BBE\u7F6E\u56DE\u6536\u7B56\u7565"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retain\uFF08\u4FDD\u7559\uFF09"}),"\uFF1A\u7528\u4E8E\u91CD\u8981\u6570\u636E\uFF0C\u5220\u9664",(0,i.jsx)(n.code,{children:"PVC"}),"\u540E",(0,i.jsx)(n.code,{children:"PV"}),"\u548C\u6570\u636E\u4FDD\u7559\uFF0C\u9700\u8981\u624B\u52A8\u6E05\u7406"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Delete\uFF08\u5220\u9664\uFF09"}),"\uFF1A\u7528\u4E8E\u4E34\u65F6\u6570\u636E\u6216\u53EF\u91CD\u5EFA\u7684\u6570\u636E\uFF0C\u5220\u9664",(0,i.jsx)(n.code,{children:"PVC"}),"\u65F6\u81EA\u52A8\u6E05\u7406",(0,i.jsx)(n.code,{children:"PV"}),"\u548C\u5E95\u5C42\u5B58\u50A8"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-\u4F7F\u7528storageclass\u5206\u7C7B\u7BA1\u7406",children:"3. \u4F7F\u7528StorageClass\u5206\u7C7B\u7BA1\u7406"}),"\n",(0,i.jsxs)(n.p,{children:["\u4E3A\u4E0D\u540C\u6027\u80FD\u8981\u6C42\u7684\u5E94\u7528\u521B\u5EFA\u4E0D\u540C\u7684",(0,i.jsx)(n.code,{children:"StorageClass"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# \u9AD8\u6027\u80FDSSD\u5B58\u50A8\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: fast-ssd\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: io2\n  iopsPerGB: "50"\nreclaimPolicy: Delete\n---\n# \u6807\u51C6HDD\u5B58\u50A8\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: standard-hdd\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: sc1\nreclaimPolicy: Delete\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u542F\u7528\u5B58\u50A8\u6269\u5BB9",children:"4. \u542F\u7528\u5B58\u50A8\u6269\u5BB9"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728",(0,i.jsx)(n.code,{children:"StorageClass"}),"\u4E2D\u542F\u7528\u5377\u6269\u5BB9\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: expandable-storage\nprovisioner: kubernetes.io/aws-ebs\nallowVolumeExpansion: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6269\u5BB9",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u7F16\u8F91PVC\u589E\u52A0storage\u5927\u5C0F\nkubectl edit pvc my-pvc\n\n# \u6216\u4F7F\u7528patch\u547D\u4EE4\nkubectl patch pvc my-pvc -p \'{"spec":{"resources":{"requests":{"storage":"100Gi"}}}}\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"5-\u4F7F\u7528volumebindingmode\u4F18\u5316\u8C03\u5EA6",children:"5. \u4F7F\u7528volumeBindingMode\u4F18\u5316\u8C03\u5EA6"}),"\n",(0,i.jsxs)(n.p,{children:["\u5BF9\u4E8E\u62D3\u6251\u611F\u77E5\u7684\u5B58\u50A8\uFF08\u5982\u672C\u5730\u5B58\u50A8\u3001\u4E91\u76D8\uFF09\uFF0C\u4F7F\u7528",(0,i.jsx)(n.code,{children:"WaitForFirstConsumer"}),"\u6A21\u5F0F\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: local-storage\nprovisioner: kubernetes.io/no-provisioner\nvolumeBindingMode: WaitForFirstConsumer\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8FD9\u6837\u53EF\u4EE5\u786E\u4FDD",(0,i.jsx)(n.code,{children:"PV"}),"\u5728",(0,i.jsx)(n.code,{children:"Pod"}),"\u8C03\u5EA6\u5230\u8282\u70B9\u540E\u518D\u7ED1\u5B9A\uFF0C\u907F\u514D",(0,i.jsx)(n.code,{children:"Pod"}),"\u56E0\u5B58\u50A8\u4F4D\u7F6E\u4E0D\u5339\u914D\u800C\u65E0\u6CD5\u8C03\u5EA6\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"6-\u76D1\u63A7\u5B58\u50A8\u4F7F\u7528\u60C5\u51B5",children:"6. \u76D1\u63A7\u5B58\u50A8\u4F7F\u7528\u60C5\u51B5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67E5\u770BPVC\u4F7F\u7528\u60C5\u51B5\nkubectl get pvc -A\n\n# \u67E5\u770BPV\u5217\u8868\nkubectl get pv\n\n# \u67E5\u770BStorageClass\nkubectl get storageclass\n\n# \u67E5\u770BPod\u7684\u5B58\u50A8\u6302\u8F7D\nkubectl describe pod <pod-name>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"7-\u6570\u636E\u5907\u4EFD\u7B56\u7565",children:"7. \u6570\u636E\u5907\u4EFD\u7B56\u7565"}),"\n",(0,i.jsx)(n.p,{children:"\u5BF9\u4E8E\u91CD\u8981\u6570\u636E\uFF0C\u5EFA\u8BAE\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"VolumeSnapshot"}),"\u8FDB\u884C\u5B9A\u671F\u5FEB\u7167"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5C06\u6570\u636E\u540C\u6B65\u5230\u5BF9\u8C61\u5B58\u50A8\uFF08\u5982",(0,i.jsx)(n.code,{children:"S3"}),"\uFF09"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528\u4E13\u4E1A\u5907\u4EFD\u5DE5\u5177\uFF08\u5982",(0,i.jsx)(n.code,{children:"Velero"}),"\uFF09"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",children:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5"}),"\n",(0,i.jsx)(n.h3,{id:"1-pvc\u4E00\u76F4\u5904\u4E8Epending\u72B6\u6001",children:"1. PVC\u4E00\u76F4\u5904\u4E8EPending\u72B6\u6001"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539F\u56E0"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6CA1\u6709\u5339\u914D\u7684",(0,i.jsx)(n.code,{children:"PV"}),"\u53EF\u7528"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StorageClass"}),"\u4E0D\u5B58\u5728\u6216\u914D\u7F6E\u9519\u8BEF"]}),"\n",(0,i.jsx)(n.li,{children:"\u5B58\u50A8\u914D\u989D\u5DF2\u6EE1"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6392\u67E5\u65B9\u6CD5"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67E5\u770BPVC\u8BE6\u60C5\nkubectl describe pvc <pvc-name>\n\n# \u67E5\u770B\u4E8B\u4EF6\nkubectl get events --sort-by='.lastTimestamp'\n\n# \u68C0\u67E5StorageClass\nkubectl get storageclass\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-pod\u65E0\u6CD5\u6302\u8F7Dpvc",children:"2. Pod\u65E0\u6CD5\u6302\u8F7DPVC"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539F\u56E0"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u8282\u70B9\u7F3A\u5C11\u5FC5\u8981\u7684\u5B58\u50A8\u5BA2\u6237\u7AEF\uFF08\u5982",(0,i.jsx)(n.code,{children:"nfs-common"}),"\u3001",(0,i.jsx)(n.code,{children:"open-iscsi"}),"\uFF09"]}),"\n",(0,i.jsx)(n.li,{children:"\u5B58\u50A8\u670D\u52A1\u5668\u7F51\u7EDC\u4E0D\u901A"}),"\n",(0,i.jsx)(n.li,{children:"\u6743\u9650\u914D\u7F6E\u9519\u8BEF"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6392\u67E5\u65B9\u6CD5"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67E5\u770BPod\u4E8B\u4EF6\nkubectl describe pod <pod-name>\n\n# \u5728\u8282\u70B9\u4E0A\u6D4B\u8BD5\u6302\u8F7D\nmount -t nfs nfs.team.local:/hpc /mnt/test\n\n# \u67E5\u770Bkubelet\u65E5\u5FD7\njournalctl -u kubelet -f\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u5B58\u50A8\u6027\u80FD\u95EE\u9898",children:"3. \u5B58\u50A8\u6027\u80FD\u95EE\u9898"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4F18\u5316\u5EFA\u8BAE"}),"\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u8C03\u6574",(0,i.jsx)(n.code,{children:"NFS"}),"\u7684",(0,i.jsx)(n.code,{children:"rsize"}),"\u3001",(0,i.jsx)(n.code,{children:"wsize"}),"\u53C2\u6570"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"SSD"}),"\u66FF\u4EE3",(0,i.jsx)(n.code,{children:"HDD"})]}),"\n",(0,i.jsx)(n.li,{children:"\u542F\u7528\u7F13\u5B58\u673A\u5236"}),"\n",(0,i.jsx)(n.li,{children:"\u8003\u8651\u4F7F\u7528\u5206\u5E03\u5F0F\u5B58\u50A8\u7CFB\u7EDF"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-\u5220\u9664namespace\u65F6pvc\u65E0\u6CD5\u5220\u9664",children:"4. \u5220\u9664Namespace\u65F6PVC\u65E0\u6CD5\u5220\u9664"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539F\u56E0"}),"\uFF1A",(0,i.jsx)(n.code,{children:"PVC"}),"\u53EF\u80FD\u88AB\u4FDD\u62A4\u6216\u5B58\u5728",(0,i.jsx)(n.code,{children:"Finalizer"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6CD5"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u67E5\u770BPVC\u7684finalizers\nkubectl get pvc <pvc-name> -o yaml | grep finalizers -A 5\n\n# \u79FB\u9664finalizers\nkubectl patch pvc <pvc-name> -p \'{"metadata":{"finalizers":null}}\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u603B\u7ED3",children:"\u603B\u7ED3"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"PersistentVolumeClaim"}),"\uFF08",(0,i.jsx)(n.code,{children:"PVC"}),"\uFF09\u662F",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u5B58\u50A8\u67B6\u6784\u7684\u6838\u5FC3\u62BD\u8C61\uFF0C\u901A\u8FC7\u5C06\u5B58\u50A8\u7684\u4F7F\u7528\u548C\u4F9B\u5E94\u89E3\u8026\uFF0C\u6781\u5927\u5730\u7B80\u5316\u4E86\u5E94\u7528\u7684\u5B58\u50A8\u7BA1\u7406\u3002\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\uFF1A"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PVC\u57FA\u7840\u6982\u5FF5"}),"\uFF1A",(0,i.jsx)(n.code,{children:"PV"}),"\u3001",(0,i.jsx)(n.code,{children:"PVC"}),"\u3001",(0,i.jsx)(n.code,{children:"StorageClass"}),"\u4E09\u8005\u7684\u5173\u7CFB\u548C\u4F5C\u7528"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7F51\u7EDC\u5B58\u50A8\u534F\u8BAE"}),"\uFF1A",(0,i.jsx)(n.code,{children:"NFS"}),"\u3001",(0,i.jsx)(n.code,{children:"CIFS"}),"\u3001",(0,i.jsx)(n.code,{children:"iSCSI"}),"\u7B49\u534F\u8BAE\u7684\u4F7F\u7528\u65B9\u6CD5\u548C\u914D\u7F6E\u793A\u4F8B"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u52A8\u6001\u5B58\u50A8\u4F9B\u5E94"}),"\uFF1A\u901A\u8FC7",(0,i.jsx)(n.code,{children:"StorageClass"}),"\u5B9E\u73B0\u5B58\u50A8\u7684\u81EA\u52A8\u521B\u5EFA\u548C\u7BA1\u7406"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5B9E\u9645\u5E94\u7528\u573A\u666F"}),"\uFF1A",(0,i.jsx)(n.code,{children:"Deployment"}),"\u548C",(0,i.jsx)(n.code,{children:"StatefulSet"}),"\u4E2D\u4F7F\u7528",(0,i.jsx)(n.code,{children:"PVC"}),"\u7684\u5B8C\u6574\u793A\u4F8B"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A\u5B58\u50A8\u9009\u578B\u3001\u914D\u7F6E\u4F18\u5316\u3001\u76D1\u63A7\u548C\u6545\u969C\u6392\u67E5"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u901A\u8FC7\u5408\u7406\u4F7F\u7528",(0,i.jsx)(n.code,{children:"PVC"}),"\u548C",(0,i.jsx)(n.code,{children:"StorageClass"}),"\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u7075\u6D3B\u3001\u53EF\u9760\u3001\u9AD8\u6548\u7684\u6301\u4E45\u5316\u5B58\u50A8\u65B9\u6848\uFF0C\u6EE1\u8DB3\u5404\u7C7B\u6709\u72B6\u6001\u5E94\u7528\u7684\u9700\u6C42\u3002\u65E0\u8BBA\u662F\u6570\u636E\u5E93\u3001\u7F13\u5B58\u3001\u6587\u4EF6\u7CFB\u7EDF\u8FD8\u662F\u65E5\u5FD7\u5B58\u50A8\uFF0C",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u7684\u5B58\u50A8\u7CFB\u7EDF\u90FD\u80FD\u63D0\u4F9B\u826F\u597D\u7684\u652F\u6301\u3002"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},50065:function(e,n,s){s.d(n,{Z:function(){return c},a:function(){return d}});var l=s(67294);let i={},r=l.createContext(i);function d(e){let n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);