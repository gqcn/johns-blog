"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["9732"],{83501:function(e,c,n){n.r(c),n.d(c,{metadata:()=>d,contentTitle:()=>l,default:()=>j,assets:()=>h,toc:()=>o,frontMatter:()=>r});var d=JSON.parse('{"id":"docs/AI\u6280\u672F/AI\u57FA\u7840\u67B6\u6784/\u7B97\u529B\u8C03\u5EA6/Docker\u4E2D\u7684CPU&NUMA\u4EB2\u548C\u6027\u914D\u7F6E","title":"Docker\u4E2D\u7684CPU&NUMA\u4EB2\u548C\u6027\u914D\u7F6E","description":"\u6DF1\u5165\u89E3\u6790Docker\u5BB9\u5668\u4E2DCPU\u548CNUMA\u4EB2\u548C\u6027\u914D\u7F6E\u7684\u539F\u7406\u4E0E\u5B9E\u8DF5\u3002\u8BE6\u7EC6\u8BF4\u660Ecpuset-cpus\u548Ccpuset-mems\u53C2\u6570\u7684\u533A\u522B\u4E0E\u914D\u7F6E\u65B9\u6CD5\uFF0C\u89E3\u91CA\u4E3A\u4EC0\u4E48CPU\u4EB2\u548C\u6027\u4E0D\u7B49\u4E8ENUMA\u5185\u5B58\u4EB2\u548C\u6027\uFF0C\u4EE5\u53CA\u5982\u4F55\u4F18\u5316\u5355GPU\u548C\u591AGPU\u4EFB\u52A1\u7684\u6027\u80FD\u3002\u6DB5\u76D6PCIe\u901A\u4FE1\u3001DMA\u4F20\u8F93\u3001\u8DE8NUMA\u8282\u70B9\u573A\u666F\u7B49\u6838\u5FC3\u6982\u5FF5\uFF0C\u5E2E\u52A9\u60A8\u5728GPU\u8BAD\u7EC3\u4EFB\u52A1\u4E2D\u83B7\u5F9710%-20%\u7684\u6027\u80FD\u63D0\u5347\u3002","source":"@site/docs/docs/1000-AI\u6280\u672F/200-AI\u57FA\u7840\u67B6\u6784/700-\u7B97\u529B\u8C03\u5EA6/4000-Docker\u4E2D\u7684CPU&NUMA\u4EB2\u548C\u6027\u914D\u7F6E.md","sourceDirName":"docs/1000-AI\u6280\u672F/200-AI\u57FA\u7840\u67B6\u6784/700-\u7B97\u529B\u8C03\u5EA6","slug":"/ai/cpu-numa-affinity-in-docker","permalink":"/ai/cpu-numa-affinity-in-docker","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4000,"frontMatter":{"slug":"/ai/cpu-numa-affinity-in-docker","title":"Docker\u4E2D\u7684CPU&NUMA\u4EB2\u548C\u6027\u914D\u7F6E","hide_title":true,"keywords":["Docker","CPU\u4EB2\u548C\u6027","NUMA","GPU\u8C03\u5EA6","cpuset-cpus","cpuset-mems","PCIe","DMA\u4F20\u8F93","NUMA\u8282\u70B9","\u5BB9\u5668\u6027\u80FD\u4F18\u5316","GPU\u62D3\u6251","\u8DE8NUMA\u901A\u4FE1"],"description":"\u6DF1\u5165\u89E3\u6790Docker\u5BB9\u5668\u4E2DCPU\u548CNUMA\u4EB2\u548C\u6027\u914D\u7F6E\u7684\u539F\u7406\u4E0E\u5B9E\u8DF5\u3002\u8BE6\u7EC6\u8BF4\u660Ecpuset-cpus\u548Ccpuset-mems\u53C2\u6570\u7684\u533A\u522B\u4E0E\u914D\u7F6E\u65B9\u6CD5\uFF0C\u89E3\u91CA\u4E3A\u4EC0\u4E48CPU\u4EB2\u548C\u6027\u4E0D\u7B49\u4E8ENUMA\u5185\u5B58\u4EB2\u548C\u6027\uFF0C\u4EE5\u53CA\u5982\u4F55\u4F18\u5316\u5355GPU\u548C\u591AGPU\u4EFB\u52A1\u7684\u6027\u80FD\u3002\u6DB5\u76D6PCIe\u901A\u4FE1\u3001DMA\u4F20\u8F93\u3001\u8DE8NUMA\u8282\u70B9\u573A\u666F\u7B49\u6838\u5FC3\u6982\u5FF5\uFF0C\u5E2E\u52A9\u60A8\u5728GPU\u8BAD\u7EC3\u4EFB\u52A1\u4E2D\u83B7\u5F9710%-20%\u7684\u6027\u80FD\u63D0\u5347\u3002"},"sidebar":"mainSidebar","previous":{"title":"CPU\u4EB2\u548C\u6027\u4E0ENUMA\u4EB2\u548C\u6027\u8C03\u5EA6","permalink":"/ai/cpu-numa-affinity-scheduling"},"next":{"title":"Kubernetes\u4E2DCPU&NUMA\u4EB2\u548C\u6027\u914D\u7F6E","permalink":"/ai/cpu-numa-affinity-in-kubernetes"}}'),s=n("85893"),i=n("50065");let r={slug:"/ai/cpu-numa-affinity-in-docker",title:"Docker\u4E2D\u7684CPU&NUMA\u4EB2\u548C\u6027\u914D\u7F6E",hide_title:!0,keywords:["Docker","CPU\u4EB2\u548C\u6027","NUMA","GPU\u8C03\u5EA6","cpuset-cpus","cpuset-mems","PCIe","DMA\u4F20\u8F93","NUMA\u8282\u70B9","\u5BB9\u5668\u6027\u80FD\u4F18\u5316","GPU\u62D3\u6251","\u8DE8NUMA\u901A\u4FE1"],description:"\u6DF1\u5165\u89E3\u6790Docker\u5BB9\u5668\u4E2DCPU\u548CNUMA\u4EB2\u548C\u6027\u914D\u7F6E\u7684\u539F\u7406\u4E0E\u5B9E\u8DF5\u3002\u8BE6\u7EC6\u8BF4\u660Ecpuset-cpus\u548Ccpuset-mems\u53C2\u6570\u7684\u533A\u522B\u4E0E\u914D\u7F6E\u65B9\u6CD5\uFF0C\u89E3\u91CA\u4E3A\u4EC0\u4E48CPU\u4EB2\u548C\u6027\u4E0D\u7B49\u4E8ENUMA\u5185\u5B58\u4EB2\u548C\u6027\uFF0C\u4EE5\u53CA\u5982\u4F55\u4F18\u5316\u5355GPU\u548C\u591AGPU\u4EFB\u52A1\u7684\u6027\u80FD\u3002\u6DB5\u76D6PCIe\u901A\u4FE1\u3001DMA\u4F20\u8F93\u3001\u8DE8NUMA\u8282\u70B9\u573A\u666F\u7B49\u6838\u5FC3\u6982\u5FF5\uFF0C\u5E2E\u52A9\u60A8\u5728GPU\u8BAD\u7EC3\u4EFB\u52A1\u4E2D\u83B7\u5F9710%-20%\u7684\u6027\u80FD\u63D0\u5347\u3002"},l=void 0,h={},o=[{value:"Docker\u7684\u4EB2\u548C\u6027\u53C2\u6570",id:"docker\u7684\u4EB2\u548C\u6027\u53C2\u6570",level:2},{value:"\u793A\u4F8B1\uFF1A\u5355GPU\u4EFB\u52A1",id:"\u793A\u4F8B1\u5355gpu\u4EFB\u52A1",level:2},{value:"\u4E3A\u4EC0\u4E48\u5355GPU\u4E5F\u9700\u8981\u8BBE\u7F6ECPU&amp;NUMA\u4EB2\u548C\u6027\uFF1F",id:"\u4E3A\u4EC0\u4E48\u5355gpu\u4E5F\u9700\u8981\u8BBE\u7F6Ecpunuma\u4EB2\u548C\u6027",level:3},{value:"\u9700\u8981\u6CE8\u610F\uFF1ACPU\u4EB2\u548C\u6027 \u2260 NUMA\u5185\u5B58\u4EB2\u548C\u6027",id:"\u9700\u8981\u6CE8\u610Fcpu\u4EB2\u548C\u6027--numa\u5185\u5B58\u4EB2\u548C\u6027",level:3},{value:"\u4E3A\u4EC0\u4E48\u6307\u5B9A\u4E86CPU\u4EB2\u548C\u6027\u8FD8\u9700\u8981\u6307\u5B9ANUMA\u4EB2\u548C\u6027\uFF1F",id:"\u4E3A\u4EC0\u4E48\u6307\u5B9A\u4E86cpu\u4EB2\u548C\u6027\u8FD8\u9700\u8981\u6307\u5B9Anuma\u4EB2\u548C\u6027",level:3},{value:"\u5982\u679C<code>cpuset-cpus</code>\u548C<code>cpuset-mems</code>\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5",id:"\u5982\u679Ccpuset-cpus\u548Ccpuset-mems\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5",level:3},{value:"\u793A\u4F8B2\uFF1A\u591AGPU\u4EFB\u52A1\uFF08\u540CNUMA\u8282\u70B9\uFF09",id:"\u793A\u4F8B2\u591Agpu\u4EFB\u52A1\u540Cnuma\u8282\u70B9",level:2},{value:"\u793A\u4F8B3\uFF1A\u591AGPU\u4EFB\u52A1\uFF08\u8DE8NUMA\u8282\u70B9\uFF09",id:"\u793A\u4F8B3\u591Agpu\u4EFB\u52A1\u8DE8numa\u8282\u70B9",level:2}];function x(e){let c={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.admonition,{title:"\u8BF4\u660E",type:"info",children:(0,s.jsxs)(c.p,{children:["\u4EE5\u4E0B\u793A\u4F8B\u4E2D\u5747\u4F7F\u7528",(0,s.jsx)(c.code,{children:"nvidia/cuda:12.2.0-base-ubuntu20.04"}),"\u955C\u50CF\u7ED3\u5408",(0,s.jsx)(c.code,{children:"nvidia-smi topo -m"}),"\u547D\u4EE4\u6765\u67E5\u770B",(0,s.jsx)(c.code,{children:"GPU"}),"\u62D3\u6251\u4FE1\u606F\u4EE5\u9A8C\u8BC1",(0,s.jsx)(c.code,{children:"CPU&NUMA"}),"\u4EB2\u548C\u6027\u8BBE\u7F6E\u7684\u6B63\u786E\u6027\uFF0C\u672C\u6587\u7AE0\u793A\u4F8B\u4E0D\u8FDB\u884C\u6027\u80FD\u5BF9\u6BD4\u9A8C\u8BC1\uFF0C\u611F\u5174\u8DA3\u7684\u5C0F\u4F19\u4F34\u53EF\u81EA\u884C\u5B9E\u73B0\u3002"]})}),"\n",(0,s.jsx)(c.h2,{id:"docker\u7684\u4EB2\u548C\u6027\u53C2\u6570",children:"Docker\u7684\u4EB2\u548C\u6027\u53C2\u6570"}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.code,{children:"Docker"}),"\u63D0\u4F9B\u4E86\u591A\u4E2A\u53C2\u6570\u6765\u63A7\u5236\u5BB9\u5668\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u548C",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4EB2\u548C\u6027\uFF1A"]}),"\n",(0,s.jsxs)(c.table,{children:[(0,s.jsx)(c.thead,{children:(0,s.jsxs)(c.tr,{children:[(0,s.jsx)(c.th,{children:"\u53C2\u6570"}),(0,s.jsx)(c.th,{children:"\u8BF4\u660E"}),(0,s.jsx)(c.th,{children:"\u793A\u4F8B"})]})}),(0,s.jsxs)(c.tbody,{children:[(0,s.jsxs)(c.tr,{children:[(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:"--cpuset-cpus"})}),(0,s.jsxs)(c.td,{children:["\u6307\u5B9A\u5BB9\u5668\u53EF\u4F7F\u7528\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u6838\u5FC3"]}),(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:'--cpuset-cpus="0-31,64-95"'})})]}),(0,s.jsxs)(c.tr,{children:[(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:"--cpuset-mems"})}),(0,s.jsxs)(c.td,{children:["\u6307\u5B9A\u5BB9\u5668\u53EF\u4F7F\u7528\u7684",(0,s.jsx)(c.code,{children:"NUMA"}),"\u5185\u5B58\u8282\u70B9"]}),(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:'--cpuset-mems="0"'})})]}),(0,s.jsxs)(c.tr,{children:[(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:"--cpus"})}),(0,s.jsxs)(c.td,{children:["\u9650\u5236\u5BB9\u5668\u53EF\u4F7F\u7528\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u6838\u5FC3\u6570\u91CF"]}),(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:'--cpus="8.0"'})})]}),(0,s.jsxs)(c.tr,{children:[(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:"--cpu-shares"})}),(0,s.jsxs)(c.td,{children:["\u8BBE\u7F6E",(0,s.jsx)(c.code,{children:"CPU"}),"\u6743\u91CD\uFF08\u76F8\u5BF9\u503C\uFF09"]}),(0,s.jsx)(c.td,{children:(0,s.jsx)(c.code,{children:"--cpu-shares=1024"})})]})]})]}),"\n",(0,s.jsx)(c.h2,{id:"\u793A\u4F8B1\u5355gpu\u4EFB\u52A1",children:"\u793A\u4F8B1\uFF1A\u5355GPU\u4EFB\u52A1"}),"\n",(0,s.jsxs)(c.p,{children:["\u5047\u8BBE\u6211\u4EEC\u8981\u8FD0\u884C\u4E00\u4E2A\u4F7F\u7528",(0,s.jsx)(c.code,{children:"GPU0"}),"\u7684\u4EFB\u52A1\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-bash",children:'docker run --gpus \'"device=0"\' \\\n--cpuset-cpus="0-31,64-95" \\\n--cpuset-mems="0" \\\nnvidia/cuda:12.2.0-base-ubuntu22.04 \\\nnvidia-smi topo -m\n'})}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u53C2\u6570\u8BF4\u660E"}),"\uFF1A"]}),"\n",(0,s.jsxs)(c.ul,{children:["\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.code,{children:"--gpus '\"device=0\"'"}),"\uFF1A\u4F7F\u7528",(0,s.jsx)(c.code,{children:"GPU0"})]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.code,{children:'--cpuset-cpus="0-31,64-95"'}),"\uFF1A\u5C06\u5BB9\u5668\u7ED1\u5B9A\u5230",(0,s.jsx)(c.code,{children:"GPU0"}),"\u7684\u4EB2\u548C",(0,s.jsx)(c.code,{children:"CPU"}),"\u6838\u5FC3"]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.code,{children:'--cpuset-mems="0"'}),"\uFF1A\u5C06\u5BB9\u5668\u7684\u5185\u5B58\u5206\u914D\u9650\u5236\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 0"})]}),"\n"]}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u7ED3\u679C\u8F93\u51FA"}),"\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-text",children:"        GPU0    CPU Affinity    NUMA Affinity   GPU NUMA ID\nGPU0     X      0-31,64-95      0               N/A\n"})}),"\n",(0,s.jsx)(c.h3,{id:"\u4E3A\u4EC0\u4E48\u5355gpu\u4E5F\u9700\u8981\u8BBE\u7F6Ecpunuma\u4EB2\u548C\u6027",children:"\u4E3A\u4EC0\u4E48\u5355GPU\u4E5F\u9700\u8981\u8BBE\u7F6ECPU&NUMA\u4EB2\u548C\u6027\uFF1F"}),"\n",(0,s.jsxs)(c.p,{children:["\u867D\u7136\u662F\u5355",(0,s.jsx)(c.code,{children:"GPU"}),"\u4EFB\u52A1\uFF0C\u8BBE\u7F6E",(0,s.jsx)(c.code,{children:"CPU"}),"\u548C",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4EB2\u548C\u6027\u4ECD\u7136\u975E\u5E38\u91CD\u8981\uFF1A"]}),"\n",(0,s.jsxs)(c.ol,{children:["\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u4F18\u5316CPU-GPU\u6570\u636E\u4F20\u8F93\uFF08\u5185\u5B58\u7EF4\u5EA6\uFF09"}),"\uFF1A",(0,s.jsx)(c.code,{children:"GPU0"}),"\u8FDE\u63A5\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\uFF0C\u5373\u4F7F\u8FDB\u7A0B\u8FD0\u884C\u5728",(0,s.jsx)(c.code,{children:"Node 0"}),"\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u4E0A\uFF0C\u5982\u679C\u5185\u5B58\u5206\u914D\u6765\u81EA",(0,s.jsx)(c.code,{children:"NUMA Node 1"}),"\uFF0C\u6570\u636E\u4ECE",(0,s.jsx)(c.code,{children:"CPU"}),"\u5185\u5B58\u4F20\u8F93\u5230",(0,s.jsx)(c.code,{children:"GPU"}),"\u65F6\u4ECD\u9700\u8981\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\uFF0C\u5EF6\u8FDF\u4F1A\u589E\u52A0",(0,s.jsx)(c.code,{children:"2-3"}),"\u500D\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u4F18\u5316CPU-GPU\u901A\u4FE1\uFF08PCIe\u7EF4\u5EA6\uFF09"}),"\uFF1A",(0,s.jsx)(c.code,{children:"GPU"}),"\u7269\u7406\u8FDE\u63A5\u5728\u7279\u5B9A",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\u7684",(0,s.jsx)(c.code,{children:"PCIe"}),"\u603B\u7EBF\u4E0A\uFF08\u5982",(0,s.jsx)(c.code,{children:"GPU0"}),"\u8FDE\u63A5\u5728",(0,s.jsx)(c.code,{children:"Node 0"}),"\u7684",(0,s.jsx)(c.code,{children:"PCIe"}),"\uFF09\uFF0C\u5982\u679C",(0,s.jsx)(c.code,{children:"CPU"}),"\u8FDB\u7A0B\u8FD0\u884C\u5728\u5176\u4ED6",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\uFF08\u5982",(0,s.jsx)(c.code,{children:"Node 1"}),"\uFF09\uFF0C",(0,s.jsx)(c.code,{children:"CPU"}),"\u4E0E",(0,s.jsx)(c.code,{children:"GPU"}),"\u7684\u63A7\u5236\u547D\u4EE4\u3001\u72B6\u6001\u67E5\u8BE2\u7B49",(0,s.jsx)(c.code,{children:"PCIe"}),"\u901A\u4FE1\u90FD\u9700\u8981\u7ECF\u8FC7",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4E92\u8054\u603B\u7EBF\uFF08",(0,s.jsx)(c.code,{children:"QPI/UPI"}),"\uFF09\uFF0C\u589E\u52A0\u989D\u5916\u5EF6\u8FDF\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u63D0\u5347\u6570\u636E\u9884\u5904\u7406\u6027\u80FD"}),"\uFF1A\u8BAD\u7EC3\u4EFB\u52A1\u901A\u5E38\u9700\u8981\u5927\u91CF",(0,s.jsx)(c.code,{children:"CPU"}),"\u8FDB\u884C\u6570\u636E\u52A0\u8F7D\u548C\u9884\u5904\u7406\uFF08\u5982\u56FE\u50CF\u89E3\u7801\u3001\u6570\u636E\u589E\u5F3A\uFF09\uFF0C\u8FD9\u4E9B\u64CD\u4F5C\u7684\u5185\u5B58\u8BBF\u95EE\u5982\u679C\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4F1A\u663E\u8457\u964D\u4F4E\u541E\u5410\u91CF\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u51CF\u5C11\u5EF6\u8FDF\u6296\u52A8"}),"\uFF1A\u5373\u4F7F",(0,s.jsx)(c.code,{children:"CPU"}),"\u7ED1\u6838\uFF0C\u5185\u5B58\u5206\u914D\u7B56\u7565\u4E0D\u5F53\u6216",(0,s.jsx)(c.code,{children:"PCIe"}),"\u8BBF\u95EE\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4ECD\u53EF\u80FD\u5BFC\u81F4\u6027\u80FD\u4E0D\u7A33\u5B9A\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u5B9E\u9645\u6027\u80FD\u63D0\u5347"}),"\uFF1A\u6839\u636E\u6D4B\u8BD5\uFF0C\u5355",(0,s.jsx)(c.code,{children:"GPU"}),"\u8BAD\u7EC3\u4EFB\u52A1\u6B63\u786E\u8BBE\u7F6E\u4EB2\u548C\u6027\u540E\uFF0C\u901A\u5E38\u53EF\u83B7\u5F97",(0,s.jsx)(c.code,{children:"10%-20%"}),"\u7684\u6027\u80FD\u63D0\u5347\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(c.h3,{id:"\u9700\u8981\u6CE8\u610Fcpu\u4EB2\u548C\u6027--numa\u5185\u5B58\u4EB2\u548C\u6027",children:"\u9700\u8981\u6CE8\u610F\uFF1ACPU\u4EB2\u548C\u6027 \u2260 NUMA\u5185\u5B58\u4EB2\u548C\u6027"}),"\n",(0,s.jsx)(c.p,{children:"\u8FD9\u662F\u4E00\u4E2A\u5E38\u89C1\u8BEF\u89E3\uFF0C\u9700\u8981\u7279\u522B\u8BF4\u660E\uFF1A"}),"\n",(0,s.jsxs)(c.ul,{children:["\n",(0,s.jsxs)(c.li,{children:[(0,s.jsxs)(c.strong,{children:[(0,s.jsx)(c.code,{children:"--cpuset-cpus"}),"\u53C2\u6570"]}),"\uFF1A\u63A7\u5236\u5BB9\u5668\u8FDB\u7A0B\u53EF\u4EE5\u5728",(0,s.jsxs)(c.strong,{children:["\u54EA\u4E9B",(0,s.jsx)(c.code,{children:"CPU"}),"\u6838\u5FC3\u4E0A\u6267\u884C"]}),"\uFF08\u8FDB\u7A0B\u8C03\u5EA6\u5C42\u9762\uFF09\u3002"]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsxs)(c.strong,{children:[(0,s.jsx)(c.code,{children:"--cpuset-mems"}),"\u53C2\u6570"]}),"\uFF1A\u63A7\u5236\u5BB9\u5668\u8FDB\u7A0B\u7684",(0,s.jsxs)(c.strong,{children:["\u5185\u5B58\u5206\u914D\u6765\u81EA\u54EA\u4E9B",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9"]}),"\uFF08\u5185\u5B58\u5206\u914D\u5C42\u9762\uFF09\uFF0C\u540C\u65F6\u4E5F\u4F1A\u5F71\u54CD ",(0,s.jsxs)(c.strong,{children:[(0,s.jsx)(c.code,{children:"GPU"}),"-\u5185\u5B58\u4E4B\u95F4\u7684",(0,s.jsx)(c.code,{children:"PCIe DMA"}),"\u4F20\u8F93\u6548\u7387"]}),"\uFF08\u56E0\u4E3A",(0,s.jsx)(c.code,{children:"GPU"}),"\u7269\u7406\u8FDE\u63A5\u5728\u7279\u5B9A",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\u7684",(0,s.jsx)(c.code,{children:"PCIe"}),"\u603B\u7EBF\u4E0A\uFF09\u3002"]}),"\n"]}),"\n",(0,s.jsx)(c.h3,{id:"\u4E3A\u4EC0\u4E48\u6307\u5B9A\u4E86cpu\u4EB2\u548C\u6027\u8FD8\u9700\u8981\u6307\u5B9Anuma\u4EB2\u548C\u6027",children:"\u4E3A\u4EC0\u4E48\u6307\u5B9A\u4E86CPU\u4EB2\u548C\u6027\u8FD8\u9700\u8981\u6307\u5B9ANUMA\u4EB2\u548C\u6027\uFF1F"}),"\n",(0,s.jsxs)(c.p,{children:["\u5373\u4F7F\u4F7F\u7528",(0,s.jsx)(c.code,{children:'--cpuset-cpus="0-31,64-95"'}),"\u5C06\u8FDB\u7A0B\u9650\u5236\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u4E0A\u8FD0\u884C\uFF0C",(0,s.jsxs)(c.strong,{children:["\u5E76\u4E0D\u610F\u5473\u7740\u5185\u5B58\u4E5F\u4F1A\u81EA\u52A8\u4ECE",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\u5206\u914D"]}),"\u3002\u539F\u56E0\u5982\u4E0B\uFF1A"]}),"\n",(0,s.jsxs)(c.ol,{children:["\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"Linux\u5185\u6838\u7684\u5185\u5B58\u5206\u914D\u7B56\u7565"}),"\uFF1A"]}),"\n",(0,s.jsxs)(c.ul,{children:["\n",(0,s.jsxs)(c.li,{children:["\u5982\u679C\u4E0D\u6307\u5B9A",(0,s.jsx)(c.code,{children:"--cpuset-mems"}),"\uFF0C\u5185\u6838\u53EF\u80FD\u4F7F\u7528\u9ED8\u8BA4\u7684\u5185\u5B58\u7B56\u7565\uFF08\u5982",(0,s.jsx)(c.code,{children:"default"}),"\u6216",(0,s.jsx)(c.code,{children:"interleave"}),"\uFF09"]}),"\n",(0,s.jsxs)(c.li,{children:["\u5185\u6838\u4F1A\u6839\u636E\u5185\u5B58\u538B\u529B\u4ECE\u4EFB\u4F55\u6709\u53EF\u7528\u5185\u5B58\u7684",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\u5206\u914D"]}),"\n",(0,s.jsxs)(c.li,{children:["\u5F53",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\u5185\u5B58\u4E0D\u8DB3\u6216\u788E\u7247\u5316\u65F6\uFF0C\u4F1A\u81EA\u52A8\u4ECE",(0,s.jsx)(c.code,{children:"Node 1"}),"\u5206\u914D"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(c.li,{children:["\n",(0,s.jsxs)(c.p,{children:[(0,s.jsxs)(c.strong,{children:[(0,s.jsx)(c.code,{children:"PCIe"}),"\u901A\u4FE1\u4E0E",(0,s.jsx)(c.code,{children:"DMA"}),"\u4F20\u8F93\u7684\u5F71\u54CD"]}),"\uFF1A"]}),"\n",(0,s.jsxs)(c.ul,{children:["\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.code,{children:"GPU"}),"\u901A\u8FC7",(0,s.jsx)(c.code,{children:"PCIe"}),"\u8FDE\u63A5\u5230\u7279\u5B9A",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\uFF08",(0,s.jsx)(c.code,{children:"GPU0-3"}),"\u8FDE\u63A5\u5230",(0,s.jsx)(c.code,{children:"Node 0"}),"\u7684",(0,s.jsx)(c.code,{children:"PCIe Root Complex"}),"\uFF09"]}),"\n",(0,s.jsxs)(c.li,{children:["\u5982\u679C",(0,s.jsx)(c.code,{children:"CPU"}),"\u5728",(0,s.jsx)(c.code,{children:"Node 0"}),"\u4F46\u4F7F\u7528",(0,s.jsx)(c.code,{children:"Node 1"}),"\u7684",(0,s.jsx)(c.code,{children:"GPU"}),"\uFF0C\u6216\u8005",(0,s.jsx)(c.code,{children:"CPU"}),"\u5728",(0,s.jsx)(c.code,{children:"Node 1"}),"\u4F46\u4F7F\u7528",(0,s.jsx)(c.code,{children:"Node 0"}),"\u7684",(0,s.jsx)(c.code,{children:"GPU"})]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.code,{children:"CPU"}),"\u4E0E",(0,s.jsx)(c.code,{children:"GPU"}),"\u4E4B\u95F4\u7684",(0,s.jsx)(c.code,{children:"PCIe"}),"\u4E8B\u52A1\uFF08\u5BC4\u5B58\u5668\u8BBF\u95EE\u3001\u4E2D\u65AD\u5904\u7406\uFF09\u90FD\u9700\u8981\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4E92\u8054"]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsxs)(c.strong,{children:[(0,s.jsx)(c.code,{children:"GPU"}),"-\u5185\u5B58",(0,s.jsx)(c.code,{children:"DMA"}),"\u4F20\u8F93\u540C\u6837\u53D7",(0,s.jsx)(c.code,{children:"NUMA"}),"\u5F71\u54CD"]}),"\uFF1A\u5982\u679C",(0,s.jsx)(c.code,{children:"GPU"}),"\u5728",(0,s.jsx)(c.code,{children:"Node 0"}),"\u4F46\u5185\u5B58\u5728",(0,s.jsx)(c.code,{children:"Node 1"}),"\uFF0C",(0,s.jsx)(c.code,{children:"GPU"}),"\u8BFB\u5199\u5185\u5B58\u65F6\u9700\u8981\u901A\u8FC7",(0,s.jsx)(c.code,{children:"QPI/UPI"}),"\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8BBF\u95EE\uFF0C",(0,s.jsx)(c.code,{children:"DMA"}),"\u5E26\u5BBD\u53EF\u80FD\u964D\u4F4E",(0,s.jsx)(c.code,{children:"50%"}),"\u4EE5\u4E0A"]}),"\n",(0,s.jsxs)(c.li,{children:["\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u7684",(0,s.jsx)(c.code,{children:"PCIe"}),"\u8BBF\u95EE\u5EF6\u8FDF\u589E\u52A0\uFF0C",(0,s.jsx)(c.code,{children:"DMA"}),"\u4F20\u8F93\u6548\u7387\u964D\u4F4E\uFF0C",(0,s.jsx)(c.code,{children:"GPU"}),"\u5229\u7528\u7387\u4E0B\u964D"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(c.h3,{id:"\u5982\u679Ccpuset-cpus\u548Ccpuset-mems\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5",children:["\u5982\u679C",(0,s.jsx)(c.code,{children:"cpuset-cpus"}),"\u548C",(0,s.jsx)(c.code,{children:"cpuset-mems"}),"\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5"]}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u6267\u884C\u6307\u4EE4"}),"\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-bash",children:'docker run --gpus \'"device=0"\' \\\n--cpuset-cpus="0-31,64-95" \\\n--cpuset-mems="1" \\\nnvidia/cuda:12.2.0-base-ubuntu22.04 \\\nnvidia-smi topo -m\n'})}),"\n",(0,s.jsxs)(c.p,{children:["\u7406\u8BBA\u4E0A",(0,s.jsx)(c.code,{children:'cpuset-cpus="0-31,64-95"'}),"\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u4EB2\u548C\u6027\u5E94\u8BE5\u5BF9\u5E94\u7684",(0,s.jsx)(c.code,{children:"NUMA"}),"\u4EB2\u548C\u6027\u662F",(0,s.jsx)(c.code,{children:"0"}),"\uFF0C\u4F46\u6211\u4EEC\u8FD9\u91CC\u5F3A\u5236\u4F7F\u7528",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9",(0,s.jsx)(c.code,{children:"1"}),"\u7684\u5185\u5B58\uFF0C\u770B\u770B\u7ED3\u679C\u5982\u4F55\u3002"]}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u7ED3\u679C\u8F93\u51FA"}),"\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-text",children:"        GPU0    CPU Affinity    NUMA Affinity   GPU NUMA ID\nGPU0     X      0-31,64-95              N/A             N/A\n"})}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.code,{children:"NUMA"}),"\u4EB2\u548C\u6027\u53D8\u6210\u4E86",(0,s.jsx)(c.code,{children:"N/A"}),"\uFF0C\u8868\u793A\u5185\u5B58\u5206\u914D\u4E0D\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\uFF0C\u800C\u662F\u8DE8\u8282\u70B9\u4E86\u3002"]}),"\n",(0,s.jsx)(c.h2,{id:"\u793A\u4F8B2\u591Agpu\u4EFB\u52A1\u540Cnuma\u8282\u70B9",children:"\u793A\u4F8B2\uFF1A\u591AGPU\u4EFB\u52A1\uFF08\u540CNUMA\u8282\u70B9\uFF09"}),"\n",(0,s.jsxs)(c.p,{children:["\u5047\u5982\u4F7F\u7528",(0,s.jsx)(c.code,{children:"GPU0-GPU3"}),"\u8FDB\u884C",(0,s.jsx)(c.code,{children:"4"}),"\u5361\u4EFB\u52A1\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-bash",children:'docker run --gpus \'"device=0,1,2,3"\' \\\n--cpuset-cpus="0-31,64-95" \\\n--cpuset-mems="0" \\\nnvidia/cuda:12.2.0-base-ubuntu22.04 \\\nnvidia-smi topo -m\n'})}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u7B80\u8981\u8BF4\u660E"}),"\uFF1A\n",(0,s.jsx)(c.code,{children:"4"}),"\u5F20",(0,s.jsx)(c.code,{children:"GPU"}),"\u90FD\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\uFF0C\u4F7F\u7528\u76F8\u540C\u7684",(0,s.jsx)(c.code,{children:"CPU"}),"\u4EB2\u548C\u6027\u914D\u7F6E"]}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u7ED3\u679C\u8F93\u51FA"}),"\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-text",children:"        GPU0    GPU1    GPU2    GPU3    CPU Affinity    NUMA Affinity   GPU NUMA ID\nGPU0     X      PIX     NODE    NODE    0-31,64-95      0               N/A\nGPU1    PIX      X      NODE    NODE    0-31,64-95      0               N/A\nGPU2    NODE    NODE     X      PIX     0-31,64-95      0               N/A\nGPU3    NODE    NODE    PIX      X      0-31,64-95      0               N/A\n"})}),"\n",(0,s.jsx)(c.h2,{id:"\u793A\u4F8B3\u591Agpu\u4EFB\u52A1\u8DE8numa\u8282\u70B9",children:"\u793A\u4F8B3\uFF1A\u591AGPU\u4EFB\u52A1\uFF08\u8DE8NUMA\u8282\u70B9\uFF09"}),"\n",(0,s.jsxs)(c.p,{children:["\u5F53\u9700\u8981\u4F7F\u7528",(0,s.jsx)(c.code,{children:"5"}),"\u5F20",(0,s.jsx)(c.code,{children:"GPU"}),"\u65F6\uFF08",(0,s.jsx)(c.code,{children:"GPU0-4"}),"\uFF0C\u8DE8\u8D8A\u4E24\u4E2A",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\uFF09\uFF0C\u9700\u8981\u8003\u8651\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\u7684\u914D\u7F6E\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-bash",children:'docker run --gpus \'"device=0,1,2,3,4"\' \\\n--cpuset-cpus="0-63,64-127" \\\n--cpuset-mems="0,1" \\\nnvidia/cuda:12.2.0-base-ubuntu22.04 \\\nnvidia-smi topo -m\n'})}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u6CE8\u610F\u4E8B\u9879"}),"\uFF1A"]}),"\n",(0,s.jsxs)(c.ul,{children:["\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.strong,{children:"\u8DE8NUMA\u573A\u666F"}),"\uFF1A",(0,s.jsx)(c.code,{children:"GPU0-3"}),"\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 0"}),"\uFF0C",(0,s.jsx)(c.code,{children:"GPU4"}),"\u5728",(0,s.jsx)(c.code,{children:"NUMA Node 1"}),"\uFF0C\u5FC5\u7136\u5B58\u5728\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u901A\u4FE1"]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.code,{children:'--cpuset-mems="0,1"'}),"\uFF1A\u5141\u8BB8\u4F7F\u7528\u4E24\u4E2A",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\u7684\u5185\u5B58"]}),"\n",(0,s.jsxs)(c.li,{children:[(0,s.jsx)(c.strong,{children:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE"}),"\uFF1A\u5982\u679C\u53EF\u80FD\uFF0C\u4F18\u5148\u4F7F\u7528",(0,s.jsx)(c.code,{children:"4"}),"\u5361\uFF08",(0,s.jsx)(c.code,{children:"GPU0-3"}),"\u6216",(0,s.jsx)(c.code,{children:"GPU4-7"}),"\uFF0C\u5355",(0,s.jsx)(c.code,{children:"NUMA"}),"\u8282\u70B9\uFF09\u800C\u975E",(0,s.jsx)(c.code,{children:"5"}),"\u5361\uFF0C\u53EF\u907F\u514D\u8DE8",(0,s.jsx)(c.code,{children:"NUMA"}),"\u5F00\u9500"]}),"\n"]}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.strong,{children:"\u7ED3\u679C\u8F93\u51FA"}),"\uFF1A"]}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-text",children:"        GPU0    GPU1    GPU2    GPU3    GPU4    CPU Affinity    NUMA Affinity   GPU NUMA ID\nGPU0     X      PIX     NODE    NODE    SYS     0-31,64-95      0               N/A\nGPU1    PIX      X      NODE    NODE    SYS     0-31,64-95      0               N/A\nGPU2    NODE    NODE     X      PIX     SYS     0-31,64-95      0               N/A\nGPU3    NODE    NODE    PIX      X      SYS     0-31,64-95      0               N/A\nGPU4    SYS     SYS     SYS     SYS      X      32-63,96-127    1               N/A\n"})})]})}function j(e={}){let{wrapper:c}={...(0,i.a)(),...e.components};return c?(0,s.jsx)(c,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}},50065:function(e,c,n){n.d(c,{Z:function(){return l},a:function(){return r}});var d=n(67294);let s={},i=d.createContext(s);function r(e){let c=d.useContext(i);return d.useMemo(function(){return"function"==typeof e?e(c):{...c,...e}},[c,e])}function l(e){let c;return c=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),d.createElement(i.Provider,{value:c},e.children)}}}]);