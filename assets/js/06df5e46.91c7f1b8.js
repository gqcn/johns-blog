"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["6153"],{48415:function(n,e,s){s.r(e),s.d(e,{metadata:()=>r,contentTitle:()=>c,default:()=>h,assets:()=>o,toc:()=>a,frontMatter:()=>d});var r=JSON.parse('{"id":"docs/\u4E91\u539F\u751F/Volcano/Volcano Session Plugins\u65B9\u6CD5\u4ECB\u7ECD","title":"Volcano Session Plugins\u65B9\u6CD5\u4ECB\u7ECD","description":"\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86Volcano\u8C03\u5EA6\u5668\u6846\u67B6\u4E2DSession\u5BF9\u8C61\u768431\u4E2AAdd*Fn\u65B9\u6CD5\uFF0C\u5305\u62EC\u6392\u5E8F\u3001\u8C03\u5EA6\u51B3\u7B56\u3001\u62A2\u5360\u56DE\u6536\u3001\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u7B49\u5404\u7C7B\u63D2\u4EF6\u6269\u5C55\u70B9\u7684\u4F5C\u7528\u3001\u4F7F\u7528\u573A\u666F\u548C\u4EE3\u7801\u793A\u4F8B\uFF0C\u4E3AVolcano\u63D2\u4EF6\u5F00\u53D1\u63D0\u4F9B\u5B8C\u6574\u7684\u6280\u672F\u53C2\u8003\u3002","source":"@site/docs/docs/2000-\u4E91\u539F\u751F/400-Volcano/4500-Volcano Session Plugins\u65B9\u6CD5\u4ECB\u7ECD.md","sourceDirName":"docs/2000-\u4E91\u539F\u751F/400-Volcano","slug":"/cloud-native/volcano-session-plugins-fns","permalink":"/cloud-native/volcano-session-plugins-fns","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4500,"frontMatter":{"slug":"/cloud-native/volcano-session-plugins-fns","title":"Volcano Session Plugins\u65B9\u6CD5\u4ECB\u7ECD","hide_title":true,"keywords":["Volcano","Kubernetes","Session","Plugins","\u8C03\u5EA6\u5668","AddFn","\u63D2\u4EF6\u5F00\u53D1","\u8C03\u5EA6\u903B\u8F91","\u6269\u5C55\u70B9","PredicateFn","NodeOrderFn","JobOrderFn"],"description":"\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86Volcano\u8C03\u5EA6\u5668\u6846\u67B6\u4E2DSession\u5BF9\u8C61\u768431\u4E2AAdd*Fn\u65B9\u6CD5\uFF0C\u5305\u62EC\u6392\u5E8F\u3001\u8C03\u5EA6\u51B3\u7B56\u3001\u62A2\u5360\u56DE\u6536\u3001\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u7B49\u5404\u7C7B\u63D2\u4EF6\u6269\u5C55\u70B9\u7684\u4F5C\u7528\u3001\u4F7F\u7528\u573A\u666F\u548C\u4EE3\u7801\u793A\u4F8B\uFF0C\u4E3AVolcano\u63D2\u4EF6\u5F00\u53D1\u63D0\u4F9B\u5B8C\u6574\u7684\u6280\u672F\u53C2\u8003\u3002"},"sidebar":"mainSidebar","previous":{"title":"Volcano Actions&Plugins\u8BE6\u89E3","permalink":"/cloud-native/volcano-scheduler-actions-plugins"},"next":{"title":"Volcano\u5C42\u7EA7\u961F\u5217\u914D\u7F6E\u5F15\u53D1\u7684\u8C03\u5EA6\u5668\u7CFB\u7EDF\u6027\u6545\u969C\u95EE\u9898","permalink":"/cloud-native/volcano-hierarchy-queue-scheduling-issue"}}'),i=s("85893"),l=s("50065");let d={slug:"/cloud-native/volcano-session-plugins-fns",title:"Volcano Session Plugins\u65B9\u6CD5\u4ECB\u7ECD",hide_title:!0,keywords:["Volcano","Kubernetes","Session","Plugins","\u8C03\u5EA6\u5668","AddFn","\u63D2\u4EF6\u5F00\u53D1","\u8C03\u5EA6\u903B\u8F91","\u6269\u5C55\u70B9","PredicateFn","NodeOrderFn","JobOrderFn"],description:"\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86Volcano\u8C03\u5EA6\u5668\u6846\u67B6\u4E2DSession\u5BF9\u8C61\u768431\u4E2AAdd*Fn\u65B9\u6CD5\uFF0C\u5305\u62EC\u6392\u5E8F\u3001\u8C03\u5EA6\u51B3\u7B56\u3001\u62A2\u5360\u56DE\u6536\u3001\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u7B49\u5404\u7C7B\u63D2\u4EF6\u6269\u5C55\u70B9\u7684\u4F5C\u7528\u3001\u4F7F\u7528\u573A\u666F\u548C\u4EE3\u7801\u793A\u4F8B\uFF0C\u4E3AVolcano\u63D2\u4EF6\u5F00\u53D1\u63D0\u4F9B\u5B8C\u6574\u7684\u6280\u672F\u53C2\u8003\u3002"},c=void 0,o={},a=[{value:"\u6392\u5E8F\u76F8\u5173\u65B9\u6CD5",id:"\u6392\u5E8F\u76F8\u5173\u65B9\u6CD5",level:2},{value:"AddJobOrderFn - \u4F5C\u4E1A\u6392\u5E8F\u51FD\u6570",id:"addjoborderfn---\u4F5C\u4E1A\u6392\u5E8F\u51FD\u6570",level:3},{value:"AddQueueOrderFn - \u961F\u5217\u6392\u5E8F\u51FD\u6570",id:"addqueueorderfn---\u961F\u5217\u6392\u5E8F\u51FD\u6570",level:3},{value:"AddVictimQueueOrderFn - \u53D7\u5BB3\u8005\u961F\u5217\u6392\u5E8F\u51FD\u6570",id:"addvictimqueueorderfn---\u53D7\u5BB3\u8005\u961F\u5217\u6392\u5E8F\u51FD\u6570",level:3},{value:"AddClusterOrderFn - \u96C6\u7FA4\u6392\u5E8F\u51FD\u6570",id:"addclusterorderfn---\u96C6\u7FA4\u6392\u5E8F\u51FD\u6570",level:3},{value:"AddTaskOrderFn - \u4EFB\u52A1\u6392\u5E8F\u51FD\u6570",id:"addtaskorderfn---\u4EFB\u52A1\u6392\u5E8F\u51FD\u6570",level:3},{value:"\u8C03\u5EA6\u51B3\u7B56\u76F8\u5173\u65B9\u6CD5",id:"\u8C03\u5EA6\u51B3\u7B56\u76F8\u5173\u65B9\u6CD5",level:2},{value:"AddPredicateFn - \u8282\u70B9\u8FC7\u6EE4\u51FD\u6570",id:"addpredicatefn---\u8282\u70B9\u8FC7\u6EE4\u51FD\u6570",level:3},{value:"AddPrePredicateFn - \u9884\u8FC7\u6EE4\u51FD\u6570",id:"addprepredicatefn---\u9884\u8FC7\u6EE4\u51FD\u6570",level:3},{value:"AddBestNodeFn - \u6700\u4F73\u8282\u70B9\u9009\u62E9\u51FD\u6570",id:"addbestnodefn---\u6700\u4F73\u8282\u70B9\u9009\u62E9\u51FD\u6570",level:3},{value:"AddNodeOrderFn - \u8282\u70B9\u6253\u5206\u51FD\u6570",id:"addnodeorderfn---\u8282\u70B9\u6253\u5206\u51FD\u6570",level:3},{value:"AddHyperNodeOrderFn - \u8D85\u7EA7\u8282\u70B9\u6392\u5E8F\u51FD\u6570",id:"addhypernodeorderfn---\u8D85\u7EA7\u8282\u70B9\u6392\u5E8F\u51FD\u6570",level:3},{value:"AddBatchNodeOrderFn - \u6279\u91CF\u8282\u70B9\u6392\u5E8F\u51FD\u6570",id:"addbatchnodeorderfn---\u6279\u91CF\u8282\u70B9\u6392\u5E8F\u51FD\u6570",level:3},{value:"AddNodeMapFn - \u8282\u70B9\u6620\u5C04\u51FD\u6570",id:"addnodemapfn---\u8282\u70B9\u6620\u5C04\u51FD\u6570",level:3},{value:"AddNodeReduceFn - \u8282\u70B9\u5F52\u7EA6\u51FD\u6570",id:"addnodereducefn---\u8282\u70B9\u5F52\u7EA6\u51FD\u6570",level:3},{value:"AddAllocatableFn - \u8D44\u6E90\u5206\u914D\u68C0\u67E5\u51FD\u6570",id:"addallocatablefn---\u8D44\u6E90\u5206\u914D\u68C0\u67E5\u51FD\u6570",level:3},{value:"AddOverusedFn - \u961F\u5217\u8D85\u7528\u68C0\u67E5\u51FD\u6570",id:"addoverusedfn---\u961F\u5217\u8D85\u7528\u68C0\u67E5\u51FD\u6570",level:3},{value:"AddPreemptiveFn - \u62A2\u5360\u80FD\u529B\u68C0\u67E5\u51FD\u6570",id:"addpreemptivefn---\u62A2\u5360\u80FD\u529B\u68C0\u67E5\u51FD\u6570",level:3},{value:"\u62A2\u5360\u548C\u56DE\u6536\u76F8\u5173\u65B9\u6CD5",id:"\u62A2\u5360\u548C\u56DE\u6536\u76F8\u5173\u65B9\u6CD5",level:2},{value:"AddPreemptableFn - \u62A2\u5360\u5224\u65AD\u51FD\u6570",id:"addpreemptablefn---\u62A2\u5360\u5224\u65AD\u51FD\u6570",level:3},{value:"AddReclaimableFn - \u8D44\u6E90\u56DE\u6536\u51FD\u6570",id:"addreclaimablefn---\u8D44\u6E90\u56DE\u6536\u51FD\u6570",level:3},{value:"\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u76F8\u5173\u65B9\u6CD5",id:"\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u76F8\u5173\u65B9\u6CD5",level:2},{value:"AddJobPipelinedFn - \u4F5C\u4E1A\u6D41\u6C34\u7EBF\u68C0\u67E5\u51FD\u6570",id:"addjobpipelinedfn---\u4F5C\u4E1A\u6D41\u6C34\u7EBF\u68C0\u67E5\u51FD\u6570",level:3},{value:"AddJobValidFn - \u4F5C\u4E1A\u6709\u6548\u6027\u68C0\u67E5\u51FD\u6570",id:"addjobvalidfn---\u4F5C\u4E1A\u6709\u6548\u6027\u68C0\u67E5\u51FD\u6570",level:3},{value:"AddJobStarvingFns - \u4F5C\u4E1A\u9965\u997F\u68C0\u67E5\u51FD\u6570",id:"addjobstarvingfns---\u4F5C\u4E1A\u9965\u997F\u68C0\u67E5\u51FD\u6570",level:3},{value:"AddJobReadyFn - \u4F5C\u4E1A\u5C31\u7EEA\u68C0\u67E5\u51FD\u6570",id:"addjobreadyfn---\u4F5C\u4E1A\u5C31\u7EEA\u68C0\u67E5\u51FD\u6570",level:3},{value:"\u9AD8\u7EA7\u8C03\u5EA6\u529F\u80FD\u65B9\u6CD5",id:"\u9AD8\u7EA7\u8C03\u5EA6\u529F\u80FD\u65B9\u6CD5",level:2},{value:"AddJobEnqueueableFn - \u4F5C\u4E1A\u5165\u961F\u68C0\u67E5\u51FD\u6570",id:"addjobenqueueablefn---\u4F5C\u4E1A\u5165\u961F\u68C0\u67E5\u51FD\u6570",level:3},{value:"AddJobEnqueuedFn - \u4F5C\u4E1A\u5165\u961F\u5B8C\u6210\u56DE\u8C03\u51FD\u6570",id:"addjobenqueuedfn---\u4F5C\u4E1A\u5165\u961F\u5B8C\u6210\u56DE\u8C03\u51FD\u6570",level:3},{value:"AddReservedNodesFn - \u8282\u70B9\u9884\u7559\u51FD\u6570",id:"addreservednodesfn---\u8282\u70B9\u9884\u7559\u51FD\u6570",level:3},{value:"AddVictimTasksFns - \u53D7\u5BB3\u8005\u4EFB\u52A1\u9009\u62E9\u51FD\u6570",id:"addvictimtasksfns---\u53D7\u5BB3\u8005\u4EFB\u52A1\u9009\u62E9\u51FD\u6570",level:3},{value:"AddTargetJobFn - \u76EE\u6807\u4F5C\u4E1A\u9009\u62E9\u51FD\u6570",id:"addtargetjobfn---\u76EE\u6807\u4F5C\u4E1A\u9009\u62E9\u51FD\u6570",level:3},{value:"AddSimulateAddTaskFn - \u6A21\u62DF\u6DFB\u52A0\u4EFB\u52A1\u51FD\u6570",id:"addsimulateaddtaskfn---\u6A21\u62DF\u6DFB\u52A0\u4EFB\u52A1\u51FD\u6570",level:3},{value:"AddSimulateRemoveTaskFn - \u6A21\u62DF\u79FB\u9664\u4EFB\u52A1\u51FD\u6570",id:"addsimulateremovetaskfn---\u6A21\u62DF\u79FB\u9664\u4EFB\u52A1\u51FD\u6570",level:3},{value:"AddSimulateAllocatableFn - \u6A21\u62DF\u8D44\u6E90\u5206\u914D\u51FD\u6570",id:"addsimulateallocatablefn---\u6A21\u62DF\u8D44\u6E90\u5206\u914D\u51FD\u6570",level:3},{value:"AddSimulatePredicateFn - \u6A21\u62DF\u9884\u9009\u51FD\u6570",id:"addsimulatepredicatefn---\u6A21\u62DF\u9884\u9009\u51FD\u6570",level:3},{value:"\u4E8B\u4EF6\u5904\u7406\u76F8\u5173\u65B9\u6CD5",id:"\u4E8B\u4EF6\u5904\u7406\u76F8\u5173\u65B9\u6CD5",level:2},{value:"AddEventHandler - \u4E8B\u4EF6\u5904\u7406\u5668\u6CE8\u518C\u51FD\u6570",id:"addeventhandler---\u4E8B\u4EF6\u5904\u7406\u5668\u6CE8\u518C\u51FD\u6570",level:3}];function t(n){let e={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"Volcano"}),"\u8C03\u5EA6\u5668\u6846\u67B6\u4E2D\u7684",(0,i.jsx)(e.code,{children:"Session"}),"\u5BF9\u8C61\u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684\u63D2\u4EF6\u6269\u5C55\u70B9\uFF0C\u901A\u8FC7\u5404\u79CD",(0,i.jsx)(e.code,{children:"Add*Fn"}),"\u65B9\u6CD5\u5141\u8BB8\u63D2\u4EF6\u6CE8\u518C\u81EA\u5B9A\u4E49\u7684\u8C03\u5EA6\u903B\u8F91\u3002\u8FD9\u4E9B\u65B9\u6CD5\u662F",(0,i.jsx)(e.code,{children:"Volcano"}),"\u8C03\u5EA6\u5668\u63D2\u4EF6\u5F00\u53D1\u7684\u6838\u5FC3\u63A5\u53E3\uFF0C\u672C\u6587\u6863\u8BE6\u7EC6\u4ECB\u7ECD\u6BCF\u4E2A\u65B9\u6CD5\u7684\u4F5C\u7528\u3001\u4F7F\u7528\u573A\u666F\u548C\u4EE3\u7801\u793A\u4F8B\u3002"]}),"\n",(0,i.jsx)(e.h2,{id:"\u6392\u5E8F\u76F8\u5173\u65B9\u6CD5",children:"\u6392\u5E8F\u76F8\u5173\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"addjoborderfn---\u4F5C\u4E1A\u6392\u5E8F\u51FD\u6570",children:"AddJobOrderFn - \u4F5C\u4E1A\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u786E\u5B9A\u4F5C\u4E1A\u7684\u8C03\u5EA6\u4F18\u5148\u7EA7\u987A\u5E8F\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobOrderFn(name string, cf api.CompareFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CompareFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type CompareFn func(interface{}, interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5DE6\u4FA7\u4F5C\u4E1A\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u53F3\u4FA7\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"-1"}),": \u8868\u793A\u5DE6\u4FA7\u4F5C\u4E1A\u4F18\u5148\u7EA7\u9AD8\u4E8E\u53F3\u4FA7\u4F5C\u4E1A"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"1"}),": \u8868\u793A\u53F3\u4FA7\u4F5C\u4E1A\u4F18\u5148\u7EA7\u9AD8\u4E8E\u5DE6\u4FA7\u4F5C\u4E1A"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"0"}),": \u8868\u793A\u4E24\u4E2A\u4F5C\u4E1A\u4F18\u5148\u7EA7\u76F8\u7B49"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u4F18\u5148\u7EA7\u7684\u4F5C\u4E1A\u8C03\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u9700\u6C42\u7684\u4F5C\u4E1A\u6392\u5E8F"}),"\n",(0,i.jsxs)(e.li,{children:["\u5B9E\u73B0\u57FA\u4E8E\u63D0\u4EA4\u65F6\u95F4\u7684",(0,i.jsx)(e.code,{children:"FIFO"}),"\u8C03\u5EA6"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"// \u5728\u63D2\u4EF6\u7684OnSessionOpen\u65B9\u6CD5\u4E2D\u6CE8\u518C\nfunc (pp *priorityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u57FA\u4E8E\u4F18\u5148\u7EA7\u7684\u4F5C\u4E1A\u6392\u5E8F\u51FD\u6570\n    ssn.AddJobOrderFn(pp.Name(), func(l, r interface{}) int {\n        lv := l.(*api.JobInfo)\n        rv := r.(*api.JobInfo)\n        \n        // \u83B7\u53D6\u4F5C\u4E1A\u4F18\u5148\u7EA7\n        lPriority := lv.PodGroup.Spec.PriorityClassName\n        rPriority := rv.PodGroup.Spec.PriorityClassName\n        \n        // \u9AD8\u4F18\u5148\u7EA7\u4F5C\u4E1A\u6392\u5728\u524D\u9762\n        if lPriority > rPriority {\n            return -1\n        } else if lPriority < rPriority {\n            return 1\n        }\n        return 0\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addqueueorderfn---\u961F\u5217\u6392\u5E8F\u51FD\u6570",children:"AddQueueOrderFn - \u961F\u5217\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u961F\u5217\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u786E\u5B9A\u961F\u5217\u7684\u8C03\u5EA6\u4F18\u5148\u7EA7\u987A\u5E8F\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddQueueOrderFn(name string, qf api.CompareFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CompareFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type CompareFn func(interface{}, interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5DE6\u4FA7\u961F\u5217\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u53F3\u4FA7\u961F\u5217\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"-1"}),": \u8868\u793A\u5DE6\u4FA7\u961F\u5217\u4F18\u5148\u7EA7\u9AD8\u4E8E\u53F3\u4FA7\u961F\u5217"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"1"}),": \u8868\u793A\u53F3\u4FA7\u961F\u5217\u4F18\u5148\u7EA7\u9AD8\u4E8E\u5DE6\u4FA7\u961F\u5217"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"0"}),": \u8868\u793A\u4E24\u4E2A\u961F\u5217\u4F18\u5148\u7EA7\u76F8\u7B49"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u6743\u91CD\u7684\u961F\u5217\u8C03\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u4F7F\u7528\u7387\u7684\u961F\u5217\u6392\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u79DF\u6237\u8D44\u6E90\u516C\u5E73\u5206\u914D"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (dp *drfPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u57FA\u4E8EDRF\u7B97\u6CD5\u7684\u961F\u5217\u6392\u5E8F\u51FD\u6570\n    ssn.AddQueueOrderFn(dp.Name(), func(l, r interface{}) int {\n        lv := l.(*api.QueueInfo)\n        rv := r.(*api.QueueInfo)\n        \n        // \u8BA1\u7B97\u961F\u5217\u7684\u4E3B\u5BFC\u8D44\u6E90\u4EFD\u989D\n        lShare := calculateDominantResourceShare(lv)\n        rShare := calculateDominantResourceShare(rv)\n        \n        // \u4E3B\u5BFC\u8D44\u6E90\u4EFD\u989D\u5C0F\u7684\u961F\u5217\u4F18\u5148\u8C03\u5EA6\n        if lShare < rShare {\n            return -1\n        } else if lShare > rShare {\n            return 1\n        }\n        return 0\n    })\n}\n\nfunc calculateDominantResourceShare(queue *api.QueueInfo) float64 {\n    // DRF\u7B97\u6CD5\u5B9E\u73B0\u903B\u8F91\n    // \u8BA1\u7B97CPU\u548C\u5185\u5B58\u7684\u8D44\u6E90\u4EFD\u989D\uFF0C\u8FD4\u56DE\u8F83\u5927\u503C\n    cpuShare := float64(queue.Used.MilliCPU) / float64(queue.Capability.MilliCPU)\n    memShare := float64(queue.Used.Memory) / float64(queue.Capability.Memory)\n    \n    if cpuShare > memShare {\n        return cpuShare\n    }\n    return memShare\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addvictimqueueorderfn---\u53D7\u5BB3\u8005\u961F\u5217\u6392\u5E8F\u51FD\u6570",children:"AddVictimQueueOrderFn - \u53D7\u5BB3\u8005\u961F\u5217\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u53D7\u5BB3\u8005\u961F\u5217\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u5728\u62A2\u5360\u573A\u666F\u4E2D\u786E\u5B9A\u961F\u5217\u7684\u4F18\u5148\u7EA7\u987A\u5E8F\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddVictimQueueOrderFn(name string, vcf api.VictimCompareFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"VictimCompareFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type VictimCompareFn func(interface{}, interface{}, interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5DE6\u4FA7\u5019\u9009\u53D7\u5BB3\u8005\u961F\u5217"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u53F3\u4FA7\u5019\u9009\u53D7\u5BB3\u8005\u961F\u5217"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E09\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u62A2\u5360\u8005\u961F\u5217"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"-1"}),": \u8868\u793A\u5DE6\u4FA7\u961F\u5217\u66F4\u9002\u5408\u4F5C\u4E3A\u53D7\u5BB3\u8005\uFF08\u4F18\u5148\u88AB\u62A2\u5360\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"1"}),": \u8868\u793A\u53F3\u4FA7\u961F\u5217\u66F4\u9002\u5408\u4F5C\u4E3A\u53D7\u5BB3\u8005\uFF08\u4F18\u5148\u88AB\u62A2\u5360\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"0"}),": \u8868\u793A\u4E24\u4E2A\u961F\u5217\u4F5C\u4E3A\u53D7\u5BB3\u8005\u7684\u4F18\u5148\u7EA7\u76F8\u7B49"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u62A2\u5360\u65F6\u7684\u961F\u5217\u9009\u62E9\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u79DF\u6237\u62A2\u5360\u4F18\u5148\u7EA7"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\u7684\u62A2\u5360\u987A\u5E8F"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (pp *preemptPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u53D7\u5BB3\u8005\u961F\u5217\u6392\u5E8F\u51FD\u6570\n    ssn.AddVictimQueueOrderFn(pp.Name(), func(l, r, preemptor interface{}) int {\n        lQueue := l.(*api.QueueInfo)\n        rQueue := r.(*api.QueueInfo)\n        preemptorQueue := preemptor.(*api.QueueInfo)\n        \n        // \u4F18\u5148\u62A2\u5360\u8D44\u6E90\u4F7F\u7528\u8D85\u51FA\u4FDD\u8BC1\u7684\u961F\u5217\n        lOverGuarantee := isQueueOverGuarantee(lQueue)\n        rOverGuarantee := isQueueOverGuarantee(rQueue)\n        \n        if lOverGuarantee && !rOverGuarantee {\n            return -1\n        } else if !lOverGuarantee && rOverGuarantee {\n            return 1\n        }\n        \n        return 0\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addclusterorderfn---\u96C6\u7FA4\u6392\u5E8F\u51FD\u6570",children:"AddClusterOrderFn - \u96C6\u7FA4\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u96C6\u7FA4\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u591A\u96C6\u7FA4\u8C03\u5EA6\u573A\u666F\u4E2D\u786E\u5B9A\u96C6\u7FA4\u7684\u4F18\u5148\u7EA7\u987A\u5E8F\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddClusterOrderFn(name string, qf api.CompareFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CompareFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type CompareFn func(interface{}, interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*scheduling.Cluster"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5DE6\u4FA7\u96C6\u7FA4\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*scheduling.Cluster"})," \u7C7B\u578B\uFF0C\u8868\u793A\u53F3\u4FA7\u96C6\u7FA4\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"-1"}),": \u8868\u793A\u5DE6\u4FA7\u96C6\u7FA4\u4F18\u5148\u7EA7\u9AD8\u4E8E\u53F3\u4FA7\u96C6\u7FA4"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"1"}),": \u8868\u793A\u53F3\u4FA7\u96C6\u7FA4\u4F18\u5148\u7EA7\u9AD8\u4E8E\u5DE6\u4FA7\u96C6\u7FA4"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"0"}),": \u8868\u793A\u4E24\u4E2A\u96C6\u7FA4\u4F18\u5148\u7EA7\u76F8\u7B49"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u96C6\u7FA4\u8D44\u6E90\u8C03\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u96C6\u7FA4\u8D1F\u8F7D\u5747\u8861"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u96C6\u7FA4\u6027\u80FD\u7684\u6392\u5E8F"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (cp *clusterPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u96C6\u7FA4\u6392\u5E8F\u51FD\u6570\n    ssn.AddClusterOrderFn(cp.Name(), func(l, r interface{}) int {\n        lCluster := l.(*scheduling.Cluster)\n        rCluster := r.(*scheduling.Cluster)\n        \n        // \u57FA\u4E8E\u96C6\u7FA4\u8D44\u6E90\u5229\u7528\u7387\u6392\u5E8F\n        lUtilization := getClusterUtilization(lCluster)\n        rUtilization := getClusterUtilization(rCluster)\n        \n        // \u4F18\u5148\u9009\u62E9\u5229\u7528\u7387\u8F83\u4F4E\u7684\u96C6\u7FA4\n        if lUtilization < rUtilization {\n            return -1\n        } else if lUtilization > rUtilization {\n            return 1\n        }\n        return 0\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addtaskorderfn---\u4EFB\u52A1\u6392\u5E8F\u51FD\u6570",children:"AddTaskOrderFn - \u4EFB\u52A1\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4EFB\u52A1\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u786E\u5B9A\u540C\u4E00\u4F5C\u4E1A\u5185\u4EFB\u52A1\u7684\u8C03\u5EA6\u987A\u5E8F\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddTaskOrderFn(name string, cf api.CompareFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CompareFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type CompareFn func(interface{}, interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5DE6\u4FA7\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u53F3\u4FA7\u4EFB\u52A1\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"-1"}),": \u8868\u793A\u5DE6\u4FA7\u4EFB\u52A1\u4F18\u5148\u7EA7\u9AD8\u4E8E\u53F3\u4FA7\u4EFB\u52A1"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"1"}),": \u8868\u793A\u53F3\u4FA7\u4EFB\u52A1\u4F18\u5148\u7EA7\u9AD8\u4E8E\u5DE6\u4FA7\u4EFB\u52A1"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"0"}),": \u8868\u793A\u4E24\u4E2A\u4EFB\u52A1\u4F18\u5148\u7EA7\u76F8\u7B49"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5B9E\u73B0\u57FA\u4E8E\u4EFB\u52A1\u7C7B\u578B\u7684\u6392\u5E8F\uFF08\u5982",(0,i.jsx)(e.code,{children:"master"}),"\u4F18\u5148\u4E8E",(0,i.jsx)(e.code,{children:"worker"}),"\uFF09"]}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u9700\u6C42\u7684\u4EFB\u52A1\u6392\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u4EFB\u52A1\u4F9D\u8D56\u5173\u7CFB\u7684\u6392\u5E8F"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (gp *gangPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u57FA\u4E8E\u4EFB\u52A1\u89D2\u8272\u7684\u6392\u5E8F\u51FD\u6570\n    ssn.AddTaskOrderFn(gp.Name(), func(l, r interface{}) int {\n        lv := l.(*api.TaskInfo)\n        rv := r.(*api.TaskInfo)\n        \n        // \u83B7\u53D6\u4EFB\u52A1\u89D2\u8272\n        lRole := getTaskRole(lv)\n        rRole := getTaskRole(rv)\n        \n        // master\u4EFB\u52A1\u4F18\u5148\u8C03\u5EA6\n        if lRole == "master" && rRole != "master" {\n            return -1\n        } else if lRole != "master" && rRole == "master" {\n            return 1\n        }\n        return 0\n    })\n}\n\nfunc getTaskRole(task *api.TaskInfo) string {\n    if role, exists := task.Pod.Labels["role"]; exists {\n        return role\n    }\n    return "worker"\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u8C03\u5EA6\u51B3\u7B56\u76F8\u5173\u65B9\u6CD5",children:"\u8C03\u5EA6\u51B3\u7B56\u76F8\u5173\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"addpredicatefn---\u8282\u70B9\u8FC7\u6EE4\u51FD\u6570",children:"AddPredicateFn - \u8282\u70B9\u8FC7\u6EE4\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8282\u70B9\u8FC7\u6EE4\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u4EFB\u52A1\u662F\u5426\u53EF\u4EE5\u8C03\u5EA6\u5230\u7279\u5B9A\u8282\u70B9\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddPredicateFn(name string, pf api.PredicateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"PredicateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type PredicateFn func(*TaskInfo, *NodeInfo) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u4EFB\u52A1\u53EF\u4EE5\u8C03\u5EA6\u5230\u8BE5\u8282\u70B9"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u4EFB\u52A1\u4E0D\u80FD\u8C03\u5EA6\u5230\u8BE5\u8282\u70B9\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8282\u70B9\u8D44\u6E90\u5145\u8DB3\u6027\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8282\u70B9\u4EB2\u548C\u6027\u548C\u53CD\u4EB2\u548C\u6027"}),"\n",(0,i.jsxs)(e.li,{children:["\u5B9E\u73B0",(0,i.jsx)(e.code,{children:"GPU"}),"\u7C7B\u578B\u5339\u914D\u68C0\u67E5"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (np *nodeAffinityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8282\u70B9\u4EB2\u548C\u6027\u68C0\u67E5\u51FD\u6570\n    ssn.AddPredicateFn(np.Name(), func(task *api.TaskInfo, node *api.NodeInfo) error {\n        // \u68C0\u67E5\u8282\u70B9\u6807\u7B7E\u662F\u5426\u6EE1\u8DB3\u4EFB\u52A1\u8981\u6C42\n        if requiredLabels, exists := task.Pod.Spec.NodeSelector; exists {\n            for key, value := range requiredLabels {\n                if nodeValue, hasLabel := node.Node.Labels[key]; !hasLabel || nodeValue != value {\n                    return fmt.Errorf("node %s doesn\'t match required label %s=%s", \n                        node.Name, key, value)\n                }\n            }\n        }\n        \n        // \u68C0\u67E5GPU\u7C7B\u578B\u5339\u914D\n        if gpuType := getRequiredGPUType(task); gpuType != "" {\n            nodeGPUType := getNodeGPUType(node)\n            if nodeGPUType != gpuType {\n                return fmt.Errorf("node %s GPU type %s doesn\'t match required %s", \n                    node.Name, nodeGPUType, gpuType)\n            }\n        }\n        \n        return nil\n    })\n}\n\nfunc getRequiredGPUType(task *api.TaskInfo) string {\n    if gpuType, exists := task.Pod.Annotations["volcano.sh/gpu-type"]; exists {\n        return gpuType\n    }\n    return ""\n}\n\nfunc getNodeGPUType(node *api.NodeInfo) string {\n    if gpuType, exists := node.Node.Labels["accelerator"]; exists {\n        return gpuType\n    }\n    return ""\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addprepredicatefn---\u9884\u8FC7\u6EE4\u51FD\u6570",children:"AddPrePredicateFn - \u9884\u8FC7\u6EE4\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u9884\u8FC7\u6EE4\u51FD\u6570\uFF0C\u5728\u8282\u70B9\u8FC7\u6EE4\u4E4B\u524D\u8FDB\u884C\u4EFB\u52A1\u7EA7\u522B\u7684\u9884\u68C0\u67E5\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddPrePredicateFn(name string, pf api.PrePredicateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"PrePredicateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type PrePredicateFn func(*TaskInfo) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u4EFB\u52A1\u901A\u8FC7\u9884\u8FC7\u6EE4\u68C0\u67E5"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u4EFB\u52A1\u4E0D\u901A\u8FC7\u9884\u8FC7\u6EE4\u68C0\u67E5\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4EFB\u52A1\u7EA7\u522B\u7684\u8D44\u6E90\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4EFB\u52A1\u72B6\u6001\u9884\u9A8C\u8BC1"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8C03\u5EA6\u524D\u7684\u5FEB\u901F\u8FC7\u6EE4"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (rp *resourcePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u9884\u8FC7\u6EE4\u51FD\u6570\n    ssn.AddPrePredicateFn(rp.Name(), func(task *api.TaskInfo) error {\n        // \u68C0\u67E5\u4EFB\u52A1\u8D44\u6E90\u8BF7\u6C42\u662F\u5426\u5408\u7406\n        if task.Resreq.MilliCPU <= 0 && task.Resreq.Memory <= 0 {\n            return fmt.Errorf("task %s has invalid resource request", task.Name)\n        }\n        \n        // \u68C0\u67E5\u4EFB\u52A1\u72B6\u6001\n        if task.Status != api.Pending {\n            return fmt.Errorf("task %s is not in pending state", task.Name)\n        }\n        \n        return nil\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addbestnodefn---\u6700\u4F73\u8282\u70B9\u9009\u62E9\u51FD\u6570",children:"AddBestNodeFn - \u6700\u4F73\u8282\u70B9\u9009\u62E9\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u6700\u4F73\u8282\u70B9\u9009\u62E9\u51FD\u6570\uFF0C\u4ECE\u5019\u9009\u8282\u70B9\u4E2D\u9009\u62E9\u6700\u4F18\u8282\u70B9\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddBestNodeFn(name string, pf api.BestNodeFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"BestNodeFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type BestNodeFn func(*TaskInfo, []*NodeInfo) *NodeInfo\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"}),": \u8868\u793A\u9009\u4E2D\u7684\u6700\u4F73\u8282\u70B9"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u6CA1\u6709\u627E\u5230\u5408\u9002\u7684\u8282\u70B9"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u81EA\u5B9A\u4E49\u8282\u70B9\u9009\u62E9\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u4E1A\u52A1\u903B\u8F91\u7684\u8282\u70B9\u9009\u62E9"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u7EF4\u5EA6\u8282\u70B9\u8BC4\u4F30"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (bp *bestNodePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u6700\u4F73\u8282\u70B9\u9009\u62E9\u51FD\u6570\n    ssn.AddBestNodeFn(bp.Name(), func(task *api.TaskInfo, nodeScores map[float64][]*api.NodeInfo) *api.NodeInfo {\n        // \u4ECE\u6700\u9AD8\u5206\u7684\u8282\u70B9\u4E2D\u9009\u62E9CPU\u5229\u7528\u7387\u6700\u4F4E\u7684\n        var bestScore float64 = -1\n        for score := range nodeScores {\n            if score > bestScore {\n                bestScore = score\n            }\n        }\n        \n        if bestScore < 0 {\n            return nil\n        }\n        \n        bestNodes := nodeScores[bestScore]\n        if len(bestNodes) == 0 {\n            return nil\n        }\n        \n        // \u9009\u62E9CPU\u5229\u7528\u7387\u6700\u4F4E\u7684\u8282\u70B9\n        var bestNode *api.NodeInfo\n        var minCPUUtilization float64 = 1.0\n        \n        for _, node := range bestNodes {\n            utilization := float64(node.Used.MilliCPU) / float64(node.Allocatable.MilliCPU)\n            if utilization < minCPUUtilization {\n                minCPUUtilization = utilization\n                bestNode = node\n            }\n        }\n        \n        return bestNode\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addnodeorderfn---\u8282\u70B9\u6253\u5206\u51FD\u6570",children:"AddNodeOrderFn - \u8282\u70B9\u6253\u5206\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8282\u70B9\u6253\u5206\u51FD\u6570\uFF0C\u7528\u4E8E\u4E3A\u8282\u70B9\u8BA1\u7B97\u4F18\u5148\u7EA7\u5206\u6570\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddNodeOrderFn(name string, pf api.NodeOrderFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"NodeOrderFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type NodeOrderFn func(*TaskInfo, *NodeInfo) (float64, error)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"float64"})," \u7C7B\u578B\uFF0C\u8868\u793A\u8282\u70B9\u7684\u4F18\u5148\u7EA7\u5206\u6570\uFF08\u5206\u6570\u8D8A\u9AD8\u4F18\u5148\u7EA7\u8D8A\u9AD8\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"error"})," \u7C7B\u578B\uFF0C\u8868\u793A\u6253\u5206\u8FC7\u7A0B\u4E2D\u7684\u9519\u8BEF\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u5229\u7528\u7387\u7684\u8282\u70B9\u6253\u5206"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u7F51\u7EDC\u62D3\u6251\u7684\u8282\u70B9\u6253\u5206"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861\u7B56\u7565"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (bp *binpackPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518CBinPack\u8282\u70B9\u6253\u5206\u51FD\u6570\n    ssn.AddNodeOrderFn(bp.Name(), func(task *api.TaskInfo, node *api.NodeInfo) (float64, error) {\n        // \u8BA1\u7B97\u8D44\u6E90\u5229\u7528\u7387\u5206\u6570\uFF0C\u4F18\u5148\u9009\u62E9\u8D44\u6E90\u5229\u7528\u7387\u9AD8\u7684\u8282\u70B9\n        cpuScore := calculateResourceScore(\n            task.Resreq.MilliCPU, \n            node.Allocatable.MilliCPU, \n            node.Used.MilliCPU,\n        )\n        \n        memScore := calculateResourceScore(\n            task.Resreq.Memory,\n            node.Allocatable.Memory,\n            node.Used.Memory,\n        )\n        \n        // \u8FD4\u56DE\u52A0\u6743\u5E73\u5747\u5206\u6570\n        return (cpuScore + memScore) / 2.0, nil\n    })\n}\n\nfunc calculateResourceScore(requested, allocatable, used int64) float64 {\n    if allocatable == 0 {\n        return 0\n    }\n    \n    // \u8BA1\u7B97\u8C03\u5EA6\u540E\u7684\u5229\u7528\u7387\n    utilization := float64(used+requested) / float64(allocatable)\n    \n    // BinPack\u7B56\u7565\uFF1A\u5229\u7528\u7387\u8D8A\u9AD8\u5206\u6570\u8D8A\u9AD8\n    if utilization <= 1.0 {\n        return utilization * 100\n    }\n    \n    // \u8D85\u51FA\u5BB9\u91CF\u5219\u8FD4\u56DE\u8D1F\u5206\n    return -100\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addhypernodeorderfn---\u8D85\u7EA7\u8282\u70B9\u6392\u5E8F\u51FD\u6570",children:"AddHyperNodeOrderFn - \u8D85\u7EA7\u8282\u70B9\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8D85\u7EA7\u8282\u70B9\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u5BF9\u8D85\u7EA7\u8282\u70B9\u7EC4\u8FDB\u884C\u6392\u5E8F\u548C\u6253\u5206\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddHyperNodeOrderFn(name string, fn api.HyperNodeOrderFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"HyperNodeOrderFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type HyperNodeOrderFn func(*TaskInfo, []*NodeInfo) (map[string]float64, error)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"map[string]float64"})," \u7C7B\u578B\uFF0C\u8868\u793A\u8282\u70B9ID\u5230\u5206\u6570\u7684\u6620\u5C04\uFF08\u5206\u6570\u8D8A\u9AD8\u4F18\u5148\u7EA7\u8D8A\u9AD8\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"error"})," \u7C7B\u578B\uFF0C\u8868\u793A\u6253\u5206\u8FC7\u7A0B\u4E2D\u7684\u9519\u8BEF\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u8282\u70B9\u7EC4\u5408\u7684\u8C03\u5EA6\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u62D3\u6251\u611F\u77E5\u7684\u8282\u70B9\u7EC4\u9009\u62E9"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u5927\u89C4\u6A21\u5206\u5E03\u5F0F\u4EFB\u52A1\u7684\u8282\u70B9\u5206\u914D"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (tp *topologyPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8D85\u7EA7\u8282\u70B9\u6392\u5E8F\u51FD\u6570\n    ssn.AddHyperNodeOrderFn(tp.Name(), func(job *api.JobInfo, hyperNodes map[string][]*api.NodeInfo) (map[string]float64, error) {\n        scores := make(map[string]float64)\n        \n        for groupName, nodes := range hyperNodes {\n            // \u8BA1\u7B97\u8282\u70B9\u7EC4\u7684\u62D3\u6251\u5206\u6570\n            topologyScore := calculateTopologyScore(nodes)\n            // \u8BA1\u7B97\u8282\u70B9\u7EC4\u7684\u8D44\u6E90\u5229\u7528\u7387\u5206\u6570\n            utilizationScore := calculateGroupUtilization(nodes)\n            \n            // \u7EFC\u5408\u8BC4\u5206\n            scores[groupName] = topologyScore*0.6 + utilizationScore*0.4\n        }\n        \n        return scores, nil\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addbatchnodeorderfn---\u6279\u91CF\u8282\u70B9\u6392\u5E8F\u51FD\u6570",children:"AddBatchNodeOrderFn - \u6279\u91CF\u8282\u70B9\u6392\u5E8F\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u6279\u91CF\u8282\u70B9\u6392\u5E8F\u51FD\u6570\uFF0C\u7528\u4E8E\u6279\u91CF\u8BA1\u7B97\u591A\u4E2A\u8282\u70B9\u7684\u4F18\u5148\u7EA7\u5206\u6570\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddBatchNodeOrderFn(name string, pf api.BatchNodeOrderFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"BatchNodeOrderFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type BatchNodeOrderFn func(*TaskInfo, []*NodeInfo) (map[string]float64, error)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"map[string]float64"})," \u7C7B\u578B\uFF0C\u8868\u793A\u8282\u70B9\u540D\u79F0\u5230\u5206\u6570\u7684\u6620\u5C04\uFF08\u5206\u6570\u8D8A\u9AD8\u4F18\u5148\u7EA7\u8D8A\u9AD8\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"error"})," \u7C7B\u578B\uFF0C\u8868\u793A\u6253\u5206\u8FC7\u7A0B\u4E2D\u7684\u9519\u8BEF\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u6279\u91CF\u8282\u70B9\u8BC4\u5206\u4F18\u5316"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u5E76\u884C\u8282\u70B9\u6253\u5206\u8BA1\u7B97"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u5927\u89C4\u6A21\u96C6\u7FA4\u7684\u6027\u80FD\u4F18\u5316"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (bp *batchPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u6279\u91CF\u8282\u70B9\u6392\u5E8F\u51FD\u6570\n    ssn.AddBatchNodeOrderFn(bp.Name(), func(task *api.TaskInfo, nodes []*api.NodeInfo) (map[string]float64, error) {\n        scores := make(map[string]float64, len(nodes))\n        \n        // \u5E76\u884C\u8BA1\u7B97\u6240\u6709\u8282\u70B9\u7684\u5206\u6570\n        for _, node := range nodes {\n            scores[node.Name] = calculateBatchNodeScore(task, node)\n        }\n        \n        return scores, nil\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addnodemapfn---\u8282\u70B9\u6620\u5C04\u51FD\u6570",children:"AddNodeMapFn - \u8282\u70B9\u6620\u5C04\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8282\u70B9\u6620\u5C04\u51FD\u6570\uFF0C\u7528\u4E8E\u5C06\u8282\u70B9\u4FE1\u606F\u6620\u5C04\u4E3A\u7279\u5B9A\u7684\u5206\u6570\u503C\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddNodeMapFn(name string, pf api.NodeMapFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"NodeMapFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type NodeMapFn func(*TaskInfo, *NodeInfo) (float64, error)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"float64"})," \u7C7B\u578B\uFF0C\u8868\u793A\u8282\u70B9\u7684\u6620\u5C04\u5206\u6570\u503C"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"error"})," \u7C7B\u578B\uFF0C\u8868\u793A\u6620\u5C04\u8FC7\u7A0B\u4E2D\u7684\u9519\u8BEF\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8282\u70B9\u7279\u5F81\u63D0\u53D6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u81EA\u5B9A\u4E49\u8282\u70B9\u8BC4\u5206\u7EF4\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8282\u70B9\u5206\u7C7B\u548C\u6807\u8BB0"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (mp *mapPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8282\u70B9\u6620\u5C04\u51FD\u6570\n    ssn.AddNodeMapFn(mp.Name(), func(task *api.TaskInfo, node *api.NodeInfo) (float64, error) {\n        score := 0.0\n        \n        // GPU\u8282\u70B9\u52A0\u5206\n        if gpuCount, exists := node.Node.Status.Capacity["nvidia.com/gpu"]; exists {\n            if gpuCount.Value() > 0 {\n                score += 20.0\n            }\n        }\n        \n        return score, nil\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addnodereducefn---\u8282\u70B9\u5F52\u7EA6\u51FD\u6570",children:"AddNodeReduceFn - \u8282\u70B9\u5F52\u7EA6\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8282\u70B9\u5F52\u7EA6\u51FD\u6570\uFF0C\u7528\u4E8E\u5C06\u591A\u4E2A\u8282\u70B9\u5206\u6570\u5F52\u7EA6\u4E3A\u6700\u7EC8\u7ED3\u679C\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddNodeReduceFn(name string, pf api.NodeReduceFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"NodeReduceFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type NodeReduceFn func(*TaskInfo, k8sframework.NodeScoreList) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"k8sframework.NodeScoreList"})," \u7C7B\u578B\uFF0C\u8868\u793A\u8282\u70B9\u5206\u6570\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u5F52\u7EA6\u5904\u7406\u6210\u529F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u5F52\u7EA6\u5904\u7406\u5931\u8D25\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u7EF4\u5EA6\u5206\u6570\u7684\u805A\u5408"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u5206\u6570\u6807\u51C6\u5316\u5904\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u6700\u7EC8\u8282\u70B9\u6392\u5E8F\u903B\u8F91"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (rp *reducePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8282\u70B9\u5F52\u7EA6\u51FD\u6570\n    ssn.AddNodeReduceFn(rp.Name(), func(task *api.TaskInfo, nodeScores k8sframework.NodeScoreList) error {\n        // \u6807\u51C6\u5316\u5206\u6570\u5904\u7406\n        return nil\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addallocatablefn---\u8D44\u6E90\u5206\u914D\u68C0\u67E5\u51FD\u6570",children:"AddAllocatableFn - \u8D44\u6E90\u5206\u914D\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8D44\u6E90\u5206\u914D\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u961F\u5217\u662F\u5426\u53EF\u4EE5\u4E3A\u4EFB\u52A1\u5206\u914D\u8D44\u6E90\u3002\u8BE5\u51FD\u6570\u5C06\u4F1A\u5141\u8BB8",(0,i.jsx)(e.code,{children:"Pending"}),"\u7684",(0,i.jsx)(e.code,{children:"Pod"}),"\u7EE7\u7EED\u8FDB\u884C\u8C03\u5EA6\uFF08\u5206\u914D\u8D44\u6E90\uFF09\uFF0C\u968F\u540E",(0,i.jsx)(e.code,{children:"Pod"}),"\u5C06\u4F1A\u4ECE",(0,i.jsx)(e.code,{children:"Pending"}),"\u72B6\u6001\u8F6C\u6362\u5230",(0,i.jsx)(e.code,{children:"Running"}),"\u72B6\u6001\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddAllocatableFn(name string, fn api.AllocatableFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"AllocatableFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type AllocatableFn func(*QueueInfo, *TaskInfo) bool\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u961F\u5217\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u5206\u914D\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"true"}),": \u8868\u793A\u961F\u5217\u53EF\u4EE5\u4E3A\u4EFB\u52A1\u5206\u914D\u8D44\u6E90"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"false"}),": \u8868\u793A\u961F\u5217\u65E0\u6CD5\u4E3A\u4EFB\u52A1\u5206\u914D\u8D44\u6E90"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u961F\u5217\u5BB9\u91CF\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u914D\u989D\u7BA1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u79DF\u6237\u8D44\u6E90\u9694\u79BB"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (cp *capacityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8D44\u6E90\u5206\u914D\u68C0\u67E5\u51FD\u6570\n    ssn.AddAllocatableFn(cp.Name(), func(queue *api.QueueInfo, candidate *api.TaskInfo) bool {\n        // \u68C0\u67E5\u961F\u5217\u662F\u5426\u8D85\u51FA\u5BB9\u91CF\u9650\u5236\n        afterCPU := queue.Used.MilliCPU + candidate.Resreq.MilliCPU\n        afterMemory := queue.Used.Memory + candidate.Resreq.Memory\n        \n        if afterCPU > queue.Capability.MilliCPU {\n            return false\n        }\n        \n        if afterMemory > queue.Capability.Memory {\n            return false\n        }\n        \n        return true\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addoverusedfn---\u961F\u5217\u8D85\u7528\u68C0\u67E5\u51FD\u6570",children:"AddOverusedFn - \u961F\u5217\u8D85\u7528\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u961F\u5217\u8D85\u7528\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u961F\u5217\u662F\u5426\u8D85\u51FA\u8D44\u6E90\u4F7F\u7528\u9650\u5236\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddOverusedFn(name string, fn api.ValidateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ValidateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type ValidateFn func(interface{}) bool\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u961F\u5217\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"true"}),": \u8868\u793A\u961F\u5217\u8D85\u51FA\u8D44\u6E90\u4F7F\u7528\u9650\u5236"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"false"}),": \u8868\u793A\u961F\u5217\u672A\u8D85\u51FA\u8D44\u6E90\u4F7F\u7528\u9650\u5236"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u961F\u5217\u8D44\u6E90\u76D1\u63A7"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u56DE\u6536\u89E6\u53D1\u6761\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u5F39\u6027\u8D44\u6E90\u7BA1\u7406"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (cp *capacityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u961F\u5217\u8D85\u7528\u68C0\u67E5\u51FD\u6570\n    ssn.AddOverusedFn(cp.Name(), func(obj interface{}) bool {\n        queue := obj.(*api.QueueInfo)\n        \n        // \u68C0\u67E5\u662F\u5426\u8D85\u51FA\u4FDD\u8BC1\u8D44\u6E90\u7684150%\n        cpuOverused := queue.Used.MilliCPU > queue.Guarantee.MilliCPU*3/2\n        memOverused := queue.Used.Memory > queue.Guarantee.Memory*3/2\n        \n        return cpuOverused || memOverused\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addpreemptivefn---\u62A2\u5360\u80FD\u529B\u68C0\u67E5\u51FD\u6570",children:"AddPreemptiveFn - \u62A2\u5360\u80FD\u529B\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u62A2\u5360\u80FD\u529B\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u961F\u5217\u662F\u5426\u5177\u5907\u62A2\u5360\u5176\u4ED6\u4EFB\u52A1\u7684\u80FD\u529B\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddPreemptiveFn(name string, fn api.ValidateWithCandidateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ValidateWithCandidateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type ValidateWithCandidateFn func(interface{}, interface{}) bool\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u961F\u5217\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u4EFB\u52A1\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"true"}),": \u8868\u793A\u961F\u5217\u5177\u5907\u62A2\u5360\u80FD\u529B"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"false"}),": \u8868\u793A\u961F\u5217\u4E0D\u5177\u5907\u62A2\u5360\u80FD\u529B"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u62A2\u5360\u6743\u9650\u63A7\u5236"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u4F18\u5148\u7EA7\u7684\u62A2\u5360\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u79DF\u6237\u62A2\u5360\u7BA1\u7406"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (pp *priorityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u62A2\u5360\u80FD\u529B\u68C0\u67E5\u51FD\u6570\n    ssn.AddPreemptiveFn(pp.Name(), func(queue *api.QueueInfo, candidate *api.TaskInfo) bool {\n        // \u68C0\u67E5\u961F\u5217\u662F\u5426\u6709\u62A2\u5360\u6743\u9650\n        if preemptive, exists := queue.Queue.Annotations["volcano.sh/preemptive"]; exists {\n            if preemptive != "true" {\n                return false\n            }\n        }\n        \n        // \u68C0\u67E5\u4EFB\u52A1\u4F18\u5148\u7EA7\u662F\u5426\u8DB3\u591F\u9AD8\n        if candidate.Pod.Spec.Priority == nil || *candidate.Pod.Spec.Priority < 1000 {\n            return false\n        }\n        \n        return true\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u62A2\u5360\u548C\u56DE\u6536\u76F8\u5173\u65B9\u6CD5",children:"\u62A2\u5360\u548C\u56DE\u6536\u76F8\u5173\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"addpreemptablefn---\u62A2\u5360\u5224\u65AD\u51FD\u6570",children:"AddPreemptableFn - \u62A2\u5360\u5224\u65AD\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u62A2\u5360\u5224\u65AD\u51FD\u6570\uFF0C\u7528\u4E8E\u786E\u5B9A\u54EA\u4E9B\u4EFB\u52A1\u53EF\u4EE5\u88AB\u62A2\u5360\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddPreemptableFn(name string, cf api.EvictableFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"EvictableFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type EvictableFn func(*TaskInfo, []*TaskInfo) ([]*TaskInfo, int)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u62A2\u5360\u8005\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u88AB\u62A2\u5360\u4EFB\u52A1\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"[]*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u6700\u7EC8\u88AB\u62A2\u5360\u7684\u4EFB\u52A1\u5217\u8868"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"int"})," \u7C7B\u578B\uFF0C\u8868\u793A\u62A2\u5360\u7684\u4EFB\u52A1\u6570\u91CF"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u4F18\u5148\u7EA7\u7684\u4EFB\u52A1\u62A2\u5360"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u4F7F\u7528\u65F6\u95F4\u7684\u62A2\u5360\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u79DF\u6237\u95F4\u7684\u8D44\u6E90\u62A2\u5360"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (pp *priorityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u57FA\u4E8E\u4F18\u5148\u7EA7\u7684\u62A2\u5360\u51FD\u6570\n    ssn.AddPreemptableFn(pp.Name(), func(preemptor *api.TaskInfo, preemptees []*api.TaskInfo) ([]*api.TaskInfo, int) {\n        var victims []*api.TaskInfo\n        preemptorPriority := getTaskPriority(preemptor)\n        \n        for _, preemptee := range preemptees {\n            preempteePriority := getTaskPriority(preemptee)\n            \n            // \u53EA\u80FD\u62A2\u5360\u4F18\u5148\u7EA7\u66F4\u4F4E\u7684\u4EFB\u52A1\n            if preemptorPriority > preempteePriority {\n                // \u68C0\u67E5\u662F\u5426\u6807\u8BB0\u4E3A\u53EF\u62A2\u5360\n                if isPreemptable(preemptee) {\n                    victims = append(victims, preemptee)\n                }\n            }\n        }\n        \n        // \u8FD4\u56DE\u53EF\u62A2\u5360\u7684\u4EFB\u52A1\u5217\u8868\u548C\u6295\u7968\u6743\u91CD\n        return victims, 1\n    })\n}\n\nfunc getTaskPriority(task *api.TaskInfo) int32 {\n    if task.Pod.Spec.Priority != nil {\n        return *task.Pod.Spec.Priority\n    }\n    return 0\n}\n\nfunc isPreemptable(task *api.TaskInfo) bool {\n    if preemptable, exists := task.Pod.Annotations["volcano.sh/preemptable"]; exists {\n        return preemptable == "true"\n    }\n    return false\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addreclaimablefn---\u8D44\u6E90\u56DE\u6536\u51FD\u6570",children:"AddReclaimableFn - \u8D44\u6E90\u56DE\u6536\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8D44\u6E90\u56DE\u6536\u51FD\u6570\uFF0C\u7528\u4E8E\u786E\u5B9A\u54EA\u4E9B\u4EFB\u52A1\u7684\u8D44\u6E90\u53EF\u4EE5\u88AB\u56DE\u6536\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddReclaimableFn(name string, rf api.EvictableFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"EvictableFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type EvictableFn func(*TaskInfo, []*TaskInfo) ([]*TaskInfo, int)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u8BF7\u6C42\u8D44\u6E90\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u56DE\u6536\u4EFB\u52A1\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"[]*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u6700\u7EC8\u88AB\u56DE\u6536\u7684\u4EFB\u52A1\u5217\u8868"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u8FD4\u56DE\u503C: ",(0,i.jsx)(e.code,{children:"int"})," \u7C7B\u578B\uFF0C\u8868\u793A\u56DE\u6536\u7684\u4EFB\u52A1\u6570\u91CF"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u961F\u5217\u95F4\u7684\u8D44\u6E90\u56DE\u6536"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u57FA\u4E8E\u8D44\u6E90\u4FDD\u8BC1\u7684\u56DE\u6536\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u5F39\u6027\u8D44\u6E90\u7BA1\u7406"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (cp *capacityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8D44\u6E90\u56DE\u6536\u51FD\u6570\n    ssn.AddReclaimableFn(cp.Name(), func(reclaimer *api.TaskInfo, reclaimees []*api.TaskInfo) ([]*api.TaskInfo, int) {\n        var victims []*api.TaskInfo\n        reclaimerQueue := ssn.Jobs[reclaimer.Job].Queue\n        \n        for _, reclaimee := range reclaimees {\n            reclaimeeQueue := ssn.Jobs[reclaimee.Job].Queue\n            \n            // \u4E0D\u80FD\u56DE\u6536\u540C\u4E00\u961F\u5217\u7684\u8D44\u6E90\n            if reclaimerQueue == reclaimeeQueue {\n                continue\n            }\n            \n            // \u68C0\u67E5\u961F\u5217\u662F\u5426\u8D85\u51FA\u4FDD\u8BC1\u8D44\u6E90\n            queueInfo := ssn.Queues[reclaimeeQueue]\n            if isQueueOverGuarantee(queueInfo) {\n                victims = append(victims, reclaimee)\n            }\n        }\n        \n        return victims, 1\n    })\n}\n\nfunc isQueueOverGuarantee(queue *api.QueueInfo) bool {\n    // \u68C0\u67E5\u961F\u5217\u662F\u5426\u8D85\u51FA\u4FDD\u8BC1\u8D44\u6E90\n    if queue.Used.MilliCPU > queue.Guarantee.MilliCPU {\n        return true\n    }\n    if queue.Used.Memory > queue.Guarantee.Memory {\n        return true\n    }\n    return false\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u76F8\u5173\u65B9\u6CD5",children:"\u4F5C\u4E1A\u72B6\u6001\u68C0\u67E5\u76F8\u5173\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"addjobpipelinedfn---\u4F5C\u4E1A\u6D41\u6C34\u7EBF\u68C0\u67E5\u51FD\u6570",children:"AddJobPipelinedFn - \u4F5C\u4E1A\u6D41\u6C34\u7EBF\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u6D41\u6C34\u7EBF\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u4F5C\u4E1A\u662F\u5426\u83B7\u5F97\u8DB3\u591F\u8D44\u6E90\u53EF\u4EE5\u8FDB\u884C\u6D41\u6C34\u7EBF\u8C03\u5EA6\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobPipelinedFn(name string, vf api.VoteFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"VoteFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type VoteFn func(interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8FD4\u56DE\u6B63\u6570: \u8868\u793A\u652F\u6301\u4F5C\u4E1A\u8FDB\u884C\u6D41\u6C34\u7EBF\u8C03\u5EA6\u7684\u7968\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u8FD4\u56DE0: \u8868\u793A\u4E2D\u6027\u7968\uFF0C\u4E0D\u5F71\u54CD\u51B3\u7B56"}),"\n",(0,i.jsx)(e.li,{children:"\u8FD4\u56DE\u8D1F\u6570: \u8868\u793A\u53CD\u5BF9\u4F5C\u4E1A\u8FDB\u884C\u6D41\u6C34\u7EBF\u8C03\u5EA6\u7684\u7968\u6570"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u6D41\u6C34\u7EBF\u4F5C\u4E1A\u8C03\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u9884\u5206\u914D\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u542F\u52A8\u6761\u4EF6\u63A7\u5236"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (pp *pipelinePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u4F5C\u4E1A\u6D41\u6C34\u7EBF\u68C0\u67E5\u51FD\u6570\n    ssn.AddJobPipelinedFn(pp.Name(), func(obj interface{}) int {\n        job := obj.(*api.JobInfo)\n        \n        // \u68C0\u67E5\u4F5C\u4E1A\u662F\u5426\u6EE1\u8DB3\u6D41\u6C34\u7EBF\u8C03\u5EA6\u6761\u4EF6\n        minResource := calculateMinResourceForPipeline(job)\n        availableResource := getAvailableResourceForJob(ssn, job)\n        \n        if availableResource.MilliCPU >= minResource.MilliCPU && \n           availableResource.Memory >= minResource.Memory {\n            return 1 // \u5141\u8BB8\u6D41\u6C34\u7EBF\u8C03\u5EA6\n        }\n        \n        return 0 // \u6682\u4E0D\u5141\u8BB8\n    })\n}\n\nfunc calculateMinResourceForPipeline(job *api.JobInfo) *api.Resource {\n    // \u8BA1\u7B97\u6D41\u6C34\u7EBF\u8C03\u5EA6\u6240\u9700\u7684\u6700\u5C0F\u8D44\u6E90\n    return &api.Resource{\n        MilliCPU: job.MinAvailable * 100, // \u6BCF\u4E2A\u4EFB\u52A1\u6700\u5C11100m CPU\n        Memory:   job.MinAvailable * 128 * 1024 * 1024, // \u6BCF\u4E2A\u4EFB\u52A1\u6700\u5C11128Mi\u5185\u5B58\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addjobvalidfn---\u4F5C\u4E1A\u6709\u6548\u6027\u68C0\u67E5\u51FD\u6570",children:"AddJobValidFn - \u4F5C\u4E1A\u6709\u6548\u6027\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u6709\u6548\u6027\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u9A8C\u8BC1\u4F5C\u4E1A\u914D\u7F6E\u7684\u5408\u6CD5\u6027\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobValidFn(name string, fn api.ValidateExFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ValidateExFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type ValidateExFn func(interface{}) *ValidateResult\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"*ValidateResult"}),": \u5305\u542B\u9A8C\u8BC1\u7ED3\u679C\u7684\u7ED3\u6784\u4F53\uFF0C\u5305\u62EC\u662F\u5426\u901A\u8FC7\u9A8C\u8BC1\u548C\u9519\u8BEF\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u914D\u7F6E\u9A8C\u8BC1"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u8BF7\u6C42\u5408\u7406\u6027\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4E1A\u52A1\u89C4\u5219\u9A8C\u8BC1"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (vp *validationPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u4F5C\u4E1A\u6709\u6548\u6027\u68C0\u67E5\u51FD\u6570\n    ssn.AddJobValidFn(vp.Name(), func(obj interface{}) *api.ValidateResult {\n        job := obj.(*api.JobInfo)\n        \n        // \u68C0\u67E5\u4F5C\u4E1A\u8D44\u6E90\u8BF7\u6C42\u662F\u5426\u5408\u7406\n        totalCPU := int64(0)\n        totalMemory := int64(0)\n        \n        for _, task := range job.Tasks {\n            totalCPU += task.Resreq.MilliCPU\n            totalMemory += task.Resreq.Memory\n        }\n        \n        // \u68C0\u67E5\u662F\u5426\u8D85\u51FA\u961F\u5217\u9650\u5236\n        queue := ssn.Queues[job.Queue]\n        if totalCPU > queue.Capability.MilliCPU {\n            return &api.ValidateResult{\n                Pass:   false,\n                Reason: fmt.Sprintf("Job CPU request %d exceeds queue capability %d", \n                    totalCPU, queue.Capability.MilliCPU),\n            }\n        }\n        \n        return &api.ValidateResult{Pass: true}\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addjobstarvingfns---\u4F5C\u4E1A\u9965\u997F\u68C0\u67E5\u51FD\u6570",children:"AddJobStarvingFns - \u4F5C\u4E1A\u9965\u997F\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u9965\u997F\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u4F5C\u4E1A\u662F\u5426\u5904\u4E8E\u8D44\u6E90\u9965\u997F\u72B6\u6001\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobStarvingFns(name string, fn api.ValidateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ValidateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type ValidateFn func(interface{}) bool\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"true"}),": \u8868\u793A\u4F5C\u4E1A\u5904\u4E8E\u9965\u997F\u72B6\u6001"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"false"}),": \u8868\u793A\u4F5C\u4E1A\u672A\u5904\u4E8E\u9965\u997F\u72B6\u6001"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u9965\u997F\u68C0\u6D4B"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F18\u5148\u7EA7\u63D0\u5347\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u516C\u5E73\u8C03\u5EA6\u4FDD\u969C"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (sp *starvationPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u4F5C\u4E1A\u9965\u997F\u68C0\u67E5\u51FD\u6570\n    ssn.AddJobStarvingFns(sp.Name(), func(obj interface{}) bool {\n        job := obj.(*api.JobInfo)\n        \n        // \u68C0\u67E5\u4F5C\u4E1A\u7B49\u5F85\u65F6\u95F4\n        waitTime := time.Since(job.CreationTimestamp.Time)\n        starvationThreshold := 10 * time.Minute\n        \n        if waitTime > starvationThreshold {\n            // \u68C0\u67E5\u662F\u5426\u6709\u4EFB\u52A1\u5728\u8FD0\u884C\n            runningTasks := len(job.TaskStatusIndex[api.Running])\n            if runningTasks == 0 {\n                return true // \u4F5C\u4E1A\u5904\u4E8E\u9965\u997F\u72B6\u6001\n            }\n        }\n        \n        return false\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addjobreadyfn---\u4F5C\u4E1A\u5C31\u7EEA\u68C0\u67E5\u51FD\u6570",children:"AddJobReadyFn - \u4F5C\u4E1A\u5C31\u7EEA\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u5C31\u7EEA\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u4F5C\u4E1A\u662F\u5426\u51C6\u5907\u597D\u8FDB\u884C\u8C03\u5EA6\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobReadyFn(name string, vf api.ValidateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ValidateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type ValidateFn func(interface{}) bool\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"true"}),": \u8868\u793A\u4F5C\u4E1A\u5DF2\u51C6\u5907\u597D\u8FDB\u884C\u8C03\u5EA6"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"false"}),": \u8868\u793A\u4F5C\u4E1A\u5C1A\u672A\u51C6\u5907\u597D\u8FDB\u884C\u8C03\u5EA6"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0Gang\u8C03\u5EA6\u7684\u5C31\u7EEA\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F9D\u8D56\u4F5C\u4E1A\u7684\u72B6\u6001\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u9884\u68C0\u67E5"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (gp *gangPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518CGang\u8C03\u5EA6\u5C31\u7EEA\u68C0\u67E5\u51FD\u6570\n    ssn.AddJobReadyFn(gp.Name(), func(obj interface{}) bool {\n        job := obj.(*api.JobInfo)\n        \n        // \u68C0\u67E5\u662F\u5426\u8FBE\u5230\u6700\u5C0F\u8FD0\u884C\u4EFB\u52A1\u6570\n        if job.MinAvailable == 0 {\n            return true\n        }\n        \n        // \u7EDF\u8BA1\u53EF\u8C03\u5EA6\u7684\u4EFB\u52A1\u6570\u91CF\n        schedulableCount := 0\n        for _, task := range job.TaskStatusIndex[api.Pending] {\n            if canScheduleTask(ssn, task) {\n                schedulableCount++\n            }\n        }\n        \n        // \u68C0\u67E5\u662F\u5426\u6EE1\u8DB3Gang\u8C03\u5EA6\u6761\u4EF6\n        return schedulableCount >= int(job.MinAvailable)\n    })\n}\n\nfunc canScheduleTask(ssn *framework.Session, task *api.TaskInfo) bool {\n    // \u68C0\u67E5\u662F\u5426\u6709\u8282\u70B9\u53EF\u4EE5\u8C03\u5EA6\u8BE5\u4EFB\u52A1\n    for _, node := range ssn.Nodes {\n        if node.State != api.Ready {\n            continue\n        }\n        \n        // \u6267\u884C\u9884\u9009\u68C0\u67E5\n        if err := ssn.PredicateFn(task, node); err != nil {\n            continue\n        }\n        \n        return true\n    }\n    return false\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u9AD8\u7EA7\u8C03\u5EA6\u529F\u80FD\u65B9\u6CD5",children:"\u9AD8\u7EA7\u8C03\u5EA6\u529F\u80FD\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"addjobenqueueablefn---\u4F5C\u4E1A\u5165\u961F\u68C0\u67E5\u51FD\u6570",children:"AddJobEnqueueableFn - \u4F5C\u4E1A\u5165\u961F\u68C0\u67E5\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u5165\u961F\u68C0\u67E5\u51FD\u6570\uFF0C\u7528\u4E8E\u5224\u65AD\u4F5C\u4E1A\u662F\u5426\u53EF\u4EE5\u8FDB\u5165\u8C03\u5EA6\u961F\u5217\u3002\u8BE5\u51FD\u6570\u5C06\u4F1A\u628A",(0,i.jsx)(e.code,{children:"Pending"}),"\u72B6\u6001\u7684",(0,i.jsx)(e.code,{children:"PodGroup"}),"\u8F6C\u6362\u4E3A",(0,i.jsx)(e.code,{children:"Inqueue"}),"\u72B6\u6001\uFF0C\u968F\u540E",(0,i.jsx)(e.code,{children:"PodHGroup"}),"\u5BF9\u5E94\u7684",(0,i.jsx)(e.code,{children:"Pod"}),"\u5C06\u4F1A\u521B\u5EFA\u51FA\u6765\uFF0C\u65B0\u5EFA\u51FA\u6765\u7684",(0,i.jsx)(e.code,{children:"Pod"}),"\u5904\u4E8E",(0,i.jsx)(e.code,{children:"Pending"}),"\u72B6\u6001\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobEnqueueableFn(name string, fn api.VoteFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"VoteFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type VoteFn func(interface{}) int\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE",(0,i.jsx)(e.code,{children:"util.Permit"}),"(",(0,i.jsx)(e.code,{children:"1"}),"): \u8868\u793A\u652F\u6301\u4F5C\u4E1A\u5165\u961F\u7684\u7968\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE",(0,i.jsx)(e.code,{children:"util.Abstain"}),"(",(0,i.jsx)(e.code,{children:"0"}),"): \u8868\u793A\u4E2D\u6027\u7968\uFF0C\u4E0D\u5F71\u54CD\u51B3\u7B56"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE",(0,i.jsx)(e.code,{children:"util.Reject"}),"(",(0,i.jsx)(e.code,{children:"-1"}),"): \u8868\u793A\u53CD\u5BF9\u4F5C\u4E1A\u5165\u961F\u7684\u7968\u6570"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u4F9D\u8D56\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u9884\u5206\u914D\u68C0\u67E5"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8C03\u5EA6\u7B56\u7565\u63A7\u5236"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (dp *dependencyPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u4F5C\u4E1A\u4F9D\u8D56\u68C0\u67E5\u51FD\u6570\n    ssn.AddJobEnqueueableFn(dp.Name(), func(obj interface{}) int {\n        job := obj.(*api.JobInfo)\n        \n        // \u68C0\u67E5\u4F5C\u4E1A\u4F9D\u8D56\n        dependencies := getJobDependencies(job)\n        for _, dep := range dependencies {\n            depJob := findJobByName(ssn, dep)\n            if depJob == nil {\n                return util.Reject // \u62D2\u7EDD\u5165\u961F\n            }\n        }\n        \n        return util.Permit // \u5141\u8BB8\u5165\u961F\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addjobenqueuedfn---\u4F5C\u4E1A\u5165\u961F\u5B8C\u6210\u56DE\u8C03\u51FD\u6570",children:"AddJobEnqueuedFn - \u4F5C\u4E1A\u5165\u961F\u5B8C\u6210\u56DE\u8C03\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4F5C\u4E1A\u5165\u961F\u5B8C\u6210\u56DE\u8C03\u51FD\u6570\uFF0C\u5728\u4F5C\u4E1A\u6210\u529F\u5165\u961F\u540E\u6267\u884C\u76F8\u5173\u64CD\u4F5C\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddJobEnqueuedFn(name string, fn api.JobEnqueuedFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"JobEnqueuedFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type JobEnqueuedFn func(interface{})\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"interface{}"})," \u7C7B\u578B\uFF0C\u901A\u5E38\u4E3A ",(0,i.jsx)(e.code,{children:"*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5DF2\u5165\u961F\u7684\u4F5C\u4E1A\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u65E0\u8FD4\u56DE\u503C\uFF0C\u4EC5\u6267\u884C\u56DE\u8C03\u64CD\u4F5C"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u5165\u961F\u540E\u7684\u72B6\u6001\u66F4\u65B0"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u5165\u961F\u7EDF\u8BA1\u548C\u76D1\u63A7"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u5165\u961F\u540E\u7684\u8D44\u6E90\u9884\u7559"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (mp *monitorPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u4F5C\u4E1A\u5165\u961F\u5B8C\u6210\u56DE\u8C03\u51FD\u6570\n    ssn.AddJobEnqueuedFn(mp.Name(), func(obj interface{}) {\n        job := obj.(*api.JobInfo)\n        \n        // \u8BB0\u5F55\u4F5C\u4E1A\u5165\u961F\u65F6\u95F4\n        if job.PodGroup.Annotations == nil {\n            job.PodGroup.Annotations = make(map[string]string)\n        }\n        job.PodGroup.Annotations["volcano.sh/enqueued-time"] = time.Now().Format(time.RFC3339)\n        \n        // \u53D1\u9001\u5165\u961F\u4E8B\u4EF6\n        klog.V(3).Infof("Job %s/%s has been enqueued to queue %s", \n            job.Namespace, job.Name, job.Queue)\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addreservednodesfn---\u8282\u70B9\u9884\u7559\u51FD\u6570",children:"AddReservedNodesFn - \u8282\u70B9\u9884\u7559\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u8282\u70B9\u9884\u7559\u51FD\u6570\uFF0C\u7528\u4E8E\u4E3A\u7279\u5B9A\u4F5C\u4E1A\u9884\u7559\u8282\u70B9\u8D44\u6E90\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddReservedNodesFn(name string, fn api.ReservedNodesFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ReservedNodesFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type ReservedNodesFn func(*TaskInfo) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u9700\u8981\u9884\u7559\u8282\u70B9\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u8282\u70B9\u9884\u7559\u6210\u529F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u8282\u70B9\u9884\u7559\u5931\u8D25\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8282\u70B9\u8D44\u6E90\u9884\u7559"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4E13\u7528\u8282\u70B9\u7BA1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u9694\u79BB\u7B56\u7565"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (rp *reservationPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u8282\u70B9\u9884\u7559\u51FD\u6570\n    ssn.AddReservedNodesFn(rp.Name(), func() {\n        // \u4E3A\u9AD8\u4F18\u5148\u7EA7\u961F\u5217\u9884\u7559\u8282\u70B9\n        for _, queue := range ssn.Queues {\n            if isHighPriorityQueue(queue) {\n                reserveNodesForQueue(ssn, queue)\n            }\n        }\n    })\n}\n\nfunc reserveNodesForQueue(ssn *framework.Session, queue *api.QueueInfo) {\n    reservedCount := 0\n    targetReserved := calculateReservedNodes(queue)\n    \n    for _, node := range ssn.Nodes {\n        if reservedCount >= targetReserved {\n            break\n        }\n        \n        if canReserveNode(node, queue) {\n            // \u6807\u8BB0\u8282\u70B9\u4E3A\u9884\u7559\u72B6\u6001\n            if node.Node.Annotations == nil {\n                node.Node.Annotations = make(map[string]string)\n            }\n            node.Node.Annotations["volcano.sh/reserved-for"] = queue.Name\n            reservedCount++\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addvictimtasksfns---\u53D7\u5BB3\u8005\u4EFB\u52A1\u9009\u62E9\u51FD\u6570",children:"AddVictimTasksFns - \u53D7\u5BB3\u8005\u4EFB\u52A1\u9009\u62E9\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u53D7\u5BB3\u8005\u4EFB\u52A1\u9009\u62E9\u51FD\u6570\uFF0C\u7528\u4E8E\u9009\u62E9\u9700\u8981\u88AB\u62A2\u5360\u6216\u56DE\u6536\u7684\u4EFB\u52A1\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddVictimTasksFns(name string, fns []api.VictimTasksFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"VictimTasksFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type VictimTasksFn func([]*TaskInfo) []*TaskInfo\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u53D7\u5BB3\u8005\u4EFB\u52A1\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"[]*api.TaskInfo"}),": \u8868\u793A\u6700\u7EC8\u9009\u4E2D\u7684\u53D7\u5BB3\u8005\u4EFB\u52A1\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4EFB\u52A1\u62A2\u5360\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D44\u6E90\u56DE\u6536\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u591A\u7EF4\u5EA6\u4EFB\u52A1\u9009\u62E9"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (vp *victimPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u53D7\u5BB3\u8005\u4EFB\u52A1\u9009\u62E9\u51FD\u6570\n    victimFns := []api.VictimTasksFn{\n        // \u6309\u4F18\u5148\u7EA7\u9009\u62E9\u53D7\u5BB3\u8005\n        func(tasks []*api.TaskInfo) []*api.TaskInfo {\n            var victims []*api.TaskInfo\n            minPriority := int32(1000)\n            \n            for _, task := range tasks {\n                priority := getTaskPriority(task)\n                if priority < minPriority {\n                    minPriority = priority\n                    victims = []*api.TaskInfo{task}\n                } else if priority == minPriority {\n                    victims = append(victims, task)\n                }\n            }\n            return victims\n        },\n        // \u6309\u8FD0\u884C\u65F6\u95F4\u9009\u62E9\u53D7\u5BB3\u8005\n        func(tasks []*api.TaskInfo) []*api.TaskInfo {\n            var victims []*api.TaskInfo\n            var shortestRunTime time.Duration = time.Hour * 24\n            \n            for _, task := range tasks {\n                runTime := getTaskRunTime(task)\n                if runTime < shortestRunTime {\n                    shortestRunTime = runTime\n                    victims = []*api.TaskInfo{task}\n                } else if runTime == shortestRunTime {\n                    victims = append(victims, task)\n                }\n            }\n            return victims\n        },\n    }\n    \n    ssn.AddVictimTasksFns(vp.Name(), victimFns)\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addtargetjobfn---\u76EE\u6807\u4F5C\u4E1A\u9009\u62E9\u51FD\u6570",children:"AddTargetJobFn - \u76EE\u6807\u4F5C\u4E1A\u9009\u62E9\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u76EE\u6807\u4F5C\u4E1A\u9009\u62E9\u51FD\u6570\uFF0C\u7528\u4E8E\u4ECE\u4F5C\u4E1A\u5217\u8868\u4E2D\u9009\u62E9\u7279\u5B9A\u7684\u76EE\u6807\u4F5C\u4E1A\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddTargetJobFn(name string, fn api.TargetJobFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"TargetJobFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type TargetJobFn func([]*JobInfo) *JobInfo\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"[]*api.JobInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u4F5C\u4E1A\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"*api.JobInfo"}),": \u8868\u793A\u9009\u4E2D\u7684\u76EE\u6807\u4F5C\u4E1A"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u6CA1\u6709\u627E\u5230\u5408\u9002\u7684\u76EE\u6807\u4F5C\u4E1A"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u4F5C\u4E1A\u4F18\u5148\u7EA7\u9009\u62E9"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u7279\u6B8A\u8C03\u5EA6\u7B56\u7565"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (sp *starvationPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u9965\u997F\u4F5C\u4E1A\u9009\u62E9\u51FD\u6570\n    ssn.AddTargetJobFn(sp.Name(), func(jobs []*api.JobInfo) *api.JobInfo {\n        var targetJob *api.JobInfo\n        maxWaitTime := time.Duration(0)\n        \n        for _, job := range jobs {\n            // \u8BA1\u7B97\u4F5C\u4E1A\u7B49\u5F85\u65F6\u95F4\n            waitTime := time.Since(job.CreationTimestamp.Time)\n            \n            // \u68C0\u67E5\u662F\u5426\u4E3A\u9965\u997F\u4F5C\u4E1A\n            if waitTime > maxWaitTime {\n                targetJob = job\n                maxWaitTime = waitTime\n            }\n        }\n        \n        return targetJob\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addsimulateaddtaskfn---\u6A21\u62DF\u6DFB\u52A0\u4EFB\u52A1\u51FD\u6570",children:"AddSimulateAddTaskFn - \u6A21\u62DF\u6DFB\u52A0\u4EFB\u52A1\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u6A21\u62DF\u6DFB\u52A0\u4EFB\u52A1\u51FD\u6570\uFF0C\u7528\u4E8E\u5728\u4E0D\u5B9E\u9645\u8C03\u5EA6\u7684\u60C5\u51B5\u4E0B\u6A21\u62DF\u4EFB\u52A1\u6DFB\u52A0\u7684\u6548\u679C\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddSimulateAddTaskFn(name string, fn api.SimulateAddTaskFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"SimulateAddTaskFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type SimulateAddTaskFn func(*TaskInfo, *NodeInfo) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u6A21\u62DF\u6DFB\u52A0\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u76EE\u6807\u8282\u70B9\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u6A21\u62DF\u6DFB\u52A0\u6210\u529F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u6A21\u62DF\u6DFB\u52A0\u5931\u8D25\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u62A2\u5360\u8C03\u5EA6\u9A8C\u8BC1"}),"\uFF1A\u5728",(0,i.jsx)(e.code,{children:"preempt action"}),"\u4E2D\u9A8C\u8BC1\u9AD8\u4F18\u5148\u7EA7\u4EFB\u52A1\u662F\u5426\u80FD\u5728\u91CA\u653E\u8D44\u6E90\u540E\u6210\u529F\u8C03\u5EA6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907F\u514D\u5B9E\u9645\u64CD\u4F5C\u526F\u4F5C\u7528"}),"\uFF1A\u5728\u786E\u5B9A\u62A2\u5360\u7B56\u7565\u524D\uFF0C\u4E0D\u5B9E\u9645\u6267\u884C",(0,i.jsx)(e.code,{children:"Pod"}),"\u8C03\u5EA6\u64CD\u4F5C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u63D0\u9AD8\u62A2\u5360\u51B3\u7B56\u51C6\u786E\u6027"}),"\uFF1A\u901A\u8FC7\u6A21\u62DF\u9A8C\u8BC1\u62A2\u5360\u65B9\u6848\u7684\u53EF\u884C\u6027"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (sp *simulatePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u6A21\u62DF\u6DFB\u52A0\u4EFB\u52A1\u51FD\u6570\n    ssn.AddSimulateAddTaskFn(sp.Name(), func(ctx context.Context, state *k8sframework.CycleState, taskToSchedule *api.TaskInfo, taskToAdd *api.TaskInfo, nodeInfo *api.NodeInfo) error {\n        // \u6A21\u62DF\u5C06\u4EFB\u52A1\u6DFB\u52A0\u5230\u8282\u70B9\n        nodeInfo.AddTask(taskToAdd)\n        \n        // \u68C0\u67E5\u8D44\u6E90\u662F\u5426\u8DB3\u591F\n        if nodeInfo.Used.MilliCPU > nodeInfo.Allocatable.MilliCPU {\n            return fmt.Errorf("simulated CPU overcommit on node %s", nodeInfo.Name)\n        }\n        \n        return nil\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"addsimulateremovetaskfn---\u6A21\u62DF\u79FB\u9664\u4EFB\u52A1\u51FD\u6570",children:"AddSimulateRemoveTaskFn - \u6A21\u62DF\u79FB\u9664\u4EFB\u52A1\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u6A21\u62DF\u79FB\u9664\u4EFB\u52A1\u51FD\u6570\uFF0C\u7528\u4E8E\u5728\u4E0D\u5B9E\u9645\u79FB\u9664\u7684\u60C5\u51B5\u4E0B\u6A21\u62DF\u4EFB\u52A1\u79FB\u9664\u7684\u6548\u679C\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddSimulateRemoveTaskFn(name string, fn api.SimulateRemoveTaskFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"SimulateRemoveTaskFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type SimulateRemoveTaskFn func(*TaskInfo, *NodeInfo) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u6A21\u62DF\u79FB\u9664\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u76EE\u6807\u8282\u70B9\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u6A21\u62DF\u79FB\u9664\u6210\u529F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u6A21\u62DF\u79FB\u9664\u5931\u8D25\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u62A2\u5360\u8D44\u6E90\u91CA\u653E\u6A21\u62DF"}),"\uFF1A\u5728",(0,i.jsx)(e.code,{children:"preempt action"}),"\u4E2D\u6A21\u62DF\u9A71\u9010\u4F4E\u4F18\u5148\u7EA7\u4EFB\u52A1\u540E\u7684\u8D44\u6E90\u72B6\u6001"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907F\u514D\u4E0D\u5FC5\u8981\u7684Pod\u9A71\u9010"}),"\uFF1A\u9A8C\u8BC1\u79FB\u9664\u67D0\u4E9B\u4EFB\u52A1\u540E\u662F\u5426\u80FD\u91CA\u653E\u8DB3\u591F\u8D44\u6E90"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u51CF\u5C11\u8D44\u6E90\u6D6A\u8D39"}),"\uFF1A\u907F\u514D\u9A71\u9010Pod\u540E\u53D1\u73B0\u65E0\u6CD5\u8C03\u5EA6\u76EE\u6807\u4EFB\u52A1\u7684\u60C5\u51B5"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (sp *simulatePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u6A21\u62DF\u79FB\u9664\u4EFB\u52A1\u51FD\u6570\n    ssn.AddSimulateRemoveTaskFn(sp.Name(), func(ctx context.Context, state *k8sframework.CycleState, taskToSchedule *api.TaskInfo, taskToRemove *api.TaskInfo, nodeInfo *api.NodeInfo) error {\n        // \u6A21\u62DF\u4ECE\u8282\u70B9\u79FB\u9664\u4EFB\u52A1\n        nodeInfo.RemoveTask(taskToRemove)\n        \n        return nil\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addsimulateallocatablefn---\u6A21\u62DF\u8D44\u6E90\u5206\u914D\u51FD\u6570",children:"AddSimulateAllocatableFn - \u6A21\u62DF\u8D44\u6E90\u5206\u914D\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u6A21\u62DF\u8D44\u6E90\u5206\u914D\u51FD\u6570\uFF0C\u7528\u4E8E\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u68C0\u67E5\u8D44\u6E90\u5206\u914D\u7684\u53EF\u884C\u6027\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddSimulateAllocatableFn(name string, fn api.SimulateAllocatableFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"SimulateAllocatableFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type SimulateAllocatableFn func(*QueueInfo, *TaskInfo) bool\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.QueueInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u961F\u5217\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u5206\u914D\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"true"}),": \u8868\u793A\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u961F\u5217\u53EF\u4EE5\u4E3A\u4EFB\u52A1\u5206\u914D\u8D44\u6E90"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"false"}),": \u8868\u793A\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u961F\u5217\u65E0\u6CD5\u4E3A\u4EFB\u52A1\u5206\u914D\u8D44\u6E90"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u961F\u5217\u8D44\u6E90\u914D\u989D\u9A8C\u8BC1"}),"\uFF1A\u5728",(0,i.jsx)(e.code,{children:"preempt action"}),"\u62A2\u5360\u8FC7\u7A0B\u4E2D\u9A8C\u8BC1\u961F\u5217\u662F\u5426\u6709\u8DB3\u591F\u914D\u989D\u6765\u8C03\u5EA6\u4EFB\u52A1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u8F6E\u62A2\u5360\u51B3\u7B56\u652F\u6301"}),"\uFF1A\u4E3A\u590D\u6742\u7684\u62A2\u5360\u7B97\u6CD5\u63D0\u4F9B\u6A21\u62DF\u73AF\u5883"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8D44\u6E90\u5206\u914D\u9884\u68C0\u67E5"}),"\uFF1A\u786E\u4FDD\u53EA\u6709\u5728\u786E\u8BA4\u53EF\u4EE5\u6210\u529F\u8C03\u5EA6\u65F6\u624D\u6267\u884C\u5B9E\u9645\u62A2\u5360\u64CD\u4F5C"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (sp *simulatePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u6A21\u62DF\u8D44\u6E90\u5206\u914D\u51FD\u6570\n    ssn.AddSimulateAllocatableFn(sp.Name(), func(ctx context.Context, state *k8sframework.CycleState, queue *api.QueueInfo, task *api.TaskInfo) bool {\n        // \u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u68C0\u67E5\u961F\u5217\u8D44\u6E90\u5206\u914D\n        simulatedUsed := &api.Resource{\n            MilliCPU: queue.Used.MilliCPU + task.Resreq.MilliCPU,\n            Memory:   queue.Used.Memory + task.Resreq.Memory,\n        }\n        \n        // \u68C0\u67E5\u662F\u5426\u8D85\u51FA\u961F\u5217\u5BB9\u91CF\n        return simulatedUsed.MilliCPU <= queue.Capability.MilliCPU && \n               simulatedUsed.Memory <= queue.Capability.Memory\n    })\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"addsimulatepredicatefn---\u6A21\u62DF\u9884\u9009\u51FD\u6570",children:"AddSimulatePredicateFn - \u6A21\u62DF\u9884\u9009\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u6A21\u62DF\u9884\u9009\u51FD\u6570\uFF0C\u7528\u4E8E\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u8FDB\u884C\u8282\u70B9\u8FC7\u6EE4\u68C0\u67E5\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddSimulatePredicateFn(name string, fn api.SimulatePredicateFn)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"SimulatePredicateFn\u7C7B\u578B\u5B9A\u4E49"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type SimulatePredicateFn func(*TaskInfo, *NodeInfo) error\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E00\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.TaskInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5F85\u6A21\u62DF\u8C03\u5EA6\u7684\u4EFB\u52A1\u4FE1\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B2C\u4E8C\u4E2A\u53C2\u6570: ",(0,i.jsx)(e.code,{children:"*api.NodeInfo"})," \u7C7B\u578B\uFF0C\u8868\u793A\u5019\u9009\u8282\u70B9\u4FE1\u606F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"nil"}),": \u8868\u793A\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u4EFB\u52A1\u53EF\u4EE5\u8C03\u5EA6\u5230\u8BE5\u8282\u70B9"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"error"}),": \u8868\u793A\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u4EFB\u52A1\u4E0D\u80FD\u8C03\u5EA6\u5230\u8BE5\u8282\u70B9\uFF0C\u9519\u8BEF\u4FE1\u606F\u8BF4\u660E\u539F\u56E0"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u62A2\u5360\u8282\u70B9\u7EA6\u675F\u9A8C\u8BC1"}),"\uFF1A\u5728",(0,i.jsx)(e.code,{children:"preempt action"}),"\u62A2\u5360\u8FC7\u7A0B\u4E2D\u9A8C\u8BC1\u4EFB\u52A1\u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u662F\u5426\u6EE1\u8DB3\u8282\u70B9\u7EA6\u675F\u6761\u4EF6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u62D3\u6251\u7EA6\u675F\u68C0\u67E5"}),"\uFF1A\u5728\u62A2\u5360\u573A\u666F\u4E2D\u7EF4\u62A4\u62D3\u6251\u7EA6\u675F\u7684\u540C\u65F6\u9A8C\u8BC1\u8C03\u5EA6\u53EF\u884C\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u667A\u80FD\u62A2\u5360\u51B3\u7B56"}),"\uFF1A\u786E\u4FDD\u62A2\u5360\u540E\u7684\u4EFB\u52A1\u80FD\u6EE1\u8DB3\u6240\u6709\u8282\u70B9\u7EA7\u522B\u7684\u8C03\u5EA6\u8981\u6C42"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (sp *simulatePlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u6A21\u62DF\u9884\u9009\u51FD\u6570\n    ssn.AddSimulatePredicateFn(sp.Name(), func(ctx context.Context, state *k8sframework.CycleState, task *api.TaskInfo, node *api.NodeInfo) error {\n        // \u5728\u6A21\u62DF\u73AF\u5883\u4E2D\u68C0\u67E5\u8282\u70B9\u9002\u914D\u6027\n        availableCPU := node.Allocatable.MilliCPU - node.Used.MilliCPU\n        availableMemory := node.Allocatable.Memory - node.Used.Memory\n        \n        if task.Resreq.MilliCPU > availableCPU {\n            return fmt.Errorf("simulated CPU insufficient on node %s", node.Name)\n        }\n        \n        if task.Resreq.Memory > availableMemory {\n            return fmt.Errorf("simulated memory insufficient on node %s", node.Name)\n        }\n        \n        return nil\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u4E8B\u4EF6\u5904\u7406\u76F8\u5173\u65B9\u6CD5",children:"\u4E8B\u4EF6\u5904\u7406\u76F8\u5173\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"addeventhandler---\u4E8B\u4EF6\u5904\u7406\u5668\u6CE8\u518C\u51FD\u6570",children:"AddEventHandler - \u4E8B\u4EF6\u5904\u7406\u5668\u6CE8\u518C\u51FD\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F5C\u7528"}),": \u6CE8\u518C\u4E8B\u4EF6\u5904\u7406\u5668\uFF0C\u7528\u4E8E\u5728\u4EFB\u52A1\u5206\u914D\u548C\u91CA\u653E\u8FC7\u7A0B\u4E2D\u6267\u884C\u81EA\u5B9A\u4E49\u7684\u56DE\u8C03\u903B\u8F91\u3002\u8FD9\u662F\u63D2\u4EF6\u4E2D\u5BF9\u8D44\u6E90\u5206\u914D\u7BA1\u7406\u7684\u5173\u952E\u65B9\u6CD5\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u51FD\u6570\u7B7E\u540D"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (ssn *Session) AddEventHandler(eh *EventHandler)\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"EventHandler\u7ED3\u6784"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type EventHandler struct {\n    AllocateFunc   func(event *Event)\n    DeallocateFunc func(event *Event)\n}\n\ntype Event struct {\n    Task *api.TaskInfo\n    Err  error\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53C2\u6570\u8BE6\u89E3"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"AllocateFunc"}),": \u4EFB\u52A1\u5206\u914D\u65F6\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u53C2\u6570\u4E3A\u5305\u542B\u4EFB\u52A1\u548C\u8282\u70B9\u4FE1\u606F\u7684\u4E8B\u4EF6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"DeallocateFunc"}),": \u4EFB\u52A1\u91CA\u653E\u65F6\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u53C2\u6570\u4E3A\u5305\u542B\u4EFB\u52A1\u548C\u8282\u70B9\u4FE1\u606F\u7684\u4E8B\u4EF6"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FD4\u56DE\u503C\u542B\u4E49"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u65E0\u8FD4\u56DE\u503C\uFF0C\u4EC5\u6267\u884C\u4E8B\u4EF6\u5904\u7406\u903B\u8F91"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u4F7F\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8D44\u6E90\u5206\u914D\u8DDF\u8E2A"}),"\uFF1A\u5728\u4EFB\u52A1\u6210\u529F\u5206\u914D\u5230\u8282\u70B9\u65F6\u6267\u884C\u8D44\u6E90\u7EDF\u8BA1\u548C\u72B6\u6001\u66F4\u65B0"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8D44\u6E90\u91CA\u653E\u7BA1\u7406"}),"\uFF1A\u5728\u4EFB\u52A1\u4ECE\u8282\u70B9\u91CA\u653E\u65F6\u6267\u884C\u8D44\u6E90\u6E05\u7406\u548C\u72B6\u6001\u6062\u590D"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u63D2\u4EF6\u72B6\u6001\u540C\u6B65"}),"\uFF1A\u7EF4\u62A4\u63D2\u4EF6\u5185\u90E8\u7684\u8D44\u6E90\u5206\u914D\u72B6\u6001\u4E0E\u8C03\u5EA6\u5668\u72B6\u6001\u4E00\u81F4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u79DF\u6237\u8D44\u6E90\u7BA1\u7406"}),"\uFF1A\u5B9E\u73B0\u961F\u5217\u7EA7\u522B\u7684\u8D44\u6E90\u4F7F\u7528\u7EDF\u8BA1\u548C\u914D\u989D\u7BA1\u7406"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8C03\u7528\u65F6\u673A"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"AllocateFunc"}),"\uFF1A\u5728",(0,i.jsx)(e.code,{children:"ssn.Allocate()"}),"\u3001",(0,i.jsx)(e.code,{children:"ssn.Pipeline()"}),"\u7B49\u5206\u914D\u64CD\u4F5C\u6210\u529F\u540E\u8C03\u7528"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"DeallocateFunc"}),"\uFF1A\u5728",(0,i.jsx)(e.code,{children:"ssn.Evict()"}),"\u3001",(0,i.jsx)(e.code,{children:"ssn.UpdateTaskStatus()"}),"\u7B49\u91CA\u653E\u64CD\u4F5C\u540E\u8C03\u7528"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (cp *capacityPlugin) OnSessionOpen(ssn *framework.Session) {\n    // \u6CE8\u518C\u4E8B\u4EF6\u5904\u7406\u5668\n    ssn.AddEventHandler(&framework.EventHandler{\n        AllocateFunc: func(event *framework.Event) {\n            job := ssn.Jobs[event.Task.Job]\n            attr := cp.queueOpts[job.Queue]\n            \n            // \u66F4\u65B0\u961F\u5217\u5DF2\u4F7F\u7528\u8D44\u6E90\n            attr.allocated.Add(event.Task.Resreq)\n            \n            klog.V(4).Infof("Capacity allocated <%v> to queue <%v>, total allocated <%v>",\n                event.Task.Resreq, job.Queue, attr.allocated)\n        },\n        DeallocateFunc: func(event *framework.Event) {\n            job := ssn.Jobs[event.Task.Job]\n            attr := cp.queueOpts[job.Queue]\n            \n            // \u91CA\u653E\u961F\u5217\u5DF2\u4F7F\u7528\u8D44\u6E90\n            attr.allocated.Sub(event.Task.Resreq)\n            \n            klog.V(4).Infof("Capacity deallocated <%v> from queue <%v>, total allocated <%v>",\n                event.Task.Resreq, job.Queue, attr.allocated)\n        },\n    })\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u5E94\u7528\u573A\u666F"}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"DRF\u63D2\u4EF6\u4E2D\u7684\u8D44\u6E90\u4EFD\u989D\u7BA1\u7406"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"ssn.AddEventHandler(&framework.EventHandler{\n    AllocateFunc: func(event *framework.Event) {\n        attr := drf.jobAttrs[event.Task.Job]\n        attr.allocated.Add(event.Task.Resreq)\n        \n        // \u91CD\u65B0\u8BA1\u7B97\u4E3B\u5BFC\u8D44\u6E90\u4EFD\u989D\n        attr.share = drf.calculateShare(attr.allocated, attr.request)\n    },\n})\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Proportion\u63D2\u4EF6\u4E2D\u7684\u6743\u91CD\u8C03\u6574"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"ssn.AddEventHandler(&framework.EventHandler{\n    AllocateFunc: func(event *framework.Event) {\n        job := ssn.Jobs[event.Task.Job]\n        attr := pp.queueOpts[job.Queue]\n        \n        // \u66F4\u65B0\u961F\u5217\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\n        attr.allocated.Add(event.Task.Resreq)\n        \n        // \u91CD\u65B0\u8BA1\u7B97\u961F\u5217\u6743\u91CD\n        pp.updateQueueWeight(job.Queue, attr)\n    },\n})\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"NUMA\u611F\u77E5\u63D2\u4EF6\u4E2D\u7684\u62D3\u6251\u72B6\u6001\u7BA1\u7406"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'ssn.AddEventHandler(&framework.EventHandler{\n    AllocateFunc: func(event *framework.Event) {\n        node := pp.nodeResSets[event.Task.NodeName]\n        \n        // \u66F4\u65B0NUMA\u8282\u70B9\u8D44\u6E90\u5206\u914D\u72B6\u6001\n        pp.assignRes[event.Task.UID] = pp.allocateNumaResource(node, event.Task)\n        \n        klog.V(4).Infof("NUMA resource allocated for task %s on node %s", \n            event.Task.Name, event.Task.NodeName)\n    },\n})\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u91CD\u8981\u7279\u6027"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u52A8\u89E6\u53D1"}),"\uFF1A\u65E0\u9700\u624B\u52A8\u8C03\u7528\uFF0C\u8C03\u5EA6\u5668\u5728\u8D44\u6E90\u5206\u914D/\u91CA\u653E\u65F6\u81EA\u52A8\u89E6\u53D1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u72B6\u6001\u540C\u6B65"}),"\uFF1A\u786E\u4FDD\u63D2\u4EF6\u5185\u90E8\u72B6\u6001\u4E0E\u8C03\u5EA6\u5668\u5B9E\u9645\u72B6\u6001\u4FDD\u6301\u4E00\u81F4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8BEF\u5904\u7406"}),"\uFF1A",(0,i.jsx)(e.code,{children:"Event"}),"\u7ED3\u6784\u5305\u542B\u9519\u8BEF\u4FE1\u606F\uFF0C\u652F\u6301\u5F02\u5E38\u60C5\u51B5\u5904\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u63D2\u4EF6\u652F\u6301"}),"\uFF1A\u591A\u4E2A\u63D2\u4EF6\u53EF\u4EE5\u6CE8\u518C\u4E0D\u540C\u7684\u4E8B\u4EF6\u5904\u7406\u5668\uFF0C\u6309\u6CE8\u518C\u987A\u5E8F\u6267\u884C"]}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(t,{...n})}):t(n)}},50065:function(n,e,s){s.d(e,{Z:function(){return c},a:function(){return d}});var r=s(67294);let i={},l=r.createContext(i);function d(n){let e=r.useContext(l);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);