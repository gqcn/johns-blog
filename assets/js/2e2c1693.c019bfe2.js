"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["5179"],{78665:function(e,n,t){t.r(n),t.d(n,{metadata:()=>r,contentTitle:()=>o,default:()=>u,assets:()=>l,toc:()=>c,frontMatter:()=>s});var r=JSON.parse('{"id":"docs/AI\u6280\u672F/\u6A21\u578B\u5F00\u53D1/Jupyter/Jupyter\u4F7F\u7528\u6848\u4F8B","title":"Jupyter\u4F7F\u7528\u6848\u4F8B","description":"\u8BE6\u7EC6\u4ECB\u7ECD\u5728Kubernetes\u73AF\u5883\u4E2D\u90E8\u7F72\u591A\u7528\u6237JupyterLab\u7684\u5B9E\u8DF5\u6848\u4F8B\u3002\u901A\u8FC7NFS\u5171\u4EAB\u5B58\u50A8\u914D\u7F6EPV/PVC\uFF0C\u4F7F\u7528InitContainer\u52A8\u6001\u8BFB\u53D6\u7528\u6237UID/GID\u5B9E\u73B0\u6743\u9650\u9694\u79BB\uFF0C\u786E\u4FDD\u6BCF\u4E2A\u7528\u6237\u7684JupyterLab\u5B9E\u4F8B\u53EA\u80FD\u8BBF\u95EE\u81EA\u5DF1\u7684\u6570\u636E\u76EE\u5F55\u3002\u6DB5\u76D6\u5B8C\u6574\u7684Pod\u914D\u7F6E\u3001\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBE\u7F6E\u3001\u5B58\u50A8\u6302\u8F7D\u548C\u8BBF\u95EE\u65B9\u5F0F\uFF0C\u9002\u7528\u4E8E\u4F01\u4E1A\u7EA7\u591A\u79DF\u6237JupyterLab\u90E8\u7F72\u573A\u666F\u3002","source":"@site/docs/docs/1000-AI\u6280\u672F/700-\u6A21\u578B\u5F00\u53D1/100-Jupyter/3000-Jupyter\u4F7F\u7528\u6848\u4F8B.md","sourceDirName":"docs/1000-AI\u6280\u672F/700-\u6A21\u578B\u5F00\u53D1/100-Jupyter","slug":"/ai/jupyter-case","permalink":"/ai/jupyter-case","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3000,"frontMatter":{"slug":"/ai/jupyter-case","title":"Jupyter\u4F7F\u7528\u6848\u4F8B","hide_title":true,"keywords":["Jupyter","JupyterLab","Kubernetes","NFS\u5B58\u50A8","Pod\u914D\u7F6E","\u7528\u6237\u6743\u9650\u7BA1\u7406","UID/GID","InitContainer","PersistentVolume","PersistentVolumeClaim","\u5171\u4EAB\u5B58\u50A8","\u591A\u7528\u6237\u73AF\u5883","\u5B89\u5168\u9694\u79BB","\u6570\u636E\u8BBF\u95EE\u63A7\u5236","\u4F01\u4E1A\u7EA7\u90E8\u7F72"],"description":"\u8BE6\u7EC6\u4ECB\u7ECD\u5728Kubernetes\u73AF\u5883\u4E2D\u90E8\u7F72\u591A\u7528\u6237JupyterLab\u7684\u5B9E\u8DF5\u6848\u4F8B\u3002\u901A\u8FC7NFS\u5171\u4EAB\u5B58\u50A8\u914D\u7F6EPV/PVC\uFF0C\u4F7F\u7528InitContainer\u52A8\u6001\u8BFB\u53D6\u7528\u6237UID/GID\u5B9E\u73B0\u6743\u9650\u9694\u79BB\uFF0C\u786E\u4FDD\u6BCF\u4E2A\u7528\u6237\u7684JupyterLab\u5B9E\u4F8B\u53EA\u80FD\u8BBF\u95EE\u81EA\u5DF1\u7684\u6570\u636E\u76EE\u5F55\u3002\u6DB5\u76D6\u5B8C\u6574\u7684Pod\u914D\u7F6E\u3001\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBE\u7F6E\u3001\u5B58\u50A8\u6302\u8F7D\u548C\u8BBF\u95EE\u65B9\u5F0F\uFF0C\u9002\u7528\u4E8E\u4F01\u4E1A\u7EA7\u591A\u79DF\u6237JupyterLab\u90E8\u7F72\u573A\u666F\u3002"},"sidebar":"mainSidebar","previous":{"title":"Jupyter\u6269\u5C55\u955C\u50CF\u4E0E\u5DE5\u5177","permalink":"/ai/jupyter-prebuild-docker-install-extra-tools"},"next":{"title":"Jupyter Server\u914D\u7F6E","permalink":"/ai/jupyter-server-configuration"}}'),i=t("85893"),a=t("50065");let s={slug:"/ai/jupyter-case",title:"Jupyter\u4F7F\u7528\u6848\u4F8B",hide_title:!0,keywords:["Jupyter","JupyterLab","Kubernetes","NFS\u5B58\u50A8","Pod\u914D\u7F6E","\u7528\u6237\u6743\u9650\u7BA1\u7406","UID/GID","InitContainer","PersistentVolume","PersistentVolumeClaim","\u5171\u4EAB\u5B58\u50A8","\u591A\u7528\u6237\u73AF\u5883","\u5B89\u5168\u9694\u79BB","\u6570\u636E\u8BBF\u95EE\u63A7\u5236","\u4F01\u4E1A\u7EA7\u90E8\u7F72"],description:"\u8BE6\u7EC6\u4ECB\u7ECD\u5728Kubernetes\u73AF\u5883\u4E2D\u90E8\u7F72\u591A\u7528\u6237JupyterLab\u7684\u5B9E\u8DF5\u6848\u4F8B\u3002\u901A\u8FC7NFS\u5171\u4EAB\u5B58\u50A8\u914D\u7F6EPV/PVC\uFF0C\u4F7F\u7528InitContainer\u52A8\u6001\u8BFB\u53D6\u7528\u6237UID/GID\u5B9E\u73B0\u6743\u9650\u9694\u79BB\uFF0C\u786E\u4FDD\u6BCF\u4E2A\u7528\u6237\u7684JupyterLab\u5B9E\u4F8B\u53EA\u80FD\u8BBF\u95EE\u81EA\u5DF1\u7684\u6570\u636E\u76EE\u5F55\u3002\u6DB5\u76D6\u5B8C\u6574\u7684Pod\u914D\u7F6E\u3001\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBE\u7F6E\u3001\u5B58\u50A8\u6302\u8F7D\u548C\u8BBF\u95EE\u65B9\u5F0F\uFF0C\u9002\u7528\u4E8E\u4F01\u4E1A\u7EA7\u591A\u79DF\u6237JupyterLab\u90E8\u7F72\u573A\u666F\u3002"},o=void 0,l={},c=[{value:"\u80CC\u666F\u63CF\u8FF0",id:"\u80CC\u666F\u63CF\u8FF0",level:2},{value:"\u914D\u7F6E\u793A\u4F8B",id:"\u914D\u7F6E\u793A\u4F8B",level:2},{value:"PV",id:"pv",level:3},{value:"PVC",id:"pvc",level:3},{value:"Jupyter Pod",id:"jupyter-pod",level:3},{value:"\u8BBF\u95EEPod",id:"\u8BBF\u95EEpod",level:3}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\u80CC\u666F\u63CF\u8FF0",children:"\u80CC\u666F\u63CF\u8FF0"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6211\u4EEC\u6709",(0,i.jsx)(n.code,{children:"NFS"}),"\u7F51\u76D8\uFF0C\u7F51\u76D8\u4E2D\u5B58\u50A8\u4E86\u5404\u4E2A\u7528\u6237\u7684\u6570\u636E\u548C\u6587\u4EF6\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6BCF\u4E2A\u7528\u6237\u53EF\u4EE5\u521B\u5EFA\u4E0D\u540C\u7684",(0,i.jsx)(n.code,{children:"JupyterLab"}),"\uFF0C\u5728\u5176\u4E2D\u53EF\u4EE5\u8BBF\u95EE\u548C\u64CD\u4F5C\u8FD9\u4E9B\u6570\u636E\u548C\u6587\u4EF6\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6211\u4EEC\u5E0C\u671B\u901A\u8FC7",(0,i.jsx)(n.code,{children:"Kubernetes"}),"\u7684",(0,i.jsx)(n.code,{children:"Pod"}),"\u914D\u7F6E\uFF0C\u786E\u4FDD",(0,i.jsx)(n.code,{children:"JupyterLab"}),"\u4EE5\u975E",(0,i.jsx)(n.code,{children:"root"}),"\u7528\u6237\u8EAB\u4EFD\u8FD0\u884C\uFF0C\u5E76\u4E14\u7528\u6237\u53EA\u80FD\u8BBF\u95EE\u81EA\u5DF1\u7684\u6570\u636E\u76EE\u5F55\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u914D\u7F6E\u793A\u4F8B",children:"\u914D\u7F6E\u793A\u4F8B"}),"\n",(0,i.jsx)(n.h3,{id:"pv",children:"PV"}),"\n",(0,i.jsxs)(n.p,{children:["\u521B\u5EFA",(0,i.jsx)(n.code,{children:"NFS"}),"\u7F51\u7EDC\u5B58\u50A8\u7684",(0,i.jsx)(n.code,{children:"PersistentVolume"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: hpc-pv\nspec:\n  capacity:\n    storage: 100Ti\n  accessModes:\n    - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: ""\n  mountOptions:\n    - vers=3\n    - rsize=1048576\n    - wsize=1048576\n    - hard\n    - nolock\n    - proto=tcp\n  nfs:\n    server: aixsky.msxf.local\n    path: /hpc\n'})}),"\n",(0,i.jsx)(n.h3,{id:"pvc",children:"PVC"}),"\n",(0,i.jsxs)(n.p,{children:["\u521B\u5EFA",(0,i.jsx)(n.code,{children:"PersistentVolumeClaim"}),"\u4EE5\u4FBF\u4F7F\u7528\u5230",(0,i.jsx)(n.code,{children:"Pod"}),"\u4E2D\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F\u8BE5PVC\u53EF\u4EE5\u88AB\u591A\u4E2A",(0,i.jsx)(n.code,{children:"Pod"}),"\u5171\u4EAB\u6302\u8F7D\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: hpc-shared-pvc\nspec:\n  resources:\n    requests:\n      storage: 100Ti \n  accessModes:\n    - ReadWriteMany \n  storageClassName: ""  # \u5FC5\u987B\u548C PV \u4E00\u81F4\uFF08\u7A7A\u5B57\u7B26\u4E32\uFF09\n  volumeName: hpc-pv\n'})}),"\n",(0,i.jsx)(n.h3,{id:"jupyter-pod",children:"Jupyter Pod"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: jupyterlab-qiangguo03\n  namespace: jupyter-system\n  labels:\n    app: jupyterlab-qiangguo03\nspec:\n # \u6838\u5FC3\uFF1AinitContainer \u81EA\u52A8\u8BFB\u53D6 HPC \u76EE\u5F55\u7684 UID/GID\n  initContainers:\n  - name: init\n    image: aiharbor.msxf.local/base/ubuntu:22.04\n    command:\n      - /bin/bash\n      - -c\n      - |\n        # \u51FA\u9519\u7ACB\u5373\u9000\u51FA\n        set -e\n\n        USER_DIR="/data/hpc/home"\n        USER_NAME="qiang.guo03"\n\n        # \u8BFB\u53D6\u76EE\u5F55\u7684 UID \u548C GID\uFF08ls -n \u8F93\u51FA\u7684\u7B2C3\u30014\u5217\uFF09\n        USER_UID=$(ls -n ${USER_DIR} | grep ${USER_NAME} | awk \'{print $3}\' | head -n1)\n        USER_GID=$(ls -n ${USER_DIR} | grep ${USER_NAME} | awk \'{print $4}\' | head -n1)\n\n        # \u5C06 UID/GID \u5199\u5165\u5171\u4EAB\u5377\u7684\u914D\u7F6E\u6587\u4EF6\n        echo "USER_UID=${USER_UID}" > /config/uid-gid.env\n        echo "USER_GID=${USER_GID}" >> /config/uid-gid.env\n        echo "USER_NAME=${USER_NAME}" >> /config/uid-gid.env\n\n        # \u6253\u5370\u65E5\u5FD7\uFF08\u65B9\u4FBF\u8C03\u8BD5\uFF09\n        echo "Read ${USER_NAME}, UID: ${USER_UID}, GID: ${USER_GID}"\n    volumeMounts:\n    - name: hpc-shared-volume\n      mountPath: /data/hpc  \n    - name: uid-gid-config\n      mountPath: /config\n      \n  containers:\n  - name: jupyterlab\n    image: aiharbor.msxf.local/jupyterhub/minimal-notebook:3.3.8\n    imagePullPolicy: IfNotPresent\n    command:\n      - /bin/bash\n      - -c\n      - |\n        # \u51FA\u9519\u7ACB\u5373\u9000\u51FA\n        set -e  \n\n        # \u52A0\u8F7D initContainer \u5199\u5165\u7684 UID/GID \u914D\u7F6E\n        source /config/uid-gid.env\n\n        export NB_UID=${USER_UID}\n        export NB_GID=${USER_GID}\n        export NB_USER=${USER_NAME}\n\n        # \u5C06\u7F51\u76D8\u4E2D\u7684\u4E2A\u4EBA\u76EE\u5F55\u8F6F\u94FE\u5230home\u76EE\u5F55\u4E0B\n        ln -s /data/hpc/home/${USER_NAME} /home/${USER_NAME}\n\n        # \u542F\u52A8Jupyter Server\uFF0C\u9ED8\u8BA4\u4F7F\u7528/home/jovyan/.jupyter/jupyter_server_config.py\u914D\u7F6E\u6587\u4EF6\n        start-notebook.sh\n    securityContext:\n      runAsUser: 0  \n      runAsGroup: 0\n    ports:\n    - containerPort: 8888\n      name: http\n      protocol: TCP\n    env:\n    - name: JUPYTER_ENABLE_LAB\n      value: "yes"\n    - name: JUPYTER_TOKEN\n      value: "pass"\n    volumeMounts:\n    - name: hpc-shared-volume\n      mountPath: /data/hpc\n    - name: uid-gid-config\n      mountPath: /config\n    resources:\n      requests:\n        cpu: "1"\n        memory: "2Gi"\n      limits:\n        cpu: "2"\n        memory: "4Gi"\n    livenessProbe:\n      httpGet:\n        path: /lab\n        port: 8888\n      initialDelaySeconds: 30\n      periodSeconds: 10\n    readinessProbe:\n      httpGet:\n        path: /lab\n        port: 8888\n      initialDelaySeconds: 10\n      periodSeconds: 5\n      \n  volumes:\n  # HPC\u5171\u4EAB\u7F51\u76D8\n  - name: hpc-shared-volume\n    persistentVolumeClaim:\n      claimName: hpc-shared-pvc\n  # \u5171\u4EAB\u5377\uFF1A\u7528\u4E8E initContainer \u548C\u4E3B\u5BB9\u5668\u4F20\u9012 UID/GID\n  - name: uid-gid-config         \n    emptyDir: {}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u8BBF\u95EEpod",children:"\u8BBF\u95EEPod"}),"\n",(0,i.jsxs)(n.p,{children:["\u4F7F\u7528",(0,i.jsx)(n.code,{children:"Port Forward"}),"\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward --address 0.0.0.0 -n jupyter-system pod/jupyterlab-qiangguo03 8888:8888\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u540E\u8BBF\u95EE ",(0,i.jsx)(n.a,{href:"http://localhost:8888",children:"http://localhost:8888"})]})]})}function u(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},50065:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return s}});var r=t(67294);let i={},a=r.createContext(i);function s(e){let n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);