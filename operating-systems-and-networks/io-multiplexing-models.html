<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/操作系统和网络/select,poll,epoll,kqueue IO多路复用模型归纳总结区分" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>select,poll,epoll,kqueue IO多路复用模型归纳总结区分 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/operating-systems-and-networks/io-multiplexing-models><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="select,poll,epoll,kqueue IO多路复用模型归纳总结区分 | John's Blog"><meta data-rh=true name=description content=深入分析和对比各种IO多路复用模型的实现原理、特点和使用场景，包括select、poll、epoll和kqueue等系统调用的详细介绍><meta data-rh=true property=og:description content=深入分析和对比各种IO多路复用模型的实现原理、特点和使用场景，包括select、poll、epoll和kqueue等系统调用的详细介绍><meta data-rh=true name=keywords content=IO多路复用,select,poll,epoll,kqueue,系统调用,网络编程,性能优化><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/operating-systems-and-networks/io-multiplexing-models><link data-rh=true rel=alternate href=https://johng.cn/operating-systems-and-networks/io-multiplexing-models hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/operating-systems-and-networks/io-multiplexing-models hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.208c11f9.css><script src=/assets/js/runtime~main.aaaa326e.js defer></script><script src=/assets/js/main.5dc6b32d.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Collapse sidebar category '操作系统和网络'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/operating-systems-and-networks/io-multiplexing-models>select,poll,epoll,kqueue IO多路复用模型归纳总结区分</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/operating-systems-and-networks/network-layer-models>OSI七层模型与TCP/IP五层模型</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/operating-systems-and-networks/tcp-handshake-teardown>TCP三次握手与四次挥手</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/operating-systems-and-networks/websocket-protocol>WebSocket的原理</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/operating-systems-and-networks/tcp-keepalive>TCP Keepalive</a></ul></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/operating-systems-and-networks><span itemprop=name>操作系统和网络</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>select,poll,epoll,kqueue IO多路复用模型归纳总结区分</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=selectpollepoll与kqueue简介>select、poll、epoll与kqueue简介<a href=#selectpollepoll与kqueue简介 class=hash-link aria-label="Direct link to select、poll、epoll与kqueue简介" title="Direct link to select、poll、epoll与kqueue简介">​</a></h2>
<table><thead><tr><th><th><tbody><tr><td><strong>select</strong><td>select本质上是通过设置或者检查存放fd标志位的数据结构来进行下一步处理。这样所带来的缺点是：<br><br>*   单个进程可监视的fd数量被限制<br>*   需要维护一个用来存放大量fd的数据结构，这样会使得用户空间和内核空间在传递该结构时复制开销大<br>*   对socket进行扫描时是<strong>线性扫描</strong><tr><td><strong>poll</strong><td>*   <strong>poll本质上和select没有区别</strong>，它将用户传入的数组拷贝到<strong>内核空间</strong>，然后查询每个fd对应的设备状态，如果设备就绪则在设备等待队列中加入一项并继续遍历，如果遍历完所有fd后没有发现就绪设备，则挂起当前进程，直到设备就绪或者主动超时，被唤醒后它又要再次遍历fd。这个过程经历了多次无谓的遍历。<br>*   它没有最大连接数的限制，原因是它是基于链表来存储的，但是同样有一个缺点：大量的fd的数组被整体复制于用户态和内核地址空间之间，而不管这样的复制是不是有意义。<br>*   poll还有一个特点是“<strong>水平触发</strong>”：如果报告了fd后，没有被处理，那么下次poll时会再次报告该fd。<tr><td><strong>epoll</strong><td>*   epoll支持<strong>水平触发</strong>和<strong>边缘触发</strong>，最大的特点在于边缘触发，它只告诉进程哪些fd刚刚变为就需态，并且只会通知一次。<br>*   在前面说到的复制问题上，epoll使用mmap减少复制开销。<br>*   还有一个特点是，<strong>epoll使用“事件”的就绪通知方式</strong>，通过epoll_ctl注册fd，一旦该fd就绪，内核就会采用类似callback的回调机制来激活该fd，epoll_wait便可以收到通知。<br>*   epoll 使用红黑树 (RB-tree) 数据结构来跟踪当前正在监视的所有文件描述符。<tr><td><strong>kqueue  <br></strong><td>*   kqueue和epoll一样，都是用来替换select和poll的。<strong>不同的是kqueue被用在FreeBSD,NetBSD, OpenBSD, DragonFly BSD, 和 macOS中</strong>。<br>*   kqueue 不仅能够处理文件描述符事件，还可以用于各种其他通知，例如文件修改监视、信号、异步 I/O 事件 (AIO)、子进程状态更改监视和支持纳秒级分辨率的计时器，此外kqueue提供了一种方式除了内核提供的事件之外，还可以使用用户定义的事件。</table>
<p>注：</p>
<ul>
<li>水平触发（level-triggered）：只要满足条件，就触发一个事件(只要有数据没有被获取，内核就不断通知你)。</li>
<li>边缘触发（edge-triggered）：每当状态变化时，触发一个事件。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=selectpollepoll与kqueue区别>select、poll、epoll与kqueue区别<a href=#selectpollepoll与kqueue区别 class=hash-link aria-label="Direct link to select、poll、epoll与kqueue区别" title="Direct link to select、poll、epoll与kqueue区别">​</a></h2>
<table><thead><tr><th><th><th><th><th><tbody><tr><td><td>select<td>poll<td>epoll<td>kqueue<tr><td>支持最大连接数<td>1024（x86） or 2048（x64）<td>无上限<td>无上限<td>无上限<tr><td>IO效率<td>每次调用进行线性遍历，时间复杂度为O(N)<td>每次调用进行线性遍历，时间复杂度为O(N)<td>使用“事件”通知方式，每当fd就绪，系统注册的回调函数就会被调用，将就绪fd放到rdllist里面，这样epoll_wait返回的时候我们就拿到了就绪的fd。时间发复杂度O(1)。<td>同epoll<tr><td>fd拷贝<td>每次select都拷贝<td>每次poll都拷贝<td>调用epoll_ctl时拷贝进内核并由内核保存，之后每次epoll_wait不拷贝<td>同epoll</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=总结>总结<a href=#总结 class=hash-link aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>当同时需要保持很多的长连接，而且连接的开关很频繁时，就能够发挥epoll最大的优势了。这里与服务器模型其实已经有些交集了。</p>
<p>同时需要保持很多的长连接，而且连接的开关很频繁，最高效的模型是非阻塞、异步IO模型。而且不要用select/poll，这两个API的有着O(N)的时间复杂度。<strong>在Linux用epoll，BSD用kqueue，Windows用IOCP，或者用libevent封装的统一接口（对于不同平台libevent实现时采用各个平台特有的API），这些平台特有的API时间复杂度为O(1)</strong>。 然而在非阻塞，异步I/O模型下的编程是非常痛苦的。由于I/O操作不再阻塞，报文的解析需要小心翼翼，并且需要亲自管理维护每个链接的状态。并且为了充分利用CPU，还应结合线程池，避免在轮询线程中处理业务逻辑。</p>
<p>但这种模型的效率是极高的。以知名的http服务器nginx为例，可以轻松应付上千万的空连接+少量活动链接，每个连接连接仅需要几K的内核缓冲区，想要应付更多的空连接，只需简单的增加内存（数据来源为淘宝一位工程师的一次技术讲座，并未实测）。这使得DDoS攻击者的成本大大增加，这种模型攻击者只能将服务器的带宽全部占用，才能达到目的，而两方的投入是不成比例的。</p>
<p>注：</p>
<ul>
<li>长连接：连接后始终不断开，然后进行报文发送和接受。</li>
<li>短链接：每一次通讯都建立连接，通讯完成即断开连接，下次通讯再建立连接。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li>
<p><a href=http://xingyunbaijunwei.blog.163.com/blog/static/76538067201241685556302/ target=_blank rel="noopener noreferrer">http://xingyunbaijunwei.blog.163.com/blog/static/76538067201241685556302/</a></p>
</li>
<li>
<p><a href=http://blog.csdn.net/nailding2/article/details/6858199 target=_blank rel="noopener noreferrer">http://blog.csdn.net/nailding2/article/details/6858199</a></p>
</li>
<li>
<p><a href=http://www.cnblogs.com/xuxm2007/archive/2011/08/15/2139809.html target=_blank rel="noopener noreferrer">http://www.cnblogs.com/xuxm2007/archive/2011/08/15/2139809.html</a></p>
</li>
<li>
<p><a href=http://www.zhihu.com/question/20114168 target=_blank rel="noopener noreferrer">http://www.zhihu.com/question/20114168</a></p>
</li>
<li>
<p><a href=http://www.doc88.com/p-106261947803.html target=_blank rel="noopener noreferrer">http://www.doc88.com/p-106261947803.html</a></p>
</li>
<li>
<p><a href=http://donghao.org/2009/08/linuxiapolliepollaueouaeaeeio.html target=_blank rel="noopener noreferrer">http://donghao.org/2009/08/linuxiapolliepollaueouaeaeeio.html</a></p>
</li>
<li>
<p><a href=https://juejin.cn/post/7071118804855554061 target=_blank rel="noopener noreferrer">https://juejin.cn/post/7071118804855554061</a></p>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/operating-systems-and-networks><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>操作系统和网络</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/operating-systems-and-networks/network-layer-models><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>OSI七层模型与TCP/IP五层模型</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#selectpollepoll与kqueue简介 class="table-of-contents__link toc-highlight">select、poll、epoll与kqueue简介</a><li><a href=#selectpollepoll与kqueue区别 class="table-of-contents__link toc-highlight">select、poll、epoll与kqueue区别</a><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>