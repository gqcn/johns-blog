<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/数据库与中间件/MySQL/浅谈 MySQL binlog 主从同步" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>浅谈 MySQL binlog 主从同步 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/database-and-middleware/mysql-binlog-replication><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="浅谈 MySQL binlog 主从同步 | John's Blog"><meta data-rh=true name=description content="深入讲解 MySQL binlog 主从同步的原理、配置方法和常见问题处理"><meta data-rh=true property=og:description content="深入讲解 MySQL binlog 主从同步的原理、配置方法和常见问题处理"><meta data-rh=true name=keywords content=MySQL,binlog,主从同步,数据复制,高可用,数据同步,主从架构><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/database-and-middleware/mysql-binlog-replication><link data-rh=true rel=alternate href=https://johng.cn/database-and-middleware/mysql-binlog-replication hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/database-and-middleware/mysql-binlog-replication hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.a5309560.css><script src=/assets/js/runtime~main.37e86b4c.js defer></script><script src=/assets/js/main.a829d88b.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/database-and-middleware>数据库与中间件</a><button aria-label="Collapse sidebar category '数据库与中间件'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/database-and-middleware/mysql>MySQL</a><button aria-label="Collapse sidebar category 'MySQL'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-innodb-mvcc>MySQL InnoDB存储引擎对MVCC的实现</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-transaction-isolation>MySQL事务并发控制和隔离级别</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-lock-mechanism>MySQL锁机制</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-index-failure-scenarios>常见MySQL索引失效场景</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/database-and-middleware/mysql-binlog-replication>浅谈 MySQL binlog 主从同步</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/database-and-middleware/redis>Redis</a><button aria-label="Expand sidebar category 'Redis'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/database-and-middleware/etcd>Etcd</a><button aria-label="Expand sidebar category 'Etcd'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/database-normalization>数据库三大范式与反三范式</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/database-and-middleware><span itemprop=name>数据库与中间件</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/database-and-middleware/mysql><span itemprop=name>MySQL</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>浅谈 MySQL binlog 主从同步</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=一binlog-的基础知识>一、binlog 的基础知识<a href=#一binlog-的基础知识 class=hash-link aria-label="Direct link to 一、binlog 的基础知识" title="Direct link to 一、binlog 的基础知识">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1binlog-的概念>1、binlog 的概念<a href=#1binlog-的概念 class=hash-link aria-label="Direct link to 1、binlog 的概念" title="Direct link to 1、binlog 的概念">​</a></h3>
<p>Server 层的日志系统（归档日志），binlog 中跟踪对其数据库的所有更改操作。是逻辑日志，以追加日志的形式记录。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2binlog-的三种格式>2、binLog 的三种格式<a href=#2binlog-的三种格式 class=hash-link aria-label="Direct link to 2、binLog 的三种格式" title="Direct link to 2、binLog 的三种格式">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=1statement><strong>1）statement</strong><a href=#1statement class=hash-link aria-label="Direct link to 1statement" title="Direct link to 1statement">​</a></h4>
<p>记录 SQL 语句的原文。</p>
<p>风险点：</p>
<ul>
<li>SQL中带有now()等内置函数时，主从的数据可能会不一致。</li>
<li>如果主/从用到的索引不同，操作语句带 limit 时，处理的可能是不同行的记录数据。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=2row><strong>2）row</strong><a href=#2row class=hash-link aria-label="Direct link to 2row" title="Direct link to 2row">​</a></h4>
<p>仅记录某条记录的数据修改细节，不关系上下文。例如SQL中带有now()等内置函数时，会被自动转换为当前具体的时间值例如2024-01-01 12:00:00。</p>
<p>缺点：占用空间，同时写 binlog 很耗费 I/O 资源，影响执行速度。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=3mixed><strong>3）mixed</strong><a href=#3mixed class=hash-link aria-label="Direct link to 3mixed" title="Direct link to 3mixed">​</a></h4>
<p>一般语句使用 statement 格式保存，如果使用了一些函数，statement 格式无法完成主从复制的操作，采用 row 格式。MySQL 自己会判断这条 SQL 语句是否可能引起主备不一致，如果有可能就用 row 格式，否则就用 statement 格式。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=二主从同步的基础流程>二、主从同步的基础流程<a href=#二主从同步的基础流程 class=hash-link aria-label="Direct link to 二、主从同步的基础流程" title="Direct link to 二、主从同步的基础流程">​</a></h2>
<p><img decoding=async loading=lazy src=/assets/images/linkedkeeper0_bb790df4-28f3-4e4e-9de0-9e6a233b0348-434836eae39767933ec7ce75783d6746.png width=864 height=470 class=img_ev3q></p>
<ol>
<li>
<p>主库接收到更新命令，执行更新操作，生成 binlog</p>
</li>
<li>
<p>从库在主从之间建立长连接</p>
</li>
<li>
<p>主库 dump_thread 从本地读取 binlog 传送刚给从库</p>
</li>
<li>
<p>从库从主库获取到 binlog 后存储到本地，成为 relay log（中继日志）</p>
</li>
<li>
<p>sql_thread 线程读取 relay log 解析、执行命令更新数据</p>
</li>
</ol>
<p>每个主/从连接都有三个线程，具有多个从库的主库会为每个连接创建一个 dump thread，每个从库都有自己的 I/O thread 和 sql thread。从库使用两个线程将读取主库 binlog 日志和执行更新操作分离开，通过 relay log 机制，使 binlog 的读取和执行互不影响。如果从库某段时间没有运行，重启后从库可以快速读取主库的 binlog 日志；如果从库在 sql thread 执行完 binlog 日志前停止，在重启后也可以在本地的 relay log 中读取到命令继续执行。</p>
<ul>
<li>
<p>dump thread：在从库与主库创建连接后，主库创建 dump thread 日志将 binlog 发送到从库，如果该线程追上了主控，它将进入休眠状态知道主库发送信号通知其有新的事件产生时才会被唤醒</p>
</li>
<li>
<p>I/O thread：在从库执行 start slave 语句时，创建 I/O thread，该线程连接到主库，将 binlog 日志记录到中继日志</p>
</li>
<li>
<p>sql thread：读取 relay log 执行命令实现从库数据的更新</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=三主从延迟问题>三、主从延迟问题<a href=#三主从延迟问题 class=hash-link aria-label="Direct link to 三、主从延迟问题" title="Direct link to 三、主从延迟问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1什么是主从延迟>1，什么是主从延迟<a href=#1什么是主从延迟 class=hash-link aria-label="Direct link to 1，什么是主从延迟" title="Direct link to 1，什么是主从延迟">​</a></h3>
<p>主从延迟指的是同一个事务在从库执行完成的时间和主库执行完成的时间直接的差值。</p>
<p>延迟时间 = 主库执行完事务写入 binlog 的时刻 - 从库执行完事务的时刻</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2主从延迟的来源>2，主从延迟的来源<a href=#2主从延迟的来源 class=hash-link aria-label="Direct link to 2，主从延迟的来源" title="Direct link to 2，主从延迟的来源">​</a></h3>
<p>1）在一些部署条件下，备库所在机器的性能比主库的机器差</p>
<p>2）备库读压力大</p>
<p>3）大事务场景</p>
<p>4）从库的并行复制能力</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3从库并行复制策略>3，从库并行复制策略<a href=#3从库并行复制策略 class=hash-link aria-label="Direct link to 3，从库并行复制策略" title="Direct link to 3，从库并行复制策略">​</a></h3>
<p><img decoding=async loading=lazy src=/assets/images/linkedkeeper0_5a7fd527-6038-49b1-a4f0-7cd20dad38ef-7012b54f873097f610efe316eb7ab952.png width=864 height=360 class=img_ev3q></p>
<p><strong>核心思想：</strong></p>
<p>由 sql_thread 作为分配者（coordinator）的角色，负责读取中转日志（relay log）和分发事务，由 worker 线程来执行命令更新数据。</p>
<p><strong>原则：</strong></p>
<ul>
<li>
<p>不能造成更新覆盖，要求更新同一行的两个事务必须分发到同一个 worker 中</p>
</li>
<li>
<p>同一个事务不能被拆开，必须放到同一个 worker 中</p>
</li>
</ul>
<p><strong>现有的一些并行复制策略：</strong></p>
<p>1）5.6 按库并行复制</p>
<p>coordinator 将 relay log 按照 DB 的维度分发给不同的 worker。</p>
<ul>
<li>
<p>优点：构造映射关系快，只需要库名；不要求 binlog 格式</p>
</li>
<li>
<p>缺点：如果主库上只有一个 DB，那这个策略就没有效果了，或者存在热点 DB，也起不到并行的效果</p>
</li>
</ul>
<p>2）MariaDB 组提交优化</p>
<p>组提交（group commit）主要有以下特性：</p>
<ul>
<li>
<p>一组提交的事务有一个相同的 <code>commit_id</code> 直接写到 bin log 里；能够在同一组里提交的事务一定不会修改同一行；主库上可以并行执行的事务备库上也一定可以并行执行。MariaDB 利用组提交的特性对并行复制进行优化，将相同 <code>commit_id</code> 的事务分发到多个 worker 执行，一组全部执行完毕后再执行下一批。</p>
</li>
<li>
<p>缺点：在从库上执行时，要等一组事务执行完成后再开始执行下一批事务，这样系统的吞吐量就不够，此外，如果出现大事务，那么这段时间就只用一个 worker 线程在工作，造成资源的浪费。</p>
</li>
</ul>
<p>3）5.7.22 增加 binlog-transaction-dependency-tracking 参数控制并行复制策略</p>
<p><code>commit_order</code> ，根据同时进入 prepare 和 commit 来判断是否可以并行的策略。</p>
<p>原则：</p>
<ul>
<li>
<p>同时出入 prepare 状态的事务在从库执行时是可以并行的；</p>
</li>
<li>
<p>处于 prepare 状态的事务与处于 commit 状态的事务之间在备库执行时也是可以并行的。</p>
</li>
</ul>
<p>可以通过 <code>binlog_group_commit_sync_delay</code> 和 <code>bin_log_group_commit_sync_no_delay_count</code> 拉长 binlog write 和 fsync 之间的时间，制造更多同时处于 prepare 阶段的事务。</p>
<p>writeset，对于事务涉及更新的每一行计算出这行的 hash 值组成集合 writeset，如果两个事务没有操作相同的行，也就是说它们的 writeset 没有交集，就可以并行。</p>
<p><code>wrtieset_session</code>，是在 writeset 的基础上多了个约束，在主库上同一个线程先后执行的两个事务，在备库执行的时候要保证先后顺序。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=四延伸>四、延伸<a href=#四延伸 class=hash-link aria-label="Direct link to 四、延伸" title="Direct link to 四、延伸">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1从库连接到主库请求-binlog-日志>1、从库连接到主库请求 binlog 日志<a href=#1从库连接到主库请求-binlog-日志 class=hash-link aria-label="Direct link to 1、从库连接到主库请求 binlog 日志" title="Direct link to 1、从库连接到主库请求 binlog 日志">​</a></h3>
<p>从库主动从主库请求 binlog 的副本，而不是主库主动将数据推送到从库。也就是说每个从库都是独立独立地与主库进行连接，每个从库只能通过向主库请求来接收 binlog 的副本，因此从库能够以自己的速度读取和更新数据库的副本，并且可以随意启动和停止赋值过程，而不会影响到主库或者其他从库的状态。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2relay-log中继日志>2、relay log（中继日志）<a href=#2relay-log中继日志 class=hash-link aria-label="Direct link to 2、relay log（中继日志）" title="Direct link to 2、relay log（中继日志）">​</a></h3>
<p>中继日志与 binlog 相同，由一组包含描述数据库更改的文件和一个包含所有已使用的中继日志文件名称的索引文件组成。在5.6以前，日志是存在 relay <a href=http://log.info target=_blank rel="noopener noreferrer">log.info</a> 文件中的，在5.6以后可以使用 <code>--relay log info repository=table</code> 启动 slave，将此日志写入 <code>mysql.slave_relay_log_info</code> 表，而不是文件。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3复制通道概念>3、复制通道概念<a href=#3复制通道概念 class=hash-link aria-label="Direct link to 3、复制通道概念" title="Direct link to 3、复制通道概念">​</a></h3>
<p>MySQL5.7.6 引入了复制通道的概念，表示事务从主库流到从库的路径。MySQL 服务器会在启动时自动创建一个默认通道，其名称为空字符串（””）。此通道始终存在；用户无法创建或销毁它。如果没有创建其他通道（具有非空名称），则复制语句仅作用于默认通道，以便所有来自旧从属服务器的复制语句都按预期工作。应用于复制通道的语句只能在至少有一个命名通道时使用。</p>
<p>在多源复制中，从库打开多个通道，每个主通道一个，每个通道都有自己的中继日志和 sql thread，一旦复制通道的接收器（I/O 线程）接收到事务，他们将被添加到通道的中继日志文件中并传递到 sql thread，使通道能够独立工作。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4主库和从库用不同引擎>4、主库和从库用不同引擎<a href=#4主库和从库用不同引擎 class=hash-link aria-label="Direct link to 4、主库和从库用不同引擎" title="Direct link to 4、主库和从库用不同引擎">​</a></h3>
<p>对于复制过程来说，主库表和从库表是否使用不同的引擎类型并不重要，实际上，在复制过程中不会复制存储引擎系统变量，用户可以针对不同的复制方案为从库设置不同的存储引擎。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5undo-log>5、undo log<a href=#5undo-log class=hash-link aria-label="Direct link to 5、undo log" title="Direct link to 5、undo log">​</a></h3>
<p>每一个事务对数据的修改都会被记录到 undo log ，当执行事务过程中出现错误或者需要执行回滚操作的话，MySQL 可以利用 undo log 将数据恢复到事务开始之前的状态。</p>
<p>undo log 属于逻辑日志，记录的是 SQL 语句，<strong>比如说事务执行一条 DELETE 语句，那 undo log 就会记录一条相对应的 INSERT 语句</strong>。**同时，undo log 的信息也会被记录到 redo log 中，因为 undo log 也要实现持久性保护。**并且，undo-log 本身是会被删除清理的，例如 INSERT 操作，在事务提交之后就可以清除掉了；UPDATE/DELETE 操作在事务提交不会立即删除，会加入 history list，由后台线程 purge 进行清理。</p>
<p>undo log 是采用 segment（段）的方式来记录的，每个 undo 操作在记录的时候占用一个 <strong>undo log segment</strong>（undo 日志段），undo log segment 包含在 <strong>rollback segment</strong>（回滚段）中。事务开始时，需要为其分配一个 rollback segment。每个 rollback segment 有 1024 个 undo log segment，这有助于管理多个并发事务的回滚需求。</p>
<p>通常情况下， <strong>rollback segment header</strong>（通常在回滚段的第一个页）负责管理 rollback segment。rollback segment header 是 rollback segment 的一部分，通常在回滚段的第一个页。<strong>history list</strong> 是 rollback segment header 的一部分，它的主要作用是记录所有已经提交但还没有被清理（purge）的事务的 undo log。这个列表使得 purge 线程能够找到并清理那些不再需要的 undo log 记录。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=五参考资料>五、参考资料<a href=#五参考资料 class=hash-link aria-label="Direct link to 五、参考资料" title="Direct link to 五、参考资料">​</a></h2>
<ul>
<li>
<p><a href=http://www.linkedkeeper.com/1503.html target=_blank rel="noopener noreferrer">http://www.linkedkeeper.com/1503.html</a> </p>
</li>
<li>
<p><a href=https://javaguide.cn/database/mysql/mysql-logs.html target=_blank rel="noopener noreferrer">https://javaguide.cn/database/mysql/mysql-logs.html</a></p>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/database-and-middleware/mysql-index-failure-scenarios><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>常见MySQL索引失效场景</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/database-and-middleware/redis><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Redis</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#一binlog-的基础知识 class="table-of-contents__link toc-highlight">一、binlog 的基础知识</a><ul><li><a href=#1binlog-的概念 class="table-of-contents__link toc-highlight">1、binlog 的概念</a><li><a href=#2binlog-的三种格式 class="table-of-contents__link toc-highlight">2、binLog 的三种格式</a></ul><li><a href=#二主从同步的基础流程 class="table-of-contents__link toc-highlight">二、主从同步的基础流程</a><li><a href=#三主从延迟问题 class="table-of-contents__link toc-highlight">三、主从延迟问题</a><ul><li><a href=#1什么是主从延迟 class="table-of-contents__link toc-highlight">1，什么是主从延迟</a><li><a href=#2主从延迟的来源 class="table-of-contents__link toc-highlight">2，主从延迟的来源</a><li><a href=#3从库并行复制策略 class="table-of-contents__link toc-highlight">3，从库并行复制策略</a></ul><li><a href=#四延伸 class="table-of-contents__link toc-highlight">四、延伸</a><ul><li><a href=#1从库连接到主库请求-binlog-日志 class="table-of-contents__link toc-highlight">1、从库连接到主库请求 binlog 日志</a><li><a href=#2relay-log中继日志 class="table-of-contents__link toc-highlight">2、relay log（中继日志）</a><li><a href=#3复制通道概念 class="table-of-contents__link toc-highlight">3、复制通道概念</a><li><a href=#4主库和从库用不同引擎 class="table-of-contents__link toc-highlight">4、主库和从库用不同引擎</a><li><a href=#5undo-log class="table-of-contents__link toc-highlight">5、undo log</a></ul><li><a href=#五参考资料 class="table-of-contents__link toc-highlight">五、参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>