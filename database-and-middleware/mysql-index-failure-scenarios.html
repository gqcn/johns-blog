<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/数据库与中间件/MySQL/常见MySQL索引失效场景" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>常见MySQL索引失效场景 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/database-and-middleware/mysql-index-failure-scenarios><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="常见MySQL索引失效场景 | John's Blog"><meta data-rh=true name=description content="详细分析 MySQL 中常见的索引失效场景及其解决方案，帮助开发者优化数据库查询性能"><meta data-rh=true property=og:description content="详细分析 MySQL 中常见的索引失效场景及其解决方案，帮助开发者优化数据库查询性能"><meta data-rh=true name=keywords content=MySQL,索引,索引失效,性能优化,查询优化,数据库调优,SQL优化><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/database-and-middleware/mysql-index-failure-scenarios><link data-rh=true rel=alternate href=https://johng.cn/database-and-middleware/mysql-index-failure-scenarios hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/database-and-middleware/mysql-index-failure-scenarios hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.18600c39.js defer></script><script src=/assets/js/main.5d41bac5.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/database-and-middleware>数据库与中间件</a><button aria-label="Collapse sidebar category '数据库与中间件'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/database-and-middleware/mysql>MySQL</a><button aria-label="Collapse sidebar category 'MySQL'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-innodb-mvcc>MySQL InnoDB存储引擎对MVCC的实现</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-transaction-isolation>MySQL事务并发控制和隔离级别</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-lock-mechanism>MySQL锁机制</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/database-and-middleware/mysql-index-failure-scenarios>常见MySQL索引失效场景</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/mysql-binlog-replication>浅谈 MySQL binlog 主从同步</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/database-and-middleware/redis>Redis</a><button aria-label="Expand sidebar category 'Redis'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/database-and-middleware/etcd>Etcd</a><button aria-label="Expand sidebar category 'Etcd'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/database-and-middleware/database-normalization>数据库三大范式与反三范式</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/database-and-middleware><span itemprop=name>数据库与中间件</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/database-and-middleware/mysql><span itemprop=name>MySQL</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>常见MySQL索引失效场景</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=背景>背景<a href=#背景 class=hash-link aria-label="Direct link to 背景" title="Direct link to 背景">​</a></h2>
<p>无论你是技术大佬，还是刚入行的小白，时不时都会踩到Mysql数据库不走索引的坑。常见的现象就是：明明在字段上添加了索引，但却并未生效。</p>
<p>为了方便学习和记忆，这篇文件将常见的一些不走索引情况进行汇总，并以实例展示，帮助大家更好地避免踩坑。建议收藏，以备不时之需。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=数据库及索引准备>数据库及索引准备<a href=#数据库及索引准备 class=hash-link aria-label="Direct link to 数据库及索引准备" title="Direct link to 数据库及索引准备">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=创建表结构>创建表结构<a href=#创建表结构 class=hash-link aria-label="Direct link to 创建表结构" title="Direct link to 创建表结构">​</a></h3>
<p>为了逐项验证索引的使用情况，我们先准备一张表t_user：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>int</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>11</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>unsigned</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'ID'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>varchar</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>18</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CHARACTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style=color:#66d9ef>COLLATE</span><span class="token plain"> utf8mb4_bin </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'身份编号'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>varchar</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>32</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CHARACTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style=color:#66d9ef>COLLATE</span><span class="token plain"> utf8mb4_bin </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'用户名'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>int</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>11</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'年龄'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>datetime</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'创建时间'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#66d9ef>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">union_idx</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time_idx</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>ENGINE</span><span class="token operator" style=color:#66d9ef>=</span><span class="token keyword" style=color:#66d9ef>InnoDB</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CHARSET</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style=color:#66d9ef>COLLATE</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">utf8mb4_bin</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在上述表结构中有三个索引：</p>
<ul>
<li><code>id</code>：为数据库主键;</li>
<li><code>union_idx</code>：为<code>id_no</code>、<code>username</code>、<code>age</code>构成的<strong>联合索引</strong>;</li>
<li><code>create_time_idx</code>：是由<code>create_time</code>构成的普通索引;</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=初始化数据>初始化数据<a href=#初始化数据 class=hash-link aria-label="Direct link to 初始化数据" title="Direct link to 初始化数据">​</a></h3>
<p>初始化数据分两部分：基础数据和批量导入数据。</p>
<p>基础数据<code>insert</code>了4条数据，其中第4条数据的创建时间为未来的时间，用于后续特殊场景的验证：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>INSERT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VALUES</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token boolean" style=color:#ae81ff>null</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1001'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom1'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>11</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2022-02-27 09:04:23'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>INSERT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VALUES</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token boolean" style=color:#ae81ff>null</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom2'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>12</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2022-02-26 09:04:23'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>INSERT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VALUES</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token boolean" style=color:#ae81ff>null</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1003'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom3'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>13</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2022-02-25 09:04:23'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>INSERT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VALUES</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token boolean" style=color:#ae81ff>null</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1004'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom4'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>14</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2023-02-25 09:04:23'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>除了基础数据，还有一条存储过程及其调用的SQL，方便批量插入数据，用来验证数据比较多的场景：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- 删除历史存储过程</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>PROCEDURE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>IF</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">insert_t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- 创建存储过程</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>delimiter</span><span class="token plain"> $</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>PROCEDURE</span><span class="token plain"> insert_t_user</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>IN</span><span class="token plain"> limit_num </span><span class="token keyword" style=color:#66d9ef>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>BEGIN</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DECLARE</span><span class="token plain"> i </span><span class="token keyword" style=color:#66d9ef>INT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>DECLARE</span><span class="token plain"> id_no </span><span class="token keyword" style=color:#66d9ef>varchar</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>18</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>DECLARE</span><span class="token plain"> username </span><span class="token keyword" style=color:#66d9ef>varchar</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>32</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>DECLARE</span><span class="token plain"> age </span><span class="token keyword" style=color:#66d9ef>TINYINT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>WHILE</span><span class="token plain"> i </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> limit_num </span><span class="token keyword" style=color:#66d9ef>DO</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>SET</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> CONCAT</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"NO"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> i</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>SET</span><span class="token plain"> username </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> CONCAT</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Tom"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">i</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>SET</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> FLOOR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> RAND</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token operator" style=color:#66d9ef>*</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>INSERT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">t_user</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VALUES</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> id_no</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> username</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> age</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>NOW</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>SET</span><span class="token plain"> i </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> i </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>END</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>WHILE</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>END</span><span class="token plain"> $</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- 调用存储过程</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>call</span><span class="token plain"> insert_t_user</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>100</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>关于存储过程的创建和存储，可暂时不执行，当用到时再执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=数据库版本及执行计划>数据库版本及执行计划<a href=#数据库版本及执行计划 class=hash-link aria-label="Direct link to 数据库版本及执行计划" title="Direct link to 数据库版本及执行计划">​</a></h3>
<p>查看当前数据库的版本：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> version</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token number" style=color:#ae81ff>8.0</span><span class="token plain">.18</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述为本人测试的数据库版本：<code>8.0.18</code>。当然，以下的所有示例，大家可在其他版本进行执行验证。</p>
<p>查看SQL语句执行计划，一般我们都采用<code>explain</code>关键字，通过执行结果来判断索引使用情况。</p>
<p>执行示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/e6803fc893d64b17cfb91908c80dc441507821-f639d3bda8e6da17f707363e255fdbc4.jpg width=1080 height=112 class=img_ev3q></p>
<p>explain</p>
<p>可以看到上述SQL语句使用了<strong>主键索引(PRIMARY)</strong>，<code>key_len</code>为4;</p>
<p>其中<code>key_len</code>的含义为：表示索引使用的字节数，根据这个值可以判断索引的使用情况，特别是在组合索引的时候，判断该索引有多少部分被使用到非常重要。</p>
<p>做好以上数据及知识的准备，下面就开始讲解具体索引失效的实例了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=常见mysql索引失效场景>常见MySQL索引失效场景<a href=#常见mysql索引失效场景 class=hash-link aria-label="Direct link to 常见MySQL索引失效场景" title="Direct link to 常见MySQL索引失效场景">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=联合索引不满足最左匹配原则>联合索引不满足最左匹配原则<a href=#联合索引不满足最左匹配原则 class=hash-link aria-label="Direct link to 联合索引不满足最左匹配原则" title="Direct link to 联合索引不满足最左匹配原则">​</a></h3>
<p>联合索引遵从最左匹配原则，顾名思义，在联合索引中，最左侧的字段优先匹配。因此，在创建联合索引时，where子句中使用最频繁的字段放在组合索引的最左侧。</p>
<p>而在查询时，要想让查询条件走索引，则需满足：最左边的字段要出现在查询条件中。</p>
<p>实例中，<code>union_idx</code>联合索引组成：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">union_idx</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id_no</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">age</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>最左边的字段为<code>id_no</code>，一般情况下，只要保证<code>id_no</code>出现在查询条件中，则会走该联合索引。</p>
<p><strong>示例一：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/098520242868b81fce270731652ade402f1fd8-0fc7b856759331c817b6f1bed68e58df.jpg width=1080 height=119 class=img_ev3q></p>
<p>explain-01</p>
<p>通过<code>explain</code>执行结果可以看出，上述SQL语句走了<code>union_idx</code>这条索引。</p>
<p>这里再普及一下<code>key_len</code>的计算：</p>
<ul>
<li><code>id_no</code>类型为<code>varchar(18)</code>，字符集为<code>utf8mb4_bin</code>，也就是使用<code>4</code>个字节来表示一个完整的<code>UTF-8</code>。此时，<code>key_len = 18* 4 = 72</code>;</li>
<li>由于该字段类型<code>varchar</code>为变长数据类型，需要再额外添加<code>2</code>个字节。此时，<code>key_len = 72 + 2 = 74</code>;</li>
<li>由于该字段运行为<code>NULL(default NULL)</code>，需要再添加1个字节。此时，<code>key_len = 74 + 1 = 75</code>;</li>
</ul>
<p>上面演示了<code>key_len</code>一种情况的计算过程，后续不再进行逐一推演，知道基本组成和原理即可，更多情况大家可自行查看。</p>
<p><strong>示例二：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>and</span><span class="token plain"> username </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom2'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/a3f097581706548b5bc446d70a6bd4bbf22635-01ef0c236a6e9abe798b37fece843aa0.jpg width=1080 height=91 class=img_ev3q></p>
<p>explain-02</p>
<p>很显然，依旧走了<code>union_idx</code>索引，根据上面<code>key_len</code>的分析，大胆猜测，在使用索引时，不仅使用了<code>id_no</code>列，还使用了<code>username</code>列。</p>
<p><strong>示例三：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>and</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>12</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/819ad350161afb240da140d1c29dd668c15301-1802c9567c7d4691b474f2e3b60c7315.jpg width=1080 height=75 class=img_ev3q></p>
<p>explain-03</p>
<p>走了<code>union_idx</code>索引，但跟示例一一样，只用到了<code>id_no</code>列。</p>
<p>当然，还有三列都在查询条件中的情况，就不再举例了。上面都是走索引的正向例子，也就是满足最左匹配原则的例子，下面来看看，不满足该原则的反向例子。</p>
<p><strong>反向示例：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> username </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom2'</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>and</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>12</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/6297212227be9bcef09770cd1de90a55a87e6d-f080155d2faa0e1ca4141f71c09f13aa.jpg width=1080 height=98 class=img_ev3q></p>
<p>explain-04</p>
<p>此时，可以看到未走任何索引，也就是说索引失效了。</p>
<p>同样的，下面只要没出现最左条件的组合，索引也是失效的：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>12</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> username </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom2'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>那么，第一种索引失效的场景就是：在联合索引的场景下，查询条件不满足最左匹配原则。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用了select->使用了select *<a href=#使用了select- class=hash-link aria-label="Direct link to 使用了select *" title="Direct link to 使用了select *">​</a></h3>
<p>在《阿里巴巴开发手册》的ORM映射章节中有一条【强制】的规范：</p>
<blockquote>
<p>【强制】在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。说明:</p>
<ol>
<li>增加查询分析器解析成本。</li>
<li>增减字段容易与 resultMap 配置不一致。</li>
<li>无用字段增加网络 消耗，尤其是 text 类型的字段。</li>
</ol>
</blockquote>
<p>虽然在规范手册中没有提到索引方面的问题，但禁止使用<code>select *</code>语句可能会带来的附带好处就是：某些情况下可以走<strong>覆盖索引</strong>。</p>
<p>比如，在上面的联合索引中，如果查询条件是<code>age</code>或<code>username</code>，当使用了<code>select *</code>，肯定是不会走索引的。</p>
<p>但如果希望根据<code>username</code>查询出<code>id_no</code>、<code>username</code>、<code>age</code>这三个结果(均为索引字段)，明确查询结果字段，是可以走覆盖索引的：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> id_no</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> username</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> age </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> username </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom2'</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> id_no</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> username</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> age </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>12</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/f28761f347d3c9fe4b4091bb38dd9d1afe5eb8-a4882db5285c15c56843d6f7301b77a3.jpg width=1080 height=90 class=img_ev3q></p>
<p>覆盖索引</p>
<p>无论查询条件是<code>username</code>还是<code>age</code>，都走了索引，根据key_len可以看出使用了索引的所有列。</p>
<p><strong>第二种索引失效场景：在联合索引下，尽量使用明确的查询列来趋向于走覆盖索引;</strong></p>
<p><strong>这一条不走索引的情况属于优化项，如果业务场景满足，则进来促使SQL语句走索引。至于阿里巴巴开发手册中的规范，只不过是两者撞到一起了，规范本身并不是为这条索引规则而定的。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=索引列参与运算>索引列参与运算<a href=#索引列参与运算 class=hash-link aria-label="Direct link to 索引列参与运算" title="Direct link to 索引列参与运算">​</a></h3>
<p>直接来看示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/e4f30b8148b6ccc9b60014c89b9aac9a272794-1db64b59347a38569c4a47a329de7a05.jpg width=1080 height=102 class=img_ev3q></p>
<p>索引列计算</p>
<p>可以看到，即便<code>id</code>列有索引，由于进行了计算处理，导致无法正常走索引。</p>
<p>针对这种情况，其实不单单是索引的问题，还会增加数据库的计算负担。就以上述SQL语句为例，数据库需要全表扫描出所有的<code>id</code>字段值，然后对其计算，计算之后再与参数值进行比较。如果每次执行都经历上述步骤，性能损耗可想而知。</p>
<p>建议的使用方式是：先在内存中进行计算好预期的值，或者在SQL语句条件的右侧进行参数值的计算。</p>
<p>针对上述示例的优化如下：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token operator" style=color:#66d9ef>--</span><span class="token plain"> 内存计算，得知要查询的id为</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">explain </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> from t_user where id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>--</span><span class="token plain"> 参数侧计算</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">explain </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> from t_user where id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>第三种索引失效情况：索引列参与了运算，会导致全表扫描，索引失效。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=索引列参使用了函数示例>索引列参使用了函数示例<a href=#索引列参使用了函数示例 class=hash-link aria-label="Direct link to 索引列参使用了函数示例" title="Direct link to 索引列参使用了函数示例">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> SUBSTR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">id_no</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'100'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/48fd28277f2576fc89591825a06b02203fcc93-75847dc8abd31350a5d953bf90afa466.jpg width=1080 height=83 class=img_ev3q></p>
<p>索引-函数</p>
<p>上述示例中，索引列使用了函数(<code>SUBSTR</code>，字符串截取)，导致索引失效。</p>
<p>此时，索引失效的原因与第三种情况一样，都是因为数据库要先进行全表扫描，获得数据之后再进行截取、计算，导致索引索引失效。同时，还伴随着性能问题。</p>
<p>示例中只列举了<code>SUBSTR</code>函数，像<code>CONCAT</code>等类似的函数，也都会出现类似的情况。解决方案可参考第三种场景，可考虑先通过内存计算或其他方式减少数据库来进行内容的处理。</p>
<p><strong>第四种索引失效情况：索引列参与了函数处理，会导致全表扫描，索引失效。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=错误的like使用>错误的like使用<a href=#错误的like使用 class=hash-link aria-label="Direct link to 错误的like使用" title="Direct link to 错误的like使用">​</a></h3>
<p>示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>like</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'%00%'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/b20fe761388f74bb3c34154faa92d5440c49e3-75847dc8abd31350a5d953bf90afa466.jpg width=1080 height=83 class=img_ev3q></p>
<p>索引-like</p>
<p>针对<code>like</code>的使用非常频繁，但使用不当往往会导致不走索引。常见的<code>like</code>使用方式有：</p>
<ul>
<li>方式一：<code>like '%abc'</code></li>
<li>方式二：<code>like 'abc%'</code></li>
<li>方式三：<code>like '%abc%'</code></li>
</ul>
<p>其中方式一和方式三，由于占位符出现在首部，导致无法走索引。这种情况不做索引的原因很容易理解，索引本身就相当于目录，从左到右逐个排序。而条件的左侧使用了占位符，导致无法按照正常的目录进行匹配，导致索引失效就很正常了。</p>
<p><strong>第五种索引失效情况：模糊查询时(<code>like</code>语句)，模糊匹配的占位符位于条件的首部。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=类型隐式转换>类型隐式转换<a href=#类型隐式转换 class=hash-link aria-label="Direct link to 类型隐式转换" title="Direct link to 类型隐式转换">​</a></h3>
<p>示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1002</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/f3e8a3f83a05aa4aeea925b3c7ac26de6beb8d-b8bb0f84e8d755578e57153825a66fa9.jpg width=1080 height=95 class=img_ev3q></p>
<p>隐式转换</p>
<p><code>id_no</code>字段类型为<code>varchar</code>，但在SQL语句中使用了<code>int</code>类型，导致全表扫描。</p>
<p>出现索引失效的原因是：<code>varchar</code>和<code>int</code>是两个种不同的类型。</p>
<p>解决方案就是将参数<code>1002</code>添加上单引号或双引号。</p>
<p><strong>第六种索引失效情况：参数类型与字段类型不匹配，导致类型发生了隐式转换，索引失效。</strong></p>
<p>这种情况还有一个特例，如果字段类型为<code>int</code>类型，而查询条件添加了单引号或双引号，则mysql会参数转化为int类型，虽然使用了单引号或双引号（优化器）：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述语句是依旧会走索引的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用or操作>使用OR操作<a href=#使用or操作 class=hash-link aria-label="Direct link to 使用OR操作" title="Direct link to 使用OR操作">​</a></h3>
<p><code>OR</code>是日常使用最多的操作关键字了，但使用不当，也会导致索引失效。</p>
<p>示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>or</span><span class="token plain"> username </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Tom2'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/359039493770a8eee6d109c0c35b94f742dfde-95496ae46f65845978e99b19346e3f9b.jpg width=1080 height=97 class=img_ev3q></p>
<p>or-索引</p>
<p>看到上述执行结果是否是很惊奇啊，明明<code>id</code>字段是有索引的，由于使用<code>or</code>关键字，索引竟然失效了。</p>
<p>其实，换一个角度来想，如果单独使用<code>username</code>字段作为条件很显然是全表扫描，既然已经进行了全表扫描了，前面<code>id</code>的条件再走一次索引反而是浪费了。所以，在使用<code>or</code>关键字时，切记两个条件都要添加索引，否则会导致索引失效。</p>
<p>但如果<code>or</code>两边同时使用<code>></code>和<code>&lt;</code>，则索引也会失效：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id  </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>or</span><span class="token plain"> id  </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>80</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/a9aab576945582c3840420eb96645031dd12e2-6b6ae989ce0dda1f22061794af338814.jpg width=1080 height=137 class=img_ev3q></p>
<p>or-范围</p>
<p><strong>第七种索引失效情况：查询条件使用<code>or</code>关键字，其中一个字段没有创建索引，则会导致整个查询语句索引失效；<code>or</code>两边为<code>></code>和<code>&lt;</code>范围查询时，索引失效。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=两列做比较>两列做比较<a href=#两列做比较 class=hash-link aria-label="Direct link to 两列做比较" title="Direct link to 两列做比较">​</a></h3>
<p>如果两个列数据都有索引，但在查询条件中对两列数据进行了对比操作，则会导致索引失效。</p>
<p>这里举个不恰当的示例，比如<code>age</code>小于<code>id</code>这样的两列(真实场景可能是两列同维度的数据比较，这里迁就现有表结构)：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> age</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/f68a9c44459768dae2a752511ed7bd1d5b8fd1-43e21b68a596bb21e4c16ecd6f37a413.jpg width=1080 height=110 class=img_ev3q></p>
<p>索引-两列比较</p>
<p>这里虽然<code>id</code>有索引，<code>age</code>也可以创建索引，但当两列做比较时，索引还是会失效的。</p>
<p><strong>第八种索引失效情况：两列数据做比较，即便两列都创建了索引，索引也会失效。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=不等于比较>不等于比较<a href=#不等于比较 class=hash-link aria-label="Direct link to 不等于比较" title="Direct link to 不等于比较">​</a></h3>
<p>示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>&lt;></span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/f88f13f4773f1d7db197912fa801f55330e2ba-dc0452754d05067918bf4e75e4e6770e.jpg width=1080 height=108 class=img_ev3q></p>
<p>索引-不等</p>
<p>当查询条件为字符串时，使用<code>&lt;></code>或<code>!=</code>作为条件查询，有可能不走索引，但也不全是。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> create_time </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2022-02-27 09:56:42'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述SQL中，由于<code>2022-02-27 09:56:42</code>是存储过程在同一秒生成的，大量数据是这个时间。执行之后会发现，当查询结果集占比比较小时，会走索引，占比比较大时不会走索引。此处与结果集与总体的占比有关。</p>
<p>需要注意的是：上述语句如果是<code>id</code>进行不等操作，则正常走索引。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/d4f3ce2714c27f4af6e9605ba826afa1666c5b-9e0ac98bced149f518d7a2ab37d95f0e.jpg width=1080 height=85 class=img_ev3q></p>
<p>不等-ID</p>
<p><strong>第九种索引失效情况：查询条件使用不等进行比较时，需要慎重，普通索引会查询结果集占比较大时索引会失效。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=is-not-null>is not null<a href=#is-not-null class=hash-link aria-label="Direct link to is not null" title="Direct link to is not null">​</a></h3>
<p>示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>is</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>not</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>null</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/037f61b8691edc5d5e48895f19b44fa361f6ac-100370db7a5c6023c5f4f4eed0ccf718.jpg width=1080 height=103 class=img_ev3q></p>
<p>索引-is not null</p>
<p><strong>第十种索引失效情况：查询条件使用<code>is null</code>时正常走索引，使用<code>is not null</code>时，不走索引。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=not-in和not-exists>not in和not exists<a href=#not-in和not-exists class=hash-link aria-label="Direct link to not in和not exists" title="Direct link to not in和not exists">​</a></h3>
<p>在日常中使用比较多的范围查询有<code>in</code>、<code>exists</code>、<code>not in</code>、<code>not exists</code>、<code>between and</code>等。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'1001'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user u1 </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>exists</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user u2 </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> u2</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">id  </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>and</span><span class="token plain"> u2</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> u1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>between</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>and</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1003'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述四种语句执行时都会正常走索引，具体的<code>explain</code>结果就不再展示。主要看不走索引的情况：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id_no </span><span class="token operator" style=color:#66d9ef>not</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>in</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'1002'</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'1003'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/68ed8df972ce4621ca5979f22db89b0f713b51-8eda6579dc0531bfada7549b18a59a66.jpg width=1080 height=91 class=img_ev3q></p>
<p>索引-not in</p>
<p>当使用<code>not in</code>时，不走索引?把条件列换成主键试试：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> id </span><span class="token operator" style=color:#66d9ef>not</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/d84b371582e8f4bff9213587783cde3a23c8cf-93c69f294458812b25166273c7a053e1.jpg width=1080 height=113 class=img_ev3q></p>
<p>主键-not in</p>
<p>如果是主键，则正常走索引。</p>
<p><strong>第十一种索引失效情况<code>not in</code>：查询条件使用<code>not in</code>时，如果是主键则走索引，如果是普通索引，则索引失效。</strong></p>
<p>再来看看<code>not exists</code>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user u1 </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>not</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>exists</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user u2 </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> u2</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">id  </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>and</span><span class="token plain"> u2</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">id </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> u1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/823542d28fd53af78221214b04e1ff23413db6-23507d179f75e5b33108eac59445d6ac.jpg width=1080 height=111 class=img_ev3q></p>
<p>索引-not in</p>
<p>当查询条件使用<code>not exists</code>时，不走索引。</p>
<p><strong>第十一种索引失效情况<code>not exists</code>：查询条件使用<code>not exists</code>时，索引失效。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=order-by导致索引失效>order by导致索引失效<a href=#order-by导致索引失效 class=hash-link aria-label="Direct link to order by导致索引失效" title="Direct link to order by导致索引失效">​</a></h3>
<p>示例：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id_no </span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/b35e6b61460a813a147441a61eeb4a4c83eac0-bd355970dc7ed2b9b6974e8eb4750ad1.jpg width=1080 height=95 class=img_ev3q></p>
<p>索引-order by</p>
<p>其实这种情况的索引失效很容易理解，毕竟需要对全表数据进行排序处理。</p>
<p>那么，添加删<code>limit</code>关键字是否就走索引了呢?</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id_no </span><span class="token keyword" style=color:#66d9ef>limit</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/11f565b49dea3fbe1b8809c376268f597b418a-2935c41d278c8d1be8b870d0b573f89a.jpg width=1080 height=106 class=img_ev3q></p>
<p>order by limit</p>
<p>结果依旧不走索引。在网络上看到有说如果<code>order by</code>条件满足最左匹配则会正常走索引， 在当前<code>8.0.18</code>版本中并未出现。所以，在基于<code>order by</code>和<code>limit</code>进行使用时，要特别留意。是否走索引不仅涉及到数据库版本，还要看mysql优化器是如何处理的。</p>
<p>这里还有一个特例，就是主键使用<code>order by</code>时，可以正常走索引。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id </span><span class="token keyword" style=color:#66d9ef>desc</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/f2482e858f7f2bf2321868ffbf063ff62fb9ed-63845c8044a51706dc33ced02efe72fc.jpg width=1080 height=104 class=img_ev3q></p>
<p>主键-order by</p>
<p>可以看出针对主键，还是<code>order by</code>可以正常走索引。</p>
<p>另外，笔者测试如下SQL语句：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> id </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> age</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> id </span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> username </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> age</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> id_no </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id_no</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述三条SQL语句都是走索引的，也就是说<strong>覆盖索引</strong>的场景也是可以正常走索引的。</p>
<p>现在将<code>id</code>和<code>id_no</code>组合起来进行<code>order by</code>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">id_no </span><span class="token keyword" style=color:#66d9ef>desc</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">id_no </span><span class="token keyword" style=color:#66d9ef>desc</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>limit</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>order</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>by</span><span class="token plain"> id_no </span><span class="token keyword" style=color:#66d9ef>desc</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">username </span><span class="token keyword" style=color:#66d9ef>desc</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/a5bec7975f9577766da744f89f213cdaa10011-c2cfde91da02083cb419f3d7c2c8ef7b.jpg width=1080 height=83 class=img_ev3q></p>
<p>orderby多索引</p>
<p>上述两个SQL语句，都未走索引。</p>
<p><strong>第十三种索引失效情况：当查询条件涉及到<code>order by</code>、<code>limit</code>等条件时，是否走索引情况比较复杂，而且与mysql版本有关，通常普通索引，如果未使用<code>limit</code>，则不会走索引。<code>order by</code>多个索引字段时，可能不会走索引。其他情况，建议在使用时进行<code>expain</code>验证。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=参数不同导致索引失效>参数不同导致索引失效<a href=#参数不同导致索引失效 class=hash-link aria-label="Direct link to 参数不同导致索引失效" title="Direct link to 参数不同导致索引失效">​</a></h3>
<p>此时，如果你还未执行最开始创建的存储过程，建议你先执行一下存储过程，然后执行如下SQL：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> create_time </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2023-02-24 09:04:23'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>其中，时间是未来的时间，确保能够查到数据。</p>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/81f486858a5f263ab7f574057e8bd8887598af-76e0bde354b4464f871779da8e286e87.jpg width=1080 height=89 class=img_ev3q></p>
<p>索引-参数</p>
<p>可以看到，正常走索引。</p>
<p>随后，我们将查询条件的参数换个日期：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>explain</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>select</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> t_user </span><span class="token keyword" style=color:#66d9ef>where</span><span class="token plain"> create_time </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2022-02-27 09:04:23'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>explain</code>结果：</p>
<p><img decoding=async loading=lazy src=/assets/images/827d6fb59e22d5690ee605882fb1f05a2ba3f7-93a1727735f9cc91f4dd0f32791f988e.jpg width=1080 height=104 class=img_ev3q></p>
<p>索引-参数</p>
<p>此时，进行了<strong>全表扫描</strong>。这也是最开始提到的奇怪的现象。</p>
<p>为什么同样的查询语句，只是查询的参数值不同，却会出现一个走索引，一个不走索引的情况呢?</p>
<p><strong>答案很简单：上述索引失效是因为DBMS发现全表扫描比走索引效率更高，因此就放弃了走索引。</strong></p>
<p>也就是说，当Mysql发现通过索引扫描的行记录数超过全表的<code>10%-30%</code>时，优化器可能会放弃走索引，自动变成全表扫描。某些场景下即便强制SQL语句走索引，也同样会失效。</p>
<p>类似的问题，在进行范围查询(比如<code>>、&lt; 、>=、&lt;=、in</code>等条件)时往往会出现上述情况，而上面提到的临界值根据场景不同也会有所不同。</p>
<p><strong>第十四种索引失效情况：当查询条件为大于等于、<code>in</code>等范围查询时，根据查询结果占全表数据比例的不同，优化器有可能会放弃索引，进行全表扫描。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=其他>其他<a href=#其他 class=hash-link aria-label="Direct link to 其他" title="Direct link to 其他">​</a></h3>
<p>当然，还有其他一些是否走索引的规则，这与索引的类型是B-tree索引还是位图索引也有关系，就不再详细展开。</p>
<p><strong>这里要说的其他，可以总结为第十五种索引失效的情况：Mysql优化器的其他优化策略，比如优化器认为在某些情况下，全表扫描比走索引快，则它就会放弃索引。</strong></p>
<p>针对这种情况，一般不用过多理会，当发现问题时再定点排查即可。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://www.51cto.com/article/702691.html target=_blank rel="noopener noreferrer">https://www.51cto.com/article/702691.html</a></li>
<li><a href=https://xiaolincoding.com/mysql/index/index_lose.html target=_blank rel="noopener noreferrer">https://xiaolincoding.com/mysql/index/index_lose.html</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/database-and-middleware/mysql-lock-mechanism><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>MySQL锁机制</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/database-and-middleware/mysql-binlog-replication><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>浅谈 MySQL binlog 主从同步</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#背景 class="table-of-contents__link toc-highlight">背景</a><li><a href=#数据库及索引准备 class="table-of-contents__link toc-highlight">数据库及索引准备</a><ul><li><a href=#创建表结构 class="table-of-contents__link toc-highlight">创建表结构</a><li><a href=#初始化数据 class="table-of-contents__link toc-highlight">初始化数据</a><li><a href=#数据库版本及执行计划 class="table-of-contents__link toc-highlight">数据库版本及执行计划</a></ul><li><a href=#常见mysql索引失效场景 class="table-of-contents__link toc-highlight">常见MySQL索引失效场景</a><ul><li><a href=#联合索引不满足最左匹配原则 class="table-of-contents__link toc-highlight">联合索引不满足最左匹配原则</a><li><a href=#使用了select- class="table-of-contents__link toc-highlight">使用了select *</a><li><a href=#索引列参与运算 class="table-of-contents__link toc-highlight">索引列参与运算</a><li><a href=#索引列参使用了函数示例 class="table-of-contents__link toc-highlight">索引列参使用了函数示例</a><li><a href=#错误的like使用 class="table-of-contents__link toc-highlight">错误的like使用</a><li><a href=#类型隐式转换 class="table-of-contents__link toc-highlight">类型隐式转换</a><li><a href=#使用or操作 class="table-of-contents__link toc-highlight">使用OR操作</a><li><a href=#两列做比较 class="table-of-contents__link toc-highlight">两列做比较</a><li><a href=#不等于比较 class="table-of-contents__link toc-highlight">不等于比较</a><li><a href=#is-not-null class="table-of-contents__link toc-highlight">is not null</a><li><a href=#not-in和not-exists class="table-of-contents__link toc-highlight">not in和not exists</a><li><a href=#order-by导致索引失效 class="table-of-contents__link toc-highlight">order by导致索引失效</a><li><a href=#参数不同导致索引失效 class="table-of-contents__link toc-highlight">参数不同导致索引失效</a><li><a href=#其他 class="table-of-contents__link toc-highlight">其他</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>