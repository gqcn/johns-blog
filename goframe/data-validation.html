<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-hidden/GoFrame/数据校验" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Go接口校验全攻略：如何优雅地处理和验证用户输入 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/goframe/data-validation><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Go接口校验全攻略：如何优雅地处理和验证用户输入 | John's Blog"><meta data-rh=true name=description content=从Go语言基础验证到GoFrame框架的高级校验功能，全面掌握Go语言数据校验技术，提升应用的安全性与可靠性><meta data-rh=true property=og:description content=从Go语言基础验证到GoFrame框架的高级校验功能，全面掌握Go语言数据校验技术，提升应用的安全性与可靠性><meta data-rh=true name=keywords content=GoFrame,数据校验,Go验证,用户输入,接口安全,自定义规则,gvalid><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/goframe/data-validation><link data-rh=true rel=alternate href=https://johng.cn/goframe/data-validation hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/goframe/data-validation hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.1f745325.css><script src=/assets/js/runtime~main.e2648255.js defer></script><script src=/assets/js/main.e2848779.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/hidden>隐藏目录</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/hidden/goframe>GoFrame</a><button aria-label="Collapse sidebar category 'GoFrame'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/goframe/notes>Go语言实战案例文章建议</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/goframe/notes-v3>GoFrame v3开发笔记</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/goframe/relation-query-best-practice>关联表查询的最佳实践：以电商系统为例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/goframe/multi-tenant>GoFrame实现多租户隔离的最佳实践</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/goframe/data-validation>Go接口校验全攻略：如何优雅地处理和验证用户输入</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/hidden/ai-prompt-notes>AI提示工程随笔</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/hidden/goframe-v3>关于GoFrame V3版本的一些思考</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/goframe/sql-migrate-database-migration>SQL Migrate数据库迁移与版本管理：管理数据库结构变更的有效方法</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/hidden/ideas>一些想法</a><button aria-label="Expand sidebar category '一些想法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/hidden/resource-collection>资源收藏</a><button aria-label="Expand sidebar category '资源收藏'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/hidden/other>其他文档</a><button aria-label="Expand sidebar category '其他文档'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/hidden/temp>临时文档</a><button aria-label="Expand sidebar category '临时文档'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/data-structures-and-algorithms>数据结构和算法</a><button aria-label="Expand sidebar category '数据结构和算法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/hidden/goframe><span itemprop=name>GoFrame</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Go接口校验全攻略：如何优雅地处理和验证用户输入</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p>在任何应用程序开发中，数据校验都是确保程序稳定性和安全性的关键环节。尤其在Web应用和微服务架构中，正确地验证用户输入可以有效防止各类安全攻击、减少运行时错误并保持数据的完整性。本文将从原生<code>Go</code>语言的数据验证方法入手，然后深入探讨<code>GoFrame</code>框架提供的强大校验功能，帮助您在实际项目中更高效地实现数据校验。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-go语言中的数据校验基础>1. Go语言中的数据校验基础<a href=#1-go语言中的数据校验基础 class=hash-link aria-label="Direct link to 1. Go语言中的数据校验基础" title="Direct link to 1. Go语言中的数据校验基础">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=11-为什么数据校验至关重要>1.1 为什么数据校验至关重要？<a href=#11-为什么数据校验至关重要 class=hash-link aria-label="Direct link to 1.1 为什么数据校验至关重要？" title="Direct link to 1.1 为什么数据校验至关重要？">​</a></h3>
<p>在深入技术细节之前，让我们先理解数据校验的重要性：</p>
<ul>
<li><strong>防止安全漏洞</strong>：未经校验的数据可能导致SQL注入、XSS攻击、命令注入等安全问题</li>
<li><strong>确保数据完整性</strong>：错误格式的数据会破坏数据库一致性和应用状态</li>
<li><strong>提升用户体验</strong>：及时发现并提示错误输入，避免用户操作失败</li>
<li><strong>减少系统错误</strong>：预防因非法输入导致的程序崩溃和异常</li>
<li><strong>保护业务逻辑</strong>：确保业务流程按预期执行，不会因错误数据而中断或产生错误结果</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=12-原生go中的数据校验方式>1.2 原生Go中的数据校验方式<a href=#12-原生go中的数据校验方式 class=hash-link aria-label="Direct link to 1.2 原生Go中的数据校验方式" title="Direct link to 1.2 原生Go中的数据校验方式">​</a></h3>
<p>在原生<code>Go</code>中，数据校验通常是手动实现的，这需要开发者编写大量的条件判断和错误处理代码。下面是几种常见的数据校验方式：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=121-直接条件判断>1.2.1 直接条件判断<a href=#121-直接条件判断 class=hash-link aria-label="Direct link to 1.2.1 直接条件判断" title="Direct link to 1.2.1 直接条件判断">​</a></h4>
<p>最简单的数据校验就是使用<code>if</code>语句和各种运算符进行直接判断：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>validateUserInput</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">username</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> email</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> password </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> age </span><span class="token builtin" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">username</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">username</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"用户名长度必须在3-20个字符之间"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">strings</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Contains</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">email</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"@"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">strings</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Contains</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">email</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"."</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"邮箱格式不正确"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">password</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>6</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"密码长度必须大于6个字符"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>18</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> age </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>120</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"年龄必须在18-120之间"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这种方法简单直接，但随着验证规则增多，代码可能变得冗长且难以维护。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=122-使用正则表达式>1.2.2 使用正则表达式<a href=#122-使用正则表达式 class=hash-link aria-label="Direct link to 1.2.2 使用正则表达式" title="Direct link to 1.2.2 使用正则表达式">​</a></h4>
<p>对于复杂的格式验证，通常使用正则表达式：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"regexp"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>validateEmail</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">email </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    pattern </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    match</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> regexp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MatchString</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pattern</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> email</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> match</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>validatePhone</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">phone </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    pattern </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`^(1)[3-9][0-9]{9}$`</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>// 中国手机号校验示例</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    match</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> regexp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MatchString</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pattern</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> phone</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> match</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=123-自定义验证函数>1.2.3 自定义验证函数<a href=#123-自定义验证函数 class=hash-link aria-label="Direct link to 1.2.3 自定义验证函数" title="Direct link to 1.2.3 自定义验证函数">​</a></h4>
<p>为了提高代码的可读性和复用性，开发者通常会封装一系列验证函数：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>IsEmpty</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">s </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">strings</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>TrimSpace</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">s</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>IsValidUsername</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">username </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">username</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">username</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"用户名长度必须在3-20个字符之间"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 只允许字母、数字和下划线</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    pattern </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`^[a-zA-Z0-9_]+$`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    match</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> regexp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MatchString</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pattern</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> username</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">match </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"用户名只能包含字母、数字和下划线"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>IsValidPassword</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">password </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">password</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>6</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"密码长度必须大于6个字符"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查密码复杂度，要求至少包含数字和字母</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    hasNumber </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> regexp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MustCompile</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>`[0-9]`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MatchString</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">password</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    hasLetter </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> regexp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MustCompile</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>`[a-zA-Z]`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MatchString</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">password</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">hasNumber </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">hasLetter </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> errors</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"密码必须包含数字和字母"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=124-基于结构体标签的验证>1.2.4 基于结构体标签的验证<a href=#124-基于结构体标签的验证 class=hash-link aria-label="Direct link to 1.2.4 基于结构体标签的验证" title="Direct link to 1.2.4 基于结构体标签的验证">​</a></h4>
<p>随着验证需求的复杂化，开发者往往会创建自定义结构体标签系统，方便声明式地定义验证规则：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> User </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`validate:"required,min=3,max=20"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Email     </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`validate:"required,email"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`validate:"required,min=6"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Age       </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`validate:"required,min=18,max=120"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// 人工实现结构体验证逻辑</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// 这里只是简单的示例，实际实现会更复杂</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=13-第三方验证库>1.3 第三方验证库<a href=#13-第三方验证库 class=hash-link aria-label="Direct link to 1.3 第三方验证库" title="Direct link to 1.3 第三方验证库">​</a></h3>
<p>手动实现所有验证逻辑非常繁琐，因此社区已经开发了多个优秀的验证库：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=131-常用的go验证库>1.3.1 常用的Go验证库<a href=#131-常用的go验证库 class=hash-link aria-label="Direct link to 1.3.1 常用的Go验证库" title="Direct link to 1.3.1 常用的Go验证库">​</a></h4>
<ul>
<li><strong>go-playground/validator</strong>：最流行的<code>Go</code>验证库之一，支持复杂的标签式验证</li>
<li><strong>asaskevich/govalidator</strong>：提供了大量的验证函数和工具</li>
<li><strong>go-ozzo/ozzo-validation</strong>：基于函数式编程的验证库</li>
</ul>
<p>例如，使用<code>go-playground/validator</code>：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> User </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`validate:"required,min=3,max=20,alphanum"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Email     </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`validate:"required,email"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`validate:"required,min=6"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Age       </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`validate:"required,gte=18,lte=120"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">validate </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> validator</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">user </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> User</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"jd"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">           </span><span class="token comment" style=color:#8292a2;font-style:italic>// 太短，不符合min=3的要求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Email</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"invalid-email"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 不是有效的邮箱格式</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"123"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">          </span><span class="token comment" style=color:#8292a2;font-style:italic>// 太短，不符合min=6的要求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Age</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">      </span><span class="token number" style=color:#ae81ff>16</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">             </span><span class="token comment" style=color:#8292a2;font-style:italic>// 小于最小年龄要求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> validate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Struct</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 处理验证错误</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> ok </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">validator</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">InvalidValidationError</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> ok </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">validator</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidationErrors</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Printf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"字段: %s, 错误: %s, 值: %v\n"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Field</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Tag</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Value</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=14-原生go验证的局限性>1.4 原生Go验证的局限性<a href=#14-原生go验证的局限性 class=hash-link aria-label="Direct link to 1.4 原生Go验证的局限性" title="Direct link to 1.4 原生Go验证的局限性">​</a></h3>
<p>在实际的企业级应用开发中，原生<code>Go</code>或第三方验证库就像一把双刃剑 - 虽然能够解决基本需求，但随着项目复杂度增加，它们的局限性很快就会显现出来：</p>
<ol>
<li>
<p><strong>代码量大且难维护</strong>：随着验证规则增多，验证逻辑会分散在代码各处，导致维护成本飞升。在大型项目中，这种分散的验证逻辑很容易导致重复代码和不一致性。</p>
</li>
<li>
<p><strong>性能开销较大</strong>：原生验证方式往往需要多次内存分配和类型转换，在高并发场景下会增加<code>GC</code>压力和内存开销。</p>
</li>
<li>
<p><strong>错误处理机制不完善</strong>：需要手动收集、组织和格式化错误信息，导致大量模板代码和重复逻辑。当需要处理复杂的嵌套结构验证错误时，情况尤为棘手。</p>
</li>
<li>
<p><strong>难以实现业务规则集中管理</strong>：业务验证规则通常分散在代码中，难以集中管理和维护，当业务规则变更时，需要修改多处代码，容易引入错误。</p>
</li>
<li>
<p><strong>国际化支持不足</strong>：大多数验证库的错误消息国际化支持有限，需要额外的工作来实现多语言错误提示，这在国际化应用中是一个显著的障碍。</p>
</li>
<li>
<p><strong>与框架生态系统难以无缝集成</strong>：在完整的Web框架中使用时，往往需要编写大量的适配代码，难以与框架的其他组件（如中间件、ORM、路由等）无缝协作。</p>
</li>
<li>
<p><strong>协程安全性考虑不足</strong>：在高并发场景下，某些验证库可能存在协程安全问题，导致潜在的协程泄漏或数据竞争。</p>
</li>
</ol>
<p>面对这些局限性，我们需要一个更全面、更高效、更易于集成的数据校验解决方案。<code>GoFrame</code>框架的<code>gvalid</code>数据校验组件正是为解决这些问题而设计，它提供了一系列强大的功能，可以显著提高开发效率并降低维护成本。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-goframe框架的数据校验组件>2. GoFrame框架的数据校验组件<a href=#2-goframe框架的数据校验组件 class=hash-link aria-label="Direct link to 2. GoFrame框架的数据校验组件" title="Direct link to 2. GoFrame框架的数据校验组件">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=21-goframe中的数据校验组件介绍>2.1 GoFrame中的数据校验组件介绍<a href=#21-goframe中的数据校验组件介绍 class=hash-link aria-label="Direct link to 2.1 GoFrame中的数据校验组件介绍" title="Direct link to 2.1 GoFrame中的数据校验组件介绍">​</a></h3>
<p><code>GoFrame</code>框架提供了强大且易用的<code>gvalid</code>数据校验组件，它解决了传统验证方式的大多数限制，并且与<code>GoFrame</code>其他组件无缝集成。主要特点包括：</p>
<ul>
<li><strong>内置丰富校验规则</strong>：提供数十种常用验证规则。</li>
<li><strong>多种校验模式</strong>：支持单数据、多数据、Map、结构体等多种校验模式。</li>
<li><strong>自定义错误提示</strong>：可为每个校验规则定制错误消息。</li>
<li><strong>i18n国际化支持</strong>：与<code>GoFrame</code>的国际化组件集成。</li>
<li><strong>自定义校验规则</strong>：易于扩展自定义校验逻辑。</li>
<li><strong>HTTP服务自动校验</strong>：与<code>GoFrame</code> HTTP服务无缝集成。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=22-goframe校验的基本使用方法>2.2 GoFrame校验的基本使用方法<a href=#22-goframe校验的基本使用方法 class=hash-link aria-label="Direct link to 2.2 GoFrame校验的基本使用方法" title="Direct link to 2.2 GoFrame校验的基本使用方法">​</a></h3>
<p>使用<code>GoFrame</code>的<code>gvalid</code>组件进行数据校验非常简单。首先，我们先来看一个基本的校验示例：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 单个数据验证</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Validator</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Data</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"john@example"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Rules</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"required|email"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Background</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 输出: The value `john@example` is not a valid email address</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面的例子涉及了<code>gvalid</code>三个核心步骤：</p>
<ol>
<li>获取验证器实例: <code>g.Validator()</code></li>
<li>设置要验证的数据: <code>.Data("john@example")</code></li>
<li>指定验证规则: <code>.Rules("required|email")</code></li>
<li>执行验证: <code>.Run(ctx)</code></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=221-各种数据类型的验证>2.2.1 各种数据类型的验证<a href=#221-各种数据类型的验证 class=hash-link aria-label="Direct link to 2.2.1 各种数据类型的验证" title="Direct link to 2.2.1 各种数据类型的验证">​</a></h4>
<p><code>GoFrame</code>支持多种数据类型的验证，包括单个值、<code>Map</code>和结构体：</p>
<p><strong>1. 验证单个值</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 验证一个简单的值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Validator</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Data</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>16</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Rules</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"min:18|max:100"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Background</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 输出: The value `16` must be equal or greater than 18</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>2. 验证Map类型数据</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 验证map中的多个字段</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">data </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"name"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">  </span><span class="token string" style=color:#a6e22e>""</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 空值，不符合required</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"age"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">   </span><span class="token string" style=color:#a6e22e>"twenty"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>// 非数字，不符合integer</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"email"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"invalid"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 不符合email格式</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rules </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"name"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">  </span><span class="token string" style=color:#a6e22e>"required"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"age"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">   </span><span class="token string" style=color:#a6e22e>"required|integer|between:18,60"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"email"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"required|email"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Validator</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Data</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">data</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Rules</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rules</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Background</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Error</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 输出多个错误信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>3. 验证结构体</strong></p>
<p><code>GoFrame</code>最强大的特性之一是支持基于结构体标签的验证：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> User </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:5,30|passport"      dc:"用户名"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:6,30"               dc:"密码"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password2 </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:6,30|same:Password" dc:"确认密码"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Nickname  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:1,30"               dc:"昵称"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Email     </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|email"                     dc:"邮箱"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Age       </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`v:"required|integer|between:18,60"     dc:"年龄"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">user </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> User</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"john"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>// 太短，不符合length:5,30</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"123"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">   </span><span class="token comment" style=color:#8292a2;font-style:italic>// 太短，不符合length:6,30</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 其他字段</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Validator</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Data</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>Run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Background</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Error</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 输出所有字段的错误信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在上面的例子中，<code>v</code>标签用于定义验证规则，<code>dc</code>标签用于提供字段的描述信息，这在错误提示和文档生成中非常有用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=23-goframe校验规则详解>2.3 GoFrame校验规则详解<a href=#23-goframe校验规则详解 class=hash-link aria-label="Direct link to 2.3 GoFrame校验规则详解" title="Direct link to 2.3 GoFrame校验规则详解">​</a></h3>
<p><code>GoFrame</code>数据校验组件提供了丰富的内置校验规则，以下是一些常用的校验规则：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=231-基本校验规则>2.3.1 基本校验规则<a href=#231-基本校验规则 class=hash-link aria-label="Direct link to 2.3.1 基本校验规则" title="Direct link to 2.3.1 基本校验规则">​</a></h4>
<table><thead><tr><th>规则名<th>说明<th>示例<tbody><tr><td><code>required</code><td>必填项，值不能为空<td><code>v:"required"</code><tr><td><code>length</code><td>长度范围校验<td><code>v:"length:6,16"</code><tr><td><code>min-length</code><td>最小长度校验<td><code>v:"min-length:6"</code><tr><td><code>max-length</code><td>最大长度校验<td><code>v:"max-length:32"</code><tr><td><code>min</code><td>最小值校验<td><code>v:"min:18"</code><tr><td><code>max</code><td>最大值校验<td><code>v:"max:100"</code><tr><td><code>between</code><td>数值范围校验<td><code>v:"between:18,60"</code><tr><td><code>integer</code><td>整数校验<td><code>v:"integer"</code><tr><td><code>float</code><td>浮点数校验<td><code>v:"float"</code><tr><td><code>boolean</code><td>布尔值校验<td><code>v:"boolean"</code><tr><td><code>json</code><td>JSON格式校验<td><code>v:"json"</code><tr><td><code>array</code><td>数组类型校验<td><code>v:"array"</code><tr><td><code>in</code><td>枚举值范围校验<td><code>v:"in:0,1,2"</code><tr><td><code>not-in</code><td>非枚举值范围校验<td><code>v:"not-in:0,1,2"</code><tr><td><code>regex</code><td>正则表达式校验<td><code>v:"regex:[A-Za-z0-9]+"</code><tr><td><code>not-regex</code><td>正则表达式反向校验<td><code>v:"not-regex:[^\w]"</code></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=232-格式校验规则>2.3.2 格式校验规则<a href=#232-格式校验规则 class=hash-link aria-label="Direct link to 2.3.2 格式校验规则" title="Direct link to 2.3.2 格式校验规则">​</a></h4>
<table><thead><tr><th>规则名<th>说明<th>示例<tbody><tr><td><code>email</code><td>邮箱格式校验<td><code>v:"email"</code><tr><td><code>phone</code><td>手机号码校验<td><code>v:"phone"</code><tr><td><code>phone-loose</code><td>宽松手机号码校验（仅数字验证）<td><code>v:"phone-loose"</code><tr><td><code>telephone</code><td>固定电话号码校验<td><code>v:"telephone"</code><tr><td><code>passport</code><td>通用帐号校验(字母开头，只能包含字母、数字和下划线)<td><code>v:"passport"</code><tr><td><code>password</code><td>简单密码(任意可见字符，长度在6~18之间)<td><code>v:"password"</code><tr><td><code>password2</code><td>中等强度密码(在<code>password</code>基础上，必须包含大小写字母和数字)<td><code>v:"password2"</code><tr><td><code>password3</code><td>高强度密码(在<code>password2</code>基础上，必须包含特殊字符)<td><code>v:"password3"</code><tr><td><code>postcode</code><td>邮政编码校验<td><code>v:"postcode"</code><tr><td><code>resident-id</code><td>身份证号码校验<td><code>v:"resident-id"</code><tr><td><code>bank-card</code><td>银行卡号校验<td><code>v:"bank-card"</code><tr><td><code>qq</code><td>QQ号码格式校验<td><code>v:"qq"</code><tr><td><code>ip</code><td>IP地址校验(IPv4/IPv6)<td><code>v:"ip"</code><tr><td><code>ipv4</code><td>IPv4地址校验<td><code>v:"ipv4"</code><tr><td><code>ipv6</code><td>IPv6地址校验<td><code>v:"ipv6"</code><tr><td><code>mac</code><td>MAC地址校验<td><code>v:"mac"</code><tr><td><code>url</code><td>URL地址校验<td><code>v:"url"</code><tr><td><code>domain</code><td>域名格式校验<td><code>v:"domain"</code></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=233-时间日期校验规则>2.3.3 时间日期校验规则<a href=#233-时间日期校验规则 class=hash-link aria-label="Direct link to 2.3.3 时间日期校验规则" title="Direct link to 2.3.3 时间日期校验规则">​</a></h4>
<table><thead><tr><th>规则名<th>说明<th>示例<tbody><tr><td><code>date</code><td>常规日期格式校验<td><code>v:"date"</code><tr><td><code>datetime</code><td>常规日期时间格式校验<td><code>v:"datetime"</code><tr><td><code>date-format</code><td>指定格式的日期校验<td><code>v:"date-format:Y-m-d"</code><tr><td><code>before</code><td>日期早于指定日期<td><code>v:"before:2023-01-01"</code><tr><td><code>before-equal</code><td>日期早于或等于指定日期<td><code>v:"before-equal:2023-01-01"</code><tr><td><code>after</code><td>日期晚于指定日期<td><code>v:"after:2023-01-01"</code><tr><td><code>after-equal</code><td>日期晚于或等于指定日期<td><code>v:"after-equal:2023-01-01"</code></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=234-比较校验规则>2.3.4 比较校验规则<a href=#234-比较校验规则 class=hash-link aria-label="Direct link to 2.3.4 比较校验规则" title="Direct link to 2.3.4 比较校验规则">​</a></h4>
<table><thead><tr><th>规则名<th>说明<th>示例<tbody><tr><td><code>same</code><td>与指定字段值相同<td><code>v:"same:Password"</code><tr><td><code>different</code><td>与指定字段值不同<td><code>v:"different:OldPassword"</code><tr><td><code>eq</code><td>等于指定值<td><code>v:"eq:100"</code><tr><td><code>not-eq</code><td>不等于指定值<td><code>v:"not-eq:0"</code><tr><td><code>gt</code><td>大于指定值<td><code>v:"gt:0"</code><tr><td><code>gte</code><td>大于等于指定值<td><code>v:"gte:1"</code><tr><td><code>lt</code><td>小于指定值<td><code>v:"lt:100"</code><tr><td><code>lte</code><td>小于等于指定值<td><code>v:"lte:100"</code></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=235-条件校验规则>2.3.5 条件校验规则<a href=#235-条件校验规则 class=hash-link aria-label="Direct link to 2.3.5 条件校验规则" title="Direct link to 2.3.5 条件校验规则">​</a></h4>
<table><thead><tr><th>规则名<th>说明<th>示例<tbody><tr><td><code>required-if</code><td>当另一字段值为某值时必填<td><code>v:"required-if:Status,1,2"</code><tr><td><code>required-if-all</code><td>当所有指定字段都等于指定值时必填<td><code>v:"required-if-all:Status,1,Type,2"</code><tr><td><code>required-unless</code><td>除非另一字段值为某值，否则必填<td><code>v:"required-unless:Status,0"</code><tr><td><code>required-with</code><td>当任一指定字段值不为空时必填<td><code>v:"required-with:FirstName,LastName"</code><tr><td><code>required-with-all</code><td>当所有指定字段值都不为空时必填<td><code>v:"required-with-all:FirstName,LastName"</code><tr><td><code>required-without</code><td>当任一指定字段值为空时必填<td><code>v:"required-without:FirstName,LastName"</code><tr><td><code>required-without-all</code><td>当所有指定字段值都为空时必填<td><code>v:"required-without-all:FirstName,LastName"</code></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=236-修饰规则>2.3.6 修饰规则<a href=#236-修饰规则 class=hash-link aria-label="Direct link to 2.3.6 修饰规则" title="Direct link to 2.3.6 修饰规则">​</a></h4>
<p>修饰规则用于修改其他规则的行为：</p>
<table><thead><tr><th>规则名<th>说明<th>示例<tbody><tr><td><code>bail</code><td>出现失败则立即停止后续检查<td>`v:"bail<tr><td><code>ci</code><td>不区分大小写进行比较<td>`v:"ci<tr><td><code>foreach</code><td>针对数组中每一项应用后续规则<td>`v:"foreach</table>
<blockquote>
<p>更多校验规则以及完整代码使用示例请参考官网文档。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=24-自定义错误提示>2.4 自定义错误提示<a href=#24-自定义错误提示 class=hash-link aria-label="Direct link to 2.4 自定义错误提示" title="Direct link to 2.4 自定义错误提示">​</a></h3>
<p><code>gvalid</code>允许我们为校验规则自定义错误提示信息，方法非常简单，使用<code>#</code>符号分隔规则和错误信息：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ProductReq </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Name  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:2,50#商品名称不能为空|商品名称长度必须在2-50个字符之间"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Price </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`v:"required|min:1#商品价格不能为空|商品价格必须大于0"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Stock </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`v:"required|min:0#库存不能为空|库存不能小于0"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>如果有多个规则，可以为每个规则单独指定错误信息，使用<code>|</code>分隔不同规则的错误信息。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-在http服务中应用goframe数据校验>3. 在HTTP服务中应用GoFrame数据校验<a href=#3-在http服务中应用goframe数据校验 class=hash-link aria-label="Direct link to 3. 在HTTP服务中应用GoFrame数据校验" title="Direct link to 3. 在HTTP服务中应用GoFrame数据校验">​</a></h2>
<p>在<code>Web</code>应用开发中，数据校验是处理用户请求的第一道防线。
<code>GoFrame</code>框架将数据校验无缝集成到<code>HTTP</code>服务中，能够自动完成请求参数的校验。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=31-定义请求和应答结构体>3.1 定义请求和应答结构体<a href=#31-定义请求和应答结构体 class=hash-link aria-label="Direct link to 3.1 定义请求和应答结构体" title="Direct link to 3.1 定义请求和应答结构体">​</a></h3>
<p><code>GoFrame</code>遵循类似<code>Request-Response</code>模式的<code>API</code>设计风格，通过定义请求(<code>Req</code>)和应答(<code>Res</code>)结构体来规范<code>API</code>接口：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>package</span><span class="token plain"> api</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// RegisterReq 用户注册请求参数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> RegisterReq </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:5,30|passport"      dc:"用户名"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:6,30"               dc:"密码"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Password2 </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:6,30|same:Password" dc:"确认密码"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Nickname  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|length:1,30"               dc:"昵称"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Email     </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|email"                     dc:"邮箱"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Mobile    </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|phone"                     dc:"手机号"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Age       </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`v:"required|integer|between:18,60"     dc:"年龄"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Gender    </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`v:"required|in:0,1,2"                  dc:"性别(0:保密,1:男,2:女)"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// RegisterRes 用户注册返回参数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> RegisterRes </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    UserId </span><span class="token builtin" style=color:#e6db74>int64</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`json:"userId" dc:"用户ID"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=32-控制器实现>3.2 控制器实现<a href=#32-控制器实现 class=hash-link aria-label="Direct link to 3.2 控制器实现" title="Direct link to 3.2 控制器实现">​</a></h3>
<p>基于上面定义的结构体，我们可以实现对应的控制器方法：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// Register 用户注册接口</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">c </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Controller</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>Register</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> req </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RegisterReq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">res </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RegisterRes</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注意：GoFrame会自动对请求参数进行校验</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 如果校验失败，会直接返回错误，不会执行以下代码</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 业务逻辑处理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 1. 检查用户名是否已存在</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 2. 密码加密</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 3. 创建用户记录</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RegisterRes</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        UserId</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100001</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 示例返回值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=33-路由注册>3.3 路由注册<a href=#33-路由注册 class=hash-link aria-label="Direct link to 3.3 路由注册" title="Direct link to 3.3 路由注册">​</a></h3>
<p>在<code>GoFrame</code>中，我们可以使用规范路由注册方式绑定控制器：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">s</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Group</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"/api"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">group </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">ghttp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RouterGroup</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    group</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Middleware</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ghttp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MiddlewareHandlerResponse</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    group</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Bind</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        user</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 自动注册控制器中的所有公开方法</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=34-请求处理流程>3.4 请求处理流程<a href=#34-请求处理流程 class=hash-link aria-label="Direct link to 3.4 请求处理流程" title="Direct link to 3.4 请求处理流程">​</a></h3>
<p>当前端发送请求时，<code>GoFrame</code>会自动执行以下流程：</p>
<ol>
<li>解析请求参数到<code>RegisterReq</code>结构体</li>
<li>根据结构体中的<code>v</code>标签执行数据校验</li>
<li>如果校验失败，自动返回错误并中断执行</li>
<li>校验通过后，调用<code>Register</code>方法执行业务逻辑</li>
<li>将方法返回的<code>RegisterRes</code>结果转为<code>JSON</code>返回给客户端</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-高级校验技巧>4. 高级校验技巧<a href=#4-高级校验技巧 class=hash-link aria-label="Direct link to 4. 高级校验技巧" title="Direct link to 4. 高级校验技巧">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=41-按条件校验条件校验规则>4.1 按条件校验(条件校验规则)<a href=#41-按条件校验条件校验规则 class=hash-link aria-label="Direct link to 4.1 按条件校验(条件校验规则)" title="Direct link to 4.1 按条件校验(条件校验规则)">​</a></h3>
<p>在实际应用中，我们经常需要基于某些条件动态地决定是否对其他字段进行校验。
<code>GoFrame</code>提供了多种条件校验规则：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> OrderReq </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    OrderType    </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">    </span><span class="token string" style=color:#a6e22e>`v:"required|in:1,2,3"      dc:"订单类型(1:普通,2:快递,3:自提)"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Address      </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required-if:OrderType,1,2" dc:"收货地址"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    PickupPoint  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required-if:OrderType,3"   dc:"自提点"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ContactName  </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required"                  dc:"联系人"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ContactPhone </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|phone"            dc:"联系电话"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面的示例演示了以下条件校验适用场景：</p>
<ul>
<li>当<code>OrderType</code>为<code>1</code>或<code>2</code>（普通或快递）时，<code>Address</code>字段必填</li>
<li>当<code>OrderType</code>为<code>3</code>（自提）时，<code>PickupPoint</code>字段必填</li>
</ul>
<p>这种条件验证的方式在复杂表单中非常有用，可以根据用户的选择动态调整验证规则。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=42-批量数据校验>4.2 批量数据校验<a href=#42-批量数据校验 class=hash-link aria-label="Direct link to 4.2 批量数据校验" title="Direct link to 4.2 批量数据校验">​</a></h3>
<p>在处理大批量数据时，我们可能需要校验多个记录，例如导入文件或批量提交场景。</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 批量商品添加的请求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ProductBatchAddReq </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Products </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">ProductInfo </span><span class="token string" style=color:#a6e22e>`v:"required|foreach" dc:"商品列表"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ProductInfo </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Name   </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain">  </span><span class="token string" style=color:#a6e22e>`v:"required|length:2,50" dc:"商品名称"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Price  </span><span class="token builtin" style=color:#e6db74>float64</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|min:0.01"    dc:"商品价格"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Stock  </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">     </span><span class="token string" style=color:#a6e22e>`v:"required|min:0"       dc:"库存数量"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Status </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">     </span><span class="token string" style=color:#a6e22e>`v:"required|in:0,1,2"    dc:"状态(0:下架,1:上架,2:待审核)"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>使用<code>foreach</code>修饰规则，可以对数组中的每一项应用后续计划。这在需要验证复杂嵌套结构时非常有用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=43-递归校验>4.3 递归校验<a href=#43-递归校验 class=hash-link aria-label="Direct link to 4.3 递归校验" title="Direct link to 4.3 递归校验">​</a></h3>
<p>对于复杂的嵌套结构，<code>GoFrame</code>支持递归校验，可以验证深层嵌套的对象：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> AddressInfo </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Province </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required" dc:"省份"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    City     </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required" dc:"城市"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    District </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required" dc:"区县"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Detail   </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required" dc:"详细地址"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> UserProfile </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    RealName </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain">      </span><span class="token string" style=color:#a6e22e>`v:"required" dc:"真实姓名"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Age      </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain">         </span><span class="token string" style=color:#a6e22e>`v:"required|between:18,100" dc:"年龄"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Address  AddressInfo </span><span class="token string" style=color:#a6e22e>`v:"required" dc:"地址信息"`</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 嵌套结构</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>当校验<code>UserProfile</code>结构体时，<code>GoFrame</code>会自动递归地校验<code>Address</code>字段中的所有字段。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=5-自定义校验规则>5. 自定义校验规则<a href=#5-自定义校验规则 class=hash-link aria-label="Direct link to 5. 自定义校验规则" title="Direct link to 5. 自定义校验规则">​</a></h2>
<p>尽管<code>GoFrame</code>已经提供了丰富的内置校验规则，但在实际业务中，我们经常需要根据特定的业务需求自定义校验逻辑。
针对业务上频繁校验的业务场景、业务参数，非常适合抽象提取出来作为自定义校验规则来管理，简化代码维护工作量。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=51-注册全局校验规则>5.1 注册全局校验规则<a href=#51-注册全局校验规则 class=hash-link aria-label="Direct link to 5.1 注册全局校验规则" title="Direct link to 5.1 注册全局校验规则">​</a></h3>
<p>当需要在整个应用中重复使用自定义校验规则时，可以将其注册为全局规则。这通常在程序初始化时完成。</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 初始化时注册自定义校验规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>init</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册一个校验商品ID是否存在的规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    gvalid</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>RegisterRule</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"product-exists"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> ProductExistsRule</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// ProductExistsRule 自定义校验规则实现</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>ProductExistsRule</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> in gvalid</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RuleFuncInput</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 获取要校验的值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    productId </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> in</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Value</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Int64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> productId </span><span class="token operator" style=color:#66d9ef>&lt;=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> gerror</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"商品ID无效"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 查询数据库验证商品是否存在</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    exist</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"product"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Ctx</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Where</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"id"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> productId</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Exist</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> err</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">exist </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 使用自定义错误消息或默认错误消息</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> in</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Message </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>""</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> gerror</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">in</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Message</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> gerror</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Newf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"商品ID %d 不存在"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> productId</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>使用自定义规则：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 购物车添加商品请求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> CartAddReq </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ProductId </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|product-exists#商品ID不能为空|商品不存在"`</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Quantity  </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"required|min:1#数量不能为空|数量必须大于0"`</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=52-注册局部校验规则>5.2 注册局部校验规则<a href=#52-注册局部校验规则 class=hash-link aria-label="Direct link to 5.2 注册局部校验规则" title="Direct link to 5.2 注册局部校验规则">​</a></h3>
<p>如果自定义规则只在特定场景下使用，可以将其注册为局部规则，只对当前的验证器实例有效：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>validateOrderSubmit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> req </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">OrderSubmitReq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Validator</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token function" style=color:#e6db74>RuleFunc</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"product-exists"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> ProductExistsRule</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token function" style=color:#e6db74>Data</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">req</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token function" style=color:#e6db74>Run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=6-goframe数据校验的最佳实践>6. GoFrame数据校验的最佳实践<a href=#6-goframe数据校验的最佳实践 class=hash-link aria-label="Direct link to 6. GoFrame数据校验的最佳实践" title="Direct link to 6. GoFrame数据校验的最佳实践">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=61-分层校验策略>6.1 分层校验策略<a href=#61-分层校验策略 class=hash-link aria-label="Direct link to 6.1 分层校验策略" title="Direct link to 6.1 分层校验策略">​</a></h3>
<p>在实际应用中，建议采用分层校验策略，从前到后依次为：</p>
<ol>
<li><strong>前端预校验</strong>：在用户输入时的实时反馈，提升用户体验</li>
<li><strong>API边界校验</strong>：在接口层使用<code>GoFrame</code>的校验组件进行输入参数校验</li>
<li><strong>业务逻辑校验</strong>：在服务层中对复杂业务规则进行校验</li>
<li><strong>数据存储校验</strong>：利用数据库约束和触发器做最后一道防线</li>
</ol>
<p>这种分层校验策略可以提高系统的安全性和守层能力，同时点到面地提升用户体验。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=62-校验性能优化>6.2 校验性能优化<a href=#62-校验性能优化 class=hash-link aria-label="Direct link to 6.2 校验性能优化" title="Direct link to 6.2 校验性能优化">​</a></h3>
<p>当需要处理大量数据校验时，尤其是涉及数据库查询的自定义规则，可以采用以下优化策略：</p>
<ol>
<li><strong>使用<code>bail</code>修饰规则</strong>：在第一个错误出现时立即停止验证</li>
</ol>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> User </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Username </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>`v:"bail|required|length:5,30|passport"`</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 使用bail修饰符</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 其他字段...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=2>
<li><strong>缓存验证结果</strong>：对于频繁请求的数据库查询验证，可以加入缓存</li>
</ol>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>ProductExistsRule</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> in gvalid</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RuleFuncInput</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    productId </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> in</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Value</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Int64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 可以使用缓存查询</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    exist</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> g</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"product"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>Ctx</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>Cache</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">gdb</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CacheOption</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            Duration</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Minute</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>// 缓存时间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>Where</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"id"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> productId</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>Exist</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 后续处理...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li><strong>批量验证</strong>：尽量减少单条验证，使用IN查询批量验证</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=64-安全校验注意事项>6.4 安全校验注意事项<a href=#64-安全校验注意事项 class=hash-link aria-label="Direct link to 6.4 安全校验注意事项" title="Direct link to 6.4 安全校验注意事项">​</a></h3>
<p>在实现数据校验时，需要注意以下安全问题：</p>
<ol>
<li>
<p><strong>防范数据注入</strong>：始终通过参数化查询和转义处理用户输入</p>
</li>
<li>
<p><strong>防止崩溃</strong>：自定义校验规则中要注意异常处理，避免应用程序崩溃</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=65-高级集成方案>6.5 高级集成方案<a href=#65-高级集成方案 class=hash-link aria-label="Direct link to 6.5 高级集成方案" title="Direct link to 6.5 高级集成方案">​</a></h3>
<p>对于复杂验证需求，可以将GoFrame的<code>gvalid</code>与其他组件集成：</p>
<ol>
<li><strong>与ORM的集成</strong>：利用<code>gvalid</code>进行数据验证，然后使用<code>gdb</code>进行数据操作</li>
<li><strong>与缓存集成</strong>：与<code>gcache</code>集成，缓存验证结果</li>
<li><strong>与事件总线集成</strong>：结合<code>gevent</code>，在验证成功/失败时触发事件</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=7-总结>7. 总结<a href=#7-总结 class=hash-link aria-label="Direct link to 7. 总结" title="Direct link to 7. 总结">​</a></h2>
<p>本文深入探讨了Go语言数据校验的各个方面，从原生Go的基础校验方式到GoFrame框架提供的高级校验功能。我们可以看到，GoFrame的<code>gvalid</code>组件提供了丰富的内置校验规则、灵活的自定义校验机制以及与HTTP服务的无缝集成，大大简化了开发者进行数据校验的工作。</p>
<p>通过使用GoFrame的数据校验功能，我们可以：</p>
<ol>
<li><strong>建立强大的数据安全防线</strong>，防止非法和错误的输入影响系统</li>
<li><strong>提供友好的错误反馈</strong>，帮助用户快速理解和解决问题</li>
<li><strong>实现复杂的业务验证逻辑</strong>，确保只有有效的数据才能进入系统</li>
<li><strong>提高代码的可读性和可维护性</strong>，通过标签式的声明式验证规则</li>
</ol>
<p>最后，记住在实际开发中遵循数据校验的最佳实践，结合分层校验策略、性能优化和安全注意事项，打造更安全、更可靠的Go应用程序。</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/goframe/multi-tenant><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>GoFrame实现多租户隔离的最佳实践</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/hidden/ai-prompt-notes><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>AI提示工程随笔</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-go语言中的数据校验基础 class="table-of-contents__link toc-highlight">1. Go语言中的数据校验基础</a><ul><li><a href=#11-为什么数据校验至关重要 class="table-of-contents__link toc-highlight">1.1 为什么数据校验至关重要？</a><li><a href=#12-原生go中的数据校验方式 class="table-of-contents__link toc-highlight">1.2 原生Go中的数据校验方式</a><li><a href=#13-第三方验证库 class="table-of-contents__link toc-highlight">1.3 第三方验证库</a><li><a href=#14-原生go验证的局限性 class="table-of-contents__link toc-highlight">1.4 原生Go验证的局限性</a></ul><li><a href=#2-goframe框架的数据校验组件 class="table-of-contents__link toc-highlight">2. GoFrame框架的数据校验组件</a><ul><li><a href=#21-goframe中的数据校验组件介绍 class="table-of-contents__link toc-highlight">2.1 GoFrame中的数据校验组件介绍</a><li><a href=#22-goframe校验的基本使用方法 class="table-of-contents__link toc-highlight">2.2 GoFrame校验的基本使用方法</a><li><a href=#23-goframe校验规则详解 class="table-of-contents__link toc-highlight">2.3 GoFrame校验规则详解</a><li><a href=#24-自定义错误提示 class="table-of-contents__link toc-highlight">2.4 自定义错误提示</a></ul><li><a href=#3-在http服务中应用goframe数据校验 class="table-of-contents__link toc-highlight">3. 在HTTP服务中应用GoFrame数据校验</a><ul><li><a href=#31-定义请求和应答结构体 class="table-of-contents__link toc-highlight">3.1 定义请求和应答结构体</a><li><a href=#32-控制器实现 class="table-of-contents__link toc-highlight">3.2 控制器实现</a><li><a href=#33-路�由注册 class="table-of-contents__link toc-highlight">3.3 路由注册</a><li><a href=#34-请求处理流程 class="table-of-contents__link toc-highlight">3.4 请求处理流程</a></ul><li><a href=#4-高级校验技巧 class="table-of-contents__link toc-highlight">4. 高级校验技巧</a><ul><li><a href=#41-按条件校验条件校验规则 class="table-of-contents__link toc-highlight">4.1 按条件校验(条件校验规则)</a><li><a href=#42-批量数据校验 class="table-of-contents__link toc-highlight">4.2 批量数据校验</a><li><a href=#43-递归校验 class="table-of-contents__link toc-highlight">4.3 递归校验</a></ul><li><a href=#5-自定义校验规则 class="table-of-contents__link toc-highlight">5. 自定义校验规则</a><ul><li><a href=#51-注册全局校验规则 class="table-of-contents__link toc-highlight">5.1 注册全局校验规则</a><li><a href=#52-注册局部校验规则 class="table-of-contents__link toc-highlight">5.2 注册局部校验规则</a></ul><li><a href=#6-goframe数据校验的最佳实践 class="table-of-contents__link toc-highlight">6. GoFrame数据校验的最佳实践</a><ul><li><a href=#61-分层校验策略 class="table-of-contents__link toc-highlight">6.1 分层校验策略</a><li><a href=#62-校验性能优化 class="table-of-contents__link toc-highlight">6.2 校验性能优化</a><li><a href=#64-安全校验注意事项 class="table-of-contents__link toc-highlight">6.4 安全校验注意事项</a><li><a href=#65-高级集成方案 class="table-of-contents__link toc-highlight">6.5 高级集成方案</a></ul><li><a href=#7-总结 class="table-of-contents__link toc-highlight">7. 总结</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>