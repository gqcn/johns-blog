<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/日常笔记/Make 命令教程" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Make 命令教程 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/notes/make-command-tutorial><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Make 命令教程 | John's Blog"><meta data-rh=true name=description content=详细介绍Make命令的使用方法、规则和最佳实践，帮助开发者更好地理解和使用这个强大的构建工具><meta data-rh=true property=og:description content=详细介绍Make命令的使用方法、规则和最佳实践，帮助开发者更好地理解和使用这个强大的构建工具><meta data-rh=true name=keywords content=Make,构建工具,自动化构建,编译工具,开发工具,命令行工具><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/notes/make-command-tutorial><link data-rh=true rel=alternate href=https://johng.cn/notes/make-command-tutorial hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/notes/make-command-tutorial hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.b3f7724c.css><script src=/assets/js/runtime~main.be692ab6.js defer></script><script src=/assets/js/main.b75d0533.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/notes>日常笔记</a><button aria-label="Collapse sidebar category '日常笔记'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/goland-debug-issue>Goland Debug无法进入断点位置</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/linux-port-forwarding-methods>Linux端口转发的几种常用方法</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/mac-terminal-copy-paste-issue>Mac 在终端下复制粘贴出现：00~ xxx 01~ 问题的解决方案</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/jetbrains-ide-search-settings>MacOS下取消JetBrains IDE双击Shift时出现的全局搜索</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/macos-ssh-proxy-github>MacOS使用SSH代理访问GitHub</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/mac-git-completion-setup>Mac安装git completion</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/notes/make-command-tutorial>Make 命令教程</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/mysql-insert-duplicate-deadlock>MySQL 5.7 insert into on duplicate 死锁</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/vscode-image-path-setting>VSCode设置Markdown截图文件存放路径</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/github-pr-collaboration>Github PR代码多人协作</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/docusaurus-site-notes>使用Docusaurus搭建静态网站笔记</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/linux-vim-encoding-fix>解决linux下vim乱码的情况</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/golang-nested-pointer-bug>遇到一个Golang指针嵌套体复制的BUG</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/golang-copy-100gb-file-in-1-second>震惊！Golang拷贝100+GB的文件不到1秒，啥情况？</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/notes><span itemprop=name>日常笔记</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Make 命令教程</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p>代码变成可执行文件，叫做<a href=https://www.ruanyifeng.com/blog/2014/11/compiler.html target=_blank rel="noopener noreferrer">编译</a>（<code>compile</code>）；先编译这个，还是先编译那个（即编译的安排），叫做<a href=https://en.wikipedia.org/wiki/Software_build target=_blank rel="noopener noreferrer">构建</a>（<code>build</code>）。</p>
<p><a href=https://en.wikipedia.org/wiki/Make_%28software%29 target=_blank rel="noopener noreferrer">Make</a>是最常用的构建工具，诞生于1977年，主要用于C语言的项目。但是实际上 ，任何只要某个文件有变化，就要重新构建的项目，都可以用<code>Make</code>构建。</p>
<p>本文介绍Make命令的用法，从简单的讲起，不需要任何基础，只要会使用命令行，就能看懂。我的参考资料主要是<code>Isaac Schlueter</code>的<a href=https://gist.github.com/isaacs/62a2d1825d04437c6f08 target=_blank rel="noopener noreferrer">《Makefile文件教程》</a>和<a href=https://www.gnu.org/software/make/manual/make.html target=_blank rel="noopener noreferrer">《GNU Make手册》</a>。</p>
<header><h1>一、Make的概念</h1></header>
<p><code>Make</code>这个词，英语的意思是"制作"。<code>Make</code>命令直接用了这个意思，就是要做出某个文件。比如，要做出文件<code>a.txt</code>，就可以执行下面的命令。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> a.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>但是，如果你真的输入这条命令，它并不会起作用。因为<code>Make</code>命令本身并不知道，如何做出<code>a.txt</code>，需要有人告诉它，如何调用其他命令完成这个目标。</p>
<p>比如，假设文件<code>a.txt</code>依赖于<code>b.txt</code>和<code>c.txt</code>，是后面两个文件连接（<code>cat</code>命令）的产物。那么，<code>make</code>需要知道下面的规则。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">a.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> b.txt c.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cat b.txt c.txt > a.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>也就是说，<code>make a.txt</code>这条命令的背后，实际上分成两步：第一步，确认<code>b.txt</code>和<code>c.txt</code>必须已经存在，第二步使用<code>cat</code>命令 将这个两个文件合并，输出为新文件。</p>
<p>像这样的规则，都写在一个叫做<code>Makefile</code>的文件中，<code>Make</code>命令依赖这个文件进行构建。<code>Makefile</code>文件也可以写为<code>makefile</code>， 或者用命令行参数指定为其他文件名。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> rules.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 或者</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--file</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">rules.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码指定<code>make</code>命令依据<code>rules.txt</code>文件中的规则，进行构建。</p>
<p>总之，<code>make</code>只是一个根据指定的<code>Shell</code>命令进行构建的工具。它的规则很简单，你规定要构建哪个文件、它依赖哪些源文件，当那些文件有变动时，如何重新构建它。</p>
<h1>二、Makefile文件的格式</h1>
<p>构建规则都写在<code>Makefile</code>文件里面，要学会如何Make命令，就必须学会如何编写<code>Makefile</code>文件。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=21-概述>2.1 概述<a href=#21-概述 class=hash-link aria-label="Direct link to 2.1 概述" title="Direct link to 2.1 概述">​</a></h2>
<p><code>Makefile</code>文件由一系列规则（<code>rules</code>）构成。每条规则的形式如下。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">&lt;target></span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;prerequisites> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">[tab]  &lt;commands></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面第一行冒号前面的部分，叫做"<strong>目标</strong>"（<code>target</code>），冒号后面的部分叫做"<strong>前置条件</strong>"（<code>prerequisites</code>）；第二行必须由一个<code>tab</code>键起首，后面跟着"<strong>命令</strong>"（<code>commands</code>）。</p>
<p>"目标"是必需的，不可省略；"前置条件"和"命令"都是可选的，但是两者之中必须至少存在一个。</p>
<p>每条规则就明确两件事：构建目标的前置条件是什么，以及如何构建。下面就详细讲解，每条规则的这三个组成部分。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=22-目标target>2.2 目标（<code>target</code>）<a href=#22-目标target class=hash-link aria-label="Direct link to 22-目标target" title="Direct link to 22-目标target">​</a></h2>
<p>一个目标（<code>target</code>）就构成一条规则。目标通常是文件名，指明Make命令所要构建的对象，比如上文的<code>a.txt</code>。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。</p>
<p>除了文件名，目标还可以是某个操作的名字，这称为"<strong>伪目标</strong>"（<code>phony target</code>）。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">clean</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    rm *.o</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码的目标是<code>clean</code>，它不是文件名，而是一个操作的名字，属于"伪目标 "，作用是删除对象文件。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> clean</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>但是，如果当前目录中，正好有一个文件叫做<code>clean</code>，那么这个命令不会执行。因为<code>Make</code>发现<code>clean</code>文件已经存在，就认为没有必要重新构建了，就不会执行指定的<code>rm</code>命令。</p>
<p>为了避免这种情况，可以明确声明<code>clean</code>是"伪目标"，写法如下。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token builtin-target builtin" style=color:#e6db74>.PHONY</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> clean</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">clean</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    rm *.o temp</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>声明<code>clean</code>是"伪目标"之后，<code>make</code>就不会去检查是否存在一个叫做<code>clean</code>的文件，而是每次运行都执行对应的命令。像<code>.PHONY</code>这样的内置目标名还有不少，可以查看<a href=https://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets target=_blank rel="noopener noreferrer">手册</a>。</p>
<p>如果<code>Make</code>命令运行时没有指定目标，默认会执行<code>Makefile</code>文件的<strong>第一个目标</strong>。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码执行<code>Makefile</code>文件的第一个目标。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=23-前置条件prerequisites>2.3 前置条件（<code>prerequisites</code>）<a href=#23-前置条件prerequisites class=hash-link aria-label="Direct link to 23-前置条件prerequisites" title="Direct link to 23-前置条件prerequisites">​</a></h2>
<p>前置条件通常是一组文件名，之间用空格分隔。它指定了"目标"是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的last-modification时间戳比目标的时间戳新），"目标"就需要重新构建。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">result.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> source.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cp source.txt result.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码中，构建<code>result.txt</code>的前置条件是<code>source.txt</code> 。如果当前目录中，<code>source.txt</code> 已经存在，那么<code>make result.txt</code>可以正常运行，否则必须再写一条规则，来生成<code>source.txt</code>。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">source.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    echo </span><span class="token string" style=color:#a6e22e>"this is the source"</span><span class="token plain"> > source.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码中，<code>source.txt</code>后面没有前置条件，就意味着它跟其他文件都无关，只要这个文件还不存在，每次调用<code>make source.txt</code>，它都会生成。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> result.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> result.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面命令连续执行两次<code>make result.txt</code>。第一次执行会先新建<code>source.txt</code>，然后再新建<code>result.txt</code>。第二次执行，<code>Make</code>发现<code>source.txt</code>没有变动（时间戳晚于<code>result.txt</code>），就不会执行任何操作，<code>result.txt</code>也不会重新生成。</p>
<p>如果需要生成多个文件，往往采用下面的写法。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">source</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> file1 file2 file3</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码中，<code>source</code>是一个伪目标，只有三个前置文件，没有任何对应的命令。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> </span><span class="token builtin class-name" style=color:#e6db74>source</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行<code>make source</code>命令后，就会一次性生成<code>file1，file2，file3</code>三个文件。这比下面的写法要方便很多。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> file1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> file2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> file3</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=24-命令commands>2.4 命令（<code>commands</code>）<a href=#24-命令commands class=hash-link aria-label="Direct link to 24-命令commands" title="Direct link to 24-命令commands">​</a></h2>
<p>命令（<code>commands</code>）表示如何更新目标文件，由一行或多行的Shell命令组成。它是构建"目标"的具体指令，它的运行结果通常就是生成目标文件。</p>
<p>每行命令之前<strong>必须</strong>有一个<code>tab</code>键。如果想用其他键，可以用内置变量<code>.RECIPEPREFIX</code>声明。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">.RECIPEPREFIX </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">all</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">> echo Hello, world</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码用<code>.RECIPEPREFIX</code>指定，大于号（<code>></code>）替代<code>tab</code>键。所以，每一行命令的起首变成了大于号，而不是<code>tab</code>键。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>warning</div><div class=admonitionContent_BuS1><p><strong>需要注意的是，每行命令在一个单独的<code>shell</code>中执行。这些<code>Shell</code>之间没有继承关系。</strong></div></div>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">var-lost</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>export</span><span class="token plain"> foo</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">bar</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    echo </span><span class="token string" style=color:#a6e22e>"foo=[$$foo]"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码执行后（<code>make var-lost</code>），取不到<code>foo</code>的值。因为两行命令在两个不同的进程执行。一个解决办法是将两行命令写在一行，中间用分号分隔。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">var-kept</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>export</span><span class="token plain"> foo</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">bar</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> echo </span><span class="token string" style=color:#a6e22e>"foo=[$$foo]"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>另一个解决办法是在换行符前加反斜杠转义。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">var-kept</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>export</span><span class="token plain"> foo</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">bar</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    echo </span><span class="token string" style=color:#a6e22e>"foo=[$$foo]"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>最后一个方法是加上<code>.ONESHELL:</code>命令。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token builtin-target builtin" style=color:#e6db74>.ONESHELL</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">var-kept</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>export</span><span class="token plain"> foo</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">bar</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    echo </span><span class="token string" style=color:#a6e22e>"foo=[$$foo]"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h1>三、Makefile文件的语法</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=31-注释>3.1 注释<a href=#31-注释 class=hash-link aria-label="Direct link to 3.1 注释" title="Direct link to 3.1 注释">​</a></h2>
<p>井号（<code>#</code>）在<code>Makefile</code>中表示注释。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 这是注释</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">result.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> source.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 这是注释</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cp source.txt result.txt </span><span class="token comment" style=color:#8292a2;font-style:italic># 这也是注释</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=32-回声echoing>3.2 回声（<code>echoing</code>）<a href=#32-回声echoing class=hash-link aria-label="Direct link to 32-回声echoing" title="Direct link to 32-回声echoing">​</a></h2>
<p>正常情况下，<code>make</code>会打印每条命令，然后再执行，这就叫做回声（<code>echoing</code>）。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">test</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 这是测试</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行上面的规则，会得到下面的结果。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> </span><span class="token builtin class-name" style=color:#e6db74>test</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 这是测试</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在命令的前面加上<code>@</code>，就可以关闭回声。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">test</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token operator" style=color:#66d9ef>@</span><span class="token comment" style=color:#8292a2;font-style:italic># 这是测试</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>现在再执行<code>make test</code>，就不会有任何输出。</p>
<p>由于在构建过程中，需要了解当前在执行哪条命令，所以通常只在注释和纯显示的<code>echo</code>命令前面加上<code>@</code>。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">test</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token operator" style=color:#66d9ef>@</span><span class="token comment" style=color:#8292a2;font-style:italic># 这是测试</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token operator" style=color:#66d9ef>@</span><span class="token plain">echo TODO</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=33-通配符>3.3 通配符<a href=#33-通配符 class=hash-link aria-label="Direct link to 3.3 通配符" title="Direct link to 3.3 通配符">​</a></h2>
<p>通配符（<code>wildcard</code>）用来指定一组符合条件的文件名。<code>Makefile</code>的通配符与<code>Bash</code>一致，主要有星号（<code>*</code>）、问号（<code>?</code>）和 [<code>...</code>] 。比如，<code>*.o</code>表示所有后缀名为<code>o</code>的文件。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">clean</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    rm -f *.o</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=34-模式匹配>3.4 模式匹配<a href=#34-模式匹配 class=hash-link aria-label="Direct link to 3.4 模式匹配" title="Direct link to 3.4 模式匹配">​</a></h2>
<p><code>Make</code>命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是<code>%</code>。比如，假定当前目录下有<code>f1.c</code>和<code>f2.c</code> 两个源码文件，需要将它们编译为对应的对象文件。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">%.o</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> %.c</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>等同于下面的写法。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">f1.o</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> f1.c</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">f2.o</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> f2.c</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>使用匹配符<code>%</code>，可以将大量同类型的文件，只用一条规则就完成构建。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=35-变量和赋值符>3.5 变量和赋值符<a href=#35-变量和赋值符 class=hash-link aria-label="Direct link to 3.5 变量和赋值符" title="Direct link to 3.5 变量和赋值符">​</a></h2>
<p><code>Makefile</code>允许使用等号自定义变量。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">txt </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> Hello World</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">test</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token operator" style=color:#66d9ef>@</span><span class="token plain">echo </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">txt</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码中，变量<code>txt</code>等于<code>Hello World</code>。调用时，变量需要放在<code>$( )</code> 之中。</p>
<p>调用<code>Shell</code>变量，需要在美元符号前，再加一个美元符号，这是因为<code>Make</code>命令会对美元符号转义。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">test</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token operator" style=color:#66d9ef>@</span><span class="token plain">echo </span><span class="token variable" style=color:#f8f8f2>$$HOME</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>有时，变量的值可能指向另一个变量。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">v1 </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">v2</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码中，变量<code>v1</code>的值是另一个变量<code>v2</code>。这时会产生一个问题，<code>v1</code>的值到底在定义时扩展（静态扩展），还是在运行时扩展（动态扩展）？如果<code>v2</code>的值是动态的，这两种扩展方式的结果可能会差异很大。</p>
<p>为了解决类似问题，<code>Makefile</code>一共提供了四个赋值运算符 （<code>=、:=、？=、+=</code>），它们的区别请看<a href=https://stackoverflow.com/questions/448910/makefile-variable-assignment target=_blank rel="noopener noreferrer">StackOverflow</a>。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">VARIABLE </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> value</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 在执行时扩展，允许递归扩展。</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">VARIABLE </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> value</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 在定义时扩展。</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">VARIABLE </span><span class="token operator" style=color:#66d9ef>?=</span><span class="token plain"> value</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 只有在该变量为空时才设置值。</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">VARIABLE </span><span class="token operator" style=color:#66d9ef>+=</span><span class="token plain"> value</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 将值追加到变量的尾端。</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=36-内置变量implicit-variables>3.6 内置变量（<code>Implicit Variables</code>）<a href=#36-内置变量implicit-variables class=hash-link aria-label="Direct link to 36-内置变量implicit-variables" title="Direct link to 36-内置变量implicit-variables">​</a></h2>
<p>Make命令提供一系列内置变量，比如，<code>$(CC)</code> 指向当前使用的编译器，<code>$(MAKE)</code> 指向当前使用的<code>Make</code>工具。这主要是为了跨平台的兼容性，详细的内置变量清单见<a href=https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html target=_blank rel="noopener noreferrer">手册</a>。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">output</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">CC</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> -o output input.c</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=37-自动变量automatic-variables>3.7 自动变量（<code>Automatic Variables</code>）<a href=#37-自动变量automatic-variables class=hash-link aria-label="Direct link to 37-自动变量automatic-variables" title="Direct link to 37-自动变量automatic-variables">​</a></h2>
<p>Make命令还提供一些自动变量，它们的值与当前规则有关。主要有以下几个。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1>（1）<code>$@</code><a href=#1 class=hash-link aria-label="Direct link to 1" title="Direct link to 1">​</a></h3>
<p><code>$@</code>指代当前目标，就是Make命令当前构建的那个目标。比如，<code>make foo</code>的  <code>$@ </code>  就指代<code>foo</code>。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">a.txt b.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    touch </span><span class="token variable" style=color:#f8f8f2>$@</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>等同于下面的写法。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">a.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    touch a.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">b.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    touch b.txt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2>（2）<code>$&lt;</code><a href=#2 class=hash-link aria-label="Direct link to 2" title="Direct link to 2">​</a></h3>
<p><code>$&lt;</code> 指代第一个前置条件。比如，规则为<code>t: p1 p2</code>，那么<code>$&lt;</code>就指代<code>p1</code>。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">a.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> b.txt c.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cp </span><span class="token variable" style=color:#f8f8f2>$&lt;</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$@</span><span class="token plain"> </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>等同于下面的写法。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">a.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> b.txt c.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cp b.txt a.txt </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3>（3）<code>$?</code><a href=#3 class=hash-link aria-label="Direct link to 3" title="Direct link to 3">​</a></h3>
<p><code>$?</code> 指代比目标更新的所有前置条件，之间以空格分隔。比如，规则为<code>t: p1 p2</code>，其中<code>p2</code>的时间戳比<code>t</code>新，<code>$?</code>就指代<code>p2</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4>（4）<code>$^</code><a href=#4 class=hash-link aria-label="Direct link to 4" title="Direct link to 4">​</a></h3>
<p><code>$^</code> 指代所有前置条件，之间以空格分隔。比如，规则为 <code>t: p1 p2</code>，那么<code>$^</code>就指代<code>p1 p2</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5>（5）<code>$*</code><a href=#5 class=hash-link aria-label="Direct link to 5" title="Direct link to 5">​</a></h3>
<p><code>$*</code>指代匹配符<code>%</code>匹配的部分， 比如<code>%</code>匹配<code>f1.txt</code>中的<code>f1</code>，<code>$*</code>就表示<code>f1</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=6d和f>（6）<code>$(@D)</code>和<code>$(@F)</code><a href=#6d和f class=hash-link aria-label="Direct link to 6d和f" title="Direct link to 6d和f">​</a></h3>
<p><code>$(@D)</code> 和<code>$(@F)</code> 分别指向  <code>$@</code>  的目录名和文件名。比如，<code>$@</code>是<code>src/input.c</code>，那么<code>$(@D)</code>的值为<code>src</code>，<code>$(@F)</code>的值为<code>input.c</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=7d-和f>（7）<code>$(&lt;D)</code> 和<code>$(&lt;F)</code><a href=#7d-和f class=hash-link aria-label="Direct link to 7d-和f" title="Direct link to 7d-和f">​</a></h3>
<p><code>$(&lt;D)</code> 和<code>$(&lt;F)</code> 分别指向<code>$&lt;</code>的目录名和文件名。</p>
<p>所有的自动变量清单，请看<a href=https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html target=_blank rel="noopener noreferrer">手册</a>。下面是自动变量的一个例子。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">dest/%.txt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> src/%.txt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token operator" style=color:#66d9ef>@</span><span class="token plain">[ -d dest ] </span><span class="token operator" style=color:#66d9ef>|</span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> mkdir dest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cp </span><span class="token variable" style=color:#f8f8f2>$&lt;</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$@</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码将<code>src</code>目录下的<code>txt</code>文件，拷贝到<code>dest</code>目录下。首先判断<code>dest</code>目录是否存在，如果不存在就新建，然后，<code>$&lt;</code>指代前置文件（<code>src/%.txt</code>），  <code>$@</code>  指代目标文件（<code>dest/%.txt</code>）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=38-判断和循环>3.8 判断和循环<a href=#38-判断和循环 class=hash-link aria-label="Direct link to 3.8 判断和循环" title="Direct link to 3.8 判断和循环">​</a></h2>
<p><code>Makefile</code>使用<code>Bash</code>语法，完成判断和循环。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>ifeq</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">CC</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">,gcc</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  libs</span><span class="token operator" style=color:#66d9ef>=</span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">libs_for_gcc</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  libs</span><span class="token operator" style=color:#66d9ef>=</span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">normal_libs</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>endif</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码判断当前编译器是否<code>gcc</code>，然后指定不同的库文件。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">LIST </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> one two three</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">all</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    for i in </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">LIST</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> do \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        echo </span><span class="token variable" style=color:#f8f8f2>$$i;</span><span class="token plain"> \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    done</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 等同于</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">all</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    for i in one two three</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> do \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        echo </span><span class="token variable" style=color:#f8f8f2>$i;</span><span class="token plain"> \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    done</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码的运行结果。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">one</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">two</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">three</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=39-函数>3.9 函数<a href=#39-函数 class=hash-link aria-label="Direct link to 3.9 函数" title="Direct link to 3.9 函数">​</a></h2>
<p><code>Makefile</code>还可以使用函数，格式如下。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token variable" style=color:#f8f8f2>$(</span><span class="token variable keyword" style=color:#66d9ef>function</span><span class="token variable" style=color:#f8f8f2> arguments</span><span class="token variable" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 或者</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token variable" style=color:#f8f8f2>${function arguments}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>Makefile</code>提供了许多<a href=https://www.gnu.org/software/make/manual/html_node/Functions.html target=_blank rel="noopener noreferrer">内置函数</a>，可供调用。下面是几个常用的内置函数。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1shell函数>（1）<code>shell</code>函数<a href=#1shell函数 class=hash-link aria-label="Direct link to 1shell函数" title="Direct link to 1shell函数">​</a></h3>
<p><code>shell</code>函数用来执行<code>shell</code>命令</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">srcfiles </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token function" style=color:#e6db74>shell</span><span class="token plain"> echo src/</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">00..99</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">.txt</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2wildcard函数>（2）<code>wildcard</code>函数<a href=#2wildcard函数 class=hash-link aria-label="Direct link to 2wildcard函数" title="Direct link to 2wildcard函数">​</a></h3>
<p><code>wildcard</code>函数用来在<code>Makefile</code>中，替换<code>Bash</code>的通配符。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">srcfiles </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token function" style=color:#e6db74>wildcard</span><span class="token plain"> src/*.txt</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3subst函数>（3）<code>subst</code>函数<a href=#3subst函数 class=hash-link aria-label="Direct link to 3subst函数" title="Direct link to 3subst函数">​</a></h3>
<p><code>subst</code>函数用来文本替换，格式如下。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token variable" style=color:#f8f8f2>$(</span><span class="token variable" style=color:#f8f8f2>subst from,to,text</span><span class="token variable" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>下面的例子将字符串"<code>feet on the street</code>"替换成"<code>fEEt on the strEEt</code>"。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token variable" style=color:#f8f8f2>$(</span><span class="token variable" style=color:#f8f8f2>subst ee,EE,feet on the street</span><span class="token variable" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>下面是一个稍微复杂的例子。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">comma</span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">empty</span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># space变量用两个空变量作为标识符，当中是一个空格</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">space</span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">empty</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">empty</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">foo</span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> a b c</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">bar</span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token function" style=color:#e6db74>subst</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">space</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">,</span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">comma</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">,</span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">foo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># bar is now `a,b,c'.</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4patsubst函数>（4）<code>patsubst</code>函数<a href=#4patsubst函数 class=hash-link aria-label="Direct link to 4patsubst函数" title="Direct link to 4patsubst函数">​</a></h3>
<p><code>patsubst</code>函数用于模式匹配的替换，格式如下。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token variable" style=color:#f8f8f2>$(</span><span class="token variable" style=color:#f8f8f2>patsubst pattern,replacement,text</span><span class="token variable" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>下面的例子将文件名"<code>x.c.c bar.c</code>"，替换成"<code>x.c.o bar.o</code>"。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token variable" style=color:#f8f8f2>$(</span><span class="token variable" style=color:#f8f8f2>patsubst %.c,%.o,x.c.c bar.c</span><span class="token variable" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5替换后缀名>（5）替换后缀名<a href=#5替换后缀名 class=hash-link aria-label="Direct link to （5）替换后缀名" title="Direct link to （5）替换后缀名">​</a></h3>
<p>替换后缀名函数的写法是：变量名 + 冒号 + 后缀名替换规则。它实际上<code>patsubst</code>函数的一种简写形式。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">min</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token variable" style=color:#f8f8f2>$</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">OUTPUT</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">.js</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">.min.js</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码的意思是，将变量<code>OUTPUT</code>中的后缀名<code>.js</code>全部替换成<code>.min.js</code>。</p>
<h1>四、Makefile 的实例</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1执行多个目标>（1）执行多个目标<a href=#1执行多个目标 class=hash-link aria-label="Direct link to （1）执行多个目标" title="Direct link to （1）执行多个目标">​</a></h2>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token builtin-target builtin" style=color:#e6db74>.PHONY</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cleanall cleanobj cleandiff</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">cleanall</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cleanobj cleandiff</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    rm program</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">cleanobj</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    rm *.o</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">cleandiff</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    rm *.diff</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上面代码可以调用不同目标，删除不同后缀名的文件，也可以调用一个目标（<code>cleanall</code>），删除所有指定类型的文件。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2编译c语言项目>（2）编译C语言项目<a href=#2编译c语言项目 class=hash-link aria-label="Direct link to （2）编译C语言项目" title="Direct link to （2）编译C语言项目">​</a></h2>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token target symbol">edit</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main.o kbd.o command.o display.o </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cc -o edit main.o kbd.o command.o display.o</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">main.o</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main.c defs.h</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cc -c main.c</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">kbd.o</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kbd.c defs.h command.h</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cc -c kbd.c</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">command.o</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> command.c defs.h command.h</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cc -c command.c</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">display.o</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> display.c defs.h</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cc -c display.c</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token target symbol">clean</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">     rm edit main.o kbd.o command.o display.o</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token builtin-target builtin" style=color:#e6db74>.PHONY</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> edit clean</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h1>五、参考资料</h1>
<ul>
<li><a href=http://www.ruanyifeng.com/blog/2015/02/make.html target=_blank rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2015/02/make.html</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/notes/mac-git-completion-setup><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Mac安装git completion</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/notes/mysql-insert-duplicate-deadlock><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>MySQL 5.7 insert into on duplicate 死锁</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#21-概述 class="table-of-contents__link toc-highlight">2.1 概述</a><li><a href=#22-目标target class="table-of-contents__link toc-highlight">2.2 目标（<code>target</code>）</a><li><a href=#23-前置条件prerequisites class="table-of-contents__link toc-highlight">2.3 前置条件（<code>prerequisites</code>）</a><li><a href=#24-命令commands class="table-of-contents__link toc-highlight">2.4 命令（<code>commands</code>）</a><li><a href=#31-注释 class="table-of-contents__link toc-highlight">3.1 注释</a><li><a href=#32-回声echoing class="table-of-contents__link toc-highlight">3.2 回声（<code>echoing</code>）</a><li><a href=#33-通配符 class="table-of-contents__link toc-highlight">3.3 通配符</a><li><a href=#34-模式匹配 class="table-of-contents__link toc-highlight">3.4 模式匹配</a><li><a href=#35-变量和赋值符 class="table-of-contents__link toc-highlight">3.5 变量和赋值符</a><li><a href=#36-内置变量implicit-variables class="table-of-contents__link toc-highlight">3.6 内置变量（<code>Implicit Variables</code>）</a><li><a href=#37-自动变量automatic-variables class="table-of-contents__link toc-highlight">3.7 自动变量（<code>Automatic Variables</code>）</a><ul><li><a href=#1 class="table-of-contents__link toc-highlight">（1）<code>$@</code></a><li><a href=#2 class="table-of-contents__link toc-highlight">（2）<code>$&lt;</code></a><li><a href=#3 class="table-of-contents__link toc-highlight">（3）<code>$?</code></a><li><a href=#4 class="table-of-contents__link toc-highlight">（4）<code>$^</code></a><li><a href=#5 class="table-of-contents__link toc-highlight">（5）<code>$*</code></a><li><a href=#6d和f class="table-of-contents__link toc-highlight">（6）<code>$(@D)</code>和<code>$(@F)</code></a><li><a href=#7d-和f class="table-of-contents__link toc-highlight">（7）<code>$(&lt;D)</code> 和<code>$(&lt;F)</code></a></ul><li><a href=#38-判断和循环 class="table-of-contents__link toc-highlight">3.8 判断和循环</a><li><a href=#39-函数 class="table-of-contents__link toc-highlight">3.9 函数</a><ul><li><a href=#1shell函数 class="table-of-contents__link toc-highlight">（1）<code>shell</code>函数</a><li><a href=#2wildcard函数 class="table-of-contents__link toc-highlight">（2）<code>wildcard</code>函数</a><li><a href=#3subst函数 class="table-of-contents__link toc-highlight">（3）<code>subst</code>函数</a><li><a href=#4patsubst函数 class="table-of-contents__link toc-highlight">（4）<code>patsubst</code>函数</a><li><a href=#5替换后缀名 class="table-of-contents__link toc-highlight">（5）替换后缀名</a></ul><li><a href=#1执行多个目标 class="table-of-contents__link toc-highlight">（1）执行多个目标</a><li><a href=#2编译c语言项目 class="table-of-contents__link toc-highlight">（2）编译C语言项目</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>