<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano Queue&Job&Pod资源抢占设计" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano Queue&Job&Pod资源抢占设计 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-queue-job-pod-preemption><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano Queue&Job&Pod资源抢占设计 | John's Blog"><meta data-rh=true name=description content=本文详细介绍了Volcano调度系统中Queue、Job和Pod三个层级的资源抢占设计与实现原理，以及它们之间的优先级关系和抢占机制。><meta data-rh=true property=og:description content=本文详细介绍了Volcano调度系统中Queue、Job和Pod三个层级的资源抢占设计与实现原理，以及它们之间的优先级关系和抢占机制。><meta data-rh=true name=keywords content=Volcano,资源抢占,优先级,Queue,Job,Pod,PriorityClass,Kubernetes,调度器,云原生><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-queue-job-pod-preemption><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-queue-job-pod-preemption hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-queue-job-pod-preemption hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.208c11f9.css><script src=/assets/js/runtime~main.2488ebd0.js defer></script><script src=/assets/js/main.966ab8cd.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-introduction>Volcano介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano注解详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job>Volcano Queue&Job详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-queue-job-pod-preemption>Volcano Queue&Job&Pod资源抢占设计</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-actions-plugins>Volcano Actions&Plugins详解</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/docker-containerd-commands>Docker和Containerd常用命令对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-kind>使用Kubernetes Kind搭建本地测试集群</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernettes-kind-mock-ai-test-cluster>使用Kubernetes Kind模拟AI算力测试集群</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano Queue&Job&Pod资源抢占设计</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-资源抢占的背景和用途>1. 资源抢占的背景和用途<a href=#1-资源抢占的背景和用途 class=hash-link aria-label="Direct link to 1. 资源抢占的背景和用途" title="Direct link to 1. 资源抢占的背景和用途">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=11-什么是资源抢占>1.1 什么是资源抢占<a href=#11-什么是资源抢占 class=hash-link aria-label="Direct link to 1.1 什么是资源抢占" title="Direct link to 1.1 什么是资源抢占">​</a></h3>
<p>在<code>Kubernetes</code>集群中，资源抢占(<code>Preemption</code>)是指当高优先级的工作负载需要资源但集群资源不足时，调度系统会终止低优先级的工作负载以释放资源，从而确保高优先级工作负载能够正常运行的机制。</p>
<p>资源抢占是解决资源竞争问题的关键技术，特别是在以下场景中尤为重要：</p>
<ul>
<li><strong>资源紧张环境</strong>：在计算资源有限的集群中，需要确保关键业务获得足够资源</li>
<li><strong>混合负载场景</strong>：同一集群中同时运行<strong>在线服务</strong>和<strong>批处理作业</strong>时，需要保证在线服务的资源优先级</li>
<li><strong>弹性计算</strong>：在需求波动较大的环境中，通过优先级机制实现资源的动态分配</li>
<li><strong>多租户环境</strong>：在多用户共享集群的情况下，通过优先级和抢占机制实现资源隔离和公平分配</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=12-kubernetes原生抢占机制的局限性>1.2 Kubernetes原生抢占机制的局限性<a href=#12-kubernetes原生抢占机制的局限性 class=hash-link aria-label="Direct link to 1.2 Kubernetes原生抢占机制的局限性" title="Direct link to 1.2 Kubernetes原生抢占机制的局限性">​</a></h3>
<p><code>Kubernetes</code>原生的抢占机制主要基于<code>Pod</code>级别的<code>PriorityClass</code>实现，虽然提供了基本的资源抢占能力，但在复杂的高性能计算和<code>AI/ML</code>工作负载场景中存在以下局限性：</p>
<ol>
<li>
<p><strong>层级抢占机制不完善</strong>：</p>
<ul>
<li>虽然原生的<code>Job</code>可以通过<code>PriorityClass</code>设置优先级，但缺乏队列级别的资源管理</li>
<li>无法实现多层级、多维度的资源抢占策略</li>
</ul>
</li>
<li>
<p><strong>缺乏作业感知</strong>：</p>
<ul>
<li>无法识别同一作业中不同<code>Pod</code>之间的关联关系</li>
<li>在资源紧张时，可能导致需要同时运行的<code>Pod</code>无法同时获得资源（资源死锁，缺乏<code>Gang</code>调度）</li>
<li>造成资源碎片化，降低资源利用效率</li>
</ul>
</li>
<li>
<p><strong>抢占策略单一</strong>：</p>
<ul>
<li>仅支持基于优先级的简单抢占</li>
<li>无法根据不同场景和业务需求定制复杂的抢占策略</li>
</ul>
</li>
<li>
<p><strong>多租户支持有限</strong>：</p>
<ul>
<li>缺乏队列级资源保障和隔离机制</li>
<li>难以为不同部门或团队提供差异化的资源配额和服务质量保障</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=13-volcano抢占机制的优势>1.3 Volcano抢占机制的优势<a href=#13-volcano抢占机制的优势 class=hash-link aria-label="Direct link to 1.3 Volcano抢占机制的优势" title="Direct link to 1.3 Volcano抢占机制的优势">​</a></h3>
<p><code>Volcano</code>作为一个面向高性能计算和<code>AI/ML</code>工作负载的调度系统，提供了更加完善的资源抢占机制：</p>
<ol>
<li><strong>多层级抢占</strong>：支持<code>Queue</code>(队列)、<code>Job</code>(作业)和<code>Pod</code>(容器组)三个层级的资源抢占</li>
<li><strong>作业感知</strong>：理解批处理作业的特性，支持<code>Gang</code>调度等高级特性</li>
<li><strong>丰富的抢占策略</strong>：提供多种可配置的抢占策略，满足不同场景需求</li>
<li><strong>队列级资源管理</strong>：支持队列级别的资源分配和抢占，适合多租户环境</li>
<li><strong>公平性保障</strong>：通过<code>DRF</code>(主导资源公平)算法等机制，确保资源分配的公平性</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-volcano资源抢占的设计与实现>2. Volcano资源抢占的设计与实现<a href=#2-volcano资源抢占的设计与实现 class=hash-link aria-label="Direct link to 2. Volcano资源抢占的设计与实现" title="Direct link to 2. Volcano资源抢占的设计与实现">​</a></h2>
<p><code>Volcano</code>的资源抢占机制设计为三个层级：<code>Queue</code>(队列)、<code>Job</code>(作业)和<code>Pod</code>(容器组)，形成了一个层级分明的抢占体系。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=21-queue级别抢占>2.1 Queue级别抢占<a href=#21-queue级别抢占 class=hash-link aria-label="Direct link to 2.1 Queue级别抢占" title="Direct link to 2.1 Queue级别抢占">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=211-设计原理>2.1.1 设计原理<a href=#211-设计原理 class=hash-link aria-label="Direct link to 2.1.1 设计原理" title="Direct link to 2.1.1 设计原理">​</a></h4>
<p><code>Queue</code>是<code>Volcano</code>中最高层级的资源管理单位，比如在业务上可以代表一个租户或一个业务线。<code>Queue</code>级别的抢占主要基于以下原则：</p>
<ol>
<li><strong>优先级机制</strong>：每个<code>Queue</code>可以设置优先级(<code>priority</code>)，高优先级<code>Queue</code>可以抢占低优先级<code>Queue</code>的资源。</li>
<li><strong>资源配额</strong>：<code>Queue</code>可以设置最小保障资源(<code>guarantee</code>)和最大资源上限(<code>capacity</code>)</li>
<li><strong>权重分配</strong>：当多个<code>Queue</code>优先级相同时，可以通过权重(<code>weight</code>)决定资源分配比例和抢占顺序</li>
</ol>
<p>注意事项：</p>
<ul>
<li><code>Queue</code>级别的抢占机制从<code>Volcano v1.10.0</code>版本开始支持。</li>
<li><code>Queue</code>并不支持<code>PriorityClass</code>，而是通过<code>priority</code>属性来设置优先级。</li>
<li>低优先级的<code>Queue</code>如果显式设置了<code>reclaimable: false</code>，那么该<code>Queue</code>不能被高优先级<code>Queue</code>抢占(<code>reclaimable</code>默认值为<code>true</code>)。</li>
<li>不同资源管理插件(<code>proportion</code>和<code>capacity</code>)会影响资源的分配和抢占：<!-- -->
<ul>
<li><code>proportion</code>插件会根据<code>Queue</code>的<code>weight</code>属性决定资源分配比例和抢占顺序。每个队列的<code>deserved</code>资源 = 剩余资源 × (队列<code>weight</code> / 总<code>weight</code>)</li>
<li><code>capacity</code>插件会根据<code>Queue</code>的<code>deserved</code>属性决定资源分配比例和抢占顺序。当<code>priority</code>相同时，按照<code>allocated/deserved</code>的比率排序。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=212-实现方式>2.1.2 实现方式<a href=#212-实现方式 class=hash-link aria-label="Direct link to 2.1.2 实现方式" title="Direct link to 2.1.2 实现方式">​</a></h4>
<p><code>Volcano</code>主要通过以下核心组件实现<code>Queue</code>级别的资源抢占：</p>
<ol>
<li>
<p><strong><code>reclaim action</code></strong>：资源回收动作，是实现不同队列间资源抢占的核心机制</p>
</li>
<li>
<p><strong>队列<code>priority</code>属性</strong>：在<code>Queue</code>定义中设置的优先级值，决定了队列间的抢占顺序</p>
<p>下面是<code>Volcano</code>调度器的配置示例，展示了资源抢占相关的动作：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler-configmap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">config</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    # 调度器执行的动作序列，包含资源回收和抢占动作</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue, allocate, preempt, reclaim, backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    # 其他插件配置...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述配置中，资源抢占相关的核心动作是<code>reclaim</code>。使用示例如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 100Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 允许其他Queue抢占此Queue的资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列优先级，值越大优先级越高</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=22-job级别抢占>2.2 Job级别抢占<a href=#22-job级别抢占 class=hash-link aria-label="Direct link to 2.2 Job级别抢占" title="Direct link to 2.2 Job级别抢占">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=221-设计原理>2.2.1 设计原理<a href=#221-设计原理 class=hash-link aria-label="Direct link to 2.2.1 设计原理" title="Direct link to 2.2.1 设计原理">​</a></h4>
<p><code>Job</code>代表一个完整的工作单元，如一个<code>AI</code>训练任务或批处理作业。<code>Job</code>级别的抢占主要基于以下原则：</p>
<ol>
<li>
<p><strong>优先级机制</strong>：</p>
<ul>
<li><code>Job</code>通过<code>priorityClassName</code>字段关联到<code>Kubernetes</code>的<code>PriorityClass</code>资源</li>
<li>高优先级<code>Job</code>可以抢占同一<code>Queue</code>中低优先级<code>Job</code>的资源</li>
<li><code>Job</code>的优先级会传递给其创建的所有<code>Pod</code>，除非<code>Pod</code>模板中明确指定了不同的<code>priorityClassName</code></li>
</ul>
</li>
<li>
<p><strong>最小资源保障</strong>：</p>
<ul>
<li><code>Job</code>可以设置<code>minResources</code>确保获得最小资源保障</li>
<li>结合<code>minAvailable</code>参数确保关键任务的资源需求</li>
</ul>
</li>
<li>
<p><strong>Gang调度</strong>：</p>
<ul>
<li>支持<code>All-or-Nothing</code>的调度模式</li>
<li>确保作业所有关键任务同时调度，避免资源碎片化</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=222-实现方式>2.2.2 实现方式<a href=#222-实现方式 class=hash-link aria-label="Direct link to 2.2.2 实现方式" title="Direct link to 2.2.2 实现方式">​</a></h4>
<p><code>Volcano</code>主要通过以下核心组件实现<code>Job</code>级别的抢占：</p>
<ol>
<li>
<p><strong><code>preempt action</code></strong>：资源抢占动作，是实现同一队列内不同作业间资源抢占的核心机制</p>
</li>
<li>
<p><strong><code>priorityClassName</code></strong>：与<code>Job</code>关联的优先级类，决定了作业间的抢占顺序</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 关联PriorityClass设置作业优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> research                   </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定所属队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> training</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">image</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=23-pod级别抢占>2.3 Pod级别抢占<a href=#23-pod级别抢占 class=hash-link aria-label="Direct link to 2.3 Pod级别抢占" title="Direct link to 2.3 Pod级别抢占">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=231-设计原理>2.3.1 设计原理<a href=#231-设计原理 class=hash-link aria-label="Direct link to 2.3.1 设计原理" title="Direct link to 2.3.1 设计��原理">​</a></h4>
<p><code>Pod</code>是<code>Kubernetes</code>中最小的调度单位，也是<code>Volcano</code>调度的基本单位。<code>Pod</code>级别的抢占主要基于以下原则：</p>
<ol>
<li><strong>优先级机制</strong>：<code>Pod</code>可以通过<code>PriorityClass</code>或<code>task-priority</code>注解设置优先级</li>
<li><strong>可抢占性</strong>：<code>Pod</code>可以通过<code>volcano.sh/preemptable</code>注解标记是否可被抢占</li>
<li><strong>资源需求</strong>：<code>Pod</code>的资源请求(<code>requests</code>)决定了需要多少资源</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=232-实现方式>2.3.2 实现方式<a href=#232-实现方式 class=hash-link aria-label="Direct link to 2.3.2 实现方式" title="Direct link to 2.3.2 实现方式">​</a></h4>
<p><code>Volcano</code>主要通过以下核心组件实现<code>Pod</code>级别的抢占：</p>
<ol>
<li>
<p><strong><code>priorityClassName</code>属性</strong>：当<code>Pod</code>使用<code>Volcano</code>调度器时，<code>priorityClassName</code>的优先级影响范围取决于<code>Pod</code>所属的<code>Job</code>和<code>Queue</code>：</p>
<ul>
<li>如果<code>Pod</code>属于某个<code>Volcano Job</code>，其<code>priorityClassName</code>优先级仅在同一个<code>Queue</code>内的不同<code>Job</code>之间生效。</li>
<li>如果<code>Pod</code>不属于任何<code>Volcano Job</code>，其<code>priorityClassName</code>优先级在整个集群范围内生效（不管该<code>Pod</code>是否属于某个<code>Queue</code>）。</li>
<li>优先级值越大，<code>Pod</code>的优先级越高，在资源竞争时优先获得资源。</li>
</ul>
</li>
<li>
<p><strong><code>volcano.sh/task-priority</code>注解</strong>：设置同一<code>Job</code>内不同<code>Pod</code>的优先级，是实现<code>Pod</code>间抢占的核心</p>
</li>
<li>
<p><strong><code>volcano.sh/preemptable</code>注解</strong>：标记<code>Pod</code>是否可被抢占，控制<code>Pod</code>的可抢占性，即便<code>Pod</code>的<code>priorityClassName</code>优先级较低，只要没有设置<code>volcano.sh/preemptable</code>注解为<code>true</code>，就不能被高优先级的<code>Pod</code>抢占。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/task-priority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"10"</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 设置Pod在Job内的优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 标记Pod可被抢占</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority       </span><span class="token comment" style=color:#8292a2;font-style:italic># 设置Pod的全局优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano                 </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用Volcano调度器</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-资源抢占的层级关系>3. 资源抢占的层级关系<a href=#3-资源抢占的层级关系 class=hash-link aria-label="Direct link to 3. 资源抢占的层级关系" title="Direct link to 3. 资源抢占的层级关系">​</a></h2>
<p>在<code>Volcano</code>的抢占体系中，<code>Queue</code>、<code>Job</code>和<code>Pod</code>三个层级之间存在明确的优先级关系，形成了一个层级化的抢占机制。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=31-queue与queue之间的抢占>3.1 <code>Queue</code>与<code>Queue</code>之间的抢占<a href=#31-queue与queue之间的抢占 class=hash-link aria-label="Direct link to 31-queue与queue之间的抢占" title="Direct link to 31-queue与queue之间的抢占">​</a></h3>
<p>当集群资源紧张时，<code>Queue</code>之间的抢占遵循以下规则：</p>
<ol>
<li><strong>优先级决定性</strong>：高优先级<code>Queue</code>可以抢占低优先级<code>Queue</code>的资源(<code>priority</code>属性)</li>
<li><strong>权重影响</strong>：当优先级相同时，权重(<code>weight</code>属性)较高的<code>Queue</code>可以获得更多资源</li>
<li><strong>最小保障</strong>：每个<code>Queue</code>的<code>guarantee</code>资源是受保护的，不会被抢占</li>
<li><strong>资源回收</strong>：当高优先级<code>Queue</code>不需要资源时，被抢占的<code>Queue</code>可以重新获得资源</li>
<li><strong>可回收标识</strong>：设置了<code>reclaimable: true</code>或者没有设置<code>reclaimable</code>属性（默认值为<code>true</code>）的<code>Queue</code>才能被高优先级<code>Queue</code>抢占资源。如果<code>Queue</code>的<code>reclaimable</code>属性设置为<code>false</code>，即使其优先级较低，也不会被高优先级<code>Queue</code>抢占资源。</li>
</ol>
<p>抢占过程：</p>
<ol>
<li><code>Volcano</code>调度器检测到高优先级<code>Queue</code>资源不足</li>
<li>根据优先级和权重策略选择低优先级的<code>Queue</code></li>
<li>检查低优先级<code>Queue</code>的<code>reclaimable</code>属性，只有设置为<code>true</code>的<code>Queue</code>才能被抢占</li>
<li>从可抢占的低优先级<code>Queue</code>中选择可抢占的<code>Job</code>和<code>Pod</code></li>
<li>驱逐选中的<code>Pod</code>，释放资源给高优先级<code>Queue</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=32-job与job之间的抢占>3.2 <code>Job</code>与<code>Job</code>之间的抢占<a href=#32-job与job之间的抢占 class=hash-link aria-label="Direct link to 32-job与job之间的抢占" title="Direct link to 32-job与job之间的抢占">​</a></h3>
<p>在同一<code>Queue</code>内，<code>Job</code>之间的抢占遵循以下规则：</p>
<ol>
<li><strong>优先级决定性</strong>：高优先级<code>Job</code>可以抢占低优先级<code>Job</code>的资源</li>
<li><strong>创建时间</strong>：当优先级相同时，通常先创建的<code>Job</code>优先级更高</li>
<li><strong>最小资源</strong>：每个<code>Job</code>的<code>minAvailable</code>资源需求会影响抢占决策</li>
<li><strong>Gang调度</strong>：支持<code>All-or-Nothing</code>的调度模式，确保作业完整性</li>
</ol>
<p>抢占过程：</p>
<ol>
<li><code>Volcano</code>检测到高优先级<code>Job</code>资源不足</li>
<li>根据<code>PriorityClass</code>和创建时间选择同一<code>Queue</code>中优先级较低的<code>Job</code></li>
<li>从低优先级<code>Job</code>中选择可抢占的<code>Pod</code></li>
<li>驱逐选中的<code>Pod</code>，释放资源给高优先级<code>Job</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=33-pod与pod之间的抢占>3.3 <code>Pod</code>与<code>Pod</code>之间的抢占<a href=#33-pod与pod之间的抢占 class=hash-link aria-label="Direct link to 33-pod与pod之间的抢占" title="Direct link to 33-pod与pod之间的抢占">​</a></h3>
<p>在同一<code>Job</code>内，<code>Pod</code>之间的抢占遵循以下规则：</p>
<ol>
<li><strong>task-priority决定性</strong>：高<code>task-priority</code>的<code>Pod</code>可以抢占低<code>task-priority</code>的<code>Pod</code></li>
<li><strong>可抢占性</strong>：只有标记为可抢占(<code>volcano.sh/preemptable: "true"</code>注解)的<code>Pod</code>才能被抢占</li>
<li><strong>BestEffort限制</strong>：<code>BestEffort Pod</code>不能抢占非<code>BestEffort Pod</code>（<code>BestEffort Pod</code>是没有明确设置资源请求<code>requests</code>和限制<code>limits</code>的<code>Pod</code>，在资源紧张时是最先被终止的）。</li>
<li><strong>状态限制</strong>：只有处于<code>Running</code>状态的<code>Pod</code>才能被抢占</li>
</ol>
<p>抢占过程：</p>
<ol>
<li><code>Volcano</code>检测到高优先级<code>Pod</code>无法调度</li>
<li>根据任务优先级找到同一<code>Job</code>中优先级较低的<code>Pod</code></li>
<li>检查<code>Pod</code>的可抢占性和其他约束条件</li>
<li>驱逐选中的<code>Pod</code>，释放资源给高优先级<code>Pod</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=34-跨层级抢占的优先顺序>3.4 跨层级抢占的优先顺序<a href=#34-跨层级抢占的优先顺序 class=hash-link aria-label="Direct link to 3.4 跨层级抢占的优先顺序" title="Direct link to 3.4 跨层级抢占的优先顺序">​</a></h3>
<p>当涉及跨层级的资源抢占时，<code>Volcano</code>遵循以下优先顺序：</p>
<ol>
<li><strong>Queue优先级最高</strong>：不同<code>Queue</code>之间的优先级高于<code>Queue</code>内部的<code>Job</code>优先级</li>
<li><strong>Job优先级次之</strong>：同一<code>Queue</code>内不同<code>Job</code>之间的优先级高于<code>Job</code>内部的<code>Pod</code>优先级</li>
<li><strong>Pod优先级最低</strong>：同一<code>Job</code>内不同<code>Pod</code>之间的优先级最低</li>
</ol>
<p>这意味着：</p>
<ul>
<li>即使是低优先级<code>Queue</code>中的高优先级<code>Job</code>，也无法抢占高优先级<code>Queue</code>中的低优先级<code>Job</code></li>
<li>即使是低优先级<code>Job</code>中的高优先级<code>Pod</code>，也无法抢占高优先级<code>Job</code>中的低优先级<code>Pod</code></li>
<li>这种设计确保了资源抢占的层次性和可预测性</li>
</ul>
<p>这种分层优先级设计的优势：</p>
<ol>
<li><strong>资源隔离</strong>：确保高优先级<code>Queue</code>的资源不会被低优先级<code>Queue</code>抢占</li>
<li><strong>可预测性</strong>：资源抢占行为更加可预测，便于资源规划</li>
<li><strong>业务保障</strong>：重要业务可以通过<code>Queue</code>优先级得到保障</li>
<li><strong>灵活性</strong>：在保证优先级层次的同时，仍然允许同层级的资源抢占</li>
</ol>
<p>使用建议：</p>
<ol>
<li>根据业务重要性设置合适的<code>Queue</code>优先级</li>
<li>在<code>Queue</code>内部，根据任务紧急程度设置<code>Job</code>优先级</li>
<li>在<code>Job</code>内部，根据任务依赖关系设置<code>Pod</code>优先级</li>
<li>合理使用<code>Queue reclaimable</code>属性和<code>Pod volcano.sh/preemptable</code>注解，进一步控制资源抢占行为</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano-queue-job><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano Queue&Job详解</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-scheduler-actions-plugins><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano Actions&Plugins详解</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-资源抢占的背景和用途 class="table-of-contents__link toc-highlight">1. 资源抢占的背景和用途</a><ul><li><a href=#11-什么是资源抢占 class="table-of-contents__link toc-highlight">1.1 什么是资源抢占</a><li><a href=#12-kubernetes原生抢占机制的局限性 class="table-of-contents__link toc-highlight">1.2 Kubernetes原生抢占机制的局限性</a><li><a href=#13-volcano抢占机制的优势 class="table-of-contents__link toc-highlight">1.3 Volcano抢占机制的优势</a></ul><li><a href=#2-volcano资源抢占的设计与实现 class="table-of-contents__link toc-highlight">2. Volcano资源抢占的设计与实现</a><ul><li><a href=#21-queue级别抢占 class="table-of-contents__link toc-highlight">2.1 Queue级别抢占</a><li><a href=#22-job级别抢占 class="table-of-contents__link toc-highlight">2.2 Job级别抢占</a><li><a href=#23-pod级别抢占 class="table-of-contents__link toc-highlight">2.3 Pod级别抢占</a></ul><li><a href=#3-资源抢占的层级关系 class="table-of-contents__link toc-highlight">3. 资源抢占的层级关系</a><ul><li><a href=#31-queue与queue之间的抢占 class="table-of-contents__link toc-highlight">3.1 <code>Queue</code>与<code>Queue</code>之间的抢占</a><li><a href=#32-job与job之间的抢占 class="table-of-contents__link toc-highlight">3.2 <code>Job</code>与<code>Job</code>之间的抢占</a><li><a href=#33-pod与pod之间的抢占 class="table-of-contents__link toc-highlight">3.3 <code>Pod</code>与<code>Pod</code>之间的抢占</a><li><a href=#34-跨层级抢占的优先顺序 class="table-of-contents__link toc-highlight">3.4 跨层级抢占的优先顺序</a></ul></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>