<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Argo Workflow/Argo Workflow常见问题/Argo Workflow的流程数据是如何实现上下文传递的" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Argo Workflow的流程数据是如何实现上下文传递的 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/argo-workflow-context-passing><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Argo Workflow的流程数据是如何实现上下文传递的 | John's Blog"><meta data-rh=true name=description content="深入分析 Argo Workflow 中的数据流转机制，包括 Parameters 和 Artifacts 两种主要的上下文传递方式及其实现原理"><meta data-rh=true property=og:description content="深入分析 Argo Workflow 中的数据流转机制，包括 Parameters 和 Artifacts 两种主要的上下文传递方式及其实现原理"><meta data-rh=true name=keywords content="Argo Workflow,上下文传递,数据流转,Parameters,Artifacts,工作流通信"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/argo-workflow-context-passing><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/argo-workflow-context-passing hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/argo-workflow-context-passing hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.a2ab4500.js defer></script><script src=/assets/js/main.8f3de613.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Collapse sidebar category 'Argo Workflow'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-introduction>Argo Workflow介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-source-code>Argo Workflow源码解析</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/argo-workflow-faq>Argo Workflow常见问题</a><button aria-label="Collapse sidebar category 'Argo Workflow常见问题'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/argo-workflow-context-passing>Argo Workflow的流程数据是如何实现上下文传递的</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-template-storage>Argo Workflow及Template数据是如何存储的</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-gc-policy>Argo Workflow的GC策略，什么时候会去清理Pod</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-development-setup>Argo Workflow开发环境搭建</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Expand sidebar category 'Volcano'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kind>Kind</a><button aria-label="Expand sidebar category 'Kind'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/argo-workflow><span itemprop=name>Argo Workflow</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/argo-workflow-faq><span itemprop=name>Argo Workflow常见问题</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Argo Workflow的流程数据是如何实现上下文传递的</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p>关于<code>Argo Workflow</code>的流程数据传递方式，官方文档上提供的是三种方式：<code>**Parameters**</code>、<code>**Artifacts**</code>及<code>**Volume**</code>。其中，通过共享<code>Volume</code>传递数据方式官方只是提了个例子（<a href=https://argoproj.github.io/argo-workflows/examples/#volumes target=_blank rel="noopener noreferrer">https://argoproj.github.io/argo-workflows/examples/#volumes</a>），来自于<code>Kubernetes</code>基本功能，并不属于<code>Argo Workflow</code>的自有特性。那么<code>Argo Workflow</code>的<code>Parameters</code>和<code>Artifacts</code>功能特性底层又是怎么实现的呢，我们这里着重探究前两种流程数据传递方式的本质。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=parameters><code>Parameters</code><a href=#parameters class=hash-link aria-label="Direct link to parameters" title="Direct link to parameters">​</a></h2>
<p><code>Parameters</code>的参数传递分为两种，一种是不带<code>Outputs</code>输出的<code>Parameters</code>，另一种是带有<code>Outputs</code>输出的<code>Parameters</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=不带outputs输出的parameters>不带<code>Outputs</code>输出的<code>Parameters</code><a href=#不带outputs输出的parameters class=hash-link aria-label="Direct link to 不带outputs输出的parameters" title="Direct link to 不带outputs输出的parameters">​</a></h3>
<p>这是 <code>Argo Workflow</code>中最简单的方式，甚至都不用做任何的脚本执行解析。因为变量都直接通过<code>Yaml</code>的形式配置到了<code>Workflow</code>中，<code>Argo Workflow Controller</code>中可以直接通过模板变量解析的方式即可将参数嵌入到命令行参数中。我们以官方示例<code>steps.yaml</code>作为示例演示一下。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVR4nG2PW2oEMQwEfZwweli2bHnWk59ASO5/og7xLIYl+SgKRKuF0sfnN85rYsxzEY+xGU96BFLzitkN3hyaM4jpDwcRUkTg4YrqDaoKIvqX9BtwE3gtYBEw3Q1vT++g1Y5mjBkOswJVQVHBKbSWhG6n4h3dGNdoMDOwCiIzvpTQmFCZkO9gQ8myUBGICEwYxq/nk3vHqAqvvodKx6LQsdr2M1EV5whoMbyb4lLGVN5uwvgBOxOMJ10dq0EAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=556 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-9-55.b8ea71a.640.png srcset="/assets/ideal-img/image2021-7-6_11-9-55.b8ea71a.640.png 640w,/assets/ideal-img/image2021-7-6_11-9-55.015e829.2002.png 2002w" alt="" width=640 height=556></noscript></div>
<p>我们查看一下创建的<code>Pod</code>情况：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcUlEQVR4nEWNyQpDIRAEvbgrOuMW3jySQP7/GztoDjnUoaHoUmMMrDlRSkFKCcYYhBCQc0atFd57OOegLhHIfR+JiKC1RowRvfeDtfagPq8nZE0kZ/FoDKP1eWRmtNb+4lsuyFqgnDCZfukYj7gLe2++zYwuuW4U3TYAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=258 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-22-11.feda31c.640.png srcset="/assets/ideal-img/image2021-7-6_11-22-11.feda31c.640.png 640w,/assets/ideal-img/image2021-7-6_11-22-11.3e2e309.2886.png 2886w" alt="" width=640 height=258></noscript></div>
<p><code>hello1</code>节点的执行：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaElEQVR4nD2NSQ7DMAwDJW+KLFlG4l77/2eysFHkMOCBA5LGGOhmGBEntfeTZgZ3h6qitQZaM/ANwy0NV2LoJicwEYgIzHygcMcTE3cEfK+pIu3iL77EnFjrcy7lEogISimotSLn/Io/2/wrXMa8H0UAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=278 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-33-33.cef593c.640.png srcset="/assets/ideal-img/image2021-7-6_11-33-33.cef593c.640.png 640w,/assets/ideal-img/image2021-7-6_11-33-33.373af6d.2142.png 2142w" alt="" width=640 height=278></noscript></div>
<p><code>hello2a</code>节点的执行：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeklEQVR4nFWOuxLDMAgEEXpYWMYgF5lU+f+/vAxUSXEDxc7dkplBzhO+N24zqCrMPX93z4gI6AlAJmweOCtDKmM1RucCKgWlFDAz6P04PnbhpRfm6JDeMZjBRKDfxKT5huqdCmst1Fr/oQTDJTxF0FpLqEfrGHljOsAv8sE2inyhcBMAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=311 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-34-22.981f79e.640.png srcset="/assets/ideal-img/image2021-7-6_11-34-22.981f79e.640.png 640w,/assets/ideal-img/image2021-7-6_11-34-22.1f824f6.1938.png 1938w" alt="" width=640 height=311></noscript></div>
<p><code>hello2b</code>节点的执行：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfUlEQVR4nFWOywpCMQxE09impsY8uBsXLvz/nxy5VRAXB4bhwAxFJlQVdRxwd5gZPGLniEBm7o6OTLgq7tcJ4Yb5RZjRWtswM+hRiacbXumwKTAZ0AtDWgMR/cgqnPP3COhauJmh9/4vnZw/qgprLYwxtjR6h4hgzvmZJcIb+i02texGn+UAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=316 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-35-11.840903b.640.png srcset="/assets/ideal-img/image2021-7-6_11-35-11.840903b.640.png 640w,/assets/ideal-img/image2021-7-6_11-35-11.7b49290.1898.png 1898w" alt="" width=640 height=316></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=带有outputs输出的parameters>带有<code>Outputs</code>输出的<code>Parameters</code><a href=#带有outputs输出的parameters class=hash-link aria-label="Direct link to 带有outputs��输出的parameters" title="Direct link to 带有outputs输出的parameters">​</a></h3>
<p>这种情况会稍微复杂一些，因为会涉及到命令的执行以及执行结果的保存和传递。我们在之前的源码解析中有介绍到，在<code>Wait Container</code>中等待<code>Main Container</code>结束后，会根据<code>Template</code>的配置决定是否将<code>Template</code>的执行结果<code>Json</code>化之后，通过<code>Patch</code>方式写入到该<code>Template</code>运行<code>Pod</code>的<code>MetaData.Annotation</code>中，随后其他依赖该<code>Template</code>的Node会读取该<code>MetaData.Annotation</code>，并解析该数据后存放到<code>globalParams</code>中，并使用<code>globalParams</code>做自身的模板变量替换，随后创建该<code>Template Pod</code>。</p>
<p><code>Parameters</code>存储到<code>MetaData.Annotations</code>：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfElEQVR4nD3Lyw2DMBAAUerBa/ZrDCTpv6yJgiIOc3uzZA3mcTCvF3PunMegRuGZmBtqxtaFJbJwd35DulJmmCq6bUhrtH9L1MBNcTeGdo4u7LJSsmLSHnzDymBU4GlkBp/euGTlLes9PVC3TrjhYaQblznTlDOcUEVE+AJO/E5ti2AjgwAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=296 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-5_20-23-45.dcb9c01.640.png srcset="/assets/ideal-img/image2021-7-5_20-23-45.dcb9c01.640.png 640w,/assets/ideal-img/image2021-7-5_20-23-45.3410c35.1930.png 1930w" alt="" width=640 height=296></noscript></div>
<p>在<code>Argo Workflow Controller</code>中<code>Template</code>使用<code>MetaData.Annotations：</code></p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVR4nEWQUXIEIQgF5zwKIoI7zlbuf61O6W4qHxQfNDzbK/LFnC9yJplBRDDcUVVqrYjI6VfkJDLJGPRuiMoZllpPbeiAI1+stc5F74aJ0ESxprTv1QP6CHJORiZPDG4zXBuuQv/GfkAP7nuRmYgqpkpIZdRyympBTrQ7o3d+njfPWry9c0shSiFrITZcClcfQa3lxK9141vKHfeBmtHMzg+cNzYVRgQZgXfHzLDWaFuo6Qfse1MVH7s3RLbpv8SfzC+WRYvBkW1f1gAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=547 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_10-35-11.8a15306.640.png srcset="/assets/ideal-img/image2021-7-6_10-35-11.8a15306.640.png 640w,/assets/ideal-img/image2021-7-6_10-35-11.8033039.2690.png 2690w" alt="" width=640 height=547></noscript></div>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWUlEQVR4nCXLUQ6EMAhAwZ5HQJDSNsZE73+qt1n9nWTakUVVMddkrEn2jkdgZqgZooqI0CKTiIP7OnnOybMG1yjCndgdN8VUadnHO8L3D0VwFUI24u8qr/0AOLIu3VC+6/EAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=180 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-3_15-42-58.5c862ec.640.png srcset="/assets/ideal-img/image2021-7-3_15-42-58.5c862ec.640.png 640w,/assets/ideal-img/image2021-7-3_15-42-58.2ee2aae.2782.png 2782w" alt="" width=640 height=180></noscript></div>
<p>我们以官方实例<code>output-parameter.yaml</code>作为示例演示一下。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVR4nH2QS44DMQhEfZ00GEPRdjuf+1+rIneikXqRWTyxeSooypiT8zXZ7505wDxAj0Yzu1BGB0c6kclalapCkY3bdqX0Pdkz6AGKyE9KAJy78zjm/6IjCa/0cErVE11T9SomwOce3CMYVtmqsqpSRf44xQHwkcbmjdOE96YMU6Iq05Runw0lkZxhZ6Kp8rYSVvMv6wuLAoBHdzrwue1HmTfLx4p9pCfSNgAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=603 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-47-49.31293b6.640.png srcset="/assets/ideal-img/image2021-7-6_11-47-49.31293b6.640.png 640w,/assets/ideal-img/image2021-7-6_11-47-49.4f81227.2440.png 2440w" alt="" width=640 height=603></noscript></div>
<p>执行后我们看看<code>Pod</code>情况：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVR4nE2Q2W7EIAxFI2VfyEoCAUM7WR5G0///vVvZ05H6cCXLHGH7JNu2YRxH9H0vaZoGWZahKApUVSV1kiRI9n3Huq4wxoBr770ASilYa7EsyxtkwDknTYau65IJdV2Dp3EEDCHAEwl03zeGYUCapmi7TiZxBPRuRyRC8B6b1qjKAnmWYlAdLP/4AX8i4XU88PyOOHeLr1VjrkoY1eF0Fo9Nv8GDPM5AOALheZ1YxwFNlmJRHaI1cOsfaPgIIlz3jUVr0ZHnueyo/+9IRIgxyjHc1FqjLEu0bSvK2Ia45Ed2Nc+zhP19ZE/TJBYY/AUo6XjJJAuaFQAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=615 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-48-51.6511cda.640.png srcset="/assets/ideal-img/image2021-7-6_11-48-51.6511cda.640.png 640w,/assets/ideal-img/image2021-7-6_11-48-51.046e4e2.1296.png 1296w" alt="" width=640 height=615></noscript></div>
<p><code>generate-parameter</code>执行结果的保存：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaElEQVR4nGXNMQ7DIAxAUQgOxhgUkIjUduj9b/mrMnTp8OYX5pxcYzDGJKsSYiSE8M/MeD8fvO7F6p3hznJjmTJMaUUREUJz52qNVisln5ueJ1lkk3QQv0vvnVqdYrbrLWdSShwp/eoP4UsriRAom7wAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=236 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-50-16.3db9f5f.640.png srcset="/assets/ideal-img/image2021-7-6_11-50-16.3db9f5f.640.png 640w,/assets/ideal-img/image2021-7-6_11-50-16.d5250e3.3170.png 3170w" alt="" width=640 height=236></noscript></div>
<p><code>consumer-parameter</code>对于其他节点执行结果参数的输入：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAAApElEQVR4nF2PWw7DMAgEbTCY+KHYeUi9/0W3spNGbT9GfIB2GbeuK/Z9n0QzhBDgieC9f3DOwZkZjvPE2TuOWrCVjFdOaIthUYVFhYYAV2tFzhk5JagKRARJBcaEyATxHmGkllIQVcHMszaIzMkD5qt28EnU+/hZ/NN7x2BIxRgvmY/ANyNx6x2tNZScJ8tt/9Ow1YojLfNxJZoSKTCMGUT0HL4BDEZV2JzIR3UAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=535 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_11-52-59.0c1e26e.640.png srcset="/assets/ideal-img/image2021-7-6_11-52-59.0c1e26e.640.png 640w,/assets/ideal-img/image2021-7-6_11-52-59.82c37a1.3150.png 3150w" alt="" width=640 height=535></noscript></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=artifacts>Artifacts<a href=#artifacts class=hash-link aria-label="Direct link to Artifacts" title="Direct link to Artifacts">​</a></h2>
<p><code>Artifacts</code>会稍微复杂一些。<code>Argo</code>默认使用<code>minio</code>来对<code>Artifacts</code>做存储和读取，并且<code>Main Container</code>对于<code>Atifacts</code>内容的操作原理都是基于共享<code>Volume</code>。也就是说往往必须要挂载<code>Volume</code>来使用<code>Artifacts</code>，不过<code>Volume</code>的挂载是由<code>Argo Workflow Controller</code>自动帮我们实现的，我们并不能直接感知到。我们以官方示例<code>artifact-passing.yaml</code>作为示例演示一下。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR4nG2QUW7DMAxDc51Fkm1ZdpxkQbvd/1BvaNoOw9qPB/4QpMTpuHxxXA+2Y2fZBh4VDz/JpfwyRVT2MNyd4o6ZMc/zC1Nr/TRGdWo0TA0ReWHy6LRijHXQlxUR5UMEe6BPY4lOTcJlVMbYyGasOtN0pj9Un8Yw4bslhmd6FkZWelZaVtakZ/Lk0c7qNQJPmaJKUaGInOp6r5+8do6qHEtlbUEtmdkUSYYmRVTvN0Z09qJsreK1sidlmFBNMP3z9W2SoyiXFnyWTDyq0v95bolXv33duJbMpvN529sdl6Lso9NaO9Pym8F/AGXXupeo9IXkAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=791 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_15-32-39.d511460.640.png srcset="/assets/ideal-img/image2021-7-6_15-32-39.d511460.640.png 640w,/assets/ideal-img/image2021-7-6_15-32-39.3d72070.1700.png 1700w" alt="" width=640 height=791></noscript></div>
<p>在<code>generate-artifact</code>的节点<code>Annotiations</code>中只有<code>Artifacts</code>的输出路径及类型，真实的内容是保存到<code>minio</code>中的：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAV0lEQVR4nB3KQQ4EIQgAQRYU0BgdE/3/U3sTD3UrWWtx7+WcQ2uNYoWqSprSTOmmuP6QzGTvzRiDyCQi+DLYGcwMvpYMr8ic86Xe+0seQXXHSkHNEJHnD9QSINXN4OiPAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=215 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image2021-7-6_15-35-12.2136294.640.png srcset="/assets/ideal-img/image2021-7-6_15-35-12.2136294.640.png 640w,/assets/ideal-img/image2021-7-6_15-35-12.a7bcff1.3174.png 3174w" alt="" width=640 height=215></noscript></div>
<p>在<code>consume-artifact</code>节点中<code>Init/Wait/Main Containers</code>挂载了相同的<code>Volume</code>，因此可以共享<code>Artifacts</code>数据。其中<code>Init Container</code>负责将<code>Artifacts</code>的内容拉取到本地的<code>/argo/inputs/artifacts</code>路径下，随后<code>Main Container</code>会读取<code>/tmp/message</code>路径下的内容，这两个路径均是来自于相同的<code>Volume (input-artifacts)</code>。</p>
<p>                    <code>           &lt;Image img={require('@site/static/attachments/image2021-7-6_15-42-7.png')} alt="" loading="eager" />           </code></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/argo-workflow-faq><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Argo Workflow常见问题</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/argo-workflow-template-storage><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Argo Workflow及Template数据是如何存储的</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#parameters class="table-of-contents__link toc-highlight"><code>Parameters</code></a><ul><li><a href=#不带outputs输出的parameters class="table-of-contents__link toc-highlight">不带<code>Outputs</code>输出的<code>Parameters</code></a><li><a href=#带有outputs输出的parameters class="table-of-contents__link toc-highlight">带有<code>Outputs</code>输出的<code>Parameters</code></a></ul><li><a href=#artifacts class="table-of-contents__link toc-highlight">Artifacts</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>