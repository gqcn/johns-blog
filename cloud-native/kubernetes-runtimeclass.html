<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Kubernetes/Kubernetes RuntimeClass" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Kubernetes RuntimeClass | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/kubernetes-runtimeclass><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Kubernetes RuntimeClass | John's Blog"><meta data-rh=true name=description content="深入解析Kubernetes RuntimeClass机制，介绍如何使用RuntimeClass为不同的Pod选择不同的容器运行时。详细讲解containerd、runc、Kata Containers、Firecracker等容器运行时的概念和关系，以及如何配置和使用RuntimeClass实现安全隔离和多租户场景。"><meta data-rh=true property=og:description content="深入解析Kubernetes RuntimeClass机制，介绍如何使用RuntimeClass为不同的Pod选择不同的容器运行时。详细讲解containerd、runc、Kata Containers、Firecracker等容器运行时的概念和关系，以及如何配置和使用RuntimeClass实现安全隔离和多租户场景。"><meta data-rh=true name=keywords content="Kubernetes,RuntimeClass,运行时类,容器运行时,containerd,runc,Kata Containers,Firecracker,QEMU,KVM,安全容器,轻量级虚拟机,容器隔离,虚拟化,沙箱容器,多租户,CRI,Container Runtime Interface,Pod调度,节点选择"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/kubernetes-runtimeclass><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/kubernetes-runtimeclass hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/kubernetes-runtimeclass hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.d14e1eeb.css><script src=/assets/js/runtime~main.d1f85a30.js defer></script><script src=/assets/js/main.b1b47389.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/docker-image-cleanup>Container</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/cloud-native/kubernetes-common-commands>Kubernetes</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/kubernetes-common-commands>Kubernetes使用笔记</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/kubernetes-informer-client-go>Kubernetes扩展开发</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/kubernetes-common-issues>Kubernetes问题排查</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-kubelet-pod-eviction-process>Kubelet驱逐Pod详细流程</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-device-plugin>Kubernetes Device Plugin</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-network-policy>Kubernetes NetworkPolicy</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/kubernetes-runtimeclass>Kubernetes RuntimeClass</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-pvc-persistent-volume>Kubernetes PVC持久化存储</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-cpu-numa-affinity>Kubernetes CPU&NUMA亲和性调度</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-node-feature-discovery>Node Feature Discovery</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-node-feature-discovery-nodefeaturerule>NodeFeatureRule配置使用</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/argo-workflow-introduction>Argo Workflow</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/volcano-introduction>Volcano</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/cloud-native/kubernetes-kind>Kind</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li class=breadcrumbs__item><span class=breadcrumbs__link>Kubernetes</span><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Kubernetes RuntimeClass</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=前言>前言<a href=#前言 class=hash-link aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2>
<p>在<code>Kubernetes</code>集群中，不同的应用场景对容器的隔离性和安全性要求不同。传统的容器技术基于<code>Linux</code>命名空间和<code>cgroup</code>实现隔离，虽然轻量高效，但在某些场景下隔离性不够强。<code>RuntimeClass</code>是<code>Kubernetes</code>提供的一种机制，允许用户为不同的<code>Pod</code>选择不同的容器运行时，从而在性能、安全性和隔离性之间做出权衡。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass是什么>RuntimeClass是什么？<a href=#runtimeclass是什么 class=hash-link aria-label="Direct link to RuntimeClass是什么？" title="Direct link to RuntimeClass是什么？">​</a></h2>
<p><code>RuntimeClass</code>是<code>Kubernetes</code>从<code>v1.12</code>版本开始引入的<code>API</code>对象（在<code>v1.14</code>进入<code>Beta</code>阶段，在<code>v1.20</code>正式<code>GA</code>），它允许集群管理员定义不同的容器运行时配置，并让用户在创建<code>Pod</code>时选择使用哪种运行时。</p>
<p>简单来说，<code>RuntimeClass</code>提供了一种机制，让你可以在同一个<code>Kubernetes</code>集群中混合使用不同的容器运行时，比如：</p>
<ul>
<li>普通工作负载使用轻量级的<code>runc</code>运行时</li>
<li>安全敏感的工作负载使用基于虚拟化的<code>Kata Containers</code></li>
<li>需要极致启动速度的负载使用<code>Firecracker</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass解决了什么问题>RuntimeClass解决了什么问题？<a href=#runtimeclass解决了什么问题 class=hash-link aria-label="Direct link to RuntimeClass解决了什么问题？" title="Direct link to RuntimeClass解决了什么问题？">​</a></h3>
<p>在<code>RuntimeClass</code>出现之前，一个<code>Kubernetes</code>集群中所有的<code>Pod</code>都使用相同的容器运行时。但在实际生产环境中，不同的应用对隔离性和性能的需求差异很大：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=痛点案例1多租户环境的安全隔离>痛点案例1：多租户环境的安全隔离<a href=#痛点案例1多租户环境的安全隔离 class=hash-link aria-label="Direct link to 痛点案例1：多租户环境的安全隔离" title="Direct link to 痛点案例1：多租户环境的安全隔离">​</a></h4>
<p><strong>场景</strong>：某公司提供<code>SaaS</code>服务，多个客户的应用运行在同一个<code>Kubernetes</code>集群中。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>普通容器共享宿主机内核，存在潜在的内核漏洞风险</li>
<li>恶意租户可能利用容器逃逸攻击其他租户的应用</li>
<li>部分租户要求更强的隔离保证（如金融、医疗行业）</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>普通租户使用<code>runc</code>运行时，成本低、性能好</li>
<li>敏感租户使用<code>Kata Containers</code>，每个容器运行在独立的轻量级虚拟机中</li>
<li>通过<code>RuntimeClass</code>让<code>Kubernetes</code>根据租户类型自动选择运行时</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=痛点案例2特权容器的风险控制>痛点案例2：特权容器的风险控制<a href=#痛点案例2特权容器的风险控制 class=hash-link aria-label="Direct link to 痛点案例2：特权容器的风险控制" title="Direct link to 痛点案例2：特权容器的风险控制">​</a></h4>
<p><strong>场景</strong>：某些应用需要运行特权容器（如监控、存储插件），但这些容器可能包含漏洞。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>特权容器能够访问宿主机的所有资源，风险极高</li>
<li>一旦被攻破，攻击者可以控制整个节点</li>
<li>无法在不影响其他工作负载的情况下提升特权容器的隔离性</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>特权容器使用<code>Kata Containers</code>或<code>gVisor</code>等安全运行时</li>
<li>即使容器被攻破，攻击者也只能控制虚拟机，无法直接访问宿主机</li>
<li>其他普通容器继续使用高性能的<code>runc</code>运行时</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=痛点案例3无服务器serverless场景的冷启动优化>痛点案例3：无服务器(Serverless)场景的冷启动优化<a href=#痛点案例3无服务器serverless场景的冷启动优化 class=hash-link aria-label="Direct link to 痛点案例3：无服务器(Serverless)场景的冷启动优化" title="Direct link to 痛点案例3：无服务器(Serverless)场景的冷启动优化">​</a></h4>
<p><strong>场景</strong>：基于<code>Kubernetes</code>构建的<code>Serverless</code>平台，需要快速启动大量短生命周期的容器。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>传统虚拟机启动慢（几秒到几十秒）</li>
<li><code>runc</code>启动快但隔离性不够</li>
<li>无法同时满足快速启动和强隔离的需求</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用<code>Firecracker</code>这种专为<code>Serverless</code>优化的轻量级<code>VMM</code></li>
<li>启动时间可以达到<code>125ms</code>以内</li>
<li>通过<code>RuntimeClass</code>让函数容器自动使用<code>Firecracker</code>运行时</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=容器运行时技术栈详解>容器运行时技术栈详解<a href=#容器运行时技术栈详解 class=hash-link aria-label="Direct link to 容器运行时技术栈详解" title="Direct link to 容器运行时技术栈详解">​</a></h2>
<p>在深入了解<code>RuntimeClass</code>之前，我们需要理解容器运行时生态系统中各个组件的作用和关系。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=技术栈架构关系>技术栈架构关系<a href=#技术栈架构关系 class=hash-link aria-label="Direct link to 技术栈架构关系" title="Direct link to 技术栈架构关系">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=各组件详解>各组件详解<a href=#各组件详解 class=hash-link aria-label="Direct link to 各组件详解" title="Direct link to 各组件详解">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=containerd>containerd<a href=#containerd class=hash-link aria-label="Direct link to containerd" title="Direct link to containerd">​</a></h4>
<p><code>containerd</code>是一个行业标准的容器运行时，负责管理容器的完整生命周期：</p>
<ul>
<li><strong>职责</strong>：镜像传输和存储、容器执行和监控、底层存储和网络</li>
<li><strong>定位</strong>：高层运行时（<code>High-Level Runtime</code>），提供<code>gRPC API</code></li>
<li><strong>历史</strong>：最初是<code>Docker</code>的一部分，后来被捐赠给<code>CNCF</code>成为独立项目</li>
<li><strong>标准</strong>：实现了<code>CRI</code>（<code>Container Runtime Interface</code>）接口，是<code>Kubernetes</code>官方推荐的容器运行时</li>
<li><strong>特点</strong>：<!-- -->
<ul>
<li>轻量级、高性能、可嵌入</li>
<li>支持多种底层运行时（<code>runc</code>、<code>Kata</code>、<code>gVisor</code>等）</li>
<li>被<code>Docker</code>、<code>Kubernetes</code>等广泛使用</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=runc>runc<a href=#runc class=hash-link aria-label="Direct link to runc" title="Direct link to runc">​</a></h4>
<p><code>runc</code>是一个轻量级的容器运行时，实现了<code>OCI</code>（<code>Open Container Initiative</code>）规范：</p>
<ul>
<li><strong>职责</strong>：创建和运行容器，配置命名空间、<code>cgroup</code>、<code>rootfs</code>等</li>
<li><strong>定位</strong>：低层运行时（<code>Low-Level Runtime</code>），只负责容器启动和管理</li>
<li><strong>隔离机制</strong>：基于<code>Linux</code>内核特性<!-- -->
<ul>
<li><code>Namespace</code>：进程、网络、文件系统、用户等隔离</li>
<li><code>cgroup</code>：资源限制和统计</li>
<li><code>capabilities</code>：权限控制</li>
</ul>
</li>
<li><strong>特点</strong>：<!-- -->
<ul>
<li>极其轻量，几乎没有性能损耗</li>
<li>启动速度快（毫秒级）</li>
<li>资源开销小</li>
<li>但隔离性相对较弱，共享内核</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=kata-containers>Kata Containers<a href=#kata-containers class=hash-link aria-label="Direct link to Kata Containers" title="Direct link to Kata Containers">​</a></h4>
<p><code>Kata Containers</code>是一个开源项目，结合了虚拟机的安全性和容器的速度：</p>
<ul>
<li><strong>核心理念</strong>：每个容器或<code>Pod</code>运行在独立的轻量级虚拟机中</li>
<li><strong>安全优势</strong>：<!-- -->
<ul>
<li>完全独立的内核，隔离性强</li>
<li>即使容器逃逸，也只能控制虚拟机，无法影响宿主机</li>
<li>支持不同内核版本，可以运行特殊内核模块</li>
</ul>
</li>
<li><strong>性能优化</strong>：<!-- -->
<ul>
<li>专为容器场景优化的轻量级虚拟机</li>
<li>内存占用和启动时间介于传统虚拟机和容器之间</li>
<li>使用精简的<code>Guest OS</code>和内核</li>
</ul>
</li>
<li><strong>架构</strong>：兼容<code>OCI</code>规范，可以作为<code>containerd</code>的底层运行时</li>
<li><strong>使用场景</strong>：多租户环境、不可信工作负载、合规要求高的场景</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=firecracker>Firecracker<a href=#firecracker class=hash-link aria-label="Direct link to Firecracker" title="Direct link to Firecracker">​</a></h4>
<p><code>Firecracker</code>是<code>AWS</code>开源的微虚拟机监控器（<code>microVM</code>）：</p>
<ul>
<li><strong>设计目标</strong>：为<code>Serverless</code>和容器工作负载提供安全和高速的虚拟化</li>
<li><strong>核心特点</strong>：<!-- -->
<ul>
<li><strong>极速启动</strong>：可以在<code>125ms</code>内启动<code>microVM</code></li>
<li><strong>低内存开销</strong>：每个<code>microVM</code>仅需<code>&lt;5MB</code>内存</li>
<li><strong>高密度</strong>：单台宿主机可运行数千个<code>microVM</code></li>
<li><strong>强隔离</strong>：基于<code>KVM</code>，每个<code>microVM</code>拥有独立内核</li>
</ul>
</li>
<li><strong>技术实现</strong>：<!-- -->
<ul>
<li>用<code>Rust</code>语言编写，安全性高</li>
<li>极简的设备模型，只提供必要的设备（网络、块设备、串口、键盘）</li>
<li>不支持<code>PCI</code>、<code>USB</code>等传统虚拟机特性</li>
</ul>
</li>
<li><strong>使用场景</strong>：<!-- -->
<ul>
<li><code>AWS Lambda</code>使用<code>Firecracker</code>运行函数</li>
<li>适合<code>Serverless</code>、<code>FaaS</code>平台</li>
<li>需要快速启动和强隔离的场景</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=qemu>QEMU<a href=#qemu class=hash-link aria-label="Direct link to QEMU" title="Direct link to QEMU">​</a></h4>
<p><code>QEMU</code>是一个通用的开源虚拟机监控器（<code>Virtual Machine Monitor</code>）：</p>
<ul>
<li><strong>职责</strong>：提供完整的硬件虚拟化，模拟<code>CPU</code>、内存、设备等</li>
<li><strong>特点</strong>：<!-- -->
<ul>
<li><strong>功能全面</strong>：支持各种设备、架构、操作系统</li>
<li><strong>灵活性高</strong>：可以运行任意操作系统</li>
<li><strong>性能较低</strong>：相比<code>Firecracker</code>更重量级</li>
<li><strong>启动较慢</strong>：通常需要几秒钟</li>
</ul>
</li>
<li><strong>使用场景</strong>：<!-- -->
<ul>
<li>需要完整虚拟机功能的场景</li>
<li>运行传统应用</li>
<li><code>Kata Containers</code>的默认<code>VMM</code>选项之一</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=linux-kvm>Linux KVM<a href=#linux-kvm class=hash-link aria-label="Direct link to Linux KVM" title="Direct link to Linux KVM">​</a></h4>
<p><code>KVM</code>（<code>Kernel-based Virtual Machine</code>）是<code>Linux</code>内核的虚拟化模块：</p>
<ul>
<li><strong>定位</strong>：硬件虚拟化的基础设施，内核模块</li>
<li><strong>工作原理</strong>：<!-- -->
<ul>
<li>将<code>Linux</code>内核转变为虚拟机监控器</li>
<li>利用<code>CPU</code>的硬件虚拟化扩展（<code>Intel VT-x</code>、<code>AMD-V</code>）</li>
<li>提供<code>/dev/kvm</code>设备节点供用户空间程序使用</li>
</ul>
</li>
<li><strong>关系</strong>：<!-- -->
<ul>
<li><code>QEMU</code>、<code>Firecracker</code>等<code>VMM</code>都基于<code>KVM</code>提供的能力</li>
<li><code>KVM</code>负责<code>CPU</code>和内存虚拟化</li>
<li><code>VMM</code>负责设备模拟和管理</li>
</ul>
</li>
<li><strong>性能</strong>：接近原生性能，虚拟化损耗很小（通常<code>&lt;5%</code>）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=技术栈总结>技术栈总结<a href=#技术栈总结 class=hash-link aria-label="Direct link to 技术栈总结" title="Direct link to 技术栈总结">​</a></h3>
<table><thead><tr><th>组件<th>层级<th>隔离方式<th>启动时间<th>内存开销<th>典型场景<tbody><tr><td><code>runc</code><td>容器运行时<td>命名空间/<code>cgroup</code><td>毫秒级<td>极小<td>通用工作负载<tr><td><code>Kata Containers</code><td>安全容器<td>轻量级虚拟机<td>百毫秒-秒级<td>中等<td>多租户、安全敏感<tr><td><code>Firecracker</code><td>微虚拟机<td>轻量级虚拟机<td><code>125ms</code><td><code>&lt;5MB</code><td><code>Serverless</code>、<code>FaaS</code><tr><td><code>QEMU</code><td>虚拟机监控器<td>完整虚拟机<td>秒级<td>较大<td>传统虚拟化<tr><td><code>KVM</code><td>内核模块<td>硬件虚拟化<td>N/A<td>N/A<td>虚拟化基础</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass使用示例>RuntimeClass使用示例<a href=#runtimeclass使用示例 class=hash-link aria-label="Direct link to RuntimeClass使用示例" title="Direct link to RuntimeClass使用示例">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=环境依赖>环境依赖<a href=#环境依赖 class=hash-link aria-label="Direct link to 环境依赖" title="Direct link to 环境依赖">​</a></h3>
<p>在使用<code>RuntimeClass</code>之前，需要确保满足以下依赖：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=kubernetes版本要求>Kubernetes版本要求<a href=#kubernetes版本要求 class=hash-link aria-label="Direct link to Kubernetes版本要求" title="Direct link to Kubernetes版本要求">​</a></h4>
<ul>
<li><code>v1.12</code>：<code>Alpha</code>版本，需要开启<code>Feature Gate</code></li>
<li><code>v1.14</code>：<code>Beta</code>版本，默认开启</li>
<li><code>v1.20+</code>：<code>GA</code>稳定版本，推荐使用</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=节点运行时配置>节点运行时配置<a href=#节点运行时配置 class=hash-link aria-label="Direct link to 节点运行时配置" title="Direct link to 节点运行时配置">​</a></h4>
<p>节点上需要安装和配置对应的容器运行时：</p>
<p><strong>使用runc（默认）</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 安装containerd</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>apt-get</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> containerd</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 默认配置即可，无需额外设置</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用Kata Containers</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 安装Kata Containers</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>bash</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-c</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"</span><span class="token string variable" style=color:#f8f8f2>$(</span><span class="token string variable function" style=color:#e6db74>curl</span><span class="token string variable" style=color:#f8f8f2> </span><span class="token string variable parameter variable" style=color:#f8f8f2>-fsSL</span><span class="token string variable" style=color:#f8f8f2> https://raw.githubusercontent.com/kata-containers/kata-containers/main/utils/kata-manager.sh</span><span class="token string variable" style=color:#f8f8f2>)</span><span class="token string" style=color:#a6e22e> install-packages"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置containerd使用Kata</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>cat</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>>></span><span class="token plain"> /etc/containerd/config.toml </span><span class="token operator" style=color:#66d9ef>&lt;&lt;</span><span class="token string" style=color:#a6e22e>EOF</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.kata]</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>  runtime_type = "io.containerd.kata.v2"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>EOF</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">systemctl restart containerd</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用Firecracker</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 安装Firecracker（需要KVM支持）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>wget</span><span class="token plain"> https://github.com/firecracker-microvm/firecracker/releases/download/v1.4.0/firecracker-v1.4.0-x86_64.tgz</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>tar</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-xf</span><span class="token plain"> firecracker-v1.4.0-x86_64.tgz</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>cp</span><span class="token plain"> release-v1.4.0-x86_64/firecracker-v1.4.0-x86_64 /usr/local/bin/firecracker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置Kata使用Firecracker作为VMM</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>cat</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> /etc/kata-containers/configuration.toml </span><span class="token operator" style=color:#66d9ef>&lt;&lt;</span><span class="token string" style=color:#a6e22e>EOF</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>[hypervisor.firecracker]</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>path = "/usr/local/bin/firecracker"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>kernel = "/usr/share/kata-containers/vmlinux.container"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>image = "/usr/share/kata-containers/kata-containers.img"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token string" style=color:#a6e22e>EOF</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=内核依赖>内核依赖<a href=#内核依赖 class=hash-link aria-label="Direct link to 内核依赖" title="Direct link to 内核依赖">​</a></h4>
<ul>
<li><strong>runc</strong>：任何现代<code>Linux</code>内核（<code>3.10+</code>），支持命名空间和<code>cgroup</code></li>
<li><strong>Kata Containers/Firecracker</strong>：需要<code>KVM</code>支持<!-- -->
<ul>
<li>内核版本：<code>4.14+</code>（推荐<code>5.10+</code>）</li>
<li>需要开启<code>KVM</code>模块：<code>modprobe kvm kvm_intel</code>（<code>Intel CPU</code>）或<code>modprobe kvm kvm_amd</code>（<code>AMD CPU</code>）</li>
<li>检查硬件虚拟化支持：<code>egrep -c '(vmx|svm)' /proc/cpuinfo</code>（输出<code>>0</code>表示支持）</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=示例1创建和使用runtimeclass>示例1：创建和使用RuntimeClass<a href=#示例1创建和使用runtimeclass class=hash-link aria-label="Direct link to 示例1：创建和使用RuntimeClass" title="Direct link to 示例1：创建和使用RuntimeClass">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=步骤1创建runtimeclass对象>步骤1：创建RuntimeClass对象<a href=#步骤1创建runtimeclass对象 class=hash-link aria-label="Direct link to 步骤1：创建RuntimeClass对象" title="Direct link to 步骤1：创建RuntimeClass对象">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># runtimeclass-runc.yaml - 默认运行时</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RuntimeClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> runc  </span><span class="token comment" style=color:#8292a2;font-style:italic># RuntimeClass的名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">handler</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> runc  </span><span class="token comment" style=color:#8292a2;font-style:italic># containerd中配置的runtime handler名称</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># runtimeclass-kata.yaml - Kata Containers运行时</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RuntimeClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">handler</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">scheduling</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 只调度到支持Kata的节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">kata-containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">overhead</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 定义运行时的资源开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podFixed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"160Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"250m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># runtimeclass-firecracker.yaml - Firecracker运行时</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RuntimeClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> firecracker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">handler</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">fc  </span><span class="token comment" style=color:#8292a2;font-style:italic># Kata使用Firecracker的handler</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">scheduling</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">firecracker-enabled</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">overhead</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podFixed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"130Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"150m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>应用这些配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> runtimeclass-runc.yaml</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> runtimeclass-kata.yaml</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> runtimeclass-firecracker.yaml</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 查看已创建的RuntimeClass</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get runtimeclass</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=步骤2在pod中使用runtimeclass>步骤2：在Pod中使用RuntimeClass<a href=#步骤2在pod中使用runtimeclass class=hash-link aria-label="Direct link to 步骤2：在Pod中使用RuntimeClass" title="Direct link to 步骤2：在Pod中使用RuntimeClass">​</a></h4>
<p><strong>使用默认runc运行时的Pod</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">runc</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> runc  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定使用runc运行时</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token number" style=color:#ae81ff>1.25</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"64Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"100m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"128Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"200m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用Kata Containers的Pod（安全敏感）</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> sensitive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">app</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">security</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata  </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用Kata运行时，提供虚拟机级别的隔离</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> app</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> myregistry/sensitive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">securityContext</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">runAsNonRoot</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">runAsUser</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 注意：这里定义的是应用需要的资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># RuntimeClass中定义的overhead会自动加上</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"256Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"500m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"512Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1000m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用Firecracker的Serverless函数</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> serverless</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">function</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> firecracker  </span><span class="token comment" style=color:#8292a2;font-style:italic># 快速启动的microVM</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Never</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> function</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> myregistry/function</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"/app/handler"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"128Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"200m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"256Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"500m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=示例2为不同应用选择运行时>示例2：为不同应用选择运行时<a href=#示例2为不同应用选择运行时 class=hash-link aria-label="Direct link to 示例2：为不同应用选择运行时" title="Direct link to 示例2：为不同应用选择运行时">​</a></h3>
<p>在实际场景中，你可能需要为不同类型的工作负载选择不同的运行时：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># deployment-web-runc.yaml - Web前端使用runc</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> apps/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Deployment</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> web</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">frontend</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> web</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> web</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> runc  </span><span class="token comment" style=color:#8292a2;font-style:italic># 性能要求高，安全要求一般</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token number" style=color:#ae81ff>1.25</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>80</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"128Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"100m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># deployment-api-kata.yaml - API服务使用Kata</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> apps/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Deployment</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> api</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">backend</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> api</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> api</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">security</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata  </span><span class="token comment" style=color:#8292a2;font-style:italic># 处理敏感数据，需要更强隔离</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> api</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> myregistry/api</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">server</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v2.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8080</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">env</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> DATABASE_URL</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">secretKeyRef</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> db</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">credentials</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> url</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"512Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"500m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass的工作原理>RuntimeClass的工作原理<a href=#runtimeclass的工作原理 class=hash-link aria-label="Direct link to RuntimeClass的工作原理" title="Direct link to RuntimeClass的工作原理">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=调度流程>调度流程<a href=#调度流程 class=hash-link aria-label="Direct link to 调度流程" title="Direct link to 调度流程">​</a></h3>
<p>当创建一个指定了<code>RuntimeClass</code>的<code>Pod</code>时，<code>Kubernetes</code>会执行以下步骤：</p>
<ol>
<li><strong>准入控制</strong>：<code>RuntimeClass Admission Controller</code>验证<code>RuntimeClass</code>是否存在</li>
<li><strong>资源开销注入</strong>：如果<code>RuntimeClass</code>定义了<code>overhead</code>，会将其加到<code>Pod</code>的资源请求中</li>
<li><strong>节点选择器应用</strong>：如果<code>RuntimeClass</code>定义了<code>nodeSelector</code>，会将其合并到<code>Pod</code>的<code>nodeSelector</code>中</li>
<li><strong>调度决策</strong>：<code>Scheduler</code>根据更新后的资源请求和节点选择器进行调度</li>
<li><strong>容器创建</strong>：<code>kubelet</code>调用<code>CRI</code>接口，指定对应的<code>runtime handler</code></li>
<li><strong>运行时执行</strong>：<code>containerd</code>根据<code>handler</code>调用对应的底层运行时（<code>runc</code>/<code>kata</code>等）</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=资源计算>资源计算<a href=#资源计算 class=hash-link aria-label="Direct link to 资源计算" title="Direct link to 资源计算">​</a></h3>
<p>当使用<code>RuntimeClass</code>时，<code>Pod</code>的实际资源需求 = 容器资源需求 + 运行时开销：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">Total Resources </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> Container Requests </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> RuntimeClass Overhead</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>例如：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> app</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"256Mi"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 应用需求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"500m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># RuntimeClass定义</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">overhead</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podFixed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"160Mi"</span><span class="token plain">     </span><span class="token comment" style=color:#8292a2;font-style:italic># Kata运行时开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"250m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 实际调度时使用的资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># memory: 256Mi + 160Mi = 416Mi</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># cpu: 500m + 250m = 750m</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这确保了节点有足够的资源运行虚拟机和容器。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=最佳实践>最佳实践<a href=#最佳实践 class=hash-link aria-label="Direct link to 最佳实践" title="Direct link to 最佳实践">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=合理选择运行时>合理选择运行时<a href=#合理选择运行时 class=hash-link aria-label="Direct link to 合理选择运行时" title="Direct link to 合理选择运行时">​</a></h3>
<ul>
<li><strong>通用工作负载</strong>：使用<code>runc</code>，性能最好</li>
<li><strong>多租户场景</strong>：使用<code>Kata Containers</code>，隔离性强</li>
<li><strong>Serverless/FaaS</strong>：使用<code>Firecracker</code>，启动快</li>
<li><strong>特权容器</strong>：使用安全运行时（<code>Kata</code>/<code>gVisor</code>）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=正确配置资源开销>正确配置资源开销<a href=#正确配置资源开销 class=hash-link aria-label="Direct link to 正确配置资源开销" title="Direct link to 正确配置资源开销">​</a></h3>
<p>不同运行时的资源开销差异很大，需要根据实际测试配置<code>overhead</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># runc - 几乎无开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">overhead</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podFixed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"0Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"0m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Kata Containers - 中等开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">overhead</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podFixed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"160Mi"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 虚拟机内存开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"250m"</span><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 虚拟化CPU开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Firecracker - 较小开销</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">overhead</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podFixed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"130Mi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"150m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用节点选择器>使用节点选择器<a href=#使用节点选择器 class=hash-link aria-label="Direct link to 使用节点选择器" title="Direct link to 使用节点选择器">​</a></h3>
<p>不是所有节点都支持所有运行时，使用<code>nodeSelector</code>确保<code>Pod</code>调度到正确的节点：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RuntimeClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">handler</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">scheduling</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">kata-enabled</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">kvm-support</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tolerations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"kata-only"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Exists"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">effect</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"NoSchedule"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=监控和告警>监控和告警<a href=#监控和告警 class=hash-link aria-label="Direct link to 监控和告警" title="Direct link to 监控和告警">​</a></h3>
<p>不同运行时的性能特征不同，需要针对性监控：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># Prometheus监控规则示例</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">alert</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> KataContainerHighOverhead</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">expr</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    (container_memory_working_set_bytes{pod=~".*kata.*"} </span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    / on(pod) group_left() </span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    kube_pod_container_resource_requests{resource="memory"}) > 1.5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">for</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 5m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">summary</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Kata Container内存开销过高"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=渐进式迁移>渐进式迁移<a href=#渐进式迁移 class=hash-link aria-label="Direct link to 渐进式迁移" title="Direct link to 渐进式迁移">​</a></h3>
<p>从<code>runc</code>迁移到其他运行时时，建议采用金丝雀发布：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 第一步：少量Pod使用新运行时</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> apps/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Deployment</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> app</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">canary</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kata</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 第二步：大部分仍使用runc</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> apps/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Deployment</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> app</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">stable</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>9</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> runc</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>观察<code>Canary</code>部署的性能和稳定性后，再逐步扩大新运行时的使用范围。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=常见问题>常见问题<a href=#常见问题 class=hash-link aria-label="Direct link to 常见问题" title="Direct link to 常见问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass可以动态修改吗>RuntimeClass可以动态修改吗？<a href=#runtimeclass可以动态修改吗 class=hash-link aria-label="Direct link to RuntimeClass可以动态修改吗？" title="Direct link to RuntimeClass可以动态修改吗？">​</a></h3>
<p><strong>答</strong>：不可以。<code>RuntimeClass</code>是在<code>Pod</code>创建时确定的，之后无法更改。如果需要切换运行时，必须删除并重建<code>Pod</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass如何验证pod使用了哪个runtimeclass>RuntimeClass如何验证Pod使用了哪个RuntimeClass？<a href=#runtimeclass如何验证pod使用了哪个runtimeclass class=hash-link aria-label="Direct link to RuntimeClass如何验证Pod使用了哪个RuntimeClass？" title="Direct link to RuntimeClass如何验证Pod使用了哪个RuntimeClass？">​</a></h3>
<p><strong>答</strong>：可以通过以下命令查看：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 查看Pod的RuntimeClassName字段</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get pod </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">pod-name</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-o</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>jsonpath</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>'{.spec.runtimeClassName}'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 查看Pod详情</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl describe pod </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">pod-name</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>grep</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Runtime Class"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 在节点上查看实际使用的运行时</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">crictl pods </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>grep</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">pod-name</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">crictl inspect </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">container-id</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>grep</span><span class="token plain"> runtime</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=runtimeclass会影响镜像拉取吗>RuntimeClass会影响镜像拉取吗？<a href=#runtimeclass会影响镜像拉取吗 class=hash-link aria-label="Direct link to RuntimeClass会影响镜像拉取吗？" title="Direct link to RuntimeClass会影响镜像拉取吗？">​</a></h3>
<p><strong>答</strong>：不会。镜像拉取由<code>containerd</code>统一处理，与底层运行时无关。只有在容器启动时才会使用指定的运行时。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=同一个pod的不同容器可以使用不同的runtimeclass吗>同一个Pod的不同容器可以使用不同的RuntimeClass吗？<a href=#同一个pod的不同容器可以使用不同的runtimeclass吗 class=hash-link aria-label="Direct link to 同一个Pod的不同容器可以使用不同的RuntimeClass吗？" title="Direct link to 同一个Pod的不同容器可以使用不同的RuntimeClass吗？">​</a></h3>
<p><strong>答</strong>：不可以。<code>RuntimeClass</code>是<code>Pod</code>级别的配置，同一个<code>Pod</code>内的所有容器共享相同的运行时。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用kata-containers后性能会下降多少>使用Kata Containers后性能会下降多少？<a href=#使用kata-containers后性能会下降多少 class=hash-link aria-label="Direct link to 使用Kata Containers后性能会下降多少？" title="Direct link to 使用Kata Containers后性能会下降多少？">​</a></h3>
<p><strong>答</strong>：性能影响取决于工作负载类型：</p>
<ul>
<li><strong>CPU密集型</strong>：性能损失约<code>5-10%</code></li>
<li><strong>IO密集型</strong>：性能损失约<code>10-20%</code></li>
<li><strong>网络密集型</strong>：性能损失约<code>15-25%</code></li>
<li><strong>内存占用</strong>：增加约<code>130-200MB</code>（虚拟机开销）</li>
</ul>
<p>建议在实际环境中进行压力测试，根据结果决定是否值得为了安全性付出这些性能代价。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=总结>总结<a href=#总结 class=hash-link aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p><code>RuntimeClass</code>为<code>Kubernetes</code>提供了灵活的运行时选择能力，让我们能够在同一集群中根据不同工作负载的需求选择最合适的容器运行时。通过合理使用<code>RuntimeClass</code>，可以在性能、安全性和成本之间找到最佳平衡点。</p>
<p>关键要点：</p>
<ul>
<li><code>RuntimeClass</code>从<code>v1.20</code>开始<code>GA</code>，生产环境可以放心使用</li>
<li>不同运行时适用于不同场景：<code>runc</code>适合通用场景，<code>Kata</code>适合安全敏感场景，<code>Firecracker</code>适合<code>Serverless</code></li>
<li>使用时需要注意资源开销、节点选择器、内核依赖等配置</li>
<li>建议通过准入控制器实现自动化运行时选择</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://kubernetes.io/docs/concepts/containers/runtime-class/ target=_blank rel="noopener noreferrer">Kubernetes官方文档 - Runtime Class</a></li>
<li><a href=https://katacontainers.io/ target=_blank rel="noopener noreferrer">Kata Containers官网</a></li>
<li><a href=https://github.com/firecracker-microvm/firecracker target=_blank rel="noopener noreferrer">Firecracker GitHub</a></li>
<li><a href=https://containerd.io/ target=_blank rel="noopener noreferrer">containerd官方文档</a></li>
<li><a href=https://github.com/opencontainers/runtime-spec target=_blank rel="noopener noreferrer">OCI Runtime Specification</a></li>
<li><a href=https://github.com/kubernetes/cri-api target=_blank rel="noopener noreferrer">CRI接口规范</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/kubernetes-network-policy><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Kubernetes NetworkPolicy</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/kubernetes-pvc-persistent-volume><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Kubernetes PVC持久化存储</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#前言 class="table-of-contents__link toc-highlight">前言</a><li><a href=#runtimeclass是什么 class="table-of-contents__link toc-highlight">RuntimeClass是什么？</a><ul><li><a href=#runtimeclass解决了什么问题 class="table-of-contents__link toc-highlight">RuntimeClass解决了什么问题？</a></ul><li><a href=#容器运行时技术栈详解 class="table-of-contents__link toc-highlight">容器运行时技术栈详解</a><ul><li><a href=#技术栈架构关系 class="table-of-contents__link toc-highlight">技术栈架构关系</a><li><a href=#各组件详解 class="table-of-contents__link toc-highlight">各组件详解</a><li><a href=#技术栈总结 class="table-of-contents__link toc-highlight">技术栈总结</a></ul><li><a href=#runtimeclass使用示例 class="table-of-contents__link toc-highlight">RuntimeClass使用示例</a><ul><li><a href=#环境依赖 class="table-of-contents__link toc-highlight">环境依赖</a><li><a href=#示例1创建和使用runtimeclass class="table-of-contents__link toc-highlight">示例1：创建和使用RuntimeClass</a><li><a href=#示例2为不同应用选择运行时 class="table-of-contents__link toc-highlight">示例2：为不同应用选择运行时</a></ul><li><a href=#runtimeclass的工作原理 class="table-of-contents__link toc-highlight">RuntimeClass的工作原理</a><ul><li><a href=#调度流程 class="table-of-contents__link toc-highlight">调度流程</a><li><a href=#资源计算 class="table-of-contents__link toc-highlight">资源计算</a></ul><li><a href=#最佳实践 class="table-of-contents__link toc-highlight">最佳实践</a><ul><li><a href=#合理选择运行时 class="table-of-contents__link toc-highlight">合理选择运行时</a><li><a href=#正确配置资源开销 class="table-of-contents__link toc-highlight">正确配置资源开销</a><li><a href=#使用节点选择器 class="table-of-contents__link toc-highlight">使用节点选择器</a><li><a href=#监控和告警 class="table-of-contents__link toc-highlight">监控和告警</a><li><a href=#渐进式迁移 class="table-of-contents__link toc-highlight">渐进式迁移</a></ul><li><a href=#常见问题 class="table-of-contents__link toc-highlight">常见问题</a><ul><li><a href=#runtimeclass可以动态修改吗 class="table-of-contents__link toc-highlight">RuntimeClass可以动态修改吗？</a><li><a href=#runtimeclass如何验证pod使用了哪个runtimeclass class="table-of-contents__link toc-highlight">RuntimeClass如何验证Pod使用了哪个RuntimeClass？</a><li><a href=#runtimeclass会影响镜像拉取吗 class="table-of-contents__link toc-highlight">RuntimeClass会影响镜像拉取吗？</a><li><a href=#同一个pod的不同容器可以使用不同的runtimeclass吗 class="table-of-contents__link toc-highlight">同一个Pod的不同容器可以使用不同的RuntimeClass吗？</a><li><a href=#使用kata-containers后性能会下降多少 class="table-of-contents__link toc-highlight">使用Kata Containers后性能会下降多少？</a></ul><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>