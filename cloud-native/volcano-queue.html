<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano Queue&Job/Volcano Queue详解" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano Queue详解 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-queue><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano Queue详解 | John's Blog"><meta data-rh=true name=description content="深入解析Volcano Queue的核心功能与配置方法，包括三级资源管理机制(capability/deserved/guarantee)、优先级与权重策略、队列状态控制、资源抢占机制、层级队列结构、节点组亲和性配置等高级特性。详细介绍capacity和proportion两种插件的资源分配策略，帮助用户构建高效的多租户资源管理体系。"><meta data-rh=true property=og:description content="深入解析Volcano Queue的核心功能与配置方法，包括三级资源管理机制(capability/deserved/guarantee)、优先级与权重策略、队列状态控制、资源抢占机制、层级队列结构、节点组亲和性配置等高级特性。详细介绍capacity和proportion两种插件的资源分配策略，帮助用户构建高效的多租户资源管理体系。"><meta data-rh=true name=keywords content="Volcano Queue,Volcano,资源管理,多租户,队列权重,优先级,capability,deserved,guarantee,资源抢占,层级队列,节点亲和性,reclaimable,proportion插件,capacity插件,云原生,Kubernetes,资源隔离"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-queue><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-queue hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-queue hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.3503e6ad.css><script src=/assets/js/runtime~main.a78a39dd.js defer></script><script src=/assets/js/main.260da71c.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano-queue-job>Volcano Queue&Job</a><button aria-label="Collapse sidebar category 'Volcano Queue&Job'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-queue>Volcano Queue详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-job-task-podgroup-pod>Volcano Job详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job-pod-preemption>Volcano Queue&Job&Pod资源抢占设计</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-actions-plugins>Volcano Actions&Plugins</a><button aria-label="Expand sidebar category 'Volcano Actions&Plugins'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-advanced-features>Volcano高级特性</a><button aria-label="Expand sidebar category 'Volcano高级特性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-extension-development>Volcano扩展开发</a><button aria-label="Expand sidebar category 'Volcano扩展开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-usage-notes>Volcano使用笔记</a><button aria-label="Expand sidebar category 'Volcano使用笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-introduction>Volcano基本介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-startup-parameters>Volcano启动参数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-examples>Volcano使用示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano常用注解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-config>Volcano调度器配置</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kind>Kind</a><button aria-label="Expand sidebar category 'Kind'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano-queue-job><span itemprop=name>Volcano Queue&Job</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano Queue详解</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p>本文详细介绍<code>Volcano</code>中<code>Queue</code>核心对象的关键设计以及使用。关于<code>Queue</code>的基础介绍，请参考<code>Volcano</code>基本介绍章节 <a href=/cloud-native/volcano-introduction>Volcano介绍</a>。</p>
<p><code>Queue</code>是<code>Volcano</code>调度系统中的核心概念，用于管理和分配集群资源。
它充当了资源池的角色，允许管理员将集群资源划分给不同的用户组或应用场景。该自定义资源可以很好地用于多租户场景下的资源隔离。</p>
<p>该对象的数据结构如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">                                      </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列权重，范围1-65535</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain">                                  </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                    </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列资源容量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"100"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1000Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"10"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">deserved</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                      </span><span class="token comment" style=color:#8292a2;font-style:italic># 应得资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"80"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"800Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"8"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">guarantee</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                     </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源保障配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">resource</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                    </span><span class="token comment" style=color:#8292a2;font-style:italic># 保障的资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"50"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"500Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"5"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">                              </span><span class="token comment" style=color:#8292a2;font-style:italic># 是否允许资源回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">parent</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"root"</span><span class="token plain">                                 </span><span class="token comment" style=color:#8292a2;font-style:italic># 父队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">affinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                      </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列亲和性配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeGroupAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                           </span><span class="token comment" style=color:#8292a2;font-style:italic># 节点组亲和性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"gpu-nodes"</span><span class="token plain">                            </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须调度到GPU节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"high-memory-nodes"</span><span class="token plain">                    </span><span class="token comment" style=color:#8292a2;font-style:italic># 优先调度到高内存节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeGroupAntiAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                       </span><span class="token comment" style=color:#8292a2;font-style:italic># 节点组反亲和性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"npu-nodes"</span><span class="token plain">                            </span><span class="token comment" style=color:#8292a2;font-style:italic># 不能调度到NPU节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">extendClusters</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                </span><span class="token comment" style=color:#8292a2;font-style:italic># 扩展集群配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"cluster-1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                  </span><span class="token comment" style=color:#8292a2;font-style:italic># 集群容量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1000"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1000Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"20"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在该队列对象上，我去掉了没有太大意义的一些配置项，以便更好理解队列功能。去掉的配置项如下：</p>
<ul>
<li>注解上实现的层级队列配置，如：<!-- -->
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">"volcano.sh/hierarchy"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"root/eng/prod"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">"volcano.sh/hierarchy-weights"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1/2/8"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>仅作队列类型标记使用的<code>spec.type</code>配置项，没有实际功能作用。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=资源管理机制>资源管理机制<a href=#资源管理机制 class=hash-link aria-label="Direct link to 资源管理机制" title="Direct link to 资源管理机制">​</a></h2>
<p><code>Volcano</code>的<code>Queue</code>资源对象采用了一个灵活的三级资源管理机制，这三个级别分别是：<code>capability</code>（资源上限）、<code>deserved</code>（应得资源）和<code>guarantee</code>（保障资源）。这种设计允许集群管理员精细控制资源分配，特别适合多租户环境下的资源管理。</p>
<p>资源管理机制的具体行为取决于使用的调度插件。下面分别介绍 <code>capacity</code> 插件和 <code>proportion</code> 插件的资源管理机制。</p>
<blockquote>
<p><strong>注意</strong>：</p>
<ul>
<li>使用 <code>capacity</code> 插件时：<code>capability</code>、<code>deserved</code>和<code>guarantee</code> 三项配置都按预设值严格执行。</li>
<li>使用 <code>proportion</code> 插件时：主要使用 <code>weight</code> 动态计算 <code>deserved</code>，<code>capability</code> 和 <code>guarantee</code> 仍然有效。</li>
<li>两种插件不能同时启用，需要根据实际需求选择合适的资源管理策略。</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用-capacity-插件的资源管理机制>使用 capacity 插件的资源管理机制<a href=#使用-capacity-插件的资源管理机制 class=hash-link aria-label="Direct link to 使用 capacity 插件的资源管理机制" title="Direct link to 使用 capacity 插件的资源管理机制">​</a></h3>
<p>当启用 <code>capacity</code> 插件时，<code>Queue</code>的三级资源配置（<code>capability</code>、<code>deserved</code>、<code>guarantee</code>）会严格按照预设值进行资源管理。</p>
<p><strong>1. capability（资源上限）</strong></p>
<p><strong>定义</strong>：队列能够使用的资源上限，队列中的所有作业使用的资源总和不能超过这个上限。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>代表队列能够使用的最大资源量</li>
<li>设置了资源使用的硬限制，防止单个队列过度消耗集群资源</li>
<li>可以针对多种资源类型设置（<code>CPU</code>、内存、<code>GPU</code>等）</li>
</ul>
<p><strong>示例场景</strong>： 假设一个生产队列设置了<code>capability.cpu=100</code>，那么即使集群有更多空闲资源，该队列中的所有作业使用的<code>CPU</code>总和也不能超过<code>100</code>核。</p>
<p><strong>2. deserved（应得资源）</strong></p>
<p><strong>定义</strong>：队列在资源竞争情况下应该获得的资源量，是资源分配和回收的基准线。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>当集群资源充足时(<code>allocated</code> &lt; <code>deserved</code>)，队列可以使用超过<code>deserved</code>的资源（但不超过<code>capability</code>）</li>
<li>当集群资源紧张时(<code>allocated</code> >= <code>deserved</code>)，超过<code>deserved</code>的资源可能被回收给其他队列使用</li>
<li>是资源借用和回收机制的核心参考值</li>
</ul>
<p><strong>配置建议</strong>：</p>
<ul>
<li>在同级队列场景下，所有队列的<code>deserved</code>值总和应等于集群总资源</li>
<li>在层级队列场景下，子队列的<code>deserved</code>值总和应等于父队列的<code>deserved</code>值</li>
</ul>
<p><strong>示例场景</strong>： 假设队列<code>A</code>设置了<code>deserved.cpu=80</code>，当资源充足时，它可以使用多达<code>100</code>核（<code>capability</code>上限）；但当资源紧张时，它只能保证获得<code>80</code>核，超出部分可能被回收。当资源极度紧张时，会保证后续介绍的队列<code>guarantee</code>资源，</p>
<p><strong>3. guarantee（保障资源）</strong></p>
<p><strong>定义</strong>：队列被保证能够使用的最小资源量，即使在集群资源紧张的情况下也不会被回收。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>提供了资源使用的最低保障</li>
<li>这部分资源专属于该队列，不会被其他队列借用或抢占</li>
<li>即使在资源紧张的情况下，调度器也会确保队列能获得这些资源</li>
</ul>
<p><strong>示例场景</strong>： 假设关键业务队列设置了<code>guarantee.cpu=50</code>，即使集群资源非常紧张，该队列也能保证获得<code>50</code>核<code>CPU</code>资源用于运行关键业务。</p>
<p><strong>三者之间的关系</strong></p>
<ol>
<li><strong>资源层级关系：guarantee ≤ deserved ≤ capability</strong></li>
</ol>
<ul>
<li><code>guarantee</code>是最低保障</li>
<li><code>deserved</code>是正常情况下（资源不是极度紧张情况下）应得的资源</li>
<li><code>capability</code>是最高上限</li>
</ul>
<ol start=2>
<li><strong>资源分配优先级</strong>：</li>
</ol>
<ul>
<li>首先保证所有队列的<code>guarantee</code>资源</li>
<li>然后按照<code>deserved</code>值和权重分配剩余资源</li>
<li>最后允许队列使用空闲资源，但不超过<code>capability</code></li>
</ul>
<ol start=3>
<li>
<p><strong>资源回收顺序</strong>：</p>
<ol>
<li>首先回收超出<code>capability</code>的资源</li>
</ol>
<ul>
<li>
<p>这种情况通常不会发生，因为调度器会确保队列使用的资源不超过<code>capability</code>上限</p>
</li>
</ul>
<ol start=2>
<li>回收超出<code>deserved</code>但未超出<code>capability</code>的资源</li>
</ol>
<ul>
<li>
<p>当资源紧张时，队列使用的超过<code>deserved</code>值的资源可能被回收</p>
</li>
<li>
<p>这部分资源被视为"借用"的资源，在资源紧张时需要"归还"</p>
</li>
</ul>
<ol start=3>
<li><code>guarantee</code>资源永远不会被回收</li>
</ol>
<ul>
<li>
<p><code>guarantee</code>资源是队列的最低保障，即使在极度资源紧张的情况下也不会被回收</p>
</li>
<li>
<p>这是保证关键业务稳定运行的基础</p>
</li>
</ul>
<p>如果设置<code>deserved</code>但未设置<code>guarantee</code>，就以<code>deserved</code>来保护队列资源。以<code>capacity</code>插件为例，资源回收的实现源码如下：
<img decoding=async loading=lazy alt="alt text" src=/assets/images/image-4a927ddd2d024d6c8a0c982776604b3e.png width=3412 height=1454 class=img_ev3q></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用-proportion-插件的资源管理机制>使用 proportion 插件的资源管理机制<a href=#使用-proportion-插件的资源管理机制 class=hash-link aria-label="Direct link to 使用 proportion 插件的资源管理机制" title="Direct link to 使用 proportion 插件的资源管理机制">​</a></h3>
<p>当启用 <code>proportion</code> 插件时，资源管理机制发生了重要变化，主要基于 <code>weight</code>（权重）进行动态资源分配。</p>
<p><strong>核心特点</strong>：</p>
<ol>
<li><strong>动态 deserved 计算</strong>：<code>proportion</code> 插件会忽略队列中预设的 <code>deserved</code> 值，而是基于 <code>weight</code> 动态计算每个队列的应得资源</li>
<li><strong>权重比例分配</strong>：每个队列的 <code>deserved</code> = 集群总资源 × (队列<code>weight</code> / 所有队列<code>weight</code>总和)</li>
<li><strong>简化配置</strong>：主要依赖 <code>weight</code> 和 <code>capability</code> 配置，<code>guarantee</code> 配置仍然有效</li>
</ol>
<p><strong>资源配置字段作用</strong>：</p>
<p><strong>1. weight（权重）</strong></p>
<p><strong>定义</strong>：队列在资源分配中的权重值，用于计算队列应得的资源比例。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>这是 <code>proportion</code> 插件最核心的配置参数</li>
<li>权重越大，队列获得的资源比例越高</li>
<li>动态计算：<code>deserved = 总资源 × (队列weight / 总weight)</code></li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 队列A：weight=3，队列B：weight=1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 假设集群总资源 100 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 队列A deserved = 100 × (3/4) = 75 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 队列B deserved = 100 × (1/4) = 25 CPU</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>2. capability（资源上限）</strong></p>
<p>在 <code>proportion</code> 插件中仍然作为硬限制：</p>
<ul>
<li>队列使用的资源不能超过 <code>capability</code> 设置的上限</li>
<li>与 <code>capacity</code> 插件中的作用相同</li>
</ul>
<p><strong>3. guarantee（保障资源）</strong></p>
<p>在 <code>proportion</code> 插件中的作用：</p>
<ul>
<li>仍然提供最低资源保障</li>
<li>但由于 <code>deserved</code> 是动态计算的，实际效果可能与 <code>capacity</code> 插件不同</li>
</ul>
<p><strong>资源分配流程</strong>：</p>
<ol>
<li><strong>第一轮分配</strong>：按权重比例计算每个队列的 <code>deserved</code> 资源</li>
<li><strong>约束检查</strong>：确保 <code>deserved</code> 不超过队列的 <code>capability</code>，不低于 <code>guarantee</code></li>
<li><strong>剩余资源分配</strong>：如果某些队列因 <code>capability</code> 限制无法使用全部应得资源，将剩余资源重新按权重分配给其他队列</li>
<li><strong>动态调整</strong>：当集群资源发生变化时，重新计算所有队列的 <code>deserved</code> 值</li>
</ol>
<p><strong>与 capacity 插件的关键区别</strong>：</p>
<table><thead><tr><th>特性<th>capacity 插件<th>proportion 插件<tbody><tr><td><code>deserved</code> 来源<td>队列配置中的固定值<td>基于 <code>weight</code> 动态计算<tr><td>主要配置参数<td><code>capability</code>、<code>deserved</code>、<code>guarantee</code><td><code>weight</code>、<code>capability</code>、<code>guarantee</code><tr><td>资源分配策略<td>静态预分配<td>动态权重分配<tr><td>配置复杂度<td>较高（需要精确设置三个资源值）<td>较低（主要配置 <code>weight</code>）<tr><td>适用场景<td>需要精确资源控制的环境<td>需要灵活资源分配的环境<tr><td>资源利用率<td>较低（预留资源可能闲置）<td>较高（动态分配未使用资源）</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=优先级与权重>优先级与权重<a href=#优先级与权重 class=hash-link aria-label="Direct link to 优先级与权重" title="Direct link to 优先级与权重">​</a></h2>
<p><code>Volcano</code>队列系统中的<code>priority</code>（优先级）和<code>weight</code>（权重）是两个不同的概念，它们在资源分配和抢占机制中扮演不同的角色：</p>
<p><strong>1. priority（优先级）</strong></p>
<p><strong>定义</strong>：队列的优先级，用于确定队列间资源分配和抢占的顺序。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>优先级是绝对的，高优先级队列总是比低优先级队列先获得资源</li>
<li>在资源紧张时，高优先级队列可以抢占（<code>reclaim</code>）低优先级队列的资源</li>
<li>优先级值越大，队列优先级越高</li>
<li>优先级是队列间资源竞争的第一决定因素</li>
</ul>
<p><strong>使用场景</strong>：</p>
<ul>
<li>区分生产环境和开发环境队列</li>
<li>确保关键业务队列优先获得资源</li>
<li>实现多租户环境中的资源优先级策略</li>
</ul>
<p><strong>优先级示例</strong>：</p>
<ul>
<li>如果队列<code>A</code>的优先级为<code>100</code>，队列<code>B</code>的优先级为<code>50</code>，当有很多任务处于<code>Pending</code>状态时，那么队列<code>A</code>的任务会优先获得调度。</li>
</ul>
<p><strong>2. weight（权重）</strong></p>
<p><strong>定义</strong>：队列的权重，用于在优先级相同的队列之间按比例分配资源。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>权重是相对的，只在优先级相同的队列之间起作用</li>
<li>权重决定了队列获得资源的比例，而不是绝对优先顺序</li>
<li>权重值越大，在同优先级队列中获得的资源比例越高</li>
<li>权重是队列间资源竞争的第二决定因素（优先级相同时才考虑权重）</li>
</ul>
<p><strong>使用场景</strong>：</p>
<ul>
<li>在同一部门的多个项目队列之间分配资源</li>
<li>实现资源的按比例分配策略</li>
<li>在非抢占场景下微调资源分配</li>
<li><strong>在使用 <code>proportion</code> 插件时</strong>：<code>weight</code> 成为动态计算 <code>deserved</code> 资源的核心参数</li>
</ul>
<p><strong>两者关系</strong>：</p>
<ol>
<li><strong>决策顺序</strong>：调度器首先根据优先级（<code>priority</code>）排序队列，然后才考虑权重（<code>weight</code>）</li>
<li><strong>资源分配</strong>：<!-- -->
<ul>
<li>不同优先级：高优先级队列可以抢占低优先级队列的资源</li>
<li>相同优先级：根据权重按比例分配资源</li>
</ul>
</li>
</ol>
<p><strong>权重示例</strong>：</p>
<ul>
<li>如果队列<code>A</code>的优先级为<code>100</code>，队列<code>B</code>的优先级为<code>50</code>，那么即使队列<code>B</code>的权重远高于队列<code>A</code>，队列<code>A</code>仍然会优先获得资源。</li>
<li>如果队列<code>C</code>和队列<code>D</code>的优先级都是<code>100</code>，权重分别是<code>2</code>和<code>1</code>，那么在资源分配时，队列<code>C</code>会获得约<code>2/3</code>的资源，队列<code>D</code>获得约<code>1/3</code>的资源。</li>
<li>当队列<code>A</code>和队列<code>B</code>的优先级都为<code>100</code>时，队列<code>A</code>的权重为<code>1</code>，队列<code>B</code>的权重为<code>2</code>，当有很多任务处于<code>Pending</code>状态时，那么队列<code>B</code>会优先获得调度。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=queue状态>Queue状态<a href=#queue状态 class=hash-link aria-label="Direct link to Queue状态" title="Direct link to Queue状态">​</a></h2>
<p><code>Volcano Queue</code>有四种状态，用于控制队列的行为和作业调度。这些状态在集群维护和资源管理中非常重要。</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// QueueState is state type of queue.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> QueueState </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// QueueStateOpen indicate `Open` state of queue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	QueueStateOpen QueueState </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Open"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// QueueStateClosed indicate `Closed` state of queue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	QueueStateClosed QueueState </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Closed"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// QueueStateClosing indicate `Closing` state of queue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	QueueStateClosing QueueState </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Closing"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// QueueStateUnknown indicate `Unknown` state of queue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	QueueStateUnknown QueueState </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Unknown"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=状态状态类型>状态状态类型<a href=#状态状态类型 class=hash-link aria-label="Direct link to 状态状态类型" title="Direct link to 状态状态类型">​</a></h3>
<ol>
<li>
<p><strong><code>Open</code></strong>：开放</p>
<ul>
<li>队列处于正常工作状态</li>
<li>可以接受新的作业提交</li>
<li>队列中的作业可以被正常调度执行</li>
<li>这是队列的默认状态</li>
</ul>
</li>
<li>
<p><strong><code>Closing</code></strong>：关闭中</p>
<ul>
<li>队列正在关闭的过渡状态</li>
<li>不再接受新的作业提交</li>
<li>已有作业仍然可以继续运行</li>
<li>当队列中所有作业都完成后，队列会转变为<code>Closed</code>状态</li>
</ul>
</li>
<li>
<p><strong><code>Closed</code></strong>：已关闭</p>
<ul>
<li>队列完全关闭状态</li>
<li>不接受新的作业提交</li>
<li>队列中的作业不会被调度（即使有足够的资源）</li>
<li>通常用于系统维护或资源重新分配</li>
</ul>
</li>
<li>
<p><strong><code>Unknown</code></strong>：未知</p>
<ul>
<li>队列状态不明确</li>
<li>通常是由于系统错误或通信问题导致</li>
<li>控制器会尝试将队列恢复到已知状态</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=检查队列状态>检查队列状态<a href=#检查队列状态 class=hash-link aria-label="Direct link to 检查队列状态" title="Direct link to 检查队列状态">​</a></h3>
<p>要检查队列的当前状态，可以使用以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 查看单个队列状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get queue </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">队列名称</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-o</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>jsonpath</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>'{.status.state}'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 查看所有队列状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get queue </span><span class="token parameter variable" style=color:#f8f8f2>-o</span><span class="token plain"> custom-columns</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">NAME:.metadata.name,STATE:.status.state</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=状态控制>状态控制<a href=#状态控制 class=hash-link aria-label="Direct link to 状态控制" title="Direct link to 状态控制">​</a></h3>
<p><code>Volcano</code>使用命令（Command）机制来控制队列的状态，而不是通过直接修改<code>Queue</code>对象的字段。以下是控制队列状态的方法：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=方式一使用kubectl-vc命令行工具推荐>方式一：使用<code>kubectl vc</code>命令行工具（推荐）<a href=#方式一使用kubectl-vc命令行工具推荐 class=hash-link aria-label="Direct link to 方式一使用kubectl-vc命令行工具推荐" title="Direct link to 方式一使用kubectl-vc命令行工具推荐">​</a></h4>
<p><code>Volcano</code>提供了专门的命令行工具来操作队列：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 关闭队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl vc queue operate </span><span class="token parameter variable" style=color:#f8f8f2>--action</span><span class="token plain"> close </span><span class="token parameter variable" style=color:#f8f8f2>--name</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">队列名称</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 开启队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl vc queue operate </span><span class="token parameter variable" style=color:#f8f8f2>--action</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>open</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--name</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">队列名称</span><span class="token operator" style=color:#66d9ef>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=方式二创建command资源>方式二：创建<code>Command</code>资源<a href=#方式二创建command资源 class=hash-link aria-label="Direct link to 方式二创建command资源" title="Direct link to 方式二创建command资源">​</a></h4>
<p>如果需要以编程方式或在自动化脚本中控制队列状态，可以创建<code>Command</code>资源：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> bus.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Command</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">generateName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">name</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">close</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 会自动生成唯一名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">ownerReferences</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;队列名称</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">uid</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;队列UID</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 需要获取队列的实际UID</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">targetObject</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;队列名称</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">uid</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;队列UID</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> CloseQueue  </span><span class="token comment" style=color:#8292a2;font-style:italic># 或 OpenQueue</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=方式三使用volcano-api客户端>方式三：使用Volcano API客户端<a href=#方式三使用volcano-api客户端 class=hash-link aria-label="Direct link to 方式三：使用Volcano API客户端" title="Direct link to 方式三：使用Volcano API客户端">​</a></h4>
<p>在<code>Go</code>程序中，可以使用<code>Volcano</code>的客户端库：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"context"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"fmt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    metav1 </span><span class="token string" style=color:#a6e22e>"k8s.io/apimachinery/pkg/apis/meta/v1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"volcano.sh/apis/pkg/apis/bus/v1alpha1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"volcano.sh/apis/pkg/client/clientset/versioned"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>closeQueue</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">client </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">versioned</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Clientset</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queueName </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 获取队列信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    queue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> client</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>SchedulingV1beta1</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Queues</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Get</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>TODO</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queueName</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> metav1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">GetOptions</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> err</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 创建控制器引用</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ctrlRef </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> metav1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>NewControllerRef</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> v1beta1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">SchemeGroupVersion</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>WithKind</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Queue"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 创建命令</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cmd </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">v1alpha1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Command</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        ObjectMeta</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> metav1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ObjectMeta</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            GenerateName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprintf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"%s-close-"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            OwnerReferences</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">metav1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">OwnerReference</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">ctrlRef</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        TargetObject</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ctrlRef</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        Action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">       </span><span class="token function" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">v1alpha1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CloseQueueAction</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 提交命令</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> client</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>BusV1alpha1</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Commands</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Namespace</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Create</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>TODO</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> cmd</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> metav1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CreateOptions</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> err</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=资源抢占机制>资源抢占机制<a href=#资源抢占机制 class=hash-link aria-label="Direct link to 资源抢占机制" title="Direct link to 资源抢占机制">​</a></h2>
<p>在<code>Volcano</code>中，资源抢占有两种主要实现方式：基于<code>Queue</code>属性的抢占和基于<code>PriorityClass</code>的抢占。</p>
<p><strong>注意事项：</strong></p>
<p>要使<code>queue</code>的<code>reclaimable</code>配置真正生效，必须在<code>Volcano</code>调度器配置中同时启用<code>preempt</code>动作（<code>action</code>）和<code>reclaim</code>动作（<code>action</code>）。</p>
<p><strong>调度器配置示例：</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue, allocate, preempt, reclaim, backfill"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 其他配置...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li><code>actions</code>字段中必须包含<code>reclaim</code></li>
<li><code>tiers</code>结构中的某个插件层级中必须包含<code>name: reclaim</code>的插件配置</li>
</ul>
<p>如果未启用<code>preempt</code>或<code>reclaim</code> <code>action</code>，即使配置了<code>reclaimable: true</code>，也不会有实际效果。</p>
<ol>
<li><code>reclaim action</code>负责识别可回收的资源并执行回收操作，但它依赖于<code>preempt</code>插件提供的抢占机制来实际终止（<code>kill</code>）低优先级队列中的任务。</li>
<li>在<code>Volcano</code>的实现中，<code>reclaim action</code>会调用<code>preempt</code>插件注册的回调函数来判断哪些任务可以被回收，如果没有启用<code>preempt action</code>，这个过程就无法完成。</li>
<li>资源回收的完整流程需要两个<code>action</code>协同工作：</li>
</ol>
<ul>
<li><code>reclaim action</code>负责识别资源紧张的情况并触发回收流程</li>
<li><code>preempt action</code>负责实际执行抢占操作，包括终止低优先级任务</li>
</ul>
<p><strong>1. 基于 Queue 属性的抢占</strong></p>
<p>这种抢占机制主要基于队列的<code>weight</code>和<code>reclaimable</code>属性组合实现。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>当集群资源紧张时，<code>Volcano</code>可能会从低<code>weight</code>队列中回收资源，以满足高<code>weight</code>队列的需求</li>
<li>这种回收可能包括终止低<code>weight</code>队列中的任务</li>
<li>当<code>reclaimable</code>设置为<code>true</code>时，该队列的资源可被回收或抢占</li>
<li>当发生队列级别的资源抢占时，被回收队列中的部分任务（<code>Pod</code>）会被调度器直接终止（<code>kill</code>），以释放资源给高优先级队列使用。</li>
</ul>
<p><strong>抢占条件</strong>：</p>
<ul>
<li>被抢占队列的<code>reclaimable</code>属性必须设置为<code>true</code></li>
<li>抢占通常只发生在资源极度紧张且无法满足高<code>weight</code>队列的<code>guarantee</code>资源需求时</li>
</ul>
<p><strong>2. 基于 PriorityClass 的抢占</strong></p>
<p>虽然<code>Queue</code>对象本身没有<code>priorityClassName</code>属性，但<code>Volcano</code>与<code>Kubernetes</code>的<code>PriorityClass</code>机制集成，在<code>PodGroup</code>（作业组）级别支持基于优先级的抢占。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li>要使<code>PodGroup</code>基于<code>PriorityClass</code>的强占生效，必须要<code>Volcano</code>调度器启用<code>preempt</code>动作（<code>action</code>），因为<code>PodGroup</code>是<code>Volcano</code>的自定义资源。</li>
<li>如果是其他<code>Kubernetes</code>原生资源如<code>Pod</code>，则不需要<code>Volcano</code>调度器，<code>Kubernetes</code>原生能力已支持。当高优先级<code>Pod</code>无法调度时，<code>kube-scheduler</code>会尝试抢占低优先级<code>Pod</code>。</li>
</ul>
<p><strong>工作原理</strong>：</p>
<ul>
<li><code>PodGroup</code>可以设置<code>priorityClassName</code>属性，关联到<code>Kubernetes</code>的<code>PriorityClass</code>资源</li>
<li>每个<code>PriorityClass</code>对应一个整数值，表示优先级</li>
<li>当集群资源紧张时，高优先级的<code>PodGroup</code>可以抢占低优先级的<code>PodGroup</code>资源</li>
<li>这种抢占是通过终止（<code>kill</code>）低优先级<code>PodGroup</code>中的<code>Pod</code>来实现的</li>
</ul>
<p><strong>示例配置</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 在Kubernetes中定义PriorityClass</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PriorityClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">globalDefault</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"This priority class should be used for critical production jobs"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 在PodGroup中使用PriorityClass</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> critical</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 关联到上面定义的PriorityClass</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>3. 两种抢占机制的区别与配合</strong></p>
<p><strong>作用范围不同</strong>：</p>
<ul>
<li><code>Queue</code>属性抢占是队列级别的，影响整个队列的资源分配</li>
<li><code>PriorityClass</code>抢占是<code>PodGroup</code>级别的，可以跨队列进行抢占</li>
</ul>
<p><strong>决策依据不同</strong>：</p>
<ul>
<li><code>Queue</code>属性抢占主要基于<code>weight</code>和<code>reclaimable</code>属性</li>
<li><code>PriorityClass</code>抢占主要基于<code>PriorityClass</code>的优先级值</li>
</ul>
<p><strong>应用场景不同</strong>：</p>
<ul>
<li><code>Queue</code>属性抢占适用于资源分组和多租户场景，实现队列间的资源隔离</li>
<li><code>PriorityClass</code>抢占适用于同一队列内或跨队列的作业优先级管理</li>
</ul>
<p><strong>配合使用</strong>：</p>
<ul>
<li>在实际使用中，这两种机制可以配合使用</li>
<li>首先基于<code>Queue</code>属性进行队列级别的资源分配</li>
<li>然后基于<code>PriorityClass</code>在队列内部或跨队列进行细粒度的作业优先级管理</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=层级队列>层级队列<a href=#层级队列 class=hash-link aria-label="Direct link to 层级队列" title="Direct link to 层级队列">​</a></h2>
<p>在<code>Volcano</code>中，层级队列结构是一种特殊的资源管理方式，允许将队列组织成树形结构，实现更精细的资源分配和控制。<code>Volcano</code>支持层级队列结构，允许根据组织结构或业务需求创建多层次的队列体系。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=层级队列的配置方式>层级队列的配置方式<a href=#层级队列的配置方式 class=hash-link aria-label="Direct link to 层级队列的配置方式" title="Direct link to 层级队列的配置方式">​</a></h3>
<p>在<code>Volcano</code>中，通过<code>spec.parent</code>属性可以简单直接地配置层级队列关系：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> dev</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">parent</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"root.eng"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定父队列，使用点号分隔层级</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=层级队列的使用示例>层级队列的使用示例<a href=#层级队列的使用示例 class=hash-link aria-label="Direct link to 层级队列的使用示例" title="Direct link to 层级队列的使用示例">​</a></h3>
<p>下面是一个使用<code>parent</code>属性创建三层队列结构的示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 根队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> root</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 工程部队列（第二层）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> eng</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">parent</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"root"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定父队列为root</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 开发环境队列（第三层）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> dev</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">parent</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"root.eng"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定父队列为root.eng</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=层级队列的工作原理>层级队列的工作原理<a href=#层级队列的工作原理 class=hash-link aria-label="Direct link to 层级队列的工作原理" title="Direct link to 层级队列的工作原理">​</a></h3>
<p>层级队列的资源分配遵循以下原则：</p>
<ul>
<li><strong>自上而下的资源分配</strong>：集群资源首先分配给根队列，然后根队列将资源分配给子队列，以此类推</li>
<li><strong>权重比例分配</strong>：同一父队列下的子队列根据其权重比例分配资源</li>
<li><strong>资源限制</strong>：子队列的<code>deserved</code>资源总和不能超过父队列的<code>deserved</code>资源</li>
<li><strong>资源继承</strong>：如果子队列没有设置<code>capability</code>，它会继承父队列的<code>capability</code>值</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=层级队列的资源回收与抢占>层级队列的资源回收与抢占<a href=#层级队列的资源回收与抢占 class=hash-link aria-label="Direct link to 层级队列的资源回收与抢占" title="Direct link to 层级队列的资源回收与抢占">​</a></h3>
<p>层级队列中的资源回收遵循特定的规则：</p>
<ul>
<li><strong>同级队列优先</strong>：当资源紧张时，会优先从同级的队列中回收资源</li>
<li><strong>层级传递</strong>：如果同级队列的资源回收不足，会向上传递资源需求，由父队列协调资源</li>
<li><strong>保障机制</strong>：即使在资源紧张时，也会保证队列的<code>guarantee</code>资源不被回收</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=层级队列的优势>层级队列的优势<a href=#层级队列的优势 class=hash-link aria-label="Direct link to 层级队列的优势" title="Direct link to 层级队列的优势">​</a></h3>
<ul>
<li><strong>组织结构映射</strong>：可以直接映射企业的组织结构，如部门/团队/项目</li>
<li><strong>精细化资源管理</strong>：实现多层次的资源配额和限制</li>
<li><strong>灵活的资源共享</strong>：同一父队列下的子队列可以共享资源</li>
<li><strong>简化管理</strong>：可以在父队列级别设置策略，自动应用到所有子队列</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=队列亲和性affinity>队列亲和性（affinity）<a href=#队列亲和性affinity class=hash-link aria-label="Direct link to 队列亲和性（affinity）" title="Direct link to 队列亲和性（affinity）">​</a></h2>
<p><code>Volcano</code>的<code>Queue</code>对象提供了强大的亲和性配置功能，允许管理员控制队列中的任务应该调度到哪些节点上。这一功能特别适用于需要特定硬件资源（如<code>GPU</code>、高内存节点）的工作负载。</p>
<blockquote>
<p><strong>注意</strong>：<code>Queue</code>的<code>affinity</code>配置<strong>必须</strong>启用<code>nodegroup</code>插件才能生效。该插件负责解析队列的亲和性配置并在调度过程中应用这些规则。如果未启用<code>nodegroup</code>插件，即使在<code>Queue</code>对象中配置了<code>affinity</code>，这些配置也不会影响调度决策。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=节点组介绍>节点组介绍<a href=#节点组介绍 class=hash-link aria-label="Direct link to 节点组介绍" title="Direct link to 节点组介绍">​</a></h3>
<p>节点组是<code>Volcano</code>中的一个逻辑概念，用于将具有相似特性或用途的节点归类管理。节点组通过节点标签 <code>volcano.sh/nodegroup-name</code> 来定义。</p>
<p><strong>核心原理：</strong></p>
<ol>
<li><strong>标签驱动分组</strong>：<code>Volcano</code>通过读取节点上的 <code>volcano.sh/nodegroup-name</code> 标签值来识别节点所属的组</li>
<li><strong>调度时匹配</strong>：当调度器处理带有 <code>nodeGroupAffinity</code> 的队列时，会根据节点组名称进行匹配过滤</li>
<li><strong>动态管理</strong>：节点组是动态的，可以随时通过修改节点标签来调整节点的分组归属</li>
</ol>
<p><strong>节点标签定义示例：</strong></p>
<p>以下是不同类型节点的标签配置示例，展示了如何通过标签将节点分配到不同的节点组：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># GPU 计算节点 - 属于 gpu-nodes 节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/nodegroup-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">nodes    </span><span class="token comment" style=color:#8292a2;font-style:italic># 关键标签：定义节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu.present</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu.count</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"8"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 其他标签...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ... 节点规格配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># NPU 计算节点 - 属于 npu-nodes 节点组（用于反亲和性排除）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> npu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/nodegroup-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> npu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">nodes    </span><span class="token comment" style=color:#8292a2;font-style:italic># 关键标签：定义节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 其他标签...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ... 节点规格配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 测试节点 - 属于 test-nodes 节点组（用于反亲和性排除）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> test</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/nodegroup-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> test</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">nodes    </span><span class="token comment" style=color:#8292a2;font-style:italic># 关键标签：定义节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 其他标签...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ... 节点规格配置</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>工作流程：</strong></p>
<ol>
<li><strong>节点注册</strong>：节点启动时，通过标签 <code>volcano.sh/nodegroup-name</code> 声明自己属于哪个节点组</li>
<li><strong>队列配置</strong>：管理员在<code>Queue</code>中配置<code>nodeGroupAffinity</code>，指定允许或禁止的节点组</li>
<li><strong>调度决策</strong>：当<code>Pod</code>需要调度时，<code>Volcano</code>调度器会：<!-- -->
<ul>
<li>读取<code>Pod</code>所属队列的<code>nodeGroupAffinity</code>配置</li>
<li>遍历候选节点，检查每个节点的 <code>volcano.sh/nodegroup-name</code> 标签</li>
<li>根据亲和性规则过滤节点，只保留符合要求的节点</li>
<li>在符合条件的节点中进行最终调度选择</li>
</ul>
</li>
</ol>
<p><strong>与 nodeAffinity 的区别：</strong></p>
<table><thead><tr><th>特性<th>nodeGroupAffinity<th>nodeAffinity<tbody><tr><td><strong>抽象层次</strong><td>节点组级别，基于逻辑分组<td>节点级别，基于具体标签<tr><td><strong>配置复杂度</strong><td>简单，直接指定组名<td>复杂，需要<code>matchExpressions</code><tr><td><strong>管理方式</strong><td>统一管理节点组，便于批量操作<td>需要管理具体的节点标签规则<tr><td><strong>适用场景</strong><td>大规模集群的节点分组管理<td>精确的节点选择控制<tr><td><strong>配置示例</strong><td><code>["gpu-nodes", "npu-nodes"]</code><td><code>matchExpressions: [{key: "nvidia.com/gpu.present", operator: In, values: ["true"]}]</code></table>
<p>这种设计使得节点组管理更加灵活和可扩展，特别适合大规模、多租户的集群环境。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=亲和性类型>亲和性类型<a href=#亲和性类型 class=hash-link aria-label="Direct link to 亲和性类型" title="Direct link to 亲和性类型">​</a></h3>
<p><code>Queue</code>的<code>affinity</code>配置支持两种主要类型：</p>
<ol>
<li>
<p><strong>节点组亲和性（<code>nodeGroupAffinity</code>）</strong>：指定队列中的任务应该调度到的节点组</p>
</li>
<li>
<p><strong>节点组反亲和性（<code>nodeGroupAntiAffinity</code>）</strong>：指定队列中的任务不应该调度到的节点组</p>
</li>
</ol>
<p>每种亲和性类型又分为两个级别：</p>
<ul>
<li><strong><code>requiredDuringSchedulingIgnoredDuringExecution</code></strong>：必须满足的亲和性规则，如果不满足，任务将不会被调度</li>
<li><strong><code>preferredDuringSchedulingIgnoredDuringExecution</code></strong>：优先满足的亲和性规则，如果不满足，任务仍然可以被调度到其他节点</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=配置示例>配置示例<a href=#配置示例 class=hash-link aria-label="Direct link to 配置示例" title="Direct link to 配置示例">​</a></h3>
<p>下面是一个完整的<code>Queue</code>亲和性配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">workloads</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">affinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 节点组亲和性配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeGroupAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须满足的亲和性规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"gpu-nodes"</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须调度到标记为 gpu-nodes 的节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 节点组反亲和性配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeGroupAntiAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须满足的反亲和性规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"test-nodes"</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 不能调度到标记为 test-nodes 的节点组</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=工作原理>工作原理<a href=#工作原理 class=hash-link aria-label="Direct link to 工作原理" title="Direct link to 工作原理">​</a></h3>
<p>当<code>Volcano</code>调度器为队列中的任务选择节点时，会根据队列的<code>affinity</code>配置进行过滤：</p>
<ol>
<li>
<p><strong>必需亲和性（<code>Required Affinity</code>）</strong>：</p>
<ul>
<li>如果配置了<code>nodeGroupAffinity.requiredDuringSchedulingIgnoredDuringExecution</code>，任务只能调度到指定的节点组</li>
<li>如果配置了<code>nodeGroupAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution</code>，任务不能调度到指定的节点组</li>
</ul>
</li>
<li>
<p><strong>首选亲和性（<code>Preferred Affinity</code>）</strong>：</p>
<ul>
<li>在满足必需亲和性的前提下，调度器会优先选择满足<code>preferredDuringSchedulingIgnoredDuringExecution</code>规则的节点</li>
</ul>
</li>
<li>
<p><strong>与Pod亲和性的关系</strong>：</p>
<ul>
<li><code>Queue</code>的亲和性配置不会直接修改<code>Pod</code>的<code>.spec.affinity</code>字段</li>
<li>而是在调度决策过程中通过<code>nodegroup</code>插件应用这些规则</li>
<li>调度器会首先查看要调度的<code>Pod</code>所属的<code>PodGroup</code>，然后确定其所属的<code>Queue</code></li>
<li>在节点筛选阶段，同时考虑<code>Pod</code>自身的亲和性和<code>Queue</code>的亲和性规则</li>
</ul>
</li>
<li>
<p><strong>优先级顺序</strong>：</p>
<ul>
<li><code>Pod</code>自身的亲和性规则优先级最高</li>
<li><code>Queue</code>的亲和性规则是额外的约束条件</li>
<li>两者都必须满足才能完成调度</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=扩展集群extendclusters>扩展集群（extendClusters）<a href=#扩展集群extendclusters class=hash-link aria-label="Direct link to 扩展集群（extendClusters）" title="Direct link to 扩展集群（extendClusters）">​</a></h2>
<p><code>Volcano</code>的<code>Queue</code>对象提供了<code>extendClusters</code>配置，允许将队列中的作业调度到多个集群中。这一功能在多集群管理和混合云场景中特别有用。</p>
<blockquote>
<p><strong>注意</strong>：要使<code>Queue</code>的<code>extendClusters</code>配置生效，需要启用<code>Volcano</code>的多集群调度功能，并配置相应的集群连接信息。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=配置结构>配置结构<a href=#配置结构 class=hash-link aria-label="Direct link to 配置结构" title="Direct link to 配置结构">​</a></h3>
<p><code>extendClusters</code>字段是一个数组，每个元素定义了一个扩展集群及其相关属性：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">extendClusters</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"cluster-1"</span><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 集群名称，必须与多集群配置中的名称匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 集群权重，影响作业分配到该集群的概率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 集群容量限制</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token plain">          </span><span class="token comment" style=color:#8292a2;font-style:italic># CPU容量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 1000Gi     </span><span class="token comment" style=color:#8292a2;font-style:italic># 内存容量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"cluster-2"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>500</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 500Gi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>主要属性说明：</p>
<ol>
<li>
<p><strong>name</strong>：指定扩展集群的名称，必须与<code>Volcano</code>多集群配置中定义的集群名称相匹配</p>
</li>
<li>
<p><strong>weight</strong>：集群的权重，决定了在多集群调度场景下，作业被调度到该集群的优先级</p>
<ul>
<li>权重越高，该集群被选中的概率越大</li>
<li>当多个集群都满足作业调度要求时，权重起到决定性作用</li>
</ul>
</li>
<li>
<p><strong>capacity</strong>：定义该队列在指定集群中可以使用的资源上限</p>
<ul>
<li>可以指定多种资源类型，如CPU、内存、GPU等</li>
<li>队列中的作业在该集群上使用的资源总和不能超过这个限制</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=工作原理-1>工作原理<a href=#工作原理-1 class=hash-link aria-label="Direct link to 工作原理" title="Direct link to 工作原理">​</a></h3>
<p>当启用多集群调度功能时，<code>Volcano</code>调度器会根据以下流程处理队列的<code>extendClusters</code>配置：</p>
<ol>
<li>
<p><strong>集群选择</strong>：</p>
<ul>
<li>调度器首先检查作业所属队列的<code>extendClusters</code>配置</li>
<li>根据各集群的<code>weight</code>和当前资源状态，选择最合适的集群</li>
</ul>
</li>
<li>
<p><strong>资源限制检查</strong>：</p>
<ul>
<li>检查选中集群的<code>capacity</code>配置</li>
<li>确保队列在该集群上的资源使用不超过限制</li>
</ul>
</li>
<li>
<p><strong>跨集群调度</strong>：</p>
<ul>
<li>将作业调度到选中的集群中执行</li>
<li>维护作业与集群的映射关系</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=应用场景>应用场景<a href=#应用场景 class=hash-link aria-label="Direct link to 应用场景" title="Direct link to 应用场景">​</a></h3>
<ol>
<li>
<p><strong>资源池扩展</strong>：当主集群资源不足时，可以将作业调度到其他集群，扩展资源池</p>
</li>
<li>
<p><strong>混合云管理</strong>：允许将作业分配到不同的云环境（公有云、私有云、混合云）</p>
</li>
<li>
<p><strong>地理分布式部署</strong>：将作业分配到不同地理位置的集群，实现全球资源调度</p>
</li>
<li>
<p><strong>特定资源类型的分配</strong>：将需要特定硬件（如GPU、FPGA）的作业调度到配备这些资源的集群</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=配置示例-1>配置示例<a href=#配置示例-1 class=hash-link aria-label="Direct link to 配置示例" title="Direct link to 配置示例">​</a></h3>
<p>下面是一个完整的使用<code>extendClusters</code>的<code>Queue</code>配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> multi</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cluster</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4000Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 扩展集群配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">extendClusters</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"on-premise-cluster"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 本地数据中心集群</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">                 </span><span class="token comment" style=color:#8292a2;font-style:italic># 高权重，优先使用</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"cloud-cluster-a"</span><span class="token plain">     </span><span class="token comment" style=color:#8292a2;font-style:italic># 公有云集群A</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">                  </span><span class="token comment" style=color:#8292a2;font-style:italic># 中等权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>500</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 1000Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"cloud-cluster-b"</span><span class="token plain">     </span><span class="token comment" style=color:#8292a2;font-style:italic># 公有云集群B</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain">                  </span><span class="token comment" style=color:#8292a2;font-style:italic># 低权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>500</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 1000Gi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个配置中：</p>
<ul>
<li>队列的作业会优先调度到权重为10的<code>on-premise-cluster</code>集群</li>
<li>当本地集群资源不足或不满足作业要求时，会考虑调度到公有云集群</li>
<li>每个集群都有各自的资源限制，确保队列不会过度使用某一集群的资源</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用注意事项>使用注意事项<a href=#使用注意事项 class=hash-link aria-label="Direct link to 使用注意事项" title="Direct link to 使用注意事项">​</a></h3>
<ol>
<li>
<p><strong>多集群配置</strong>：使用<code>extendClusters</code>前，需要先在<code>Volcano</code>调度器中配置多集群环境</p>
</li>
<li>
<p><strong>集群连通性</strong>：确保各集群之间的网络连通性，特别是对于跨地域部署的集群</p>
</li>
<li>
<p><strong>资源类型兼容性</strong>：确保不同集群的资源类型定义一致，否则可能导致调度失败</p>
</li>
<li>
<p><strong>性能影响</strong>：跨集群调度可能引入额外的网络延迟和性能开销，需要考虑这些因素</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=队列使用方式>队列使用方式<a href=#�队列使用方式 class=hash-link aria-label="Direct link to 队列使用方式" title="Direct link to 队列使用方式">​</a></h2>
<p><code>Volcano Queue</code>可以与多种<code>Kubernetes</code>工作负载类型结合使用。以下是不同工作负载类型如何关联到指定队列的示例：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-volcano-job>1. Volcano Job<a href=#1-volcano-job class=hash-link aria-label="Direct link to 1. Volcano Job" title="Direct link to 1. Volcano Job">​</a></h3>
<p><code>Volcano Job</code>可以直接在定义中指定队列名称：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> distributed</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ai</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定队列名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ps</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">gpu</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-kubernetes-pod>2. Kubernetes Pod<a href=#2-kubernetes-pod class=hash-link aria-label="Direct link to 2. Kubernetes Pod" title="Direct link to 2. Kubernetes Pod">​</a></h3>
<p>对于普通的<code>Kubernetes Pod</code>，可以通过添加特定注解来指定队列：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">inference</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/queue-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"inference-queue"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定队列名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano  </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须指定使用volcano调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> inference</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-kubernetes-deployment>3. Kubernetes Deployment<a href=#3-kubernetes-deployment class=hash-link aria-label="Direct link to 3. Kubernetes Deployment" title="Direct link to 3. Kubernetes Deployment">​</a></h3>
<p>对于<code>Deployment</code>，需要在<code>Pod</code>模板中添加相关注解：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> apps/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Deployment</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> web</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> web</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> web</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">volcano.sh/queue-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"web-queue"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 通过labels指定队列名称（推荐方式，便于查询）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 也可以通过annotations指定队列名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># annotations:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic>#   volcano.sh/queue-name: "web-queue"  </span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano  </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须指定使用volcano调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>注意：使用labels方式关联队列有助于通过标签选择器快速查询属于特定队列的Pod，例如：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get pods </span><span class="token parameter variable" style=color:#f8f8f2>-l</span><span class="token plain"> volcano.sh/queue-name</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">web-queue</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-kubernetes-statefulset>4. Kubernetes StatefulSet<a href=#4-kubernetes-statefulset class=hash-link aria-label="Direct link to 4. Kubernetes StatefulSet" title="Direct link to 4. Kubernetes StatefulSet">​</a></h3>
<p><code>StatefulSet</code>的配置方式与<code>Deployment</code>类似：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> apps/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> StatefulSet</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> database</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">serviceName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"db"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> database</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> database</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">volcano.sh/queue-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"db-queue"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定队列名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano  </span><span class="token comment" style=color:#8292a2;font-style:italic># 必须指定使用volcano调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> mysql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> mysql</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token number" style=color:#ae81ff>5.7</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5-podgroup>5. PodGroup<a href=#5-podgroup class=hash-link aria-label="Direct link to 5. PodGroup" title="Direct link to 5. PodGroup">​</a></h3>
<p><code>PodGroup</code>是<code>Volcano</code>提供的一种自定义资源，用于将多个<code>Pod</code>作为一个组进行调度：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">group</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定队列名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> training</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">worker</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">podgroup</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">group  </span><span class="token comment" style=color:#8292a2;font-style:italic># 关联到PodGroup</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=注意事项>注意事项<a href=#注意事项 class=hash-link aria-label="Direct link to 注意事项" title="Direct link to 注意事项">​</a></h3>
<ol>
<li>
<p><strong>调度器指定</strong>：无论使用哪种方式，都必须将<code>schedulerName</code>设置为<code>volcano</code>，否则<code>Pod</code>不会被<code>Volcano</code>调度器处理</p>
</li>
<li>
<p><strong>队列存在性</strong>：指定的队列必须已经创建，否则<code>Pod</code>将无法被成功调度</p>
</li>
<li>
<p><strong>权限控制</strong>：在多租户环境中，通常需要配置<code>RBAC</code>权限，限制用户只能使用特定的队列</p>
</li>
<li>
<p><strong>默认队列</strong>：如果未指定队列，<code>Pod</code>将被分配到默认队列（通常名为<code>default</code>）</p>
</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano-queue-job><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano Queue&Job</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-job-task-podgroup-pod><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano Job详解</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#资源管理机制 class="table-of-contents__link toc-highlight">资源管理机制</a><ul><li><a href=#使用-capacity-插件的资源管理机制 class="table-of-contents__link toc-highlight">使用 capacity 插件的资源管理机制</a><li><a href=#使用-proportion-插件的资源管理机制 class="table-of-contents__link toc-highlight">使用 proportion 插件的资源管理机制</a></ul><li><a href=#优先级与权重 class="table-of-contents__link toc-highlight">优先级与权重</a><li><a href=#queue状态 class="table-of-contents__link toc-highlight">Queue状态</a><ul><li><a href=#状态状态类型 class="table-of-contents__link toc-highlight">状态状态类型</a><li><a href=#检查队列状态 class="table-of-contents__link toc-highlight">检查队列状态</a><li><a href=#状态控制 class="table-of-contents__link toc-highlight">状态控制</a></ul><li><a href=#资源抢占机制 class="table-of-contents__link toc-highlight">资源抢占机制</a><li><a href=#层级队列 class="table-of-contents__link toc-highlight">层级队列</a><ul><li><a href=#层级队列的配置方式 class="table-of-contents__link toc-highlight">层级队列的配置方式</a><li><a href=#层级队列的使用示例 class="table-of-contents__link toc-highlight">层级队列的使用示例</a><li><a href=#层级队列的工作原理 class="table-of-contents__link toc-highlight">层级队列的工作原理</a><li><a href=#层级队列的资源回收与抢占 class="table-of-contents__link toc-highlight">层级队列的资源回收与抢占</a><li><a href=#层级队列的优势 class="table-of-contents__link toc-highlight">层级队列的优势</a></ul><li><a href=#队列亲和性affinity class="table-of-contents__link toc-highlight">队列亲和性（affinity）</a><ul><li><a href=#节点组介绍 class="table-of-contents__link toc-highlight">节点组介绍</a><li><a href=#亲和性类型 class="table-of-contents__link toc-highlight">亲和性类型</a><li><a href=#配置示例 class="table-of-contents__link toc-highlight">配置示例</a><li><a href=#工作原理 class="table-of-contents__link toc-highlight">工作原理</a></ul><li><a href=#扩展集群extendclusters class="table-of-contents__link toc-highlight">扩展集群（extendClusters）</a><ul><li><a href=#配置结构 class="table-of-contents__link toc-highlight">配置结构</a><li><a href=#工作原理-1 class="table-of-contents__link toc-highlight">工作原理</a><li><a href=#应用场景 class="table-of-contents__link toc-highlight">应用场景</a><li><a href=#配置示例-1 class="table-of-contents__link toc-highlight">配置示例</a><li><a href=#使用注意事项 class="table-of-contents__link toc-highlight">使用注意事项</a></ul><li><a href=#队列使用方式 class="table-of-contents__link toc-highlight">队列使用方式</a><ul><li><a href=#1-volcano-job class="table-of-contents__link toc-highlight">1. Volcano Job</a><li><a href=#2-kubernetes-pod class="table-of-contents__link toc-highlight">2. Kubernetes Pod</a><li><a href=#3-kubernetes-deployment class="table-of-contents__link toc-highlight">3. Kubernetes Deployment</a><li><a href=#4-kubernetes-statefulset class="table-of-contents__link toc-highlight">4. Kubernetes StatefulSet</a><li><a href=#5-podgroup class="table-of-contents__link toc-highlight">5. PodGroup</a><li><a href=#注意事项 class="table-of-contents__link toc-highlight">注意事项</a></ul></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>