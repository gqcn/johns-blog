<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano Actions&Plugins/Volcano Actions详解" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano Actions详解 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-scheduler-actions><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano Actions详解 | John's Blog"><meta data-rh=true name=description content=深入解析Volcano调度器的6个核心Actions（enqueue、allocate、backfill、preempt、reclaim、shuffle）的工作原理、执行流程和配置方法，涵盖任务入队、资源分配、碎片资源利用、同队列优先级抢占、跨队列资源回收、负载重平衡等关键调度机制，为构建高效的批处理和AI训练调度系统提供完整的技术指南。><meta data-rh=true property=og:description content=深入解析Volcano调度器的6个核心Actions（enqueue、allocate、backfill、preempt、reclaim、shuffle）的工作原理、执行流程和配置方法，涵盖任务入队、资源分配、碎片资源利用、同队列优先级抢占、跨队列资源回收、负载重平衡等关键调度机制，为构建高效的批处理和AI训练调度系统提供完整的技术指南。><meta data-rh=true name=keywords content=Volcano,Kubernetes,Actions,调度器,enqueue,allocate,backfill,preempt,reclaim,shuffle,资源调度,优先级抢占,资源回收,碎片资源,负载均衡,调度流程,predicateErrorCache,Gang调度><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-scheduler-actions><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-scheduler-actions hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-scheduler-actions hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.4427dfae.js defer></script><script src=/assets/js/main.139bc18f.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-introduction>Volcano基本介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-installation-testing>Volcano安装测试</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-startup-parameters>Volcano启动参数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-examples>Volcano使用示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano常用注解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-config>Volcano调度器配置</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-queue-job>Volcano Queue&Job</a><button aria-label="Expand sidebar category 'Volcano Queue&Job'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano-actions-plugins>Volcano Actions&Plugins</a><button aria-label="Collapse sidebar category 'Volcano Actions&Plugins'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-scheduler-actions>Volcano Actions详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-plugins>Volcano Plugins详解</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-advanced-features>Volcano高级特性</a><button aria-label="Expand sidebar category 'Volcano高级特性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-extension-development>Volcano扩展开发</a><button aria-label="Expand sidebar category 'Volcano扩展开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano-usage-notes>Volcano使用笔记</a><button aria-label="Expand sidebar category 'Volcano使用笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kind>Kind</a><button aria-label="Expand sidebar category 'Kind'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano-actions-plugins><span itemprop=name>Volcano Actions&Plugins</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano Actions详解</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>Actions</code>（动作）定义了调度器的工作流程和执行顺序。
目前<code>Volcano</code>提供了<code>5</code>个<code>Actions</code>：<code>enqueue</code>、<code>allocate</code>、<code>backfill</code>、<code>preempt</code>和<code>reclaim</code>。这些动作将按照定义的顺序执行。在<code>Volcano</code>的新版本中，可能会有增加新的动作，让我们逐一解释各个动作的作用：</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=enqueue入队>enqueue（入队）<a href=#enqueue入队 class=hash-link aria-label="Direct link to enqueue（入队）" title="Direct link to enqueue（入队）">​</a></h2>
<p><strong>主要功能</strong>：将新提交的任务放入调度队列，并检查任务是否满足调度条件。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>创建任务和队列的优先级队列，按照调度策略中定义的顺序处理</li>
<li>检查<code>PodGroup</code>是否满足最小成员数要求</li>
<li>将符合条件的<code>Job</code>状态从<code>Pending</code>更新为<code>Inqueue</code></li>
<li>更新<code>PodGroup</code>的状态为<code>PodGroupInqueue</code>，表示已准备好被调度</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当一个要求至少三个<code>Pod</code>同时运行的<code>TensorFlow</code>训练任务被提交时，<code>enqueue</code>动作会检查是否有足够的资源来运行这些<code>Pod</code>，如果有，则将其标记为可调度。</p>
<p><strong>参数说明</strong>：</p>
<p>没有可配置参数。</p>
<p><strong>注意事项</strong>：<code>enqueue action</code> 是不可省略的核心组件，原因如下：</p>
<ol>
<li><strong>调度流程的入口点</strong>：</li>
</ol>
<ul>
<li><code>enqueue</code>是整个调度流程的第一步，负责将任务从"未调度"状态转移到"可调度"状态</li>
<li>如果没有<code>enqueue</code>，新提交的任务将无法进入调度队列，调度器将无法感知这些任务的存在</li>
</ul>
<ol start=2>
<li><strong>基础验证机制</strong>：</li>
</ol>
<ul>
<li><code>enqueue</code> 执行关键的前置检查，如验证<code>PodGroup</code>是否满足最小成员数要求</li>
<li>它确保只有满足基本条件的任务才能进入调度流程，避免无效调度</li>
</ul>
<ol start=3>
<li><strong>默认配置的一部分</strong>：</li>
</ol>
<ul>
<li>在 <code>Volcano</code> 的默认配置中，<code>enqueue</code>总是作为第一个 <code>action</code>存在</li>
<li>即使在自定义配置中不显式指定，系统也会使用内置的<code>enqueue</code>逻辑</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=allocate分配>allocate（分配）<a href=#allocate分配 class=hash-link aria-label="Direct link to allocate（分配）" title="Direct link to allocate（分配）">​</a></h2>
<p><strong>主要功能</strong>：为队列中的任务分配资源，并将它们调度到合适的节点上。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>根据队列权重和任务优先级对任务进行排序</li>
<li>使用插件对任务进行过滤和打分<!-- -->
<ul>
<li><strong>过滤策略（Predicates）</strong>：<!-- -->
<ul>
<li>资源匹配过滤：检查节点是否有足够的<code>CPU</code>、内存、<code>GPU</code>等资源</li>
<li>节点亲和性过滤：根据<code>Pod</code>的<code>nodeAffinity</code>设置过滤节点</li>
<li>污点容忍过滤：检查任务是否能容忍节点上的污点（<code>Taints</code>）</li>
<li><code>PodGroup</code>约束过滤：检查是否有足够的资源同时运行<code>PodGroup</code>中的所有<code>Pod</code></li>
<li>自定义过滤器：通过<code>predicates</code>插件实现的特定过滤逻辑</li>
</ul>
</li>
<li><strong>打分策略（Scoring）</strong>：<!-- -->
<ul>
<li>节点资源打分：包括<code>leastrequested</code>（选择资源使用率低的节点）、<code>mostrequested</code>（选择资源使用率高的节点）和<code>balancedresource</code>（平衡各类资源使用）</li>
<li>节点亲和性打分（<code>nodeaffinity</code>）：根据节点亲和性规则给节点打分</li>
<li><code>Pod</code>间亲和性打分（<code>podaffinity</code>）：考虑<code>Pod</code>之间的亲和性和反亲和性</li>
<li>污点容忍打分（<code>tainttoleration</code>）：根据<code>Pod</code>对节点污点的容忍度打分</li>
<li>镜像本地性打分（<code>imagelocality</code>）：优先选择已经有所需镜像的节点</li>
<li><code>Pod</code>拓扑分布打分（<code>podtopologyspread</code>）：实现<code>Pod</code>在拓扑域之间的均匀分布</li>
<li>任务拓扑打分（<code>task-topology</code>）：通过注解定义任务间的亲和性和反亲和性，优化分布式任务的调度</li>
</ul>
</li>
</ul>
</li>
<li>为符合条件的任务分配资源并绑定到得分最高的节点</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当多个队列中有多个任务时，<code>allocate</code>动作会首先将资源分配给高权重队列中的高优先级任务，然后再考虑低权重队列中的任务。</p>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>predicateErrorCacheEnable</code><td><code>bool</code><td><code>true</code><td>是否启用谓词错误缓存。启用后，调度器会缓存节点过滤阶段的错误信息，避免重复计算，提高调度效率。</table>
<p><strong>参数示例</strong>：</p>
<p><code>allocate</code>动作的参数需要在<code>Volcano</code>调度器的<code>ConfigMap</code>中配置。具体来说，这些参数应该在<code>volcano-scheduler.conf</code>文件的<code>configurations</code>部分中配置。以下是一个配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler-configmap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue,allocate,preempt,reclaim,backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    configurations:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - name: allocate</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        predicateErrorCacheEnable: true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>注意事项</strong>：</p>
<ol>
<li>谓词错误缓存（<code>Predicate Error Cache</code>）是一种优化机制，可以避免对已知不满足条件的节点重复执行过滤操作，从而提高调度效率。</li>
<li>在大规模集群中，启用此功能可以显著减少调度延迟，特别是当集群中有大量节点且调度频繁时。</li>
<li>在某些特殊场景下（如节点状态快速变化的环境），可能需要禁用此功能以确保调度决策基于最新状态。</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>在大多数情况下，建议保持谓词错误缓存启用（默认设置）。</li>
<li>如果观察到由于缓存导致的调度异常（例如，节点状态变化后调度决策不准确），可以考虑禁用此功能。</li>
<li>在调试调度问题时，临时禁用此功能可能有助于排查问题。</li>
</ol>
<p><strong>注意事项</strong>：在 <code>Volcano</code> 调度器中，<code>allocate</code> <code>action</code>也是<strong>不可省略</strong>的核心组件，原因如下：</p>
<ol>
<li>
<p><strong>核心调度功能的实现者</strong>：</p>
<ul>
<li><code>allocate</code> 是实际执行资源分配和<code>Pod</code>绑定的关键<code>action</code></li>
<li>它负责将已入队的任务分配到具体的节点上，是调度过程的核心步骤</li>
<li>如果没有 <code>allocate</code>，任务会停留在队列中而不会被实际调度执行</li>
</ul>
</li>
<li>
<p><strong>调度决策的执行者</strong>：</p>
<ul>
<li>虽然其他<code>actions</code>（如<code>backfill</code>、<code>preempt</code>）也可以执行调度，但它们都是针对特殊场景的补充</li>
<li><code>allocate</code> 处理常规的资源分配，是最基本的调度机制</li>
<li>其他<code>actions</code>通常在<code>allocate</code>无法满足需求时才会被触发</li>
</ul>
</li>
<li>
<p><strong>插件系统的主要应用点</strong>：</p>
<ul>
<li>大多数调度插件（如<code>drf</code>、<code>predicates</code>、<code>nodeorder</code>等）主要在<code>allocate</code>阶段发挥作用</li>
<li>这些插件通过<strong>过滤</strong>和<strong>打分</strong>机制帮助<code>allocate</code>做出最优的调度决策</li>
</ul>
</li>
<li>
<p><strong>调度流程的核心环节</strong>：</p>
<ul>
<li>在典型的调度流程中，<code>enqueue</code>将任务放入队列，而<code>allocate</code>则负责实际分配资源</li>
<li>这两个<code>action</code>构成了调度的基本闭环，缺一不可</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=backfill回填>backfill（回填）<a href=#backfill回填 class=hash-link aria-label="Direct link to backfill（回填）" title="Direct link to backfill（回填）">​</a></h2>
<p><code>backfill</code>（回填）是 <code>Volcano</code> 调度流程中非常重要的一个补充环节，其主要作用是在 <code>allocate</code> 完成主资源分配后，进一步挖掘和利用集群中的碎片资源。通常情况下，<code>allocate</code>负责为大部分高优先级或核心任务分配资源，而 <code>backfill</code> 主要针对那些由于资源碎片化而无法被 <code>allocate</code> 充分利用的节点，调度小型或低优先级任务，从而提升整体资源利用率。</p>
<p><strong>backfill 在调度流程中的定位</strong>：</p>
<ul>
<li><code>Volcano</code>的调度流程并不是"一次性"分配完所有资源、所有任务就结束。调度器会不断循环执行<code>actions</code>，每一轮都会尝试调度新的任务和处理资源变化。</li>
<li><code>enqueue</code> 负责将任务放入调度队列，<code>allocate</code> 负责进行主要的资源分配。</li>
<li>当 <code>allocate</code> 无法满足所有任务需求，或集群中出现大量碎片资源时，<code>backfill</code> 会被触发，专门调度适合这些碎片资源的小任务。</li>
<li>这使得调度流程形成了"主分配 + 回填补充"的高效闭环。</li>
</ul>
<p><strong>插件系统与 backfill 的配合</strong>：</p>
<ul>
<li>大多数调度插件（如 <code>drf</code>、<code>predicates</code>、<code>nodeorder</code> 等）虽然主要在 <code>allocate</code> 阶段发挥作用，但 <code>backfill</code> 阶段同样会复用这些插件的过滤和打分机制，确保回填任务的调度决策依然科学合理。</li>
<li>某些插件参数（如谓词错误缓存）可以显著提升 <code>backfill</code> 的调度效率。</li>
</ul>
<p><strong>典型应用场景</strong>：</p>
<ul>
<li>当集群中有节点仅剩少量 <code>CPU</code> 和内存时，这些资源不足以运行大型任务，但通过 <code>backfill</code>，可以将这些资源分配给小型批处理任务或低优先级作业，避免资源浪费。</li>
</ul>
<p><strong>主要功能</strong>：利用集群中的空闲资源来运行小型或低优先级的任务，提高资源利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>在主要的资源分配完成后执行</li>
<li>寻找集群中的碎片资源（小块未使用的资源）</li>
<li>将这些资源分配给可以快速完成的小任务</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当集群中有一些节点只剩下少量的<code>CPU</code>和内存时，这些资源可能不足以运行大型任务，但<code>backfill</code>动作可以将这些资源分配给小型的批处理任务。</p>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>predicateErrorCacheEnable</code><td><code>bool</code><td><code>true</code><td>是否启用谓词错误缓存。启用后，调度器会缓存节点过滤阶段的错误信息，避免重复计算，提高调度效率。</table>
<p><strong>参数示例</strong>：</p>
<p><code>backfill</code>动作的参数需要在<code>Volcano</code>调度器的<code>ConfigMap</code>中配置。具体来说，这些参数应该在<code>volcano-scheduler.conf</code>文件的<code>configurations</code>部分中配置。以下是一个配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler-configmap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue,allocate,preempt,reclaim,backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    configurations:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - name: backfill</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        predicateErrorCacheEnable: true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>注意事项</strong>：</p>
<ol>
<li><code>backfill</code>动作与<code>allocate</code>动作类似，也支持谓词错误缓存功能，但它专注于利用集群的<strong>碎片资源</strong>。</li>
<li>在资源紧张的集群中，启用此功能可以提高资源利用率，尤其是当有大量小型任务需要调度时。</li>
<li>如果集群中的节点状态频繁变化，禁用此功能可能会带来更准确的调度结果，但代价是调度效率的降低。</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>在资源利用率需要提高的场景中，建议保持<code>backfill</code>动作启用。</li>
<li>对于具有大量小型任务（如数据处理、批量任务）的工作负载，<code>backfill</code>可以显著提高资源利用率。</li>
<li>对于需要精确资源预留的关键应用，可能需要谨慎使用<code>backfill</code>，以避免资源碎片化影响主要工作负载的性能。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=preempt抢占>preempt（抢占）<a href=#preempt抢占 class=hash-link aria-label="Direct link to preempt（抢占）" title="Direct link to preempt（抢占）">​</a></h2>
<p><strong>主要功能</strong>：当高优先级任务无法获得足够资源时，从低优先级任务中抢占资源（仅针对同队列任务）。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>识别高优先级但无法调度的任务（首先任务的<code>PodGroup</code>需要处于<code>Inqueue</code>状态）</li>
<li>查找可以被抢占的低优先级任务</li>
<li>终止被选中的低优先级任务，释放其资源</li>
<li>将释放的资源分配给高优先级任务</li>
</ul>
<p>抢占行为主要由以下机制控制：</p>
<ol>
<li>
<p><strong>Pod的Preemptable标记</strong>：通过<code>volcano.sh/preemptable</code>注解控制<code>Pod</code>是否可被抢占</p>
<ul>
<li>注意：默认值为<code>true</code>（可被抢占）</li>
<li>设置为<code>false</code>则该<code>Pod</code>不会被抢占</li>
</ul>
</li>
<li>
<p><strong>Kubernetes PriorityClass</strong>：定义任务的优先级</p>
<ul>
<li>高优先级任务可以抢占低优先级任务</li>
<li>优先级通过<code>priorityClassName</code>字段指定</li>
</ul>
</li>
<li>
<p><strong>Plugin的Preemptable函数</strong>：各插件（如<code>priority</code>、<code>conformance</code>、<code>gang</code>等）通过实现<code>PreemptableFn</code>来决定哪些任务可被抢占</p>
<ul>
<li>多个插件的结果取<strong>交集</strong></li>
<li>只有所有启用的插件都认为可抢占的任务才会被抢占</li>
</ul>
</li>
<li>
<p><strong>Victim选择策略</strong>：通过<code>BuildVictimsPriorityQueue</code>实现</p>
<ul>
<li>同一<code>Job</code>内的任务：按<code>Task</code>优先级从低到高抢占</li>
<li>不同<code>Job</code>的任务：按<code>Job</code>优先级从低到高抢占</li>
<li>不同<code>Queue</code>的任务：按<code>VictimQueueOrderFn</code>排序</li>
</ul>
</li>
</ol>
<p><strong>注意</strong>：<code>Volcano</code>的抢占策略是<strong>基于优先级的确定性选择</strong>，而非随机选择。系统会优先抢占优先级最低的任务，确保高优先级任务优先保障。</p>
<p><strong>示例场景</strong>：</p>
<p>当一个生产环境的关键任务（高优先级）需要运行，但集群资源已被开发环境的任务（低优先级）占用时，<code>preempt</code>动作会终止部分开发环境的任务，将资源让给生产环境的关键任务。</p>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>predicateErrorCacheEnable</code><td><code>bool</code><td><code>true</code><td>是否启用谓词错误缓存。启用后，调度器会缓存节点过滤阶段的错误信息，避免重复计算，提高调度效率。<tr><td><code>enableTopologyAwarePreemption</code><td><code>bool</code><td><code>false</code><td>是否启用拓扑感知抢占。启用后，调度器会考虑节点拓扑关系进行更智能的抢占决策。<tr><td><code>topologyAwarePreemptWorkerNum</code><td><code>int</code><td><code>16</code><td>拓扑感知抢占的并发工作线程数。<tr><td><code>minCandidateNodesPercentage</code><td><code>int</code><td><code>10</code><td>候选节点的最小百分比（用于拓扑感知抢占）。<tr><td><code>minCandidateNodesAbsolute</code><td><code>int</code><td><code>1</code><td>候选节点的最小绝对数量（用于拓扑感知抢占）。<tr><td><code>maxCandidateNodesAbsolute</code><td><code>int</code><td><code>100</code><td>候选节点的最大绝对数量（用于拓扑感知抢占）。</table>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">configurations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> preempt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicateErrorCacheEnable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">enableTopologyAwarePreemption</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">topologyAwarePreemptWorkerNum</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>16</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">minCandidateNodesPercentage</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">minCandidateNodesAbsolute</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">maxCandidateNodesAbsolute</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>配置示例</strong>：</p>
<p><code>preempt</code>动作的配置主要包括启用<code>action</code>和配置相关<code>plugin</code>。以下是一个完整的配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue, allocate, backfill, preempt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> overcommit</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> binpack</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>工作流程</strong>：</p>
<p>根据源码分析，抢占的关键流程如下：</p>
<ol>
<li>
<p><strong>识别抢占者（Preemptor）</strong>：调度器便利所有的任务，识别出因资源不足而无法调度的高优先级任务（通过<code>JobStarving</code>方法判断）。并将任务按照队列为维度进行归并，后续按照队列维度进行遍历处理。</p>
</li>
<li>
<p><strong>检查抢占资格</strong>：</p>
<ul>
<li>检查任务的<code>PreemptionPolicy</code>是否为<code>Never</code></li>
<li>检查任务是否有<code>NominatedNodeName</code>且该节点是否仍然不可调度</li>
</ul>
</li>
<li>
<p><strong>筛选候选节点</strong>：</p>
<ul>
<li>过滤掉<code>UnschedulableAndUnresolvable</code>状态的节点</li>
<li>对候选节点执行<code>Predicate</code>检查</li>
</ul>
</li>
<li>
<p><strong>查找可抢占任务（Victims）</strong>：</p>
<ul>
<li>遍历节点上的所有任务，应用<code>filter</code>函数过滤</li>
<li>调用各插件的<code>PreemptableFn</code>，取所有插件结果的交集</li>
<li>只有标记为<code>volcano.sh/preemptable: "true"</code>（或未标记，默认为<code>true</code>）的<code>Pod</code>才可被抢占</li>
<li><code>BestEffort Pod</code>不能抢占非<code>BestEffort Pod</code></li>
</ul>
</li>
<li>
<p><strong>选择Victim</strong>：</p>
<ul>
<li>通过<code>BuildVictimsPriorityQueue</code>构建优先级队列</li>
<li>同一<code>Job</code>内：按<code>Task</code>优先级从低到高抢占</li>
<li>不同<code>Job</code>：按<code>Job</code>优先级从低到高抢占</li>
<li>不同<code>Queue</code>：按<code>VictimQueueOrderFn</code>排序</li>
</ul>
</li>
<li>
<p><strong>执行抢占</strong>：</p>
<ul>
<li>依次驱逐（<code>Evict</code>）选中的低优先级任务</li>
<li>释放的资源累加到节点的<code>FutureIdle</code>中</li>
<li>当资源足够或队列可分配时停止抢占</li>
</ul>
</li>
<li>
<p><strong>Pipeline调度</strong>：</p>
<ul>
<li>将高优先级任务<code>Pipeline</code>到目标节点</li>
<li>更新任务状态为<code>Pipelined</code></li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=reclaim回收>reclaim（回收）<a href=#reclaim回收 class=hash-link aria-label="Direct link to reclaim（回收）" title="Direct link to reclaim（回收）">​</a></h2>
<p><strong>主要功能</strong>：从超出其公平份额的队列中回收资源，并将其重新分配给其他队列（仅针对跨队列任务的资源回收，同队列不生效）。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个队列的公平份额和实际使用情况</li>
<li>识别超额使用资源的队列</li>
<li>从这些队列中选择可回收的任务</li>
<li>终止这些任务以释放资源</li>
<li>只回收标记为<code>reclaimable: true</code>的队列的资源</li>
</ul>
<p><strong>Preempt vs Reclaim 核心差别</strong></p>
<table><thead><tr><th>维度<th>Preempt Action<th>Reclaim Action<tbody><tr><td>作用范围<td>同队列内不同<code>Job</code>之间<td>跨队列资源回收<tr><td>触发条件<td><code>Job</code>资源不足（<code>JobStarving</code>）<td><code>Job</code>资源不足 + 队列未超额<tr><td>抢占对象<td>同队列的低优先级<code>Job</code><td>其他队列的可回收资源<tr><td>关键过滤<td><code>job.Queue == preemptorJob.Queue</code><td><code>j.Queue != job.Queue</code><tr><td>队列控制<td>无需队列配置<td>需要<code>reclaimable: true</code><tr><td>支持场景<td>1. 队列内<code>Job</code>优先级; 2. 同<code>Job</code>内<code>Task</code>优先级<td>队列间资源公平分配</table>
<p><strong>示例场景</strong>：</p>
<p>当集群中有多个队列，每个队列都有权重设置（如生产队列权重为<code>60%</code>，开发队列为<code>30%</code>，测试队列为<code>10%</code>）。如果开发队列使用了超过<code>50%</code>的集群资源，而生产队列需要更多资源时，<code>reclaim</code>动作会从开发队列中回收资源。</p>
<p><strong>参数说明</strong>：</p>
<p>没有可配置参数。</p>
<p><strong>注意事项</strong>：</p>
<p>为什么队列设置了 <code>Quota</code> 还会出现超额使用的情况？</p>
<p><code>Volcano</code> 的资源分配和回收机制采用了"宽松分配+周期性回收"的设计，主要原因有：</p>
<ul>
<li><strong>宽松分配</strong>：在实际调度时，为了提升资源利用率和调度灵活性，调度器可能允许某些队列临时超出其配额（<code>Quota</code>）使用资源，尤其是在集群资源充足、其他队列没有资源需求时。</li>
<li><strong>动态变化</strong>：集群资源和队列需求是动态变化的，某一时刻资源分配合理，但随着新任务加入或资源需求变化，某些队列可能会暂时超额。</li>
<li><strong>周期性回收</strong>：<code>reclaim</code> 动作就是为了解决上述问题而设计的。它会定期检查所有队列的资源使用情况，一旦发现某队列超出其公平份额，就会触发资源回收，将多占用的资源释放出来，分配给资源不足的队列。</li>
</ul>
<p><code>Volcano</code> 的 <code>reclaim</code>（回收）操作本质上就是强制终止（<code>Evict/Kill</code>）超额队列中的部分任务的 <code>Pod</code>，以释放资源并将其分配给其他资源不足或高优先级的队列。被回收的任务如果有重试或重调度机制，后续可能会被重新调度到集群中。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=shuffle重新分配>shuffle（重新分配）<a href=#shuffle重新分配 class=hash-link aria-label="Direct link to shuffle（重新分配）" title="Direct link to shuffle（重新分配）">​</a></h2>
<p><strong>主要功能</strong>：选择并驱逐正在运行的任务，以实现资源重新分配或负载均衡。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>收集所有正在运行的任务</li>
<li>通过插件定义的策略选择需要驱逐的任务</li>
<li>驱逐选中的任务，释放其资源</li>
<li>这些任务将在后续调度周期中被重新调度</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当集群中的负载分布不均衡时，例如某些节点资源利用率非常高而其他节点却相对空闲，<code>shuffle</code>动作可以驱逐部分任务，让它们在下一个调度周期重新分配到资源利用率较低的节点上，从而实现负载均衡。</p>
<p><strong>参数说明</strong>：</p>
<p>没有可配置参数。</p>
<p><strong>注意事项</strong>：</p>
<ol>
<li><code>shuffle</code>动作会导致任务被驱逐并重新调度，这可能会对应用程序造成短暂的中断。</li>
<li><strong>需要配合相应的插件（如<code>victimtasks</code>）来定义驱逐策略，决定哪些任务应该被驱逐。</strong></li>
<li>对于状态敏感或需要长时间运行的应用，应谨慎使用<code>shuffle</code>动作，或者确保这些应用有适当的状态保存和恢复机制。</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>将<code>shuffle</code>动作放在调度器配置的后面，确保它只在其他调度策略（如<code>allocate</code>、<code>backfill</code>）无法解决问题时才会被触发。</li>
<li>为需要保护的关键任务添加适当的标签或注解，确保它们不会被<code>shuffle</code>动作驱逐。</li>
<li>在资源利用率不均衡或需要定期重新平衡集群负载的场景中，<code>shuffle</code>动作可以提供显著的效益。</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano-actions-plugins><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano Actions&Plugins</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-scheduler-plugins><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano Plugins详解</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#enqueue入队 class="table-of-contents__link toc-highlight">enqueue（入队）</a><li><a href=#allocate分配 class="table-of-contents__link toc-highlight">allocate（分配）</a><li><a href=#backfill回填 class="table-of-contents__link toc-highlight">backfill（回填）</a><li><a href=#preempt抢占 class="table-of-contents__link toc-highlight">preempt（抢占）</a><li><a href=#reclaim回收 class="table-of-contents__link toc-highlight">reclaim（回收）</a><li><a href=#shuffle重新分配 class="table-of-contents__link toc-highlight">shuffle（重新分配）</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>