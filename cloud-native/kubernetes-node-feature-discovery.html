<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Kubernetes/Node Feature Discovery" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Node Feature Discovery | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/kubernetes-node-feature-discovery><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Node Feature Discovery | John's Blog"><meta data-rh=true name=description content="深入介绍Kubernetes Node Feature Discovery（NFD）机制，包括其核心概念、工作原理和使用方法。NFD能够自动检测节点的硬件特性和系统配置，并将其转换为节点标签，帮助实现硬件感知的Pod调度。本文详细讲解NFD的架构组件、NodeFeatureRule的配置和使用、应用场景以及最佳实践，助力构建智能化的异构Kubernetes集群。"><meta data-rh=true property=og:description content="深入介绍Kubernetes Node Feature Discovery（NFD）机制，包括其核心概念、工作原理和使用方法。NFD能够自动检测节点的硬件特性和系统配置，并将其转换为节点标签，帮助实现硬件感知的Pod调度。本文详细讲解NFD的架构组件、NodeFeatureRule的配置和使用、应用场景以及最佳实践，助力构建智能化的异构Kubernetes集群。"><meta data-rh=true name=keywords content="Kubernetes,Node Feature Discovery,NFD,节点特性发现,硬件特性,节点标签,自动标注,GPU,CPU特性,设备发现,NodeFeatureRule,自定义资源,异构集群,硬件感知调度,特性检测"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/kubernetes-node-feature-discovery><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/kubernetes-node-feature-discovery hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/kubernetes-node-feature-discovery hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.fe95fb51.js defer></script><script src=/assets/js/main.e8b45d15.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Collapse sidebar category 'Kubernetes'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes-usage-notes>Kubernetes使用笔记</a><button aria-label="Expand sidebar category 'Kubernetes使用笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes-extension-development>Kubernetes扩展开发</a><button aria-label="Expand sidebar category 'Kubernetes扩展开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes-troubleshooting>Kubernetes问题排查</a><button aria-label="Expand sidebar category 'Kubernetes问题排查'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-kubelet-pod-eviction-process>Kubelet驱逐Pod详细流程</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-device-plugin>Kubernetes Device Plugin</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-network-policy>Kubernetes NetworkPolicy</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-runtimeclass>Kubernetes RuntimeClass</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-pvc-persistent-volume>Kubernetes PVC持久化存储</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-cpu-numa-affinity>Kubernetes CPU&NUMA亲和性调度</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/kubernetes-node-feature-discovery>Node Feature Discovery</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-node-feature-discovery-nodefeaturerule>NodeFeatureRule配置使用</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Expand sidebar category 'Volcano'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kind>Kind</a><button aria-label="Expand sidebar category 'Kind'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/kubernetes><span itemprop=name>Kubernetes</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Node Feature Discovery</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=前言>前言<a href=#前言 class=hash-link aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2>
<p>在<code>Kubernetes</code>集群中，节点的硬件配置往往是异构的。不同节点可能配备不同型号的<code>CPU</code>、<code>GPU</code>、网卡或其他专用硬件。传统的<code>Kubernetes</code>调度主要基于<code>CPU</code>和内存资源，无法感知节点的硬件特性。<code>Node Feature Discovery</code>（<code>NFD</code>）正是为了解决这个问题而生，它能够自动发现节点的硬件特性和系统配置，并将这些信息转换为节点标签，从而实现更加智能的调度决策。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=node-feature-discovery是什么>Node Feature Discovery是什么？<a href=#node-feature-discovery是什么 class=hash-link aria-label="Direct link to Node Feature Discovery是什么？" title="Direct link to Node Feature Discovery是什么？">​</a></h2>
<p><code>Node Feature Discovery</code>（简称<code>NFD</code>）是一个<code>Kubernetes</code>插件，用于检测节点的硬件特性和系统配置。它会自动发现诸如<code>CPU</code>指令集、内核版本、<code>PCI</code>设备、<code>USB</code>设备等信息，并将这些特性作为标签添加到对应的节点上。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=核心特点>核心特点<a href=#核心特点 class=hash-link aria-label="Direct link to 核心特点" title="Direct link to 核心特点">​</a></h3>
<ul>
<li><strong>自动化特性发现</strong>：无需手动配置，自动检测节点的硬件和系统特性</li>
<li><strong>灵活的标签管理</strong>：支持预定义的特性标签和自定义标签规则</li>
<li><strong>可扩展性</strong>：支持通过插件扩展新的特性检测能力</li>
<li><strong>多种输出方式</strong>：支持节点标签、注解、扩展资源和污点等多种形式</li>
<li><strong>规则引擎</strong>：通过<code>NodeFeatureRule</code>自定义资源实现灵活的标签规则</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=node-feature-discovery解决了什么问题>Node Feature Discovery解决了什么问题？<a href=#node-feature-discovery解决了什么问题 class=hash-link aria-label="Direct link to Node Feature Discovery解决了什么问题？" title="Direct link to Node Feature Discovery解决了什么问题？">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=痛点案例1异构gpu集群的调度困境>痛点案例1：异构GPU集群的调度困境<a href=#痛点案例1异构gpu集群的调度困境 class=hash-link aria-label="Direct link to 痛点案例1：异构GPU集群的调度困境" title="Direct link to 痛点案例1：异构GPU集群的调度困境">​</a></h4>
<p><strong>场景</strong>：某AI训练平台的<code>Kubernetes</code>集群中混合部署了<code>NVIDIA A100</code>、<code>V100</code>和<code>T4</code>等不同型号的<code>GPU</code>节点。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>不同的训练任务对<code>GPU</code>型号有特定要求（如大模型训练需要<code>A100</code>的大显存）</li>
<li>默认的<code>Device Plugin</code>只能识别<code>GPU</code>数量，无法区分型号</li>
<li>用户需要手动为每个节点打标签，维护成本高且容易出错</li>
<li>节点扩缩容时容易遗漏标签配置，导致调度失败</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用<code>NFD</code>自动检测<code>GPU</code>型号并添加对应的节点标签</li>
<li>训练任务通过<code>nodeSelector</code>或<code>nodeAffinity</code>指定所需的<code>GPU</code>型号</li>
<li>新增节点时无需手动配置，<code>NFD</code>自动完成特性发现和标签添加</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=痛点案例2cpu特性敏感的高性能计算>痛点案例2：CPU特性敏感的高性能计算<a href=#痛点案例2cpu特性敏感的高性能计算 class=hash-link aria-label="Direct link to 痛点案例2：CPU特性敏感的高性能计算" title="Direct link to 痛点案例2：CPU特性敏感的高性能计算">​</a></h4>
<p><strong>场景</strong>：金融机构的量化交易系统需要使用特定的<code>CPU</code>指令集（如<code>AVX512</code>）来加速计算。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>集群中部分旧节点不支持<code>AVX512</code>指令集</li>
<li>应用运行在不支持的节点上会崩溃或性能严重下降</li>
<li>管理员难以准确识别哪些节点支持特定的<code>CPU</code>特性</li>
<li>节点硬件升级后需要手动更新标签</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li><code>NFD</code>自动检测<code>CPU</code>的<code>CPUID</code>特性，包括<code>AVX512</code>等指令集</li>
<li>为支持的节点自动添加<code>feature.node.kubernetes.io/cpu-cpuid.AVX512F=true</code>标签</li>
<li>应用通过节点选择器确保运行在支持所需指令集的节点上</li>
<li>硬件变更时标签自动更新，无需人工干预</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=痛点案例3网络设备感知的边缘计算>痛点案例3：网络设备感知的边缘计算<a href=#痛点案例3网络设备感知的边缘计算 class=hash-link aria-label="Direct link to 痛点案例3：网络设备感知的边缘计算" title="Direct link to 痛点案例3：网络设备感知的边缘计算">​</a></h4>
<p><strong>场景</strong>：物联网边缘计算平台需要根据节点的网络设备类型部署不同的网关服务。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>边缘节点配备不同的网络接口（<code>5G</code>模组、<code>LoRa</code>、工业以太网等）</li>
<li>网关服务需要运行在配备特定网络设备的节点上</li>
<li>节点数量多且地理分布广，手动管理标签几乎不可能</li>
<li>设备故障或更换后难以及时更新配置</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li><code>NFD</code>检测<code>PCI</code>和<code>USB</code>网络设备，识别设备类型和厂商</li>
<li>通过<code>NodeFeatureRule</code>定义规则，为不同设备类型添加语义化标签</li>
<li>网关服务通过标签选择器自动部署到正确的节点</li>
<li>设备变更时<code>NFD</code>实时更新标签，确保调度准确性</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=nfd核心架构>NFD核心架构<a href=#nfd核心架构 class=hash-link aria-label="Direct link to NFD核心架构" title="Direct link to NFD核心架构">​</a></h2>
<p><code>NFD</code>采用分布式架构，主要包含四个核心组件。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=架构组件>架构组件<a href=#架构组件 class=hash-link aria-label="Direct link to 架构组件" title="Direct link to 架构组件">​</a></h3>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=nfd-master>NFD-Master<a href=#nfd-master class=hash-link aria-label="Direct link to NFD-Master" title="Direct link to NFD-Master">​</a></h4>
<p><code>nfd-master</code>是一个<code>Deployment</code>，负责与<code>Kubernetes API Server</code>通信：</p>
<ul>
<li>
<p><strong>职责</strong>：</p>
<ul>
<li>接收来自<code>nfd-worker</code>的特性发现请求</li>
<li>根据<code>NodeFeatureRule</code>规则处理特性数据</li>
<li>更新节点对象的标签、注解、扩展资源和污点</li>
<li>监听<code>NodeFeatureRule</code>自定义资源的变更</li>
</ul>
</li>
<li>
<p><strong>高可用</strong>：虽然是<code>Deployment</code>，但通常配置为单副本，因为标签更新操作是幂等的</p>
</li>
<li>
<p><strong>工作模式</strong>：</p>
<ul>
<li>接收<code>Worker</code>上报的特性信息</li>
<li>应用<code>NodeFeatureRule</code>规则进行标签转换</li>
<li>批量更新节点对象减少<code>API Server</code>压力</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=nfd-worker>NFD-Worker<a href=#nfd-worker class=hash-link aria-label="Direct link to NFD-Worker" title="Direct link to NFD-Worker">​</a></h4>
<p><code>nfd-worker</code>以<code>DaemonSet</code>形式部署，在每个节点上运行一个实例：</p>
<ul>
<li>
<p><strong>职责</strong>：</p>
<ul>
<li>检测节点的硬件特性和系统配置</li>
<li>通过<code>gRPC</code>将检测结果发送给<code>nfd-master</code></li>
<li>定期重新扫描特性变化（默认<code>60</code>秒）</li>
</ul>
</li>
<li>
<p><strong>特性来源</strong>：</p>
<ul>
<li><code>CPU</code>：<code>CPUID</code>特性、拓扑信息、电源管理状态等</li>
<li><code>Kernel</code>：内核版本、配置选项、加载的模块等</li>
<li><code>Memory</code>：<code>NUMA</code>信息、内存类型等</li>
<li><code>Network</code>：网络设备信息</li>
<li><code>PCI</code>：<code>PCI</code>设备（包括<code>GPU</code>、网卡等）</li>
<li><code>Storage</code>：存储设备信息</li>
<li><code>System</code>：系统信息（<code>DMI</code>、操作系统等）</li>
<li><code>USB</code>：<code>USB</code>设备</li>
<li><code>Custom</code>：基于规则的自定义特性</li>
<li><code>Local</code>：通过文件定义的本地特性</li>
</ul>
</li>
<li>
<p><strong>扩展机制</strong>：</p>
<ul>
<li>支持外部插件扩展特性检测能力</li>
<li>可以通过配置文件定制特性源</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=nfd-topology-updater>NFD-Topology-Updater<a href=#nfd-topology-updater class=hash-link aria-label="Direct link to NFD-Topology-Updater" title="Direct link to NFD-Topology-Updater">​</a></h4>
<p><code>nfd-topology-updater</code>也是以<code>DaemonSet</code>形式部署，用于硬件拓扑感知：</p>
<ul>
<li><strong>职责</strong>：<!-- -->
<ul>
<li>检测节点的硬件拓扑信息（<code>NUMA</code>节点、<code>CPU</code>核心分布等）</li>
<li>跟踪已分配的资源和可分配资源</li>
<li>创建和更新<code>NodeResourceTopology</code>自定义资源</li>
</ul>
</li>
<li><strong>使用场景</strong>：<!-- -->
<ul>
<li><code>NUMA</code>感知调度</li>
<li>拓扑感知的资源分配</li>
<li>高性能计算场景的细粒度资源管理</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=nfd-gc>NFD-GC<a href=#nfd-gc class=hash-link aria-label="Direct link to NFD-GC" title="Direct link to NFD-GC">​</a></h4>
<p><code>nfd-gc</code>（<code>Garbage Collector</code>）负责清理过时的资源：</p>
<ul>
<li><strong>职责</strong>：<!-- -->
<ul>
<li>清理已删除节点对应的<code>NodeFeature</code>对象</li>
<li>清理过期的<code>NodeResourceTopology</code>对象</li>
<li>防止资源泄漏</li>
</ul>
</li>
<li><strong>部署形式</strong>：单副本<code>Deployment</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=特性发现源>特性发现源<a href=#特性发现源 class=hash-link aria-label="Direct link to 特性发现源" title="Direct link to 特性发现源">​</a></h3>
<p><code>NFD</code>通过多个特性源来检测节点的不同方面：</p>
<table><thead><tr><th>特性源<th>检测内容<th>标签示例<tbody><tr><td><code>cpu</code><td><code>CPU</code>指令集、拓扑、电源管理<td><code>feature.node.kubernetes.io/cpu-cpuid.AVX512F</code><tr><td><code>kernel</code><td>内核版本、配置、加载的模块<td><code>feature.node.kubernetes.io/kernel-version.major=5</code><tr><td><code>memory</code><td><code>NUMA</code>信息、内存类型<td><code>feature.node.kubernetes.io/memory-numa=true</code><tr><td><code>network</code><td>网络设备、<code>SRIOV</code>支持<td><code>feature.node.kubernetes.io/network-sriov.capable=true</code><tr><td><code>pci</code><td><code>PCI</code>设备（<code>GPU</code>、网卡等）<td><code>feature.node.kubernetes.io/pci-10de.present=true</code><tr><td><code>storage</code><td>存储设备、<code>NVMe</code>支持<td><code>feature.node.kubernetes.io/storage-nonrotationaldisk=true</code><tr><td><code>system</code><td>系统信息、固件版本<td><code>feature.node.kubernetes.io/system-os_release.ID=ubuntu</code><tr><td><code>usb</code><td><code>USB</code>设备<td><code>feature.node.kubernetes.io/usb-fe_1a6e_089a.present=true</code><tr><td><code>custom</code><td>自定义规则生成的特性<td>用户定义<tr><td><code>local</code><td>从文件读取的特性<td>用户定义</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=如何使用node-feature-discovery>如何使用Node Feature Discovery<a href=#如何使用node-feature-discovery class=hash-link aria-label="Direct link to 如何使用Node Feature Discovery" title="Direct link to 如何使用Node Feature Discovery">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安装部署>安装部署<a href=#安装部署 class=hash-link aria-label="Direct link to 安装部署" title="Direct link to 安装部署">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用kustomize部署推荐>使用Kustomize部署（推荐）<a href=#使用kustomize部署推荐 class=hash-link aria-label="Direct link to 使用Kustomize部署（推荐）" title="Direct link to 使用Kustomize部署（推荐）">​</a></h4>
<p>这是最简单的部署方式：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-k</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/default?ref=v0.17.3"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个命令会创建：</p>
<ul>
<li><code>node-feature-discovery</code>命名空间</li>
<li>必需的<code>RBAC</code>规则（<code>ServiceAccount</code>、<code>Role</code>、<code>ClusterRole</code>等）</li>
<li><code>nfd-master</code> <code>Deployment</code></li>
<li><code>nfd-worker</code> <code>DaemonSet</code></li>
<li><code>nfd-gc</code> <code>Deployment</code></li>
<li><code>NodeFeatureRule</code>、<code>NodeFeature</code>、<code>NodeFeatureGroup</code>等<code>CRD</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用helm部署>使用Helm部署<a href=#使用helm部署 class=hash-link aria-label="Direct link to 使用Helm部署" title="Direct link to 使用Helm部署">​</a></h4>
<p>如果需要自定义配置，可以使用<code>Helm</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 添加 Helm 仓库</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm repo </span><span class="token function" style=color:#e6db74>add</span><span class="token plain"> nfd https://kubernetes-sigs.github.io/node-feature-discovery/charts</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm repo update</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 安装 NFD</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> nfd nfd/node-feature-discovery </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token parameter variable" style=color:#f8f8f2>--namespace</span><span class="token plain"> node-feature-discovery </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  --create-namespace</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=部署topology-updater可选>部署Topology Updater（可选）<a href=#部署topology-updater可选 class=hash-link aria-label="Direct link to 部署Topology Updater（可选）" title="Direct link to 部署Topology Updater（可选）">​</a></h4>
<p>如果需要拓扑感知调度功能：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-k</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"https://github.com/kubernetes-sigs/node-feature-discovery/deployment/overlays/topologyupdater?ref=v0.17.3"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=验证安装>验证安装<a href=#验证安装 class=hash-link aria-label="Direct link to 验证安装" title="Direct link to 验证安装">​</a></h3>
<p>检查<code>NFD</code>组件是否正常运行：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> node-feature-discovery get all</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>预期输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">NAME                              READY   STATUS    RESTARTS   AGE</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">pod/nfd-gc-565fc85d9b-94jpj       1/1     Running   0          1m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">pod/nfd-master-6796d89d7b-qccrq   1/1     Running   0          1m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">pod/nfd-worker-nwdp6              1/1     Running   0          1m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">pod/nfd-worker-p8s2l              1/1     Running   0          1m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">deployment.apps/nfd-gc       1/1     1            1           1m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">deployment.apps/nfd-master   1/1     1            1           1m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">NAME                         DESIRED   CURRENT   READY   AGE</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">daemonset.apps/nfd-worker    2         2         2       1m</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=查看节点标签>查看节点标签<a href=#查看节点标签 class=hash-link aria-label="Direct link to 查看节点标签" title="Direct link to 查看节点标签">​</a></h3>
<p><code>NFD</code>会自动为节点添加特性标签，查看某个节点的标签：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain">node-name</span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-o</span><span class="token plain"> json </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> jq </span><span class="token string" style=color:#a6e22e>'.metadata.labels'</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>grep</span><span class="token plain"> feature.node.kubernetes.io</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>常见的标签包括：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">feature.node.kubernetes.io/cpu-cpuid.ADX</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/cpu-cpuid.AESNI</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/cpu-cpuid.AVX</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/cpu-cpuid.AVX2</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/kernel-version.full</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"5.15.0-91-generic"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/kernel-version.major</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"5"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/kernel-version.minor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"15"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/pci-10de.present</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># NVIDIA GPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">feature.node.kubernetes.io/system-os_release.ID</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"ubuntu"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=配置管理>配置管理<a href=#配置管理 class=hash-link aria-label="Direct link to 配置管理" title="Direct link to 配置管理">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=master配置>Master配置<a href=#master配置 class=hash-link aria-label="Direct link to Master配置" title="Direct link to Master配置">​</a></h4>
<p>通过<code>ConfigMap</code>配置<code>nfd-master</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nfd</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">master</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">conf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">feature</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">discovery</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">nfd-master.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    enableTaints: false</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    extraLabelNs:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - custom.vendor.io</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    labelWhiteList:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - ".*"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    noPublish: false</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    resyncPeriod: "1h"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>配置项说明：</p>
<ul>
<li><code>enableTaints</code>：是否允许创建污点，默认为<code>false</code></li>
<li><code>extraLabelNs</code>：允许的额外标签命名空间</li>
<li><code>labelWhiteList</code>：标签白名单，支持正则表达式</li>
<li><code>noPublish</code>：不发布标签到节点（调试用）</li>
<li><code>resyncPeriod</code>：重新同步<code>NodeFeatureRule</code>的周期</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=worker配置>Worker配置<a href=#worker配置 class=hash-link aria-label="Direct link to Worker配置" title="Direct link to Worker配置">​</a></h4>
<p>通过<code>ConfigMap</code>配置<code>nfd-worker</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nfd</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">worker</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">conf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  namespace node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">feature</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">discovery</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">nfd-worker.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    core:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      sleepInterval: 60s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      labelSources:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - cpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - kernel</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - pci</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - usb</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - custom</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - local</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      featureSources:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - cpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - kernel</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - pci</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - usb</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - custom</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        - local</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    sources:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      cpu:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        cpuid:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          attributeBlacklist:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            - "BMI1"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            - "BMI2"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            - "CLMUL"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      pci:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        deviceClassWhitelist:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          - "0200"  # Network controller</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          - "03"    # Display controller</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          - "12"    # Processing accelerators</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>配置项说明：</p>
<ul>
<li><code>core.sleepInterval</code>：特性扫描间隔</li>
<li><code>core.labelSources</code>：启用的标签源</li>
<li><code>core.featureSources</code>：启用的特性源</li>
<li><code>sources.&lt;source></code>：各个特性源的具体配置</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用节点标签调度pod>使用节点标签调度Pod<a href=#使用节点标签调度pod class=hash-link aria-label="Direct link to 使用节点标签调度Pod" title="Direct link to 使用节点标签调度Pod">​</a></h3>
<p>一旦节点被打上标签，就可以在<code>Pod</code>中使用这些标签进行调度：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用nodeselector>使用nodeSelector<a href=#使用nodeselector class=hash-link aria-label="Direct link to 使用nodeSelector" title="Direct link to 使用nodeSelector">​</a></h4>
<p>最简单的方式是使用<code>nodeSelector</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> avx512</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">feature.node.kubernetes.io/cpu-cpuid.AVX512F</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> app</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> myapp</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用nodeaffinity>使用nodeAffinity<a href=#使用nodeaffinity class=hash-link aria-label="Direct link to 使用nodeAffinity" title="Direct link to 使用nodeAffinity">​</a></h4>
<p>更灵活的方式是使用<code>nodeAffinity</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">affinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> feature.node.kubernetes.io/pci</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">10de.present</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">values</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> feature.node.kubernetes.io/kernel</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">version.major</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Gt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">values</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"5"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">app</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">workload</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=nodefeaturerule使用>NodeFeatureRule使用<a href=#nodefeaturerule使用 class=hash-link aria-label="Direct link to NodeFeatureRule使用" title="Direct link to NodeFeatureRule使用">​</a></h2>
<p><code>NodeFeatureRule</code>是<code>NFD</code>最强大的功能之一，允许用户定义自定义的标签规则。通过<code>NodeFeatureRule</code>，可以将底层的硬件特性转换为高层次的语义化标签，实现灵活的节点分类和管理。</p>
<p>由于<code>NodeFeatureRule</code>内容较多且复杂，我们将其详细配置和使用方法单独整理成了专门的文章，详见：</p>
<p>👉 <strong><a href=/cloud-native/kubernetes-node-feature-discovery-nodefeaturerule>NodeFeatureRule配置使用</a></strong></p>
<p>该文章详细介绍了：</p>
<ul>
<li><code>NodeFeatureRule</code>的工作原理和流程</li>
<li>所有核心字段的详细说明和使用方法</li>
<li>完整的可用特性类型列表（<code>CPU</code>、内核、内存、网络、<code>PCI</code>、存储等）</li>
<li>丰富的实战示例（<code>GPU</code>检测、<code>CPU</code>分级、网络设备识别等）</li>
<li>最佳实践和故障排查技巧</li>
</ul>
<p>下面是一个简单的<code>NodeFeatureRule</code>使用示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nfd.k8s</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sigs.io/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> NodeFeatureRule</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">detection</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">example</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"nvidia gpu detection"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">"nvidia.com/gpu"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">"gpu.present"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">matchFeatures</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">feature</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> pci.device</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">vendor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token key atrule">op</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"10de"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># NVIDIA</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">class</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token key atrule">op</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"0300"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"0302"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># Display controller</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=典型应用场景>典型应用场景<a href=#典型应用场景 class=hash-link aria-label="Direct link to 典型应用场景" title="Direct link to 典型应用场景">​</a></h2>
<p><code>NFD</code>配合<code>NodeFeatureRule</code>可以应用于多种场景。以下列举几个常见的使用场景，更多详细的配置示例请参考 <strong><a href=/cloud-native/kubernetes-node-feature-discovery-nodefeaturerule>NodeFeatureRule配置使用</a></strong>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=异构gpu集群管理>异构GPU集群管理<a href=#异构gpu集群管理 class=hash-link aria-label="Direct link to 异构GPU集群管理" title="Direct link to 异构GPU集群管理">​</a></h3>
<p>在混合部署不同型号<code>GPU</code>的集群中，可以使用<code>NFD</code>自动识别<code>GPU</code>型号，并通过<code>NodeFeatureRule</code>为不同型号的<code>GPU</code>节点添加语义化标签。应用可以通过标签选择器将任务调度到合适的节点上。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li><code>AI</code>训练平台需要区分训练卡和推理卡</li>
<li>大模型训练需要指定高显存的<code>GPU</code></li>
<li>成本优化，将不同优先级的任务分配到不同档次的<code>GPU</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=高性能计算节点分级>高性能计算节点分级<a href=#高性能计算节点分级 class=hash-link aria-label="Direct link to 高性能计算节点分级" title="Direct link to 高性能计算节点分级">​</a></h3>
<p>根据<code>CPU</code>的指令集支持情况（如<code>AVX512</code>、<code>AVX2</code>等）对节点进行性能分级，为不同计算密集度的任务分配合适的计算资源。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>科学计算需要<code>AVX512</code>加速</li>
<li>金融量化交易对<code>CPU</code>性能有严格要求</li>
<li>成本敏感的任务可以运行在低配节点上</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=存储设备感知>存储设备感知<a href=#存储设备感知 class=hash-link aria-label="Direct link to 存储设备感知" title="Direct link to 存储设备感知">​</a></h3>
<p>自动识别节点的存储设备类型（<code>NVMe SSD</code>、<code>SATA SSD</code>、<code>HDD</code>），为数据库等<code>I/O</code>密集型应用选择高性能存储节点。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>数据库需要高<code>IOPS</code>的<code>NVMe</code>存储</li>
<li>日志收集可以使用低成本的<code>HDD</code></li>
<li>缓存服务需要低延迟的<code>SSD</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=网络设备类型识别>网络设备类型识别<a href=#网络设备类型识别 class=hash-link aria-label="Direct link to 网络设备类型识别" title="Direct link to 网络设备类型识别">​</a></h3>
<p>在边缘计算场景中，根据节点配备的网络设备类型（<code>5G</code>模组、<code>LoRa</code>、工业以太网等）部署相应的网关服务。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>物联网边缘网关需要特定的网络接口</li>
<li>工业现场需要识别工业以太网设备</li>
<li>移动边缘计算需要识别<code>5G</code>模组</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安全合规节点标识>安全合规节点标识<a href=#安全合规节点标识 class=hash-link aria-label="Direct link to 安全合规节点标识" title="Direct link to 安全合规节点标识">​</a></h3>
<p>识别节点的安全特性（如<code>Intel SGX</code>、<code>SELinux</code>配置等），确保敏感工作负载运行在符合安全要求的节点上。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>金融行业的合规要求</li>
<li>医疗数据处理的安全隔离</li>
<li>多租户环境的安全分级</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://github.com/kubernetes-sigs/node-feature-discovery target=_blank rel="noopener noreferrer">Node Feature Discovery GitHub</a></li>
<li><a href=https://kubernetes-sigs.github.io/node-feature-discovery/ target=_blank rel="noopener noreferrer">NFD官方文档</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/kubernetes-cpu-numa-affinity><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Kubernetes CPU&NUMA亲和性调度</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/kubernetes-node-feature-discovery-nodefeaturerule><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>NodeFeatureRule配置使用</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#前言 class="table-of-contents__link toc-highlight">前言</a><li><a href=#node-feature-discovery是什么 class="table-of-contents__link toc-highlight">Node Feature Discovery是什么？</a><ul><li><a href=#核心特点 class="table-of-contents__link toc-highlight">核心特点</a><li><a href=#node-feature-discovery解决了什么问题 class="table-of-contents__link toc-highlight">Node Feature Discovery解决了什么问题？</a></ul><li><a href=#nfd核心架构 class="table-of-contents__link toc-highlight">NFD核心架构</a><ul><li><a href=#架构组件 class="table-of-contents__link toc-highlight">架构组件</a><li><a href=#特性发现源 class="table-of-contents__link toc-highlight">特性发现源</a></ul><li><a href=#如何使用node-feature-discovery class="table-of-contents__link toc-highlight">如何使用Node Feature Discovery</a><ul><li><a href=#安装部署 class="table-of-contents__link toc-highlight">安装部署</a><li><a href=#验证安装 class="table-of-contents__link toc-highlight">验证安装</a><li><a href=#查看节点标签 class="table-of-contents__link toc-highlight">查看节点标签</a><li><a href=#配置管理 class="table-of-contents__link toc-highlight">配置管理</a><li><a href=#使用节点标签调度pod class="table-of-contents__link toc-highlight">使用节点标签调度Pod</a></ul><li><a href=#nodefeaturerule使用 class="table-of-contents__link toc-highlight">NodeFeatureRule使用</a><li><a href=#典型应用场景 class="table-of-contents__link toc-highlight">典型应用场景</a><ul><li><a href=#异构gpu集群管理 class="table-of-contents__link toc-highlight">异构GPU集群管理</a><li><a href=#高性能计算节点分级 class="table-of-contents__link toc-highlight">高性能计算节点分级</a><li><a href=#存储设备感知 class="table-of-contents__link toc-highlight">存储设备感知</a><li><a href=#网络设备类型识别 class="table-of-contents__link toc-highlight">网络设备类型识别</a><li><a href=#安全合规节点标识 class="table-of-contents__link toc-highlight">安全合规节点标识</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>