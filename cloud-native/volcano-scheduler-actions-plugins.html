<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano Actions&Plugins详解" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano Actions&Plugins详解 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano Actions&Plugins详解 | John's Blog"><meta data-rh=true name=description content=本文详细介绍了Volcano调度器中的Actions和Plugins机制，包括各种Actions的作用、应用场景和配置示例，以及如何通过这些机制实现灵活的任务生命周期管理和事件处理。><meta data-rh=true property=og:description content=本文详细介绍了Volcano调度器中的Actions和Plugins机制，包括各种Actions的作用、应用场景和配置示例，以及如何通过这些机制实现灵活的任务生命周期管理和事件处理。><meta data-rh=true name=keywords content=Volcano,Kubernetes,Actions,Plugins,调度器,Job,Pod,PodGroup,RestartJob,CompleteJob,AbortJob,生命周期管理,事件处理><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.208c11f9.css><script src=/assets/js/runtime~main.0ed85470.js defer></script><script src=/assets/js/main.f78684f1.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-introduction>Volcano基本介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-startup-parameters>Volcano启动参数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-examples>Volcano使用示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano常用注解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue>Volcano Queue详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-job>Volcano Job详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job-pod-preemption>Volcano Queue&Job&Pod资源抢占设计</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-scheduler-actions-plugins>Volcano Actions&Plugins详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-session-plugins-fns>Volcano Session Plugins方法介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-hierarchy-queue-scheduling-issue>Volcano层级队列配置引发的调度器系统性故障问题</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-hierarchy-queue-notes>Volcano层级队列使用的一些笔记</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-kind>使用Kubernetes Kind搭建本地测试集群</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernettes-kind-mock-ai-test-cluster>使用Kubernetes Kind模拟AI算力测试集群</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano Actions&Plugins详解</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>Volcano</code>调度器是一个为高性能计算、机器学习和批处理工作负载设计的<code>Kubernetes</code>调度器。它的核心功能之一是通过可插拔的<code>Actions</code>和<code>Plugins</code>机制来实现灵活的调度策略。本文将详细地介绍这些机制，帮助你更好地理解和使用<code>Volcano</code>调度器。</p>
<p><img decoding=async loading=lazy src=/assets/images/zh-cn_image_0000002065638558-3f8e26a4366a07fed3803bfbb3056ed7.png width=1256 height=503 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=调度器配置说明>调度器配置说明<a href=#调度器配置说明 class=hash-link aria-label="Direct link to 调度器配置说明" title="Direct link to 调度器��配置说明">​</a></h2>
<p><code>Volcano</code>默认调度器配置：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue, allocate, backfill"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> overcommit</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>一个典型的<code>Volcano</code>调度器配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue,allocate,preempt,reclaim,backfill"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> resourcequota</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> binpack</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置定义了调度器的工作流程（<code>Actions</code>）和决策机制（<code>Plugins</code>）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=可插拔的插件功能管理>可插拔的插件功能管理<a href=#可插拔的插件功能管理 class=hash-link aria-label="Direct link to 可插拔的插件功能管理" title="Direct link to 可插拔的插件功能管理">​</a></h3>
<p>需要注意：</p>
<ul>
<li>当您提供自定义配置时，Volcano不会将其与默认配置合并</li>
<li>自定义配置会完全替换默认配置，而不是与默认配置合并</li>
</ul>
<p>这种设计意味着：</p>
<ol>
<li><strong>必须明确指定所有需要的插件</strong>：</li>
</ol>
<ul>
<li>如果您提供自定义配置，必须在配置中明确列出所有需要的插件，包括那些在默认配置中已经存在的插件</li>
<li>例如，如果您需要使用conformance插件（默认已启用），但在自定义配置中没有包含它，那么它将不会被启用</li>
</ul>
<ol start=2>
<li><strong>完整性要求</strong>：</li>
</ol>
<ul>
<li>您的自定义配置必须是完整的，包含所有必要的actions和plugins</li>
<li>不能只指定您想要更改的部分，因为整个配置会被替换</li>
</ul>
<ol start=3>
<li><strong>默认配置的作用</strong>：</li>
</ol>
<ul>
<li>默认配置仅在没有提供自定义配置时使用</li>
<li>或者在自定义配置解析失败时作为备选方案</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=多层级tiers数组结构>多层级(tiers)数组结构<a href=#多层级tiers数组结构 class=hash-link aria-label="Direct link to 多层级(tiers)数组结构" title="Direct link to 多层级(tiers)数组结构">​</a></h3>
<p>为什么使用多层级(<code>tiers</code>)数组结构来配置<code>Plugins</code>？</p>
<ol>
<li>
<p><strong>优先级分层执行</strong>：</p>
<ul>
<li>不同层级（<code>tier</code>）的插件有着严格的优先级顺序</li>
<li>高层级（第一个数组）中的插件会先执行，其决策结果会影响或限制低层级插件的决策空间</li>
<li>只有当高层级的所有插件都允许一个调度决策时，才会继续执行低层级的插件</li>
</ul>
</li>
<li>
<p><strong>决策流程的过滤机制</strong>：</p>
<ul>
<li>第一层级的插件（如 <code>priority</code>、<code>gang</code>、<code>conformance</code>）主要负责基本的筛选和约束</li>
<li>第二层级的插件（如 <code>drf</code>、<code>predicates</code>、<code>proportion</code> 等）负责更细粒度的资源分配和优化</li>
<li>这种分层设计形成了一种"<strong>粗筛-细筛</strong>"的决策流水线</li>
</ul>
</li>
<li>
<p><strong>解决冲突的明确机制</strong>：</p>
<ul>
<li>当不同插件之间可能产生冲突决策时，层级结构提供了明确的优先级规则</li>
<li>例如，如果 <code>gang</code> 插件（第一层）决定某个任务不能被调度（因为它的所有成员无法同时运行），那么即使 <code>binpack</code> 插件（第二层）认为该任务可以被有效打包，该任务也不会被调度</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=与单一数组相比的优势>与单一数组相比的优势<a href=#与单一数组相比的优势 class=hash-link aria-label="Direct link to 与单一数组相比的优势" title="Direct link to 与单一数组相比的优势">​</a></h3>
<p>如果所有插件都放在一个扁平的数组中，调度器将面临以下问题：</p>
<ol>
<li><strong>无法表达优先级关系</strong>：<!-- -->
<ul>
<li>所有插件将被视为同等重要，难以表达某些基本约束（如成组调度）应该优先于优化决策（如资源打包）</li>
</ul>
</li>
<li><strong>决策冲突难以解决</strong>：<!-- -->
<ul>
<li>没有明确的机制来解决插件之间的冲突，可能导致不一致或不可预测的调度行为</li>
</ul>
</li>
<li><strong>调度效率降低</strong>：<!-- -->
<ul>
<li>分层执行允许在早期阶段快速过滤掉不符合基本条件的调度决策，避免不必要的计算</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=actions配置顺序的重要性>Actions配置顺序的重要性<a href=#actions配置顺序的重要性 class=hash-link aria-label="Direct link to Actions配置顺序的重要性" title="Direct link to Actions配置顺序的重要性">​</a></h3>
<p><code>Volcano</code>中的<code>actions</code>顺序配置非常重要，因为它决定了调度器执行各种调度操作的顺序，这直接影响调度决策和性能。</p>
<p><code>actions</code>的执行是按照配置中指定的顺序依次进行的，不同的顺序配置会产生以下影响：</p>
<ol>
<li>
<p><strong>效率影响</strong>：</p>
<ul>
<li>如果将<code>backfill</code>放在<code>allocate</code>之前，可能会导致资源碎片化，降低整体资源利用率</li>
<li>如果将<code>preempt</code>放在最前面，可能会导致过度抢占，增加系统波动</li>
</ul>
</li>
<li>
<p><strong>公平性影响</strong>：</p>
<ul>
<li>如果将资源公平相关的<code>action</code>放在较后位置，可能会影响资源分配的公平性</li>
</ul>
</li>
<li>
<p><strong>性能影响</strong>：</p>
<ul>
<li>某些<code>action</code>计算复杂度较高，如果频繁执行可能会影响调度器性能</li>
<li>合理的顺序可以减少不必要的计算和资源重分配</li>
</ul>
</li>
</ol>
<p>推荐的顺序通常是：<code>enqueue,allocate,preempt,reclaim,backfill</code>。这个顺序确保了：</p>
<ol>
<li>首先将任务入队(<code>enqueue</code>)</li>
<li>然后尝试正常分配资源(<code>allocate</code>)</li>
<li>如果仍有高优先级任务未得到满足，考虑抢占(<code>preempt</code>)</li>
<li>尝试回收利用率低的资源(<code>reclaim</code>)</li>
<li>最后利用剩余资源进行回填(<code>backfill</code>)，最大化资源利用率</li>
</ol>
<p>在特定场景下，你可能需要根据工作负载特点调整顺序。例如，在高优先级任务较多的环境中，可能希望提前执行<code>preempt</code>；在资源紧张的环境中，可能希望提前执行<code>reclaim</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano中的job和podgroup状态流转>Volcano中的Job和PodGroup状态流转<a href=#volcano中的job和podgroup状态流转 class=hash-link aria-label="Direct link to Volcano中的Job和PodGroup状态流转" title="Direct link to Volcano中的Job和PodGroup状态流转">​</a></h2>
<p>在深入了解<code>Volcano</code>调度器的<code>Actions</code>和<code>Plugins</code>之前，我们需要先理解<code>Job</code>和<code>PodGroup</code>的状态以及它们之间的转换流程，这有助于我们更好地理解调度器的工作原理。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup状态>PodGroup状态<a href=#podgroup状态 class=hash-link aria-label="Direct link to PodGroup状态" title="Direct link to PodGroup状态">​</a></h3>
<p><code>PodGroup</code>是<code>Volcano</code>中的一个重要概念，它代表一组需要一起调度的<code>Pod</code>。<code>PodGroup</code>有以下几种状态：</p>
<ol>
<li>
<p><strong>Pending（等待中）</strong>：<code>PodGroup</code>已被系统接受，但调度器无法为其分配足够的资源。这是<code>PodGroup</code>的初始状态。</p>
</li>
<li>
<p><strong>Inqueue（入队）</strong>：控制器可以开始创建<code>Pod</code>，这是<code>PodGroup</code>从<code>Pending</code>到<code>Running</code>之间的一个中间状态。当<code>enqueue action</code>执行成功后，<code>PodGroup</code>会从<code>Pending</code>转变为<code>Inqueue</code>状态。</p>
</li>
<li>
<p><strong>Running（运行中）</strong>：<code>PodGroup</code>中的<code>spec.minMember</code>数量的<code>Pod</code>已经处于运行状态。</p>
</li>
<li>
<p><strong>Unknown（未知）</strong>：部分<code>spec.minMember</code>的<code>Pod</code>正在运行，但其他部分无法被调度，例如资源不足；调度器将等待相关控制器恢复它。</p>
</li>
<li>
<p><strong>Completed（已完成）</strong>：<code>PodGroup</code>中的所有<code>Pod</code>都已完成。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=job状态>Job状态<a href=#job状态 class=hash-link aria-label="Direct link to Job状态" title="Direct link to Job状态">​</a></h3>
<p><code>Volcano Job</code>是一个更高级别的抽象，它包含一个或多个<code>Task</code>，每个<code>Task</code>可以有多个<code>Pod</code>副本。<code>Job</code>有以下几种状态：</p>
<ol>
<li>
<p><strong>Pending（等待中）</strong>：<code>Job</code>正在队列中等待，等待调度决策。</p>
</li>
<li>
<p><strong>Inqueue（入队）</strong>：<code>Job</code>已入队，等待调度。</p>
</li>
<li>
<p><strong>Aborting（中止中）</strong>：<code>Job</code>正在被中止，等待释放<code>Pod</code>。</p>
</li>
<li>
<p><strong>Aborted（已中止）</strong>：<code>Job</code>已被中止，所有<code>Pod</code>已被释放。</p>
</li>
<li>
<p><strong>Running（运行中）</strong>：<code>Job</code>中的<code>Pod</code>正在运行。</p>
</li>
<li>
<p><strong>Restarting（重启中）</strong>：<code>Job</code>正在重启，等待<code>Pod</code>终止。</p>
</li>
<li>
<p><strong>Completing（完成中）</strong>：<code>Job</code>正在完成，等待<code>Pod</code>终止。</p>
</li>
<li>
<p><strong>Completed（已完成）</strong>：<code>Job</code>已成功完成，所有<code>Pod</code>都已成功运行并终止。</p>
</li>
<li>
<p><strong>Terminating（终止中）</strong>：<code>Job</code>正在终止，等待<code>Pod</code>终止。</p>
</li>
<li>
<p><strong>Terminated（已终止）</strong>：<code>Job</code>已终止，所有<code>Pod</code>已被终止。</p>
</li>
<li>
<p><strong>Failed（失败）</strong>：<code>Job</code>已失败，无法继续运行。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=状态转换流程>状态转换流程<a href=#状态转换��流程 class=hash-link aria-label="Direct link to 状态转换流程" title="Direct link to 状态转换流程">​</a></h3>
<p><code>Job</code>和<code>PodGroup</code>的状态转换是紧密相关的，它们共同反映了任务在<code>Volcano</code>调度系统中的生命周期。以下是一个典型的状态转换流程：</p>
<ol>
<li>
<p><strong>提交阶段</strong>：</p>
<ul>
<li>用户创建一个<code>Volcano Job</code></li>
<li>系统自动为该<code>Job</code>创建一个对应的<code>PodGroup</code></li>
<li><code>Job</code>和<code>PodGroup</code>初始状态均为<code>Pending</code></li>
</ul>
</li>
<li>
<p><strong>入队阶段</strong>：</p>
<ul>
<li>调度器的<code>enqueue action</code>检查<code>PodGroup</code>是否满足最小成员数要求</li>
<li>如果满足条件，将<code>PodGroup</code>状态更新为<code>Inqueue</code></li>
<li>相应地，<code>Job</code>状态也会更新为<code>Inqueue</code></li>
</ul>
</li>
<li>
<p><strong>调度阶段</strong>：</p>
<ul>
<li>调度器的<code>allocate action</code>为<code>Inqueue</code>状态的<code>PodGroup</code>中的<code>Pod</code>分配资源</li>
<li>当足够数量的<code>Pod</code>被成功调度并运行后，<code>PodGroup</code>状态更新为<code>Running</code></li>
<li>相应地，<code>Job</code>状态也会更新为<code>Running</code></li>
</ul>
</li>
<li>
<p><strong>执行阶段</strong>：</p>
<ul>
<li><code>Pod</code>在分配的节点上执行任务</li>
<li>如果出现资源不足或其他问题，可能触发<code>preempt</code>或<code>reclaim action</code></li>
<li>这些<code>action</code>可能导致某些<code>Pod</code>被抢占或资源被回收</li>
</ul>
</li>
<li>
<p><strong>完成阶段</strong>：</p>
<ul>
<li>当所有<code>Pod</code>成功完成任务后，<code>PodGroup</code>状态更新为<code>Completed</code></li>
<li>相应地，<code>Job</code>状态更新为<code>Completed</code></li>
</ul>
</li>
<li>
<p><strong>异常处理</strong>：</p>
<ul>
<li>如果任务执行过程中出现错误，<code>Job</code>可能转为<code>Failed</code>、<code>Aborted</code>或其他状态</li>
<li>根据配置的生命周期策略，系统可能尝试重启任务（<code>Restarting</code>）或直接终止（<code>Terminating</code>）</li>
</ul>
</li>
</ol>
<p>理解这些状态和转换流程对于理解<code>Volcano</code>调度器的<code>Actions</code>工作原理至关重要，因为每个<code>Action</code>都是在特定的状态下对<code>Job</code>和<code>PodGroup</code>进行操作，以推动它们在生命周期中前进。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-中的-actions>Volcano 中的 Actions<a href=#volcano-中的-actions class=hash-link aria-label="Direct link to Volcano 中的 Actions" title="Direct link to Volcano 中的 Actions">​</a></h2>
<p>动作（<code>Actions</code>）定义了调度器的工作流程和执行顺序。
在上面的配置中，我们定义了五个动作：<code>enqueue</code>、<code>allocate</code>、<code>backfill</code>、<code>preempt</code>和<code>reclaim</code>。这些动作将按照定义的顺序执行。</p>
<p>在<code>Volcano</code>的新版本中，可能会有增加新的动作，让我们逐一解释各个动作的作用：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-enqueue入队>1. enqueue（入队）<a href=#1-enqueue入队 class=hash-link aria-label="Direct link to 1. enqueue（入队）" title="Direct link to 1. enqueue（入队）">​</a></h3>
<p><strong>主要功能</strong>：将新提交的任务放入调度队列，并检查任务是否满足调度条件。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>创建任务和队列的优先级队列，按照调度策略中定义的顺序处理</li>
<li>检查<code>PodGroup</code>是否满足最小成员数要求</li>
<li>将符合条件的<code>Job</code>状态从<code>Pending</code>更新为<code>Inqueue</code></li>
<li>更新<code>PodGroup</code>的状态为<code>PodGroupInqueue</code>，表示已准备好被调度</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当一个要求至少三个<code>Pod</code>同时运行的<code>TensorFlow</code>训练任务被提交时，<code>enqueue</code>动作会检查是否有足够的资源来运行这些<code>Pod</code>，如果有，则将其标记为可调度。</p>
<p><strong>注意事项</strong>：<code>enqueue action</code> 是不可省略的核心组件，原因如下：</p>
<ol>
<li><strong>调度流程的入口点</strong>：</li>
</ol>
<ul>
<li><code>enqueue</code>是整个调度流程的第一步，负责将任务从"未调度"状态转移到"可调度"状态</li>
<li>如果没有<code>enqueue</code>，新提交的任务将无法进入调度队列，调度器将无法感知这些任务的存在</li>
</ul>
<ol start=2>
<li><strong>基础验证机制</strong>：</li>
</ol>
<ul>
<li><code>enqueue</code> 执行关键的前置检查，如验证<code>PodGroup</code>是否满足最小成员数要求</li>
<li>它确保只有满足基本条件的任务才能进入调度流程，避免无效调度</li>
</ul>
<ol start=3>
<li><strong>默认配置的一部分</strong>：</li>
</ol>
<ul>
<li>在 <code>Volcano</code> 的默认配置中，<code>enqueue</code>总是作为第一个 <code>action</code>存在</li>
<li>即使在自定义配置中不显式指定，系统也会使用内置的<code>enqueue</code>逻辑</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-allocate分配>2. allocate（分配）<a href=#2-allocate分配 class=hash-link aria-label="Direct link to 2. allocate（分配）" title="Direct link to 2. allocate（分配）">​</a></h3>
<p><strong>主要功能</strong>：为队列中的任务分配资源，并将它们调度到合适的节点上。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>根据队列权重和任务优先级对任务进行排序</li>
<li>使用插件对任务进行过滤和打分<!-- -->
<ul>
<li><strong>过滤策略（Predicates）</strong>：<!-- -->
<ul>
<li>资源匹配过滤：检查节点是否有足够的<code>CPU</code>、内存、<code>GPU</code>等资源</li>
<li>节点亲和性过滤：根据<code>Pod</code>的<code>nodeAffinity</code>设置过滤节点</li>
<li>污点容忍过滤：检查任务是否能容忍节点上的污点（<code>Taints</code>）</li>
<li><code>PodGroup</code>约束过滤：检查是否有足够的资源同时运行<code>PodGroup</code>中的所有<code>Pod</code></li>
<li>自定义过滤器：通过<code>predicates</code>插件实现的特定过滤逻辑</li>
</ul>
</li>
<li><strong>打分策略（Scoring）</strong>：<!-- -->
<ul>
<li>节点资源打分：包括<code>leastrequested</code>（选择资源使用率低的节点）、<code>mostrequested</code>（选择资源使用率高的节点）和<code>balancedresource</code>（平衡各类资源使用）</li>
<li>节点亲和性打分（<code>nodeaffinity</code>）：根据节点亲和性规则给节点打分</li>
<li><code>Pod</code>间亲和性打分（<code>podaffinity</code>）：考虑<code>Pod</code>之间的亲和性和反亲和性</li>
<li>污点容忍打分（<code>tainttoleration</code>）：根据<code>Pod</code>对节点污点的容忍度打分</li>
<li>镜像本地性打分（<code>imagelocality</code>）：优先选择已经有所需镜像的节点</li>
<li><code>Pod</code>拓扑分布打分（<code>podtopologyspread</code>）：实现<code>Pod</code>在拓扑域之间的均匀分布</li>
<li>任务拓扑打分（<code>task-topology</code>）：通过注解定义任务间的亲和性和反亲和性，优化分布式任务的调度</li>
</ul>
</li>
</ul>
</li>
<li>为符合条件的任务分配资源并绑定到得分最高的节点</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当多个队列中有多个任务时，<code>allocate</code>动作会首先将资源分配给高权重队列中的高优先级任务，然后再考虑低权重队列中的任务。</p>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>默认值<th>说明<tbody><tr><td><code>predicateErrorCacheEnable</code><td><code>true</code><td>是否启用谓词错误缓存。启用后，调度器会缓存节点过滤阶段的错误信息，避免重复计算，提高调度效率。</table>
<p><strong>参数示例</strong>：</p>
<p><code>allocate</code>动作的参数需要在<code>Volcano</code>调度器的<code>ConfigMap</code>中配置。具体来说，这些参数应该在<code>volcano-scheduler.conf</code>文件的<code>actions.allocate</code>部分中配置。以下是一个配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler-configmap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue,allocate,preempt,reclaim,backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    configurations:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - name: allocate</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        predicateErrorCacheEnable: true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>注意事项</strong>：</p>
<ol>
<li>谓词错误缓存（<code>Predicate Error Cache</code>）是一种优化机制，可以避免对已知不满足条件的节点重复执行过滤操作，从而提高调度效率。</li>
<li>在大规模集群中，启用此功能可以显著减少调度延迟，特别是当集群中有大量节点且调度频繁时。</li>
<li>在某些特殊场景下（如节点状态快速变化的环境），可能需要禁用此功能以确保调度决策基于最新状态。</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>在大多数情况下，建议保持谓词错误缓存启用（默认设置）。</li>
<li>如果观察到由于缓存导致的调度异常（例如，节点状态变化后调度决策不准确），可以考虑禁用此功能。</li>
<li>在调试调度问题时，临时禁用此功能可能有助于排查问题。</li>
</ol>
<p><strong>注意事项</strong>：在 <code>Volcano</code> 调度器中，<code>allocate</code> <code>action</code>也是<strong>不可省略</strong>的核心组件，原因如下：</p>
<ol>
<li>
<p><strong>核心调度功能的实现者</strong>：</p>
<ul>
<li><code>allocate</code> 是实际执行资源分配和<code>Pod</code>绑定的关键<code>action</code></li>
<li>它负责将已入队的任务分配到具体的节点上，是调度过程的核心步骤</li>
<li>如果没有 <code>allocate</code>，任务会停留在队列中而不会被实际调度执行</li>
</ul>
</li>
<li>
<p><strong>调度决策的执行者</strong>：</p>
<ul>
<li>虽然其他<code>actions</code>（如<code>backfill</code>、<code>preempt</code>）也可以执行调度，但它们都是针对特殊场景的补充</li>
<li><code>allocate</code> 处理常规的资源分配，是最基本的调度机制</li>
<li>其他<code>actions</code>通常在<code>allocate</code>无法满足需求时才会被触发</li>
</ul>
</li>
<li>
<p><strong>插件系统的主要应用点</strong>：</p>
<ul>
<li>大多数调度插件（如<code>drf</code>、<code>predicates</code>、<code>nodeorder</code>等）主要在<code>allocate</code>阶段发挥作用</li>
<li>这些插件通过<strong>过滤</strong>和<strong>打分</strong>机制帮助<code>allocate</code>做出最优的调度决策</li>
</ul>
</li>
<li>
<p><strong>调度流程的核心环节</strong>：</p>
<ul>
<li>在典型的调度流程中，<code>enqueue</code>将任务放入队列，而<code>allocate</code>则负责实际分配资源</li>
<li>这两个<code>action</code>构成了调度的基本闭环，缺一不可</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-backfill回填>3. backfill（回填）<a href=#3-backfill回填 class=hash-link aria-label="Direct link to 3. backfill（回填）" title="Direct link to 3. backfill（回填）">​</a></h3>
<p><code>backfill</code>（回填）是 <code>Volcano</code> 调度流程中非常重要的一个补充环节，其主要作用是在 <code>allocate</code> 完成主资源分配后，进一步挖掘和利用集群中的碎片资源。通常情况下，<code>allocate</code>负责为大部分高优先级或核心任务分配资源，而 <code>backfill</code> 主要针对那些由于资源碎片化而无法被 <code>allocate</code> 充分利用的节点，调度小型或低优先级任务，从而提升整体资源利用率。</p>
<p><strong>backfill 在调度流程中的定位</strong>：</p>
<ul>
<li><code>Volcano</code>的调度流程并不是"一次性"分配完所有资源、所有任务就结束。调度器会不断循环执行<code>actions</code>，每一轮都会尝试调度新的任务和处理资源变化。</li>
<li><code>enqueue</code> 负责将任务放入调度队列，<code>allocate</code> 负责进行主要的资源分配。</li>
<li>当 <code>allocate</code> 无法满足所有任务需求，或集群中出现大量碎片资源时，<code>backfill</code> 会被触发，专门调度适合这些碎片资源的小任务。</li>
<li>这使得调度流程形成了"主分配 + 回填补充"的高效闭环。</li>
</ul>
<p><strong>插件系统与 backfill 的配合</strong>：</p>
<ul>
<li>大多数调度插件（如 <code>drf</code>、<code>predicates</code>、<code>nodeorder</code> 等）虽然主要在 <code>allocate</code> 阶段发挥作用，但 <code>backfill</code> 阶段同样会复用这些插件的过滤和打分机制，确保回填任务的调度决策依然科学合理。</li>
<li>某些插件参数（如谓词错误缓存）可以显著提升 <code>backfill</code> 的调度效率。</li>
</ul>
<p><strong>典型应用场景</strong>：</p>
<ul>
<li>当集群中有节点仅剩少量 <code>CPU</code> 和内存时，这些资源不足以运行大型任务，但通过 <code>backfill</code>，可以将这些资源分配给小型批处理任务或低优先级作业，避免资源浪费。</li>
</ul>
<p><strong>主要功能</strong>：利用集群中的空闲资源来运行小型或低优先级的任务，提高资源利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>在主要的资源分配完成后执行</li>
<li>寻找集群中的碎片资源（小块未使用的资源）</li>
<li>将这些资源分配给可以快速完成的小任务</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当集群中有一些节点只剩下少量的<code>CPU</code>和内存时，这些资源可能不足以运行大型任务，但<code>backfill</code>动作可以将这些资源分配给小型的批处理任务。</p>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>默认值<th>说明<tbody><tr><td><code>predicateErrorCacheEnable</code><td><code>true</code><td>是否启用谓词错误缓存。启用后，调度器会缓存节点过滤阶段的错误信息，避免重复计算，提高调度效率。</table>
<p><strong>参数示例</strong>：</p>
<p><code>backfill</code>动作的参数需要在<code>Volcano</code>调度器的<code>ConfigMap</code>中配置。具体来说，这些参数应该在<code>volcano-scheduler.conf</code>文件的<code>actions.backfill</code>部分中配置。以下是一个配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler-configmap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue,allocate,preempt,reclaim,backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    configurations:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - name: backfill</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        predicateErrorCacheEnable: true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>注意事项</strong>：</p>
<ol>
<li><code>backfill</code>动作与<code>allocate</code>动作类似，也支持谓词错误缓存功能，但它专注于利用集群的<strong>碎片资源</strong>。</li>
<li>在资源紧张的集群中，启用此功能可以提高资源利用率，尤其是当有大量小型任务需要调度时。</li>
<li>如果集群中的节点状态频繁变化，禁用此功能可能会带来更准确的调度结果，但代价是调度效率的降低。</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>在资源利用率需要提高的场景中，建议保持<code>backfill</code>动作启用。</li>
<li>对于具有大量小型任务（如数据处理、批量任务）的工作负载，<code>backfill</code>可以显著提高资源利用率。</li>
<li>对于需要精确资源预留的关键应用，可能需要谨慎使用<code>backfill</code>，以避免资源碎片化影响主要工作负载的性能。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-preempt抢占>4. preempt（抢占）<a href=#4-preempt抢占 class=hash-link aria-label="Direct link to 4. preempt（抢占）" title="Direct link to 4. preempt（抢占）">​</a></h3>
<p><strong>主要功能</strong>：当高优先级任务无法获得足够资源时，从低优先级任务中抢占资源。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>识别高优先级但无法调度的任务</li>
<li>查找可以被抢占的低优先级任务</li>
<li>终止被选中的低优先级任务，释放其资源</li>
<li>将释放的资源分配给高优先级任务</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当一个生产环境的关键任务（高优先级）需要运行，但集群资源已被开发环境的任务（低优先级）占用时，<code>preempt</code>动作会终止部分开发环境的任务，将资源让给生产环境的关键任务。</p>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>默认值<th>说明<tbody><tr><td><code>preemptable</code><td><code>true</code><td>是否允许抢占操作。设置为<code>false</code>将禁用抢占功能。<tr><td><code>preemptablePriority</code><td><code>0</code><td>可被抢占的任务优先级阈值，低于此优先级的任务可被抢占。例如设置为<code>100</code>意味着优先级低于<code>100</code>的任务可被抢占。默认值为<code>0</code>意味着不启用强占功能。<tr><td><code>preemptPriority</code><td><code>0</code><td>可执行抢占的任务优先级阈值，高于此优先级的任务可执行抢占。例如设置为<code>1000</code>意味着优先级高于<code>1000</code>的任务可以抢占其他任务的资源。<tr><td><code>preemptPolicy</code><td><code>Arbitrary</code><td>抢占策略，决定如何选择被抢占的任务。可选值为<code>Arbitrary</code>（随机选择）或<code>PriorityBased</code>（基于优先级选择）。</table>
<p>如果任务之间存在不同的优先级，理论上应该优先选择优先级最低的任务作为被抢占对象，这样才能体现"高优先级任务优先保障"的调度原则。</p>
<p>但在 <code>Volcano</code> 的 <code>preemptPolicy</code> 配置中，即使任务存在不同的优先级，如果你设置为 <code>Arbitrary</code>，调度器依然可能不是优先抢占最低优先级的任务，而是从所有符合条件的任务中随机选择一个进行抢占。这种策略通常只在某些特殊场景下使用（比如你希望打散负载、避免长时间抢占同一批任务等），但<strong>并不推荐在有明确优先级需求的场景下使用</strong>。</p>
<p><strong>参数示例</strong>：</p>
<p><code>preempt</code>动作的参数需要在<code>Volcano</code>调度器的<code>ConfigMap</code>中配置。具体来说，这些参数应该在<code>volcano-scheduler.conf</code>文件的<code>configurations</code>部分中配置。以下是一个完整的配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler-configmap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue,allocate,preempt,reclaim,backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    configurations:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - name: preempt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        preemptable: true</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        preemptablePriority: 100</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        preemptPriority: 1000</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        preemptPolicy: PriorityBased</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>如何配置preempt动作</strong>：</p>
<ol>
<li>
<p><strong>在调度器配置中启用preempt动作，并配置参数</strong>：</p>
<p>推荐在配置文件的 <code>configurations</code> 部分为 preempt 动作增加参数，避免默认 <code>preemptablePriority=0</code> 导致抢占不生效。例如：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue,allocate,preempt,reclaim,backfill"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">configurations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> preempt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">preemptablePriority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 低于100的任务可被抢占</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">preemptPriority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token plain">         </span><span class="token comment" style=color:#8292a2;font-style:italic># 高于1000的任务可以抢占</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">preemptPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PriorityBased  </span><span class="token comment" style=color:#8292a2;font-style:italic># 基于优先级选择被抢占对象</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>为Pod标记是否可被抢占</strong>：</p>
<p>通过在<code>Pod</code>上添加<code>volcano.sh/preemptable</code>注解来标记<code>Pod</code>是否可被抢占：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> low</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 标记此Pod可被抢占</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>使用优先级类定义任务优先级</strong>：</p>
<p>创建优先级类（<code>PriorityClass</code>）来定义不同优先级的任务：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PriorityClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">globalDefault</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"高优先级任务，可以抢占低优先级任务"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PriorityClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> low</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">globalDefault</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"低优先级任务，可被高优先级任务抢占"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>在PodGroup中使用优先级类</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用高优先级类</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<p><strong>preempt动作的工作流程</strong>：</p>
<ol>
<li>调度器识别出因资源不足而无法调度的高优先级任务</li>
<li>根据<code>preemptPolicy</code>策略，在集群中寻找可被抢占的低优先级任务</li>
<li>对于标记为<code>volcano.sh/preemptable: "true"</code>的Pod，优先考虑抢占</li>
<li>根据优先级差异，选择优先级最低的任务进行抢占</li>
<li>终止被选中的低优先级任务，释放其资源</li>
<li>将释放的资源分配给高优先级任务</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>明确标记哪些<code>Pod</code>可被抢占，避免关键服务被意外终止</li>
<li>为不同类型的工作负载设置合理的优先级类</li>
<li>对于可能被抢占的工作负载，实现适当的检查点机制或任务恢复能力</li>
<li>在资源紧张的环境中，合理使用<code>preempt</code>动作可以提高关键任务的响应速度和集群资源利用率</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5-reclaim回收>5. reclaim（回收）<a href=#5-reclaim回收 class=hash-link aria-label="Direct link to 5. reclaim（回收）" title="Direct link to 5. reclaim（回收）">​</a></h3>
<p><strong>主要功能</strong>：从超出其公平份额的队列中回收资源，并将其重新分配给其他队列。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个队列的公平份额和实际使用情况</li>
<li>识别超额使用资源的队列</li>
<li>从这些队列中选择可回收的任务</li>
<li>终止这些任务以释放资源</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当集群中有多个队列，每个队列都有权重设置（如生产队列权重为<code>60%</code>，开发队列为<code>30%</code>，测试队列为<code>10%</code>）。如果开发队列使用了超过<code>50%</code>的集群资源，而生产队列需要更多资源时，<code>reclaim</code>动作会从开发队列中回收资源。</p>
<p><strong>注意事项</strong>：</p>
<p>为什么队列设置了 <code>Quota</code> 还会出现超额使用的情况？</p>
<p><code>Volcano</code> 的资源分配和回收机制采用了"宽松分配+周期性回收"的设计，主要原因有：</p>
<ul>
<li><strong>宽松分配</strong>：在实际调度时，为了提升资源利用率和调度灵活性，调度器可能允许某些队列临时超出其配额（<code>Quota</code>）使用资源，尤其是在集群资源充足、其他队列没有资源需求时。</li>
<li><strong>动态变化</strong>：集群资源和队列需求是动态变化的，某一时刻资源分配合理，但随着新任务加入或资源需求变化，某些队列可能会暂时超额。</li>
<li><strong>周期性回收</strong>：<code>reclaim</code> 动作就是为了解决上述问题而设计的。它会定期检查所有队列的资源使用情况，一旦发现某队列超出其公平份额，就会触发资源回收，将多占用的资源释放出来，分配给资源不足的队列。</li>
</ul>
<p><code>Volcano</code> 的 <code>reclaim</code>（回收）操作本质上就是强制终止（<code>Evict/Kill</code>）超额队列中的部分任务的 <code>Pod</code>，以释放资源并将其分配给其他资源不足或高优先级的队列。被回收的任务如果有重试或重调度机制，后续可能会被重新调度到集群中。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=6-shuffle重新分配>6. shuffle（重新分配）<a href=#6-shuffle重新分配 class=hash-link aria-label="Direct link to 6. shuffle（重新分配）" title="Direct link to 6. shuffle（重新分配）">​</a></h3>
<p><strong>主要功能</strong>：选择并驱逐正在运行的任务，以实现资源重新分配或负载均衡。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>收集所有正在运行的任务</li>
<li>通过插件定义的策略选择需要驱逐的任务</li>
<li>驱逐选中的任务，释放其资源</li>
<li>这些任务将在后续调度周期中被重新调度</li>
</ul>
<p><strong>示例场景</strong>：</p>
<p>当集群中的负载分布不均衡时，例如某些节点资源利用率非常高而其他节点却相对空闲，<code>shuffle</code>动作可以驱逐部分任务，让它们在下一个调度周期重新分配到资源利用率较低的节点上，从而实现负载均衡。</p>
<p><strong>注意事项</strong>：</p>
<ol>
<li><code>shuffle</code>动作会导致任务被驱逐并重新调度，这可能会对应用程序造成短暂的中断。</li>
<li><strong>需要配合相应的插件（如<code>victimtasks</code>）来定义驱逐策略，决定哪些任务应该被驱逐。</strong></li>
<li>对于状态敏感或需要长时间运行的应用，应谨慎使用<code>shuffle</code>动作，或者确保这些应用有适当的状态保存和恢复机制。</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>将<code>shuffle</code>动作放在调度器配置的后面，确保它只在其他调度策略（如<code>allocate</code>、<code>backfill</code>）无法解决问题时才会被触发。</li>
<li>为需要保护的关键任务添加适当的标签或注解，确保它们不会被<code>shuffle</code>动作驱逐。</li>
<li>在资源利用率不均衡或需要定期重新平衡集群负载的场景中，<code>shuffle</code>动作可以提供显著的效益。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-中的-plugins>Volcano 中的 Plugins<a href=#volcano-中的-plugins class=hash-link aria-label="Direct link to Volcano 中的 Plugins" title="Direct link to Volcano 中的 Plugins">​</a></h2>
<p><code>Plugins</code>是<code>Volcano</code>调度器的决策模块，它们在不同的调度阶段提供特定的功能。
在上面的配置中，插件被组织成两个层级（<code>tiers</code>），每个层级包含多个插件。
层级的概念允许插件按照优先级顺序执行，高层级的插件优先级高于低层级的插件。</p>
<p><strong>注意事项</strong>：部分插件支持在<code>Job</code>的<code>spec.plugins</code>中设置插件参数，但是只有在<code>Volcano</code>的全局配置中启用了该插件，在<code>Job</code>的<code>spec.plugins</code>中该插件才能起作用，否则无效。</p>
<p>让我们逐一解释这些插件的作用：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-priority优先级>1. priority（优先级）<a href=#1-priority优先级 class=hash-link aria-label="Direct link to 1. priority（优先级）" title="Direct link to 1. priority（优先级）">​</a></h3>
<p><strong>主要功能</strong>：根据任务的优先级对其进行排序，确保高优先级任务先被调度。</p>
<p><img decoding=async loading=lazy src=/assets/images/fair-share-1a3531fe35b4925edd4c09a058c2700e.png width=1272 height=500 class=img_ev3q></p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>读取任务的<code>PriorityClass</code>或优先级注解</li>
<li>根据优先级值对任务进行排序</li>
<li>高优先级任务在资源分配时会被优先考虑</li>
</ul>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PriorityClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">globalDefault</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"This priority class is used for critical production jobs"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> critical</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 其他配置...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置将使<code>critical-job</code>获得高优先级，在资源竞争时优先被调度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-gang成组>2. gang（成组）<a href=#2-gang成组 class=hash-link aria-label="Direct link to 2. gang（成组）" title="Direct link to 2. gang（成组）">​</a></h3>
<p><strong>主要功能</strong>：实现成组调度，确保任务的所有成员（<code>Pod</code>）可以同时运行。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>读取任务的<code>minAvailable</code>设置</li>
<li>检查是否有足够的资源来运行最小所需的<code>Pod</code>数量</li>
<li>只有当所有必要的<code>Pod</code>都能被调度时，才会进行调度</li>
</ul>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> distributed</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ps</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># Pod模板...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># Pod模板...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置要求至少<code>4</code>个<code>Pod</code>（<code>1</code>个<code>ps</code>和<code>3</code>个<code>worker</code>）同时可用才会开始调度。这对于分布式训练等需要多个组件协同工作的任务非常重要。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-conformance一致性>3. conformance（一致性）<a href=#3-conformance一致性 class=hash-link aria-label="Direct link to 3. conformance（一致性）" title="Direct link to 3. conformance（一致性）">​</a></h3>
<blockquote>
<p>官网介绍链接：<a href=https://volcano.sh/en/docs/schduler_introduction/#conformance target=_blank rel="noopener noreferrer">https://volcano.sh/en/docs/schduler_introduction/#conformance</a></p>
</blockquote>
<p><strong>主要功能</strong>：<code>conformance</code>插件就像<code>Kubernetes</code>的"规则检查员"，确保<code>Volcano</code>的调度决策符合<code>Kubernetes</code>的标准和约定。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>检查<code>Pod</code>的配置是否符合<code>Kubernetes</code>的规则（比如不能设置无效的资源请求）</li>
<li>验证调度决策不会违反<code>Kubernetes</code>的基本原则（比如不会将<code>Pod</code>调度到资源不足的节点）</li>
<li>确保<code>Volcano</code>的行为与标准<code>Kubernetes</code>调度器保持一致，避免冲突</li>
</ul>
<p><strong>使用示例</strong>：
假设有一个任务请求了以下资源：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> example</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> example</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"2Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"500m"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>conformance</code>插件会执行以下检查：</p>
<ol>
<li>验证资源请求格式是否正确（如"<code>500m</code>" <code>CPU</code>是有效格式）</li>
<li>确保<code>Pod</code>不会被调度到无法满足<code>2GB</code>内存和<code>0.5CPU</code>需求的节点上</li>
<li>如果该<code>Pod</code>有特殊的调度约束（如污点容忍），确保这些约束被正确处理</li>
</ol>
<p>如果<code>Volcano</code>尝试做出不符合<code>Kubernetes</code>规则的调度决策（例如，将<code>Pod</code>调度到资源已满的节点），<code>conformance</code>插件会阻止这种行为，确保系统稳定性和一致性。</p>
<p>这个插件对用户来说是"无形"的，它在后台默默工作，确保所有调度决策都符合<code>Kubernetes</code>的标准，不需要用户进行特殊配置。</p>
<p><strong>是否可以不使用<code>conformance</code>插件？</strong></p>
<p>从技术上讲，可以不使用<code>conformance</code>插件，因为<code>Volcano</code>允许用户自定义启用哪些插件。但这样做会带来一些潜在风险：</p>
<ul>
<li><strong>调度不一致性</strong>：没有<code>conformance</code>插件，<code>Volcano</code>可能会做出与<code>Kubernetes</code>标准不兼容的调度决策，导致系统行为不可预测。</li>
<li><strong>资源冲突</strong>：可能会出现资源分配冲突，例如<code>Pod</code>被调度到不满足其资源需求的节点上。</li>
<li><strong>API兼容性问题</strong>：可能会接受一些不符合<code>Kubernetes</code> API约定的配置，导致后续操作失败。</li>
<li><strong>系统稳定性降低</strong>：<code>conformance</code>插件是<code>Volcano</code>的核心插件之一，它确保调度系统的基础稳定性。禁用它可能会导致一些难以排查的问题。</li>
</ul>
<p><strong>注意事项</strong>：</p>
<p>在<code>Volcano</code>的默认配置中，<code>conformance</code>通常是作为必要插件启用的。如果你有特殊的调度需求，建议保留<code>conformance</code>插件，同时通过配置其他插件来满足你的特定需求，而不是禁用这个基础的一致性保障机制。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-drf主导资源公平性>4. drf（主导资源公平性）<a href=#4-drf主导资源公平性 class=hash-link aria-label="Direct link to 4. drf（主导资源公平性）" title="Direct link to 4. drf（主导资源公平性）">​</a></h3>
<p><strong>主要功能</strong>：实现主导资源公平性（<code>Dominant Resource Fairness</code>）算法，确保资源在不同队列和任务之间公平分配。</p>
<p><img decoding=async loading=lazy src=/assets/images/drfjob-541cd13a977b6710cdc634a9db1f7934.png width=732 height=488 class=img_ev3q></p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个任务的主导资源（即任务所需的最多的资源类型）</li>
<li>根据主导资源的使用比例对任务进行排序</li>
<li>确保所有用户或队列都能获得公平的资源份额</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li><strong>多租户环境</strong>：多个团队或项目共享同一个集群</li>
<li><strong>异构工作负载</strong>：集群中运行不同类型的任务</li>
<li><strong>资源紧张环境</strong>：集群资源不足以满足所有队列的需求</li>
<li><strong>需要公平调度的场景</strong>：确保每个队列都能获得合理的资源份额</li>
</ul>
<p><strong>DRF插件的核心价值</strong>：</p>
<ol>
<li>
<p><strong>解决资源竞争问题</strong>：</p>
<ul>
<li>在<code>Kubernetes</code>集群中，不同队列可能运行不同类型的任务</li>
<li>有些任务可能是CPU密集型（如机器学习训练）</li>
<li>有些任务可能是内存密集型（如大数据处理）</li>
<li>有些任务可能是GPU密集型（如深度学习）</li>
<li>如果不使用DRF，先提交的队列可能会占用过多资源，导致其他队列无法获得足够的资源</li>
</ul>
</li>
<li>
<p><strong>确保资源分配公平性</strong>：</p>
<ul>
<li>DRF会计算每个队列的"主导资源"（即该队列最需要的资源类型）</li>
<li>根据主导资源的使用比例对任务进行排序</li>
<li>确保所有队列都能获得其主导资源的公平份额</li>
<li>防止某些队列因为资源竞争而完全无法运行</li>
</ul>
</li>
<li>
<p><strong>提高资源利用率</strong>：</p>
<ul>
<li>通过考虑每个队列的主导资源需求</li>
<li>避免资源分配不均衡导致的资源浪费</li>
<li>确保集群资源得到更高效的利用</li>
</ul>
</li>
</ol>
<p><strong>与Kubernetes默认调度器的区别</strong>：</p>
<ul>
<li>默认调度器是"先到先得"的方式</li>
<li>不考虑资源分配的公平性</li>
<li>只关注单个<code>Pod</code>的资源需求</li>
<li>不考虑队列级别的资源分配策略</li>
</ul>
<p><strong>使用示例</strong>：</p>
<p>假设集群中有两个队列（<code>A</code>和<code>B</code>）和两种资源（<code>CPU</code>和<code>内存</code>），总资源为<code>20</code>个<code>CPU</code>核心和<code>40GB</code>内存。</p>
<p>队列<code>A</code>中的任务主要需要<code>CPU</code>资源：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">intensive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">a</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">workload</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"10"</span><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 每个Pod请求10个CPU核心</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"5Gi"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 每个Pod请求5GB内存</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>队列<code>B</code>中的任务主要需要内存资源：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> memory</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">intensive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">b</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> memory</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> memory</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> memory</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">workload</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"2"</span><span class="token plain">     </span><span class="token comment" style=color:#8292a2;font-style:italic># 每个Pod请求2个CPU核心</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"20Gi"</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># 每个Pod请求20GB内存</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>DRF如何工作</strong>：</p>
<ol>
<li>
<p><strong>计算主导资源</strong>：</p>
<ul>
<li>队列<code>A</code>：<code>CPU</code>是主导资源（每个<code>Pod</code>需要<code>50%</code>的集群<code>CPU</code>）</li>
<li>队列<code>B</code>：<code>内存</code>是主导资源（每个<code>Pod</code>需要<code>50%</code>的集群内存）</li>
</ul>
</li>
<li>
<p><strong>不使用DRF的情况</strong>：</p>
<ul>
<li>如果队列<code>A</code>先提交任务：<!-- -->
<ul>
<li><code>2</code>个<code>Pod</code>会占用<code>20</code>个<code>CPU</code>和<code>10GB</code>内存</li>
<li>剩余资源：<code>0</code>个<code>CPU</code> + <code>30GB</code>内存</li>
<li>队列<code>B</code>完全无法运行（因为<code>CPU</code>资源不足）</li>
<li>结果：队列<code>A</code>获得<code>100%</code>的<code>CPU</code>份额，队列<code>B</code>获得<code>0%</code>的资源份额</li>
</ul>
</li>
<li>如果队列<code>B</code>先提交任务：<!-- -->
<ul>
<li><code>2</code>个<code>Pod</code>会占用<code>4</code>个<code>CPU</code>和<code>40GB</code>内存</li>
<li>剩余资源：<code>16</code>个<code>CPU</code> + <code>0GB</code>内存</li>
<li>队列<code>A</code>只能运行<code>1</code>个<code>Pod</code>（因为内存限制：<code>5GB</code> > 剩余<code>0GB</code>）</li>
<li>结果：队列<code>B</code>获得<code>100%</code>的内存份额，队列<code>A</code>只能获得<code>50%</code>的<code>CPU</code>份额</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>使用DRF后的效果</strong>：</p>
<ul>
<li><code>DRF</code>会确保公平分配：<!-- -->
<ul>
<li>队列<code>A</code>获得约<code>50%</code>的<code>CPU</code>份额（<code>10</code>个<code>CPU</code>）和约<code>25%</code>的内存份额（<code>10GB</code>）</li>
<li>队列<code>B</code>获得约<code>50%</code>的<code>CPU</code>份额（<code>10</code>个<code>CPU</code>）和约<code>75%</code>的内存份额（<code>30GB</code>）</li>
</ul>
</li>
<li>最终结果：<!-- -->
<ul>
<li>队列<code>A</code>可以运行<code>1</code>个<code>Pod</code>（使用<code>10</code>个<code>CPU</code>和<code>5GB</code>内存）</li>
<li>队列<code>B</code>可以运行<code>1</code>个<code>Pod</code>（使用<code>2</code>个<code>CPU</code>和<code>20GB</code>内存）</li>
<li>两个队列都能获得其主导资源的公平份额</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>DRF插件的局限性</strong>：</p>
<p>需要注意的是，仅仅启用<code>DRF</code>插件并不能完全解决资源竞争问题。这是因为：</p>
<ol>
<li>
<p><strong>调度时机的影响</strong>：</p>
<ul>
<li><code>Volcano</code>调度器按照调度周期（默认<code>1</code>秒）执行</li>
<li>如果队列<code>A</code>的任务先提交，在<code>DRF</code>插件生效前，这些任务可能已经被调度并运行</li>
<li>当队列<code>B</code>的任务提交时，可能已经无法获得足够的资源</li>
</ul>
</li>
<li>
<p><strong>已运行任务的影响</strong>：</p>
<ul>
<li><code>DRF</code>插件只能影响当前待调度的任务</li>
<li>对于已经运行的任务，<code>DRF</code>插件无法强制重新分配资源</li>
<li>除非这些任务完成或被终止，否则资源分配不会改变</li>
</ul>
</li>
<li>
<p><strong>更好的解决方案</strong>：</p>
<ul>
<li>使用队列（<code>Queue</code>）资源限制</li>
<li>使用资源配额（<code>ResourceQuota</code>）</li>
<li>使用优先级（<code>Priority</code>）机制</li>
<li>这些机制可以在任务提交前就限制资源使用</li>
</ul>
</li>
</ol>
<p>因此，在实际使用中，通常需要结合其他机制来确保资源分配的公平性。这也说明了为什么<code>Volcano</code>提供了多种插件和机制来管理资源分配。</p>
<p><strong>是否可以不使用<code>DRF</code>插件？</strong></p>
<p>从技术上讲，可以不使用<code>DRF</code>插件，因为<code>Volcano</code>允许用户自定义启用哪些插件。
但在以下场景中，<code>DRF</code>插件几乎是必不可少的：</p>
<ul>
<li><strong>多队列环境</strong>：当集群中有多个队列竞争资源时</li>
<li><strong>异构工作负载</strong>：当不同队列的任务有显著不同的资源需求特点（如<code>CPU</code>密集型与内存密集型）</li>
<li><strong>资源紧张场景</strong>：当集群资源紧张，需要更公平高效的资源分配时</li>
</ul>
<p>如果你的集群资源充足，或者只有单一队列，或者所有任务的资源需求特点相似，那么可能不需要<code>DRF</code>插件。
但在大多数生产环境中，<code>DRF</code>插件提供的公平性保障是非常有价值的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5-predicates断言>5. predicates（断言）<a href=#5-predicates断言 class=hash-link aria-label="Direct link to 5. predicates（断言）" title="Direct link to 5. predicates（断言）">​</a></h3>
<p><strong>主要功能</strong>：检查节点是否满足运行特定任务的条件，类似于标准<code>Kubernetes</code>调度器的断言。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>检查节点资源是否满足任务需求</li>
<li>检查节点是否满足任务的亲和性、反亲和性要求</li>
<li>检查节点标签是否符合任务要求</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>predicates.enableNodeSelectorPredicate</code><td><code>bool</code><td><code>true</code><td>是否启用节点标签断言<tr><td><code>predicates.enablePodAffinityPredicate</code><td><code>bool</code><td><code>false</code><td>是否启用<code>Pod</code>亲和性断言<tr><td><code>predicates.enablePodTolerationPredicate</code><td><code>bool</code><td><code>true</code><td>是否启用污点容忍断言<tr><td><code>predicates.enableResourcePredicate</code><td><code>bool</code><td><code>true</code><td>是否启用资源断言<tr><td><code>predicates.enableNodePortsPredicate</code><td><code>bool</code><td><code>true</code><td>是否启用端口冲突断言<tr><td><code>predicates.enableVolumePredicate</code><td><code>bool</code><td><code>true</code><td>是否启用存储卷断言<tr><td><code>predicates.resourceThresholds</code><td><code>map</code><td><code>{}</code><td>自定义资源阈值（如<code>cpu</code>、<code>memory</code>等）</table>
<p><strong>参数说明补充</strong>：</p>
<ul>
<li>
<p><code>predicates.resourceThresholds</code> 用于自定义节点资源的可用阈值，影响调度器在断言节点资源是否满足任务需求时的判定标准。默认情况下，调度器会根据节点的实际可用资源与 <code>Pod</code> 的 <code>requests</code> 进行对比，判断节点是否有足够资源来承载任务。通过配置该参数，可以为如 <code>cpu</code>、<code>memory</code> 等资源设置阈值，只有当节点的可用资源大于等于该阈值时，才会被认为可调度。</p>
</li>
<li>
<p>典型用途包括保护节点资源，防止节点被调度到极限，提升集群稳定性。例如：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.resourceThresholds</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 8Gi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述配置表示：只有当节点剩余 <code>CPU≥2000m</code>、<code>内存≥8Gi</code> 时，才会被断言为"可用节点"。</p>
</li>
</ul>
<p>如不配置该参数，默认 <code>{}</code>，即不额外限制，由调度器按实际资源判断。</p>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.enableNodeSelectorPredicate</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.enablePodAffinityPredicate</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.enablePodTolerationPredicate</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.enableResourcePredicate</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.enableNodePortsPredicate</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.enableVolumePredicate</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">predicates.resourceThresholds</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 8Gi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nvidia/cuda</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置要求任务只能运行在标记为<code>gpu=true</code>的节点上，并且需要<code>GPU</code>资源。<code>predicates</code>插件会确保只有满足这些条件的节点才会被选中。</p>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><code>predicates</code> 插件并不是 <code>Volcano</code> 调度器中的"强制必选"插件，但在绝大多数实际生产场景下，它是非常推荐启用的核心插件之一。</p>
</li>
<li>
<p><code>predicates</code> 插件实现了节点资源、亲和性、污点容忍、端口冲突等一系列基础调度断言，类似于 <code>Kubernetes</code> 默认调度器的核心功能。如果关闭该插件，调度器将无法正确判断节点是否真正满足任务的各种约束条件，可能导致任务被调度到不合适的节点，带来资源冲突、调度失败或业务异常等问题。</p>
</li>
<li>
<p><code>Volcano</code> 支持插件化调度框架，允许用户通过配置 <code>tiers/plugins</code> 灵活启用或禁用插件。如果你明确了解自己的业务场景、节点环境和调度需求，也可以选择不启用 <code>predicates</code> 插件，但需自行确保不会引入调度安全隐患。
结论：</p>
</li>
<li>
<p>对于大多数生产集群和常规批量计算场景，建议始终启用 <code>predicates</code> 插件，以保障调度的正确性与安全性。
只有在非常特殊、可控的实验性场景下，且明确知道后果时，才可以选择不启用该插件。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=6-proportion比例>6. proportion（比例）<a href=#6-proportion比例 class=hash-link aria-label="Direct link to 6. proportion（比例）" title="Direct link to 6. proportion（比例）">​</a></h3>
<p><strong>主要功能</strong>：根据队列的权重按比例分配资源，确保资源分配符合预定的比例。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个队列的目标资源份额（根据<code>weight</code>权重）</li>
<li>监控实际资源使用情况</li>
<li>调整资源分配以符合目标比例</li>
</ul>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>6</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> development</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> testing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置定义了三个队列，权重比例为<code>6:3:1</code>。<code>proportion</code>插件会确保资源分配大致符合这个比例，
即生产队列获得<code>60%</code>的资源，开发队列获得<code>30%</code>，测试队列获得<code>10%</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=7-nodeorder节点排序>7. nodeorder（节点排序）<a href=#7-nodeorder节点排序 class=hash-link aria-label="Direct link to 7. nodeorder（节点排序）" title="Direct link to 7. nodeorder（节点排序）">​</a></h3>
<p><strong>主要功能</strong>：为任务选择最适合的节点，基于多种因素对节点进行打分和排序。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>考虑节点的资源利用率</li>
<li>考虑任务的亲和性和反亲和性要求</li>
<li>考虑节点的标签和条件</li>
<li>为每个节点计算分数，选择分数最高的节点</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>nodeaffinity.weight</code><td><code>int</code><td><code>1</code><td>节点亲和性优先级权重<tr><td><code>podaffinity.weight</code><td><code>int</code><td><code>1</code><td><code>Pod</code> 亲和性优先级权重<tr><td><code>leastrequested.weight</code><td><code>int</code><td><code>1</code><td>最少资源使用优先级权重<tr><td><code>balancedresource.weight</code><td><code>int</code><td><code>1</code><td>资源均衡优先级权重<tr><td><code>mostrequested.weight</code><td><code>int</code><td><code>1</code><td>最大资源使用优先级权重<tr><td><code>tainttoleration.weight</code><td><code>int</code><td><code>1</code><td>污点容忍优先级权重<tr><td><code>imagelocality.weight</code><td><code>int</code><td><code>1</code><td>镜像本地性优先级权重<tr><td><code>podtopologyspread.weight</code><td><code>int</code><td><code>1</code><td><code>Pod</code> 拓扑分布优先级权重</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>所有权重参数的默认值均为 <code>1</code>，如未配置则调度器采用默认权重。</li>
<li>权重越大，相关因素在节点排序中的影响越大。</li>
<li>可根据实际业务场景灵活调整权重，实现资源利用、亲和性、分布均衡等多目标优化。</li>
</ul>
</blockquote>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeaffinity.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">podaffinity.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">leastrequested.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">balancedresource.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">mostrequested.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">tainttoleration.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">imagelocality.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">podtopologyspread.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：</p>
<p>下面是一个典型的 <code>nodeorder</code> 插件配置与任务调度示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># volcano-scheduler.conf 片段</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nodeaffinity.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">podaffinity.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">leastrequested.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">balancedresource.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">mostrequested.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">tainttoleration.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">imagelocality.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">podtopologyspread.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># Job 示例</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> affinity</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">affinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">nodeAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> disktype</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                        </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                        </span><span class="token key atrule">values</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">ssd</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">podAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">labelSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                      </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> myapp</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">topologyKey</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> kubernetes.io/hostname</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> busybox</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"sleep"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"3600"</span><span class="token punctuation" style=color:#f8f8f2>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在上述配置中：</p>
<ul>
<li><code>nodeorder</code> 插件通过不同权重综合考虑节点亲和性、<code>Pod</code> 亲和性、资源利用率等因素，为每个节点打分。</li>
<li>任务通过 <code>affinity</code> 字段表达了节点和 <code>Pod</code> 亲和性需求。</li>
<li>调度器最终会选择分数最高、最符合业务需求的节点进行任务调度。</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><code>nodeorder</code> 插件并不是 <code>Volcano</code> 调度器中的"强制必选"插件，但在实际生产环境中，它也是非常常用且推荐启用的插件之一。</p>
</li>
<li>
<p><code>nodeorder</code> 插件负责为所有可用节点打分排序，帮助调度器选择最适合任务的节点。它支持多种打分策略（如资源利用率、亲和性、污点容忍等），极大提升了调度的灵活性和智能性。</p>
</li>
<li>
<p>如果不启用 <code>nodeorder</code> 插件，调度器将无法对节点进行综合打分排序，可能只能采用简单的随机或轮询等方式分配任务，容易导致资源利用率低下或调度结果不理想。</p>
</li>
<li>
<p><code>Volcano</code> 支持插件化调度框架，允许用户根据实际需求选择启用或禁用 <code>nodeorder</code>。只有在极为特殊、对节点选择没有要求的场景下，才可能不启用该插件。</p>
</li>
<li>
<p>对于绝大多数生产集群和批量计算场景，建议始终启用 <code>nodeorder</code> 插件，以实现更优的资源利用和调度效果。</p>
</li>
<li>
<p>只有在明确知道后果且业务场景极为特殊时，才可以选择不启用该插件。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=8-binpack装箱>8. binpack（装箱）<a href=#8-binpack装箱 class=hash-link aria-label="Direct link to 8. binpack（装箱）" title="Direct link to 8. binpack（装箱）">​</a></h3>
<p><strong>主要功能</strong>：将任务紧密地打包到尽可能少的节点上，提高资源利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>优先选择已经有高资源利用率的节点</li>
<li>尽量将任务集中在少数节点上</li>
<li>减少空闲节点的数量，提高能源效率</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>binpack.weight</code><td><code>int</code><td><code>1</code><td><code>binpack</code> 策略整体权重（优先级）<tr><td><code>binpack.cpu</code><td><code>int</code><td><code>1</code><td><code>CPU</code> 资源权重<tr><td><code>binpack.memory</code><td><code>int</code><td><code>1</code><td>内存资源权重<tr><td><code>binpack.resources</code><td><code>map</code><td>无<td>其他自定义资源权重（如<code>gpu</code>等），需显式配置</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>所有权重参数默认值均为 <code>1</code>，如未配置则调度器采用默认权重。</li>
<li><code>binpack.resources</code> 可用于为 <code>GPU</code>、<code>FPGA</code> 等自定义资源单独设置权重，未配置时不生效。</li>
<li>权重越大，相关资源在 <code>binpack</code> 排序中的影响越大。</li>
<li>可根据实际业务场景灵活调整各项权重，实现资源利用最大化。</li>
</ul>
</blockquote>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> binpack</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">binpack.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">binpack.cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">binpack.memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">binpack.resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：
当集群中有多个小型任务需要调度时，<code>binpack</code>插件会尽量将它们调度到同一个或少数几个节点上，而不是分散到多个节点。
这样可以保持更多的节点处于空闲状态，可以关闭这些节点以节省能源，或者用于运行大型任务。以<code>deepseek</code>为例，一个集群有三个<code>8</code>卡节点，每个节点上都已经被占用了一个卡，每个节点只有<code>7</code>卡，而<code>deepseek</code>需要两个<code>8</code>卡节点才能启动，这时候管理视角有<code>21</code>卡空余，但是实际却不能调度任何容器。这是需要调度器尽可能优先将一个节点填满，或者可以触发重调度，将三个单卡容器调度到一个节点，以平衡资源状态，使业务可以被调度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=9-numaawarenuma感知>9. numaaware（NUMA感知）<a href=#9-numaawarenuma感知 class=hash-link aria-label="Direct link to 9. numaaware（NUMA感知）" title="Direct link to 9. numaaware（NUMA感知）">​</a></h3>
<p><strong>NUMA简介</strong>：
<code>NUMA</code>（<code>Non-Uniform Memory Access</code>，非统一内存访问）是一种计算机内存架构，在这种架构中，内存访问时间取决于内存相对于处理器的位置。在<code>NUMA</code>系统中，处理器访问其本地内存（同一<code>NUMA</code>节点上的内存）比访问非本地内存（其他<code>NUMA</code>节点上的内存）要快。这种架构在现代多处理器服务器中非常常见，对于高性能计算工作负载来说至关重要。</p>
<p><img decoding=async loading=lazy src=/assets/images/20220602110808-6967b51ad8ee5e28238453c3f3226f91.png width=513 height=367 class=img_ev3q></p>
<p><strong>主要功能</strong>：优化对<code>NUMA</code>（非统一内存访问）架构的支持，提高计算密集型任务的性能。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>识别节点的<code>NUMA</code>拓扑结构</li>
<li>尽量将任务的所有资源（<code>CPU</code>、内存、设备）分配在同一<code>NUMA</code>节点上</li>
<li>减少跨<code>NUMA</code>节点的内存访问，降低延迟</li>
</ul>
<p><strong>使用示例</strong>：
对于高性能计算或AI训练等对内存访问延迟敏感的工作负载，
<code>numaaware</code>插件可以确保任务的<code>CPU</code>和内存资源分配在同一<code>NUMA</code>节点上，避免跨节点访问导致的性能下降。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=10-task-topology任务拓扑>10. task-topology（任务拓扑）<a href=#10-task-topology任务拓扑 class=hash-link aria-label="Direct link to 10. task-topology（任务拓扑）" title="Direct link to 10. task-topology（任务拓扑）">​</a></h3>
<p><strong>主要功能</strong>：基于任务之间的亲和性和反亲和性配置，计算任务和节点的优先级，优化任务分布。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>分析任务之间的亲和性和反亲和性设置</li>
<li>将有亲和性配置的任务优先调度到同一节点</li>
<li>将有反亲和性配置的任务调度到不同节点</li>
</ul>
<p><strong>使用示例</strong>：
在深度学习计算场景中，任务拓扑对提高计算效率非常重要。以<code>TensorFlow</code>分布式训练为例，我们可以定义如下任务拓扑关系：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">ssh</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">svc</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">policies</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">event</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodEvicted</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RestartJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ps</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">2.4.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/train.py"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"--job_name=ps"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"--task_index=0"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">ports</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2222</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tfjob</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">port</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 8Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">policies</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">event</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> TaskCompleted</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> CompleteJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">2.4.0</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">gpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/train.py"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"--job_name=worker"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"--task_index=${VK_TASK_INDEX}"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 8Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">topologyPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">affinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token key atrule">"taskA"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"ps"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token key atrule">"taskB"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"worker"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token key atrule">"weight"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ps和worker之间的亲和性，权重为10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">antiAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token key atrule">"taskA"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"worker"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token key atrule">"taskB"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"worker"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token key atrule">"weight"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># worker之间的反亲和性，权重为5</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个配置中：</p>
<ol>
<li>
<p><strong>亲和性配置</strong>：</p>
<ul>
<li><code>ps</code>和<code>worker</code>任务之间设置了亲和性，权重为<code>10</code></li>
<li>这意味着调度器将尽量将<code>ps</code>和<code>worker</code>调度到同一节点或者物理上接近的节点</li>
<li>这样可以显著减少参数服务器（<code>PS</code>）和工作节点之间的网络延迟，提高训练效率</li>
</ul>
</li>
<li>
<p><strong>反亲和性配置</strong>：</p>
<ul>
<li><code>worker</code>之间设置了反亲和性，权重为<code>5</code></li>
<li>这意味着调度器将尽量将不同的<code>worker</code>调度到不同的节点</li>
<li>这样可以提高系统的容错性（单个节点失效不会导致所有<code>worker</code>都下线），并充分利用集群中的分布式计算能力</li>
</ul>
</li>
<li>
<p><strong>权重设置</strong>：</p>
<ul>
<li>亲和性的权重为<code>10</code></li>
<li>反亲和性的权重为<code>5</code></li>
<li>这意味着在决策过程中，如果出现冲突，调度器会优先考虑<code>ps</code>和<code>worker</code>的亲和性需求</li>
</ul>
</li>
</ol>
<p>通过这种配置，<code>task-topology</code>插件可以显著提高分布式训练的效率和可靠性。在实际应用中，可以根据具体工作负载的特点和集群的结构来调整亲和性和反亲和性的配置及其权重。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=11-sla服务级别协议>11. sla（服务级别协议）<a href=#11-sla服务级别协议 class=hash-link aria-label="Direct link to 11. sla（服务级别协议）" title="Direct link to 11. sla（服务级别协议）">​</a></h3>
<p><strong>主要功能</strong>：实现服务级别协议（<code>Service Level Agreement</code>）的管理，确保任务的调度符合特定的服务质量要求。</p>
<p><strong>工作原理</strong>：</p>
<p>该插件的核心机制，就是为任务设置一个"调度等待时间阈值"。当某个任务在队列中等待调度的时间超过了这个阈值，调度器就会自动提升该任务的优先级，从而让它更快地被调度执行，避免长期得不到资源导致"饿死"现象。</p>
<ul>
<li>监控任务的等待时间和调度状态</li>
<li>根据<code>sla</code>策略调整任务的优先级</li>
<li>防止任务长时间处于等待状态，避免资源饥饿</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>sla-waiting-time</code><td><code>bool</code><td><code>false</code><td>是否启用等待时间提升优先级功能<tr><td><code>job-waiting-time.优先级名</code><td><code>string</code><td>无<td>各优先级任务的等待时间阈值（如 <code>60s</code>、<code>120s</code>、<code>300s</code>）<tr><td><code>job-starvation-timeout</code><td><code>string</code><td>无<td>任务饥饿超时时间，超时后强制提升优先级（如 <code>900s</code>）<tr><td><code>sla-queue-waiting-time.队列名</code><td><code>string</code><td>无<td>针对特定队列的等待时间阈值（可选）<tr><td><code>sla-job-label-waiting-time.标签名=标签值</code><td><code>string</code><td>无<td>针对带特定 <code>label</code> 的 <code>Job</code> 的等待时间阈值（可选）</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>sla-waiting-time</code> 默认关闭，需显式设置为 <code>true</code> 才会生效。</li>
<li>其它参数如未配置则不生效，需根据业务场景显式指定。</li>
<li>时间阈值参数支持 <code>s</code>（秒）、<code>m</code>（分钟）等单位。</li>
</ul>
</blockquote>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> sla</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">sla-waiting-time</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">job-waiting-time.high-priority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 60s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">job-waiting-time.medium-priority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 120s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">job-waiting-time.low-priority</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 300s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">job-starvation-timeout</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 900s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">sla-queue-waiting-time.analytics</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 180s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">sla-job-label-waiting-time.type=batch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 600s</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：
下面是一个完整的<code>sla</code>插件配置示例，展示了如何为不同类型的任务设置不同的<code>sla</code>策略：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue, allocate, backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: binpack</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: sla</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          sla-waiting-time: true</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          job-waiting-time.high-priority: 60s     # 高优先级任务的等待时间阈值</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          job-waiting-time.medium-priority: 120s  # 中优先级任务的等待时间阈值</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          job-waiting-time.low-priority: 300s     # 低优先级任务的等待时间阈值</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          job-starvation-timeout: 900s            # 任务饥饿超时时间</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个配置中，我们为<code>sla</code>插件设置了以下参数：</p>
<ol>
<li>
<p><strong>等待时间策略</strong>：</p>
<ul>
<li>启用了<code>sla-waiting-time</code>功能，允许基于任务等待时间调整优先级</li>
<li>为不同优先级的任务设置了不同的等待时间阈值：<!-- -->
<ul>
<li>高优先级任务：<code>60</code>秒</li>
<li>中优先级任务：<code>120</code>秒</li>
<li>低优先级任务：<code>300</code>秒</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>饥饿防止机制</strong>：</p>
<ul>
<li>设置了<code>job-starvation-timeout</code>为<code>900</code>秒，即如果任何任务等待超过<code>15</code>分钟仍未被调度，将触发饥饿防止机制</li>
</ul>
</li>
</ol>
<p>现在，让我们看一个具体的任务配置示例，展示如何为任务设置优先级以便于与<code>sla</code>插件配合使用：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> real</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">time</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">analytics</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用高优先级类别</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> analytics</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> analytics</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> analytics</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">processing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> low</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用低优先级类别</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 1000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2Gi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个示例中，我们定义了两个任务：</p>
<ol>
<li>
<p><strong>实时分析任务</strong>：</p>
<ul>
<li>设置为<code>high-priority</code>优先级</li>
<li>根据<code>sla</code>插件配置，如果该任务等待超过<code>60</code>秒，其优先级将被提升</li>
<li>这确保了实时分析任务能快速获得调度，满足其实时性需求</li>
</ul>
</li>
<li>
<p><strong>批处理任务</strong>：</p>
<ul>
<li>设置为<code>low-priority</code>优先级</li>
<li>根据<code>sla</code>插件配置，该任务可以等待长达<code>300</code>秒才会被提升优先级</li>
<li>这适合于不需要实时响应的批量计算任务</li>
</ul>
</li>
</ol>
<p>当集群资源紧张时，<code>sla</code>插件将确保：</p>
<ol>
<li>高优先级的实时分析任务优先获得资源</li>
<li>如果低优先级的批处理任务等待时间过长（超过<code>300</code>秒），其优先级会被提升，以避免资源饥饿</li>
<li>如果任何任务等待时间超过<code>900</code>秒（饥饿超时），将触发特殊的饥饿防止机制，确保其能尽快获得调度</li>
</ol>
<p>通过这种方式，<code>sla</code>插件在保证高优先级任务快速响应的同时，也避免了低优先级任务的资源饥饿问题，实现了集群资源的合理分配和服务质量保证。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=12-tdm时分复用>12. tdm（时分复用）<a href=#12-tdm时分复用 class=hash-link aria-label="Direct link to 12. tdm（时分复用）" title="Direct link to 12. tdm（时分复用）">​</a></h3>
<p><strong>主要功能</strong>：实现时分复用（<code>Time Division Multiplexing</code>）机制，允许不同系统在不同时间段共享同一节点的资源。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>将特定节点标记为可撤销节点（<code>revocable nodes</code>）</li>
<li>在节点的可用时间段内，将可抢占任务调度到这些节点</li>
<li>在非可用时间段，将这些任务从节点上驱逐</li>
</ul>
<p><strong>参数说明</strong>：</p>
<p><strong>全局插件参数</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>tdm-scheduler-name</code><td><code>string</code><td><code>volcano-tdm</code><td>负责时分复用调度的调度器名称（需与 <code>schedulerName</code> 匹配）<tr><td><code>tdm-revocable-node-label</code><td><code>string</code><td><code>volcano.sh/revocable-node</code><td>标记可撤销节点的标签名，只有带此标签的节点参与时分复用<tr><td><code>tdm-time-ranges</code><td><code>string</code><td>无<td>不同时间段的配置，支持 <code>JSON</code> 数组格式，定义名称、起止时间、星期、时区等<tr><td><code>tdm-revocable</code><td><code>bool</code><td><code>false</code><td>是否为可撤销任务（可在指定时间段被调度到可撤销节点）<tr><td><code>tdm-timezone</code><td><code>string</code><td><code>Asia/Shanghai</code><td>时区设置，影响时间段的生效范围</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>tdm-scheduler-name</code> 和 <code>tdm-revocable-node-label</code> 一般无需更改，除非有多套调度器或特殊节点标签。</li>
<li><code>tdm-time-ranges</code> 必须配置，支持多个时间段（如工作日、非工作日、周末等），每个时间段可指定名称、起止时间、适用星期、时区等。</li>
<li><code>tdm-revocable</code> 通常在 <code>Job/task</code> 的插件参数中指定，决定该任务是否为可撤销任务。</li>
<li><code>tdm-timezone</code> 可选，默认 <code>Asia/Shanghai</code>，适用于多时区集群。</li>
</ul>
</blockquote>
<p><strong>Job插件参数</strong>：</p>
<p><code>Volcano</code> 支持在 <code>Job</code> 级别通过 <code>spec.plugins</code> 单独配置 <code>tdm</code> 插件参数，实现更细粒度的时分复用调度控制。</p>
<table><thead><tr><th>Job 层级参数<th>类型<th>说明<tbody><tr><td><code>revocable</code><td><code>bool</code><td>是否为可收回任务，决定是否参与时分复用调度<tr><td><code>timeRanges</code><td><code>[]string</code><td>允许任务运行的时间段名称，需与全局 <code>tdm</code> 配置的 <code>time-ranges</code> 匹配<tr><td><code>timezone</code><td><code>string</code><td>可选，指定该 Job 使用的时区，默认继承全局配置</table>
<p><strong>Job插件参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tdm</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">revocable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">timeRanges</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"non-working-hours"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"weekend"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">timezone</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Asia/Shanghai"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Job插件参数与全局参数关系</strong></p>
<ul>
<li><code>Job</code> 层级的 <code>tdm</code> 参数不会覆盖全局配置，而是基于全局配置做细粒度补充。<!-- -->
<ul>
<li>例如 <code>timeRanges</code> 必须引用全局 <code>tdm</code> 配置中定义的 <code>time-ranges</code> 名称，否则无效。</li>
<li><code>revocable</code> 仅影响该 <code>Job</code> 是否参与可收回任务调度，不会影响全局其它 <code>Job</code>。</li>
</ul>
</li>
<li>如果 <code>Job</code> 层级未配置某参数，则默认继承全局配置（如 <code>timezone</code>）。</li>
<li><code>Job</code> 层级参数仅对当前 <code>Job</code> 有效，不会影响全局设置。</li>
</ul>
<blockquote>
<p><strong>总结：</strong></p>
<ul>
<li><code>Job.spec.plugins</code> 是 <code>Volcano</code> 支持的原生扩展点。</li>
<li><code>plugins.tdm</code> 支持 <code>revocable</code>、<code>timeRanges</code>、<code>timezone</code> 等参数，主要用于细化 <code>Job</code> 的时分复用调度行为。</li>
<li><code>Job</code> 层级参数不会与全局参数冲突，而是互为补充，<code>Job</code> 层级参数优先生效，仅影响该 <code>Job</code>。</li>
</ul>
</blockquote>
<p><strong>使用示例</strong>：
下面是一个完整的<code>tdm</code>插件配置示例，展示了如何在混合计算环境中实现资源的时分复用：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue, allocate, backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: binpack</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: tdm</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          tdm-scheduler-name: "volcano-tdm"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          tdm-revocable-node-label: "volcano.sh/revocable-node"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          tdm-time-ranges: |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            [</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>              {</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "name": "working-hours",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "start": "09:00",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "end": "18:00",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "locations": ["Asia/Shanghai"]</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>              },</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>              {</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "name": "non-working-hours",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "start": "18:00",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "end": "09:00",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "locations": ["Asia/Shanghai"]</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>              },</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>              {</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "name": "weekend",</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "days": ["Saturday", "Sunday"],</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                "locations": ["Asia/Shanghai"]</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>              }</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            ]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个配置中，我们为<code>tdm</code>插件设置了以下参数：</p>
<ol>
<li>
<p><strong>调度器名称</strong>：</p>
<ul>
<li><code>tdm-scheduler-name: "volcano-tdm"</code>指定了负责时分复用的调度器名称</li>
</ul>
</li>
<li>
<p><strong>可收回节点标签</strong>：</p>
<ul>
<li><code>tdm-revocable-node-label: "volcano.sh/revocable-node"</code>指定了标记可收回节点的标签</li>
<li>只有带有这个标签的节点才会参与时分复用</li>
</ul>
</li>
<li>
<p><strong>时间段配置</strong>：</p>
<ul>
<li><code>tdm-time-ranges</code>定义了不同的时间段，每个时间段都有自己的名称、开始时间、结束时间、适用的星期和时区</li>
<li>这里定义了三个时间段：工作时间（工作日的<code>9:00-18:00</code>）、非工作时间（工作日的<code>18:00</code>-次日<code>9:00</code>）和周末时间</li>
</ul>
</li>
</ol>
<p>现在，让我们看一个具体的节点和任务配置示例，展示如何使用<code>tdm</code>插件进行时分复用：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 首先，我们需要标记可收回的节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>01</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/revocable-node</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 标记该节点为可收回节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">node-role.kubernetes.io/worker</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>""</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 然后，我们可以创建一个交互式服务任务，它将在工作时间运行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> interactive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> service</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> interactive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> service</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nginx</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">tdm</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">revocable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 这个任务不是可收回的，它将在工作时间运行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 最后，我们创建一个批处理任务，它将在非工作时间运行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">processing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">processing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">processor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">v1.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/process.py"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 1000m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 2Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">tdm</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">revocable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 这个任务是可收回的，它将在非工作时间运行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">timeRanges</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"non-working-hours"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"weekend"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定这个任务可以运行的时间段</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个示例中，我们实现了以下功能：</p>
<ol>
<li>
<p><strong>节点配置</strong>：</p>
<ul>
<li>我们将<code>worker-node-01</code>标记为可收回节点，这意味着它将参与时分复用</li>
</ul>
</li>
<li>
<p><strong>交互式服务任务</strong>：</p>
<ul>
<li>这个任务不是可收回的（<code>revocable: false</code>）</li>
<li>它将在工作时间（工作日的<code>9:00-18:00</code>）运行</li>
<li>在这个时间段，它将优先使用集群资源</li>
</ul>
</li>
<li>
<p><strong>批处理任务</strong>：</p>
<ul>
<li>这个任务是可收回的（<code>revocable: true</code>）</li>
<li>它被配置为在非工作时间和周末运行（<code>timeRanges: ["non-working-hours", "weekend"]</code>）</li>
<li>当工作时间开始时，这个任务将被驱逐，以便交互式服务可以使用这些资源</li>
</ul>
</li>
</ol>
<p>通过这种配置，<code>tdm</code>插件实现了以下效果：</p>
<ol>
<li>
<p><strong>资源利用率提高</strong>：</p>
<ul>
<li>同一组节点在不同时间段被不同类型的任务使用</li>
<li>在工作时间，资源用于交互式服务，确保用户体验</li>
<li>在非工作时间，资源用于批处理任务，提高计算效率</li>
</ul>
</li>
<li>
<p><strong>成本降低</strong>：</p>
<ul>
<li>不需要为不同类型的工作负载维护独立的集群</li>
<li>减少了闲置资源，降低了硬件和运维成本</li>
</ul>
</li>
<li>
<p><strong>灵活的时间管理</strong>：</p>
<ul>
<li>可以根据实际需求灵活调整时间段定义</li>
<li>支持多个时区，适用于全球分布式集群</li>
</ul>
</li>
</ol>
<p>这种方式特别适用于以下场景：</p>
<ol>
<li>
<p><strong>企业混合工作负载</strong>：在工作时间运行交互式服务，在非工作时间运行数据分析和批处理任务</p>
</li>
<li>
<p><strong>云服务提供商</strong>：为不同客户在不同时间段提供资源，最大化资源利用率</p>
</li>
<li>
<p><strong>混合系统集成</strong>：允许<code>Kubernetes</code>和其他系统（如<code>Hadoop/Yarn</code>）在不同时间段共享同一组物理资源</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=13-deviceshare设备共享>13. deviceshare（设备共享）<a href=#13-deviceshare设备共享 class=hash-link aria-label="Direct link to 13. deviceshare（设备共享）" title="Direct link to 13. deviceshare（设备共享）">​</a></h3>
<p><strong>主要功能</strong>：支持在同一节点上安全高效地共享 <code>GPU</code>、<code>FPGA</code> 等特殊硬件资源。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>跟踪节点上的可用设备资源</li>
<li>动态分配、隔离和调度设备到不同任务</li>
<li>支持设备分片和多任务共享同一物理设备</li>
</ul>
<p><strong>应用场景</strong>：AI 训练、推理等需要特殊硬件资源的场景，提升资源利用率。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li><code>deviceshare</code> 插件本身只负责调度决策，实际的物理设备发现、分配与隔离，必须依赖 <code>Kubernetes</code> 的 <code>Device Plugin</code> 机制或相关 <code>Operator</code>。</li>
<li><strong>NVIDIA GPU 场景</strong>：需提前安装 <a href=https://github.com/NVIDIA/k8s-device-plugin target=_blank rel="noopener noreferrer">NVIDIA Device Plugin</a> 或 <a href=https://github.com/NVIDIA/gpu-operator target=_blank rel="noopener noreferrer">GPU Operator</a>。</li>
<li><strong>FPGA/其它设备</strong>：需根据硬件类型选择对应的 <code>Device Plugin/Operator</code>。</li>
<li><strong>显存分片/vGPU</strong>：如需启用 <code>deviceshare.GPUSharingEnable: true</code>，还需配合社区（如 <code>volcano-sh/gpu-share-device-plugin</code>）或厂商的分片插件。</li>
<li>若未安装对应 <code>Device Plugin</code>，<code>deviceshare</code> 插件无法实现对物理资源的精细调度和隔离。</li>
</ul>
<p><strong>参数说明</strong>：</p>
<p><strong>全局插件参数</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>deviceshare.GPUSharingEnable</code><td><code>bool</code><td><code>false</code><td>是否启用 <code>GPU</code> 显存分片共享<tr><td><code>deviceshare.NodeLockEnable</code><td><code>bool</code><td><code>false</code><td>是否启用节点锁定（防止多任务争抢同一设备）<tr><td><code>deviceshare.GPUNumberEnable</code><td><code>bool</code><td><code>false</code><td>是否按 <code>GPU</code> 数量调度<tr><td><code>deviceshare.VGPUEnable</code><td><code>bool</code><td><code>false</code><td>是否启用 <code>vGPU</code> 支持<tr><td><code>deviceshare.SchedulePolicy</code><td><code>string</code><td><code>binpack</code><td>设备调度策略（如<code>binpack</code>、<code>spread</code>等）<tr><td><code>deviceshare.ScheduleWeight</code><td><code>int</code><td><code>10</code><td>设备调度打分权重</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>如未配置，所有布尔参数默认 <code>false</code>，<code>SchedulePolicy</code> 默认 <code>binpack</code>，<code>ScheduleWeight</code> 默认 <code>10</code>。</li>
<li>可按需开启分片、锁定或 <code>vGPU</code> 支持，提升设备利用率。</li>
</ul>
</blockquote>
<p><strong>全局插件参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> deviceshare</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">deviceshare.GPUSharingEnable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">deviceshare.NodeLockEnable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">deviceshare.SchedulePolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"binpack"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">deviceshare.ScheduleWeight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Job插件参数</strong>：</p>
<p><code>Volcano</code> 支持在 <code>Job</code> 级别通过 <code>spec.plugins</code> 单独配置 <code>deviceshare</code> 插件参数，实现更细粒度的设备调度控制。</p>
<table><thead><tr><th>参数名<th>类型<th>说明<tbody><tr><td><code>GPUSharingEnable</code><td><code>bool</code><td>是否启用 <code>GPU</code> 显存分片共享<tr><td><code>NodeLockEnable</code><td><code>bool</code><td>是否启用节点锁定<tr><td><code>GPUNumberEnable</code><td><code>bool</code><td>是否按 <code>GPU</code> 数量调度<tr><td><code>VGPUEnable</code><td><code>bool</code><td>是否启用 <code>vGPU</code> 支持<tr><td><code>SchedulePolicy</code><td><code>string</code><td>设备调度策略（如 <code>binpack</code>、<code>spread</code> 等）<tr><td><code>ScheduleWeight</code><td><code>int</code><td>设备调度打分权重</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>Job</code> 层级参数与全局参数同名时，仅对当前 <code>Job</code> 生效，不影响全局其它任务。</li>
<li>未配置参数时，默认继承全局 <code>deviceshare</code> 配置。</li>
</ul>
</blockquote>
<p><strong>Job插件参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">deviceshare</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">GPUSharingEnable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">SchedulePolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"spread"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">ScheduleWeight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Job插件参数与全局参数关系</strong></p>
<ul>
<li><code>Job</code> 层级的 <code>deviceshare</code> 参数不会覆盖全局配置，而是基于全局配置做细粒度补充。</li>
<li>仅对当前 <code>Job</code> 有效，不影响其它 <code>Job</code> 和全局调度策略。</li>
</ul>
<p><strong>使用示例</strong>：</p>
<p>下方示例展示了如何通过 <code>deviceshare</code> 插件实现 <code>GPU</code> 显存分片调度：</p>
<ul>
<li>用户只需在 <code>Job</code> 的 <code>plugins</code> 字段中启用 <code>deviceshare</code> 插件，并在容器资源 <code>limits</code> 中声明所需的显存分片（如 <code>4096 MiB</code>）。</li>
<li>调度器会根据 <code>deviceshare</code> 配置和底层<code> Device Plugin</code> 的资源分片能力，将多个任务合理分配到同一块物理 <code>GPU</code> 上，实现资源高效复用。</li>
<li>需要注意，只有在集群已正确部署支持显存分片的 <code>Device Plugin</code> 时，该功能才能生效。</li>
</ul>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">share</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">deviceshare</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nvidia/cuda</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">volcano.sh/gpu-mem</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4096</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># 申请4GB显存分片</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=14-overcommit超额分配>14. overcommit（超额分配）<a href=#14-overcommit超额分配 class=hash-link aria-label="Direct link to 14. overcommit（超额分配）" title="Direct link to 14. overcommit（超额分配）">​</a></h3>
<p><strong>主要功能</strong>：允许节点资源被"超额预定"，提升资源利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li><code>overcommit</code> 插件通过调度层面对节点资源进行"超额预定"（<code>Overcommit</code>），并不是物理硬件超频，而是放大调度器感知的节点可分配资源。</li>
<li>支持为节点设置超配策略，通过 <code>overcommit-factor</code>、<code>cpu-overcommit-ratio</code>、<code>mem-overcommit-ratio</code> 等参数，将节点的"可分配资源"虚拟放大。例如节点实际 <code>100</code> 核 <code>CPU</code>，设置 <code>cpu-overcommit-ratio: 2.0</code> 后，调度器视为可分配 <code>200</code> 核。</li>
<li>在调度决策阶段，允许任务总资源请求超过节点实际物理资源，实现资源的"虚拟扩容"，适合实际资源消耗远低于申请量的场景（如离线批处理、AI 推理等）。</li>
<li><code>Kubernetes</code> 本身支持资源 <code>overcommit</code>，<code>Volcano</code> 通过插件机制进一步增强了资源超配的灵活性和粒度。</li>
<li>超配策略仅影响调度决策，节点 <code>kubelet</code> 仍按物理资源运行容器，若所有任务实际消耗接近申请值，可能导致节点资源耗尽、任务 <code>OOM</code> 或性能抖动。</li>
<li>建议根据节点实际资源消耗情况合理设置超配比例，平衡资源利用率与稳定性。</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ol>
<li>需谨慎使用，避免资源争抢导致任务 <code>OOM</code> 或性能抖动。</li>
<li><code>overcommit</code>插件还有一个隐藏功能，当队列的<code>capability</code>资源不够调度时，<code>overcommit</code>插件会阻止任务创建对应的<code>Pod</code>，以减少Pending的<code>Pod</code>数量。否则，即便队列资源不够，也会创建<code>Pod</code>，导致<code>Pending</code>的<code>Pod</code>数量不断增加。</li>
</ol>
<p><strong>参数说明</strong>：</p>
<p><strong>全局插件参数</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>overcommit-factor</code><td><code>float</code><td><code>1.2</code><td>超额分配因子（全局生效）<tr><td><code>cpu-overcommit-ratio</code><td><code>float</code><td>无<td><code>CPU</code> 资源超配比例，未配置则不超配<tr><td><code>mem-overcommit-ratio</code><td><code>float</code><td>无<td>内存资源超配比例，未配置则不超配</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>overcommit-factor</code> 为全局默认超配因子，若未配置 <code>cpu-overcommit-ratio</code> 或 <code>mem-overcommit-ratio</code> 时生效。</li>
<li>建议根据节点实际资源消耗情况合理设置，避免因超配导致 <code>OOM</code>。</li>
</ul>
</blockquote>
<p><strong>全局插件参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> overcommit</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">overcommit-factor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.5</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Job插件参数</strong>：</p>
<p><code>Volcano</code> 支持在 <code>Job</code> 级别通过 <code>spec.plugins</code> 单独配置 <code>overcommit</code> 插件参数，实现更细粒度的超配调度控制。</p>
<table><thead><tr><th>参数名<th>类型<th>说明<tbody><tr><td><code>overcommitFactor</code><td><code>float</code><td>当前 <code>Job</code> 的超配因子，优先生效于全局配置<tr><td><code>cpuOvercommitRatio</code><td><code>float</code><td>当前 <code>Job</code> 的 <code>CPU</code> 超配比例<tr><td><code>memOvercommitRatio</code><td><code>float</code><td>当前 <code>Job</code> 的内存超配比例</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>Job</code> 层级参数仅对当前 <code>Job</code> 生效，不影响全局其它任务。</li>
<li>未配置参数时，默认继承全局 <code>overcommit</code> 配置。</li>
</ul>
</blockquote>
<p><strong>Job插件参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">overcommit</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">overcommitFactor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpuOvercommitRatio</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">memOvercommitRatio</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Job插件参数与全局参数关系</strong></p>
<ul>
<li><code>Job</code> 层级的 <code>overcommit</code> 参数不会覆盖全局配置，而是基于全局配置做细粒度补充。</li>
<li>仅对当前 <code>Job</code> 有效，不影响其它 <code>Job</code> 和全局调度策略。</li>
</ul>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: overcommit</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          cpu-overcommit-ratio: 2.0   # 允许CPU超配2倍</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          mem-overcommit-ratio: 1.5   # 允许内存超配1.5倍</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=15-pdbpoddisruptionbudget-支持>15. pdb（PodDisruptionBudget 支持）<a href=#15-pdbpoddisruptionbudget-支持 class=hash-link aria-label="Direct link to 15. pdb（PodDisruptionBudget 支持）" title="Direct link to 15. pdb（PodDisruptionBudget 支持）">​</a></h3>
<p><strong>主要功能</strong>：在调度和驱逐任务时，遵守 <code>Kubernetes</code> 的 <code>PDB</code> 约束，保障服务可用性。如需保障服务的高可用和安全驱逐，务必在 <code>scheduler</code> 全局配置中启用 <code>pdb</code> 插件，让调度器在相关操作时主动遵守 <code>PDB</code> 约束。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>检查 <code>PDB</code> 约束，避免一次性驱逐过多 <code>Pod</code></li>
<li>保证关键服务的最小可用实例数</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>说明<tbody><tr><td>无<td>-<td><code>pdb</code> 插件无可配置参数，只需启用插件即可</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>pdb</code> 插件只需在 <code>scheduler</code> 配置文件的 <code>tiers.plugins</code> 中启用即可生效。</li>
<li>插件行为完全依赖于集群中已存在的 <code>PDB</code> 资源对象。</li>
</ul>
</blockquote>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"reclaim, preempt, shuffle"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> pdb</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=16-resourcequota资源配额>16. resourcequota（资源配额）<a href=#16-resourcequota资源配额 class=hash-link aria-label="Direct link to 16. resourcequota（资源配额）" title="Direct link to 16. resourcequota（资源配额）">​</a></h3>
<p><strong>主要功能</strong>：支持队列或命名空间级别的资源配额限制，防止资源被单一队列/用户占满。</p>
<p><strong><code>Queue</code> 资源配额与 <code>resourcequota</code> 插件的区别</strong>：</p>
<table><thead><tr><th>特性<th><code>Queue</code> 资源配额<th><code>resourcequota</code> 插件<tbody><tr><td><strong>作用范围</strong><td>仅限 <code>Volcano Queue </code><td>可跨命名空间、跨队列<tr><td><strong>限制粒度</strong><td>队列级别<td>可自定义分组（如项目、部门等）<tr><td><strong>资源类型</strong><td>主要限制计算资源<td>支持更多资源类型（如存储、对象数量等）<tr><td><strong>灵活性</strong><td>相对固定<td>支持自定义资源组和复杂策略<tr><td><strong>集成性</strong><td><code>Volcano</code> 原生机制<td>可与 <code>Kubernetes ResourceQuota</code> 对象协同</table>
<p><strong><code>Kubernetes</code> 原生 <code>ResourceQuota</code> 与 <code>Volcano resourcequota</code> 插件的区别</strong>：</p>
<table><thead><tr><th>特性<th><code>Kubernetes ResourceQuota</code><th><code>Volcano resourcequota</code> 插件<tbody><tr><td><strong>作用时机</strong><td>资源创建时的准入控制<td>调度决策阶段<tr><td><strong>作用对象</strong><td>命名空间级别的资源总量<td>批量作业调度和资源分配<tr><td><strong>调度感知</strong><td>不参与调度决策<td>直接影响调度决策<tr><td><strong>队列感知</strong><td>不理解 <code>Volcano</code> 队列<td>可与 <code>Volcano</code> 队列系统协同工作<tr><td><strong>批处理优化</strong><td>不针对批处理场景优化<td>专为批处理工作负载设计</table>
<p><strong>工作原理</strong>：</p>
<ul>
<li>跟踪每个队列/命名空间的资源使用量</li>
<li>拒绝超出配额的任务调度请求</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><code>Volcano</code> 的 <code>resourcequota</code> 插件依赖于 <code>Kubernetes</code> 原生的 <code>ResourceQuota</code> 资源对象，其资源限制只能针对特定命名空间生效，而不能跨命名空间实现资源限制
需要为队列使用的每个命名空间单独配置 <code>ResourceQuota</code>。</p>
</li>
<li>
<p>如果一个队列跨多个命名空间，<code>resourcequota</code> 插件无法对整个队列实施统一的资源限制</p>
</li>
</ul>
<p><strong>参数说明</strong>：</p>
<p>当前插件无参数配置。</p>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ResourceQuota</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">quota</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">hard</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">requests.cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"8"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">requests.memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 16Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">limits.cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"16"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">limits.memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 32Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> quota</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> busybox</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"sleep"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"3600"</span><span class="token punctuation" style=color:#f8f8f2>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=17-rescheduling重调度>17. rescheduling（重调度）<a href=#17-rescheduling重调度 class=hash-link aria-label="Direct link to 17. rescheduling（重调度）" title="Direct link to 17. rescheduling（重调度）">​</a></h3>
<p><strong>主要功能</strong>：动态检测资源碎片或节点利用率低下情况，自动触发任务重调度，提升集群整体利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>定期评估节点利用率</li>
<li>识别低效分布的任务并触发迁移</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>interval</code><td><code>string</code><td><code>5m</code><td>执行重调度的时间间隔（如<code>5m</code>）<tr><td><code>metricsPeriod</code><td><code>string</code><td><code>5m</code><td>指标收集周期<tr><td><code>strategies</code><td>数组<td>无<td>重调度策略列表<tr><td><code>strategies.name</code><td><code>string</code><td>无<td>策略名称（见下方支持的策略列表）<tr><td><code>strategies.params</code><td><code>map</code><td>无<td>策略参数（不同策略有不同参数）<tr><td><code>queueSelector</code><td>数组<td>无<td>选择特定队列中的工作负载进行重调度<tr><td><code>labelSelector</code><td><code>map</code><td>无<td>选择带有特定标签的工作负载进行重调度</table>
<p><strong>支持的策略名称及参数</strong>：</p>
<ol>
<li>
<p><strong><code>lowNodeUtilization</code></strong>：对低节点利用率进行优化，将资源从低利用率节点迁移到高利用率节点</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>thresholds</code><td><code>map[string]int</code><td><code>{"cpu": 100, "memory": 100, "pods": 100}</code><td>低利用率阈值，低于此阈值的节点被视为低利用率节点<tr><td><code>targetThresholds</code><td><code>map[string]int</code><td><code>{"cpu": 100, "memory": 100, "pods": 100}</code><td>目标利用率阈值，高于此阈值的节点被视为高利用率节点<tr><td><code>thresholdPriorityClassName</code><td><code>string</code><td><code>"system-cluster-critical"</code><td>指定了一个<code>PriorityClass</code>优先级类名，高于或等于该优先级的工作负载将受到保护，不会被重调度<tr><td><code>nodeFit</code><td><code>bool</code><td><code>true</code><td>是否考虑节点适配性，当为 <code>true</code> 时仅重调度到适配的节点</table>
<p>个别参数说明：</p>
<p><code>nodeFit</code>参数决定了在重调度过程中是否考虑节点与工作负载的适配性。</p>
<p>工作原理：</p>
<ul>
<li>当 <code>nodeFit: true </code>时（默认值）：<!-- -->
<ul>
<li>重调度插件在选择目标节点时，会考虑节点的资源情况、亲和性规则、污点容忍等因素</li>
<li>只会将工作负载重调度到满足其所有调度要求的节点上</li>
<li>确保重调度后的工作负载能够在新节点上正常运行</li>
</ul>
</li>
<li>当 <code>nodeFit: false</code> 时：<!-- -->
<ul>
<li>重调度插件只考虑资源平衡，不考虑节点与工作负载的适配性</li>
<li>可能会将工作负载重调度到不完全满足其调度要求的节点上</li>
<li>可能导致工作负载在新节点上无法正常运行或性能下降</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>offlineOnly</code></strong>：仅选择离线工作负载（带有 <code>preemptable: true</code> 注解）进行重调度</p>
<ul>
<li>当前版本暂无特殊参数</li>
</ul>
</li>
<li>
<p><strong><code>lowPriorityFirst</code></strong>：按优先级排序，低优先级的工作负载先重调度</p>
<ul>
<li>当前版本暂无特殊参数</li>
</ul>
</li>
<li>
<p><strong><code>shortLifeTimeFirst</code></strong>：按运行时间排序，生命周期短的工作负载先重调度</p>
<ul>
<li>当前版本暂无特殊参数</li>
</ul>
</li>
<li>
<p><strong><code>bigObjectFirst</code></strong>：选择请求最多主导资源的工作负载先重调度</p>
<ul>
<li>当前版本暂无特殊参数</li>
</ul>
</li>
<li>
<p><strong><code>moreReplicasFirst</code></strong>：按副本数量排序，副本数量最多的工作负载先重调度</p>
<ul>
<li>当前版本暂无特殊参数</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><code>interval</code> 默认 <code>5</code> 分钟，可根据集群规模和业务需求调整。</li>
<li><code>strategies</code> 需显式配置，支持多种策略组合。</li>
<li>当前版本（<code>v1.11.2</code>）中仅实现了 <code>lowNodeUtilization</code> 策略，其他策略在后续版本中实现。</li>
<li><strong>不支持</strong> <code>Job</code> 级别的 <code>spec.plugins</code> 参数配置，只能在全局配置中启用和设置参数。</li>
</ul>
</blockquote>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> rescheduling</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">interval</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 10m                    </span><span class="token comment" style=color:#8292a2;font-style:italic># 每10分钟执行一次重调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">metricsPeriod</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 5m               </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用过5分钟的指标数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">strategies</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                     </span><span class="token comment" style=color:#8292a2;font-style:italic># 重调度策略列表，按顺序执行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> lowNodeUtilization     </span><span class="token comment" style=color:#8292a2;font-style:italic># 低节点利用率策略</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">params</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">thresholds</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                </span><span class="token comment" style=color:#8292a2;font-style:italic># 低利用率阈值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain">                  </span><span class="token comment" style=color:#8292a2;font-style:italic># CPU利用率低于20%的节点被认为是低利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain">               </span><span class="token comment" style=color:#8292a2;font-style:italic># 内存利用率低于20%的节点被认为是低利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">pods</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain">                 </span><span class="token comment" style=color:#8292a2;font-style:italic># Pod数量利用率低于20%的节点被认为是低利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">targetThresholds</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">          </span><span class="token comment" style=color:#8292a2;font-style:italic># 目标利用率阈值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">                  </span><span class="token comment" style=color:#8292a2;font-style:italic># CPU利用率高于50%的节点被认为是高利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">               </span><span class="token comment" style=color:#8292a2;font-style:italic># 内存利用率高于50%的节点被认为是高利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">pods</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">                 </span><span class="token comment" style=color:#8292a2;font-style:italic># Pod数量利用率高于50%的节点被认为是高利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">nodeFit</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">              </span><span class="token comment" style=color:#8292a2;font-style:italic># 考虑节点适配性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">thresholdPriorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"system-cluster-critical"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 保护优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> offlineOnly            </span><span class="token comment" style=color:#8292a2;font-style:italic># 只重调度离线任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">queueSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                  </span><span class="token comment" style=color:#8292a2;font-style:italic># 只重调度指定队列中的任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> batch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">labelSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                  </span><span class="token comment" style=color:#8292a2;font-style:italic># 只重调度带有指定标签的任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> offline</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue, allocate, backfill, rescheduling"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: rescheduling</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          rescheduling-interval-seconds: 300 # 每5分钟检测一次重调度</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=18-capacity容量感知>18. capacity（容量感知）<a href=#18-capacity容量感知 class=hash-link aria-label="Direct link to 18. capacity（容量感知）" title="Direct link to 18. capacity（容量感知）">​</a></h3>
<p><strong>主要功能</strong>：根据节点和队列的容量约束进行调度，防止资源超卖。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>跟踪并校验队列/节点的容量限制</li>
<li>调度时严格遵守容量约束</li>
<li>支持资源借用和回收机制，实现弹性资源管理</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>默认值<th>说明<tbody><tr><td><code>enabledHierarchy</code><td><code>bool</code><td><code>false</code><td>是否启用队列层级调度</table>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>默认关闭队列层级调度，如需多级队列管理需显式开启。</li>
</ul>
</blockquote>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> capacity</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">enabledHierarchy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>重要注意事项</strong>：</p>
<ol>
<li>
<p><strong>非默认插件</strong>：<code>capacity</code>插件<strong>不是</strong><code>Volcano</code>默认启用的插件，必须在调度器配置中显式启用。</p>
</li>
<li>
<p><strong>与proportion插件互斥</strong>：<code>capacity</code>插件和默认的<code>proportion</code>插件是互斥的，它们代表两种不同的资源管理策略：</p>
<ul>
<li><code>proportion</code>：基于权重的简单比例分配</li>
<li><code>capacity</code>：基于具体资源量的精细化管理和弹性借用/回收</li>
</ul>
</li>
<li>
<p><strong>Queue资源配置依赖</strong>：如果不在<code>Volcano</code>配置中启用<code>capacity</code>插件，<code>Queue</code>资源中的以下配置将<strong>无法生效</strong>：</p>
<ul>
<li><code>spec.capability</code>：队列资源上限</li>
<li><code>spec.guarantee</code>：队列保障资源</li>
<li><code>spec.deserved</code>：队列应得资源</li>
</ul>
</li>
<li>
<p><strong>配置替换而非合并</strong>：自定义<code>Volcano</code>配置会完全替换默认配置，因此在添加<code>capacity</code>插件时，必须保留其他必要的插件（如<code>priority</code>、<code>gang</code>、<code>conformance</code>等）。</p>
</li>
</ol>
<p><strong>为什么不默认启用capacity插件？</strong></p>
<ol>
<li>
<p><strong>历史和兼容性考虑</strong>：<code>proportion</code>插件是<code>Volcano</code>早期就有的功能，而<code>capacity</code>插件是后来添加的更高级功能。为了保持向后兼容性，<code>Volcano</code>保留了<code>proportion</code>作为默认插件。</p>
</li>
<li>
<p><strong>复杂性和使用场景</strong>：<code>capacity</code>插件提供了更复杂的资源管理机制，这些功能在简单场景下可能过于复杂。<code>proportion</code>插件的简单权重机制对于大多数基本使用场景已经足够。</p>
</li>
<li>
<p><strong>层级队列支持</strong>：<code>capacity</code>插件支持层级队列管理，这是一个更高级的功能，需要更复杂的配置和管理。对于不需要这种复杂性的用户，默认的<code>proportion</code>插件更简单易用。</p>
</li>
</ol>
<p><strong>推荐配置示例</strong>：</p>
<p>如果需要使用<code>Queue</code>的<code>capacity</code>配置功能，建议使用以下配置（注意移除<code>proportion</code>插件，添加<code>capacity</code>插件）：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue, allocate, backfill, reclaim, preempt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> capacity  </span><span class="token comment" style=color:#8292a2;font-style:italic># 替换默认的proportion插件</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> research</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capacity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"32"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 128Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> research</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> research</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> busybox</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"sleep"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"3600"</span><span class="token punctuation" style=color:#f8f8f2>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=19-cdp自定义调度参数>19. cdp（自定义调度参数）<a href=#19-cdp自定义调度参数 class=hash-link aria-label="Direct link to 19. cdp（自定义调度参数）" title="Direct link to 19. cdp（自定义调度参数）">​</a></h3>
<p><strong>主要功能</strong>：允许用户通过 <code>CRD</code> 配置自定义调度参数，增强调度灵活性。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>支持通过 <code>CRD</code> 动态扩展调度参数</li>
<li>满足特殊业务场景的调度需求</li>
<li>在不修改调度器代码的情况下实现自定义调度逻辑</li>
</ul>
<p><strong>参数说明</strong>：</p>
<p>主要通过 <code>CRD</code>（如 <code>CustomDispatchPolicy</code>）配置，无调度器插件参数。</p>
<p><strong>CustomDispatchPolicy配置项详解</strong>：</p>
<p><code>CustomDispatchPolicy</code>是一种自定义资源，用于定义灵活的调度规则，主要包含以下配置项：</p>
<ol>
<li><strong>基本结构</strong></li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> CustomDispatchPolicy</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;策略名称</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;规则名称</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">match</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;匹配条件</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;执行动作</span><span class="token punctuation" style=color:#f8f8f2>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=2>
<li><strong>规则配置 (spec.rules)</strong></li>
</ol>
<p>每个<code>CustomDispatchPolicy</code>可以包含多条规则，每条规则由以下部分组成：</p>
<p>2.1 <strong>规则名称 (name)</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> prefer</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cpu  </span><span class="token comment" style=color:#8292a2;font-style:italic># 规则的唯一标识符</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>2.2 <strong>匹配条件 (match)</strong>
匹配条件决定哪些工作负载会应用此规则，支持以下匹配方式：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">match</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 标签选择器匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labelSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">&lt;key></span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;value</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 精确匹配标签</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 表达式匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;label</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In/NotIn/Exists/DoesNotExist</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">values</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"value1"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"value2"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 命名空间匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespaces</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> &lt;namespace1</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> &lt;namespace2</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queues</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> &lt;queue1</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> &lt;queue2</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 任务名称匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">jobNames</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> &lt;job</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">name1</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> &lt;job</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">name2</span><span class="token punctuation" style=color:#f8f8f2>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>2.3 <strong>执行动作 (actions)</strong>
当工作负载匹配规则条件时，将执行以下一个或多个动作：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 设置节点选择器（替换现有的，基于标签选择）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">setNodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">&lt;key></span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;value</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 添加节点选择器（保留现有的，基于标签选择）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">addNodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">&lt;key></span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;value</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 设置节点亲和性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">setNodeAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">label</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">values</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"value1"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"value2"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 添加节点亲和性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">addNodeAffinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">preference</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">label</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> In</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">values</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"value1"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 设置污点容忍</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">setTolerations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;taint</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Equal/Exists</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;taint</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">value</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">effect</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> NoSchedule/PreferNoSchedule/NoExecute</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 添加污点容忍</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">addTolerations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;taint</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">operator</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Equal</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> &lt;taint</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">value</span><span class="token punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">effect</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> NoSchedule</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li>
<p><strong>注意事项</strong></p>
<ul>
<li><strong>规则优先级</strong>：规则按照定义顺序执行，如果多个规则匹配同一工作负载，后面的规则可能会覆盖前面规则的某些设置</li>
<li><strong>动作组合</strong>：可以在一个规则中组合多个动作，它们会按顺序应用</li>
<li><strong>与其他调度机制的交互</strong>：<code>CustomDispatchPolicy</code>会与<code>Volcano</code>的其他调度机制（如<code>gang</code>调度、队列管理等）协同工作</li>
<li><strong>资源限制</strong>：<code>CustomDispatchPolicy</code>主要影响工作负载的调度位置，不会改变其资源请求和限制</li>
<li><strong>动态性</strong>：可以在不重启调度器的情况下创建、更新或删除<code>CustomDispatchPolicy</code>资源</li>
</ul>
</li>
</ol>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1alpha1  </span><span class="token comment" style=color:#8292a2;font-style:italic># API版本，指定使用Volcano的自定义调度策略API</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> CustomDispatchPolicy            </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源类型，表示这是一个自定义调度策略</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> my</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">policy                     </span><span class="token comment" style=color:#8292a2;font-style:italic># 策略名称，在引用此策略时使用</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                                 </span><span class="token comment" style=color:#8292a2;font-style:italic># 策略规范</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                              </span><span class="token comment" style=color:#8292a2;font-style:italic># 规则列表，可以定义多个规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> prefer</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cpu                </span><span class="token comment" style=color:#8292a2;font-style:italic># 规则名称，用于标识和描述规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">match</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                          </span><span class="token comment" style=color:#8292a2;font-style:italic># 匹配条件，用于确定哪些工作负载适用此规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">labelSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                </span><span class="token comment" style=color:#8292a2;font-style:italic># 标签选择器，基于Pod/Job标签进行匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                </span><span class="token comment" style=color:#8292a2;font-style:italic># 精确匹配标签</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">intensive        </span><span class="token comment" style=color:#8292a2;font-style:italic># 匹配标签为app=cpu-intensive的工作负载</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">                        </span><span class="token comment" style=color:#8292a2;font-style:italic># 匹配成功后要执行的操作列表</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">setNodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 设置节点选择器操作</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">cpu-type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">performance </span><span class="token comment" style=color:#8292a2;font-style:italic># 将匹配的工作负载调度到标签为cpu-type=high-performance的节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">intensive</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">intensive</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> busybox</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"sleep"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"3600"</span><span class="token punctuation" style=color:#f8f8f2>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=20-extender调度扩展>20. extender（调度扩展）<a href=#20-extender调度扩展 class=hash-link aria-label="Direct link to 20. extender（调度扩展）" title="Direct link to 20. extender（调度扩展）">​</a></h3>
<p><strong>主要功能</strong>：支持与外部调度器集成，允许通过 <code>HTTP/gRPC</code> 等方式扩展调度决策。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>与外部调度器通信，获取调度建议</li>
<li>支持定制化的调度逻辑扩展</li>
<li>在关键调度点调用外部服务，修改或影响调度决策</li>
</ul>
<p><strong>外部调度器与Volcano调度器的协作流程</strong>：</p>
<p><code>Extender</code>插件允许<code>Volcano</code>调度器在关键决策点与外部自定义调度器进行协作。整个协作流程如下：</p>
<ol>
<li>
<p><strong>会话生命周期事件</strong>：</p>
<ul>
<li><strong>会话开始时</strong>：<code>Volcano</code>调度器通过<code>onSessionOpenVerb</code>调用外部调度器，传递当前集群状态信息</li>
<li><strong>会话结束时</strong>：通过<code>onSessionCloseVerb</code>通知外部调度器当前调度周期结束</li>
</ul>
</li>
<li>
<p><strong>节点筛选阶段</strong>：</p>
<ul>
<li><code>Volcano</code>调度器首先执行内部的<code>predicates</code>插件进行初步筛选</li>
<li>然后通过<code>predicateVerb</code>调用外部调度器，发送候选节点列表和待调度任务信息</li>
<li>外部调度器返回过滤后的节点列表，可以完全移除不适合的节点</li>
</ul>
</li>
<li>
<p><strong>节点排序阶段</strong>：</p>
<ul>
<li><code>Volcano</code>调度器执行内部的<code>nodeorder</code>插件进行初步排序</li>
<li>通过<code>prioritizeVerb</code>调用外部调度器，发送当前排序结果</li>
<li>外部调度器返回修改后的节点排序分数，影响最终的节点选择</li>
</ul>
</li>
<li>
<p><strong>资源抢占与回收阶段</strong>：</p>
<ul>
<li>当<code>Volcano</code>调度器执行<code>preempt</code>或<code>reclaim</code>动作时，可以通过<code>preemptableVerb</code>和<code>reclaimableVerb</code>响应地咨询外部调度器</li>
<li>外部调度器可以决定哪些任务可以被抢占或回收，以及它们的优先级</li>
</ul>
</li>
<li>
<p><strong>错误处理机制</strong>：</p>
<ul>
<li>如果外部调度器返回错误或超时，根据<code>extender.ignorable</code>设置决定是否忽略错误</li>
<li>当<code>ignorable=true</code>时，外部调度器失败不会阻止调度过程，<code>Volcano</code>将使用内部插件的结果</li>
<li>当<code>ignorable=false</code>时，外部调度器失败将导致整个调度周期失败</li>
</ul>
</li>
</ol>
<p><strong>数据交互格式</strong>：</p>
<p>外部调度器与<code>Volcano</code>之间的数据交互采用<code>JSON</code>格式，主要包含以下类型的数据：</p>
<ul>
<li><strong>节点信息</strong>：包含节点名称、标签、可用资源等</li>
<li><strong>任务信息</strong>：包含任务ID、资源请求、优先级等</li>
<li><strong>调度结果</strong>：包含节点排序分数、过滤决策等</li>
</ul>
<p><strong>实际应用场景</strong>：</p>
<ol>
<li>
<p><strong>特定硬件调度</strong>：外部调度器可以实现复杂的硬件亲和性逻辑，如<code>GPU</code>拓扑优化、<code>NUMA</code>亲和性等</p>
</li>
<li>
<p><strong>业务特定策略</strong>：实现基于业务指标的调度决策，如服务响应时间、客户优先级等</p>
</li>
<li>
<p><strong>机器学习增强调度</strong>：集成机器学习模型来预测工作负载特性并优化调度决策</p>
</li>
</ol>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>说明<tbody><tr><td><code>extender.urlPrefix</code><td><code>string</code><td>扩展调度器服务地址<tr><td><code>extender.httpTimeout</code><td><code>string</code><td><code>HTTP</code>超时时间（如<code>2s</code>）<tr><td><code>extender.onSessionOpenVerb</code><td><code>string</code><td><code>OnSessionOpen</code> 调用名<tr><td><code>extender.onSessionCloseVerb</code><td><code>string</code><td><code>OnSessionClose</code> 调用名<tr><td><code>extender.predicateVerb</code><td><code>string</code><td><code>Predicate</code> 调用名<tr><td><code>extender.prioritizeVerb</code><td><code>string</code><td><code>Prioritize</code> 调用名<tr><td><code>extender.preemptableVerb</code><td><code>string</code><td><code>Preemptable</code> 调用名<tr><td><code>extender.reclaimableVerb</code><td><code>string</code><td><code>Reclaimable</code> 调用名<tr><td><code>extender.ignorable</code><td><code>bool</code><td>是否忽略扩展器异常</table>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> extender</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">extender.urlPrefix</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"http://localhost:8888"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">extender.ignorable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: extender</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          extender-url: "http://my-extender-service/scheduler"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          extender-timeout: 2s</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=21-nodegroup节点分组>21. nodegroup（节点分组）<a href=#21-nodegroup节点分组 class=hash-link aria-label="Direct link to 21. nodegroup（节点分组）" title="Direct link to 21. nodegroup（节点分组）">​</a></h3>
<p><strong>主要功能</strong>：对节点进行逻辑分组，支持基于节点组的调度策略。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>标记和分组不同类型节点</li>
<li>支持按组调度、资源隔离等高级策略</li>
</ul>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>说明<tbody><tr><td><code>affinity</code><td><code>map</code><td>队列与节点组的亲和性/反亲和性配置，详见下方说明</table>
<p><strong><code>affinity</code> 参数详细说明</strong>：</p>
<p><code>affinity</code> 参数是一个复杂的映射结构，用于定义队列与节点组之间的亲和性和反亲和性关系。它支持以下四种主要的配置选项：</p>
<ol>
<li>
<p><strong><code>queueGroupAffinityRequired</code></strong>：强制要求队列中的任务必须调度到指定的节点组上</p>
<ul>
<li>这是一个硬性要求，如果指定的节点组没有足够资源，任务将保持等待状态</li>
<li>格式：<code>{队列名}: [节点组名1, 节点组名2, ...]</code></li>
</ul>
</li>
<li>
<p><strong><code>queueGroupAffinityPreferred</code></strong>：优先考虑将队列中的任务调度到指定的节点组上</p>
<ul>
<li>这是一个软性偏好，如果指定的节点组没有足够资源，任务仍可以调度到其他节点组</li>
<li>格式：<code>{队列名}: [节点组名1, 节点组名2, ...]</code></li>
</ul>
</li>
<li>
<p><strong><code>queueGroupAntiAffinityRequired</code></strong>：强制要求队列中的任务不能调度到指定的节点组上</p>
<ul>
<li>这是一个硬性禁止，指定的节点组将被完全排除</li>
<li>格式：<code>{队列名}: [节点组名1, 节点组名2, ...]</code></li>
</ul>
</li>
<li>
<p><strong><code>queueGroupAntiAffinityPreferred</code></strong>：优先避免将队列中的任务调度到指定的节点组上</p>
<ul>
<li>这是一个软性避免，当其他节点组没有足够资源时，任务仍可以调度到这些节点组</li>
<li>格式：<code>{队列名}: [节点组名1, 节点组名2, ...]</code></li>
</ul>
</li>
</ol>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodegroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">affinity</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 强制要求queueA的任务必须调度到group1节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">queueGroupAffinityRequired</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">queueA</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">group1</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 优先避免将queueB的任务调度到group2节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">queueGroupAntiAffinityPreferred</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">queueB</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">group2</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 优先考虑将queueC的任务调度到group3节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">queueGroupAffinityPreferred</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">queueC</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">group3</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 强制要求queueD的任务不能调度到group4节点组</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">queueGroupAntiAffinityRequired</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">queueD</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">group4</span><span class="token punctuation" style=color:#f8f8f2>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>常见业务场景示例</strong>：</p>
<ol>
<li>
<p><strong>硬件异构集群管理</strong>：</p>
<ul>
<li>场景：集群中包含不同类型的节点（如<code>GPU</code>节点、高内存节点、普通计算节点）</li>
<li>应用：将节点按硬件类型分组，并将特定工作负载（如<code>AI</code>训练任务）调度到相应的节点组</li>
<li>配置示例：使用<code>queueGroupAffinityRequired</code>将<code>AI</code>训练队列与含有<code>GPU</code>的节点组绑定</li>
</ul>
</li>
<li>
<p><strong>多租户资源隔离</strong>：</p>
<ul>
<li>场景：不同部门或团队共享同一个<code>Kubernetes</code>集群</li>
<li>应用：将节点分组并分配给不同部门，确保每个部门的工作负载只能运行在其指定的节点上</li>
<li>配置示例：使用<code>queueGroupAffinityRequired</code>将每个部门的队列与其专用节点组绑定</li>
</ul>
</li>
<li>
<p><strong>生产环境与测试环境隔离</strong>：</p>
<ul>
<li>场景：同一集群中同时运行生产和测试工作负载</li>
<li>应用：将节点分为生产组和测试组，确保测试工作负载不会影响生产环境</li>
<li>配置示例：使用<code>queueGroupAntiAffinityRequired</code>确保生产队列的任务不会调度到测试节点组</li>
</ul>
</li>
<li>
<p><strong>成本敏感工作负载优化</strong>：</p>
<ul>
<li>场景：集群包含不同成本的节点（如标准实例、端到端加密实例、高性能实例）</li>
<li>应用：将非关键任务调度到低成本节点，将高价值任务调度到高性能节点</li>
<li>配置示例：使用<code>queueGroupAffinityPreferred</code>将低优先级队列优先调度到低成本节点组</li>
</ul>
</li>
<li>
<p><strong>容灾与高可用性设计</strong>：</p>
<ul>
<li>场景：跨可用区域或机架的集群部署</li>
<li>应用：将节点按可用区分组，并确保关键应用的多个副本分布在不同的可用区</li>
<li>配置示例：使用<code>queueGroupAffinityPreferred</code>和<code>queueGroupAntiAffinityPreferred</code>的组合来实现跨可用区的平衡分布</li>
</ul>
</li>
</ol>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">a</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/nodegroup</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> group1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">b</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/nodegroup</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> group2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> group</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">volcano.sh/nodegroup</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> group1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> busybox</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"sleep"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"3600"</span><span class="token punctuation" style=color:#f8f8f2>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=22-usage资源使用统计>22. usage（资源使用统计）<a href=#22-usage资源使用统计 class=hash-link aria-label="Direct link to 22. usage（资源使用统计）" title="Direct link to 22. usage（资源使用统计）">​</a></h3>
<p><strong>主要功能</strong>：收集和统计任务、队列、节点的资源使用情况，为调度决策和资源优化提供数据基础。该插件是实现资源感知调度的关键组件。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>实时收集各类资源使用数据，包括<code>CPU</code>、内存等实际使用情况</li>
<li>计算节点的资源利用率并生成节点分数</li>
<li>在调度决策中考虑实际资源使用情况，而不仅仅是资源申请量</li>
<li>支持设置资源利用率阈值，避免调度到负载过高的节点</li>
</ul>
<p><strong>具体作用</strong>：</p>
<ol>
<li>
<p><strong>资源感知调度</strong>：</p>
<ul>
<li>与传统调度器不同，<code>usage</code>插件考虑节点的实际资源使用情况，而非仅仅基于资源申请量</li>
<li>即使两个节点的可分配资源相同，实际负载不同的节点会获得不同的调度优先级</li>
</ul>
</li>
<li>
<p><strong>负载平衡</strong>：</p>
<ul>
<li>优先将新任务调度到资源利用率较低的节点，实现负载均衡分布</li>
<li>防止某些节点资源过度使用导致的性能问题</li>
</ul>
</li>
<li>
<p><strong>资源效率优化</strong>：</p>
<ul>
<li>通过权重调整，可以优化不同资源类型（<code>CPU</code>、内存）的利用效率</li>
<li>对于内存密集型工作负载，可以提高内存权重；对于<code>CPU</code>密集型工作负载，可以提高<code>CPU</code>权重</li>
</ul>
</li>
<li>
<p><strong>防止资源耗尽</strong>：</p>
<ul>
<li>通过设置阈值，避免将任务调度到资源利用率超过特定阈值的节点</li>
<li>保护节点不会因资源过度消耗而导致系统不稳定</li>
</ul>
</li>
</ol>
<p><strong>应用场景</strong>：</p>
<ol>
<li>
<p><strong>混合工作负载环境</strong>：当集群中运行着不同类型的应用，如数据处理、Web服务、数据库等，<code>usage</code>插件可以确保资源均衡分配</p>
</li>
<li>
<p><strong>弹性伸缩系统</strong>：在基于负载进行自动伸缩的系统中，<code>usage</code>插件提供的资源使用数据是做出伸缩决策的重要依据</p>
</li>
<li>
<p><strong>高性能计算集群</strong>：在<code>HPC</code>环境中，精确的资源分配和负载平衡对于最大化计算效率至关重要</p>
</li>
</ol>
<p><strong>参数说明</strong>：</p>
<table><thead><tr><th>参数名<th>类型<th>说明<tbody><tr><td><code>usage.weight</code><td><code>int</code><td>总资源利用率打分权重<tr><td><code>cpu.weight</code><td><code>int</code><td><code>CPU</code> 利用率打分权重<tr><td><code>memory.weight</code><td><code>int</code><td>内存利用率打分权重<tr><td><code>thresholds</code><td><code>map</code><td>各资源类型的利用率阈值（如<code>cpu/mem</code>）</table>
<p><strong>参数示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> usage</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 总体资源利用率打分权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">usage.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># CPU利用率打分权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 内存利用率打分权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory.weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源利用率阈值配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">thresholds</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># CPU利用率阈值，超过该值的节点将获得较低的调度优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>80</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 内存利用率阈值，超过该值的节点将获得较低的调度优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">mem</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>80</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>阈值配置说明</strong>：</p>
<p><code>thresholds</code>参数定义了各类资源的利用率阈值，当节点的实际资源利用率超过这些阈值时，该节点在调度过程中的优先级将会降低。这有助于：</p>
<ol>
<li>防止资源过度使用导致的系统不稳定</li>
<li>实现更均衡的负载分布</li>
<li>为系统组件和关键任务保留足够的资源缓冲</li>
</ol>
<p>阈值的设置应根据实际工作负载特点和集群性能要求来确定：</p>
<ul>
<li>对于关键生产环境，建议设置较低的阈值（如 <code>70-80%</code>）以确保系统稳定性</li>
<li>对于测试环境或资源效率优先的场景，可以设置较高的阈值（如 <code>85-90%</code>）</li>
</ul>
<p><strong>使用示例</strong>：</p>
<p>下面是一个完整的调度器配置示例，其中启用了<code>usage</code>插件并为<code>CPU</code>密集型工作负载进行了优化：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    actions: "enqueue, allocate, backfill"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: binpack</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: usage</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          # 提高CPU权重，适合CPU密集型工作负载</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          usage.weight: 5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          cpu.weight: 2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          memory.weight: 1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          thresholds:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            cpu: 85</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>            mem: 80</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>使用示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">scheduler</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">configmap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">volcano-scheduler.conf</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    tiers:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    - plugins:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - name: usage</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>        arguments:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>          usage-collect-interval: 60s # 每60秒统计一次资源使用</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://volcano.sh/zh/docs/actions target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/actions</a></li>
<li><a href=https://volcano.sh/zh/docs/plugins target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/plugins</a></li>
<li><a href=https://github.com/volcano-sh/volcano target=_blank rel="noopener noreferrer">https://github.com/volcano-sh/volcano</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano-queue-job-pod-preemption><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano Queue&Job&Pod资源抢占设计</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-session-plugins-fns><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano Session Plugins方法介绍</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#调度器配置说明 class="table-of-contents__link toc-highlight">调度器配置说明</a><ul><li><a href=#可插拔的插件功能管理 class="table-of-contents__link toc-highlight">可插拔的插件功能管理</a><li><a href=#多层级tiers数组结构 class="table-of-contents__link toc-highlight">多层级(tiers)数组结构</a><li><a href=#与单一数组相比的优势 class="table-of-contents__link toc-highlight">与单一数组相比的优势</a><li><a href=#actions配置顺序的重要性 class="table-of-contents__link toc-highlight">Actions配置顺序的重要性</a></ul><li><a href=#volcano中的job和podgroup状态流转 class="table-of-contents__link toc-highlight">Volcano中的Job和PodGroup状态流转</a><ul><li><a href=#podgroup状态 class="table-of-contents__link toc-highlight">PodGroup状态</a><li><a href=#job状态 class="table-of-contents__link toc-highlight">Job状态</a><li><a href=#状态转换流程 class="table-of-contents__link toc-highlight">状态转换流程</a></ul><li><a href=#volcano-中的-actions class="table-of-contents__link toc-highlight">Volcano 中的 Actions</a><ul><li><a href=#1-enqueue入队 class="table-of-contents__link toc-highlight">1. enqueue（入队）</a><li><a href=#2-allocate分配 class="table-of-contents__link toc-highlight">2. allocate（分配）</a><li><a href=#3-backfill回填 class="table-of-contents__link toc-highlight">3. backfill（回填）</a><li><a href=#4-preempt抢占 class="table-of-contents__link toc-highlight">4. preempt（抢占）</a><li><a href=#5-reclaim回收 class="table-of-contents__link toc-highlight">5. reclaim（回收）</a><li><a href=#6-shuffle重新分配 class="table-of-contents__link toc-highlight">6. shuffle（重新分配）</a></ul><li><a href=#volcano-中的-plugins class="table-of-contents__link toc-highlight">Volcano 中的 Plugins</a><ul><li><a href=#1-priority优先级 class="table-of-contents__link toc-highlight">1. priority（优先级）</a><li><a href=#2-gang成组 class="table-of-contents__link toc-highlight">2. gang（成组）</a><li><a href=#3-conformance一致性 class="table-of-contents__link toc-highlight">3. conformance（一致性）</a><li><a href=#4-drf主导资源公平性 class="table-of-contents__link toc-highlight">4. drf（主导资源公平性）</a><li><a href=#5-predicates断言 class="table-of-contents__link toc-highlight">5. predicates（断言）</a><li><a href=#6-proportion比例 class="table-of-contents__link toc-highlight">6. proportion（比例）</a><li><a href=#7-nodeorder节点排序 class="table-of-contents__link toc-highlight">7. nodeorder（节点排序）</a><li><a href=#8-binpack装箱 class="table-of-contents__link toc-highlight">8. binpack（装箱）</a><li><a href=#9-numaawarenuma感知 class="table-of-contents__link toc-highlight">9. numaaware（NUMA感知）</a><li><a href=#10-task-topology任务拓扑 class="table-of-contents__link toc-highlight">10. task-topology（任务拓扑）</a><li><a href=#11-sla服务级别协议 class="table-of-contents__link toc-highlight">11. sla（服务级别协议）</a><li><a href=#12-tdm时分复用 class="table-of-contents__link toc-highlight">12. tdm（时分复用）</a><li><a href=#13-deviceshare设备共享 class="table-of-contents__link toc-highlight">13. deviceshare（设备共享）</a><li><a href=#14-overcommit超额分配 class="table-of-contents__link toc-highlight">14. overcommit（超额分配）</a><li><a href=#15-pdbpoddisruptionbudget-支持 class="table-of-contents__link toc-highlight">15. pdb（PodDisruptionBudget 支持）</a><li><a href=#16-resourcequota资源配额 class="table-of-contents__link toc-highlight">16. resourcequota（资源配额）</a><li><a href=#17-rescheduling重调度 class="table-of-contents__link toc-highlight">17. rescheduling（重调度）</a><li><a href=#18-capacity容量感知 class="table-of-contents__link toc-highlight">18. capacity（容量感知）</a><li><a href=#19-cdp自定义调度参数 class="table-of-contents__link toc-highlight">19. cdp（自定义调度参数）</a><li><a href=#20-extender调度扩展 class="table-of-contents__link toc-highlight">20. extender（调度扩展）</a><li><a href=#21-nodegroup节点分组 class="table-of-contents__link toc-highlight">21. nodegroup（节点分组）</a><li><a href=#22-usage资源使用统计 class="table-of-contents__link toc-highlight">22. usage（资源使用统计）</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>