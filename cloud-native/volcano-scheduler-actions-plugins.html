<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano调度器Actions&Plugins" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano调度器Actions & Plugins | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano调度器Actions & Plugins | John's Blog"><meta data-rh=true name=description content=本文详细介绍了Volcano调度器中的Actions和Plugins机制，包括各种Actions的作用、应用场景和配置示例，以及如何通过这些机制实现灵活的任务生命周期管理和事件处理。><meta data-rh=true property=og:description content=本文详细介绍了Volcano调度器中的Actions和Plugins机制，包括各种Actions的作用、应用场景和配置示例，以及如何通过这些机制实现灵活的任务生命周期管理和事件处理。><meta data-rh=true name=keywords content=Volcano,Kubernetes,Actions,Plugins,调度器,Job,Pod,PodGroup,RestartJob,CompleteJob,AbortJob,生命周期管理,事件处理><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-scheduler-actions-plugins hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.a5309560.css><script src=/assets/js/runtime~main.1cd77dc6.js defer></script><script src=/assets/js/main.a11acb47.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-introduction>Volcano介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-examples>Volcano使用示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano注解介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-scheduler-actions-plugins>Volcano调度器Actions & Plugins</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/docker-containerd-commands>Docker和Containerd常用命令对比</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/data-structures-and-algorithms>数据结构和算法</a><button aria-label="Expand sidebar category '数据结构和算法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano调度器Actions & Plugins</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>Volcano</code>调度器是一个为高性能计算、机器学习和批处理工作负载设计的<code>Kubernetes</code>调度器。它的核心功能之一是通过可插拔的<code>Actions</code>和<code>Plugins</code>机制来实现灵活的调度策略。本文将通俗地介绍这些机制，帮助你更好地理解和使用<code>Volcano</code>调度器。</p>
<p><img decoding=async loading=lazy src=/assets/images/zh-cn_image_0000002065638558-3f8e26a4366a07fed3803bfbb3056ed7.png width=1256 height=503 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=调度器配置示例>调度器配置示例<a href=#调度器配置示例 class=hash-link aria-label="Direct link to 调度器配置示例" title="Direct link to 调度器配置示例">​</a></h2>
<p>以下是一个典型的<code>Volcano</code>调度器配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue,allocate,backfill,preempt,reclaim"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> resourcequota</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> binpack</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置定义了调度器的工作流程（<code>Actions</code>）和决策机制（<code>Plugins</code>）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=为什么使用多层级tiers的数组结构>为什么使用多层级(tiers)的数组结构<a href=#为什么使用多层级tiers的数组结构 class=hash-link aria-label="Direct link to 为什么使用多层级(tiers)的数组结构" title="Direct link to 为什么使用多层级(tiers)的数组结构">​</a></h3>
<ol>
<li>
<p><strong>优先级分层执行</strong>：</p>
<ul>
<li>不同层级（<code>tier</code>）的插件有着严格的优先级顺序</li>
<li>高层级（第一个数组）中的插件会先执行，其决策结果会影响或限制低层级插件的决策空间</li>
<li>只有当高层级的所有插件都允许一个调度决策时，才会继续执行低层级的插件</li>
</ul>
</li>
<li>
<p><strong>决策流程的过滤机制</strong>：</p>
<ul>
<li>第一层级的插件（如 <code>priority</code>、<code>gang</code>、<code>conformance</code>）主要负责基本的筛选和约束</li>
<li>第二层级的插件（如 <code>drf</code>、<code>predicates</code>、<code>proportion</code> 等）负责更细粒度的资源分配和优化</li>
<li>这种分层设计形成了一种"粗筛-细筛"的决策流水线</li>
</ul>
</li>
<li>
<p><strong>解决冲突的明确机制</strong>：</p>
<ul>
<li>当不同插件之间可能产生冲突决策时，层级结构提供了明确的优先级规则</li>
<li>例如，如果 <code>gang</code> 插件（第一层）决定某个任务不能被调度（因为它的所有成员无法同时运行），那么即使 <code>binpack</code> 插件（第二层）认为该任务可以被有效打包，该任务也不会被调度</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=与单一数组相比的优势>与单一数组相比的优势<a href=#与单一数组相比的优势 class=hash-link aria-label="Direct link to 与单一数组相比的优势" title="Direct link to 与单一数组相比的优势">​</a></h3>
<p>如果所有插件都放在一个扁平的数组中，调度器将面临以下问题：</p>
<ol>
<li><strong>无法表达优先级关系</strong>：<!-- -->
<ul>
<li>所有插件将被视为同等重要，难以表达某些基本约束（如成组调度）应该优先于优化决策（如资源打包）</li>
</ul>
</li>
<li><strong>决策冲突难以解决</strong>：<!-- -->
<ul>
<li>没有明确的机制来解决插件之间的冲突，可能导致不一致或不可预测的调度行为</li>
</ul>
</li>
<li><strong>调度效率降低</strong>：<!-- -->
<ul>
<li>分层执行允许在早期阶段快速过滤掉不符合基本条件的调度决策，避免不必要的计算</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-中的-actions>Volcano 中的 Actions<a href=#volcano-中的-actions class=hash-link aria-label="Direct link to Volcano 中的 Actions" title="Direct link to Volcano 中的 Actions">​</a></h2>
<p><code>Actions</code>定义了调度器的工作流程和执行顺序。在上面的配置中，我们定义了五个动作：<code>enqueue</code>、<code>allocate</code>、<code>backfill</code>、<code>preempt</code>和<code>reclaim</code>。这些动作将按照定义的顺序执行。</p>
<p>让我们逐一解释各个动作的作用：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-enqueue入队>1. enqueue（入队）<a href=#1-enqueue入队 class=hash-link aria-label="Direct link to 1. enqueue（入队）" title="Direct link to 1. enqueue（入队）">​</a></h3>
<p><strong>作用</strong>：将新提交的任务放入调度队列，并检查任务是否满足调度条件。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>检查<code>PodGroup</code>是否满足最小成员数要求</li>
<li>检查队列是否有足够的配额</li>
<li>将符合条件的任务标记为“可调度”状态</li>
</ul>
<p><strong>示例</strong>：当一个要求至少三个<code>Pod</code>同时运行的<code>TensorFlow</code>训练任务被提交时，<code>enqueue</code>动作会检查是否有足够的资源来运行这些<code>Pod</code>，如果有，则将其标记为可调度。</p>
<p><strong>注意</strong>：<code>enqueue action</code> 是不可省略的核心组件，原因如下：</p>
<ol>
<li><strong>调度流程的入口点</strong>：</li>
</ol>
<ul>
<li><code>enqueue</code>是整个调度流程的第一步，负责将任务从"未调度"状态转移到"可调度"状态</li>
<li>如果没有<code>enqueue</code>，新提交的任务将无法进入调度队列，调度器将无法感知这些任务的存在</li>
</ul>
<ol start=2>
<li><strong>基础验证机制</strong>：</li>
</ol>
<ul>
<li><code>enqueue</code> 执行关键的前置检查，如验证<code>PodGroup</code>是否满足最小成员数要求</li>
<li>它确保只有满足基本条件的任务才能进入调度流程，避免无效调度</li>
</ul>
<ol start=3>
<li><strong>默认配置的一部分</strong>：</li>
</ol>
<ul>
<li>在 <code>Volcano</code> 的默认配置中，<code>enqueue</code>总是作为第一个 <code>action</code>存在</li>
<li>即使在自定义配置中不显式指定，系统也会使用内置的<code>enqueue</code>逻辑</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-allocate分配>2. allocate（分配）<a href=#2-allocate分配 class=hash-link aria-label="Direct link to 2. allocate（分配）" title="Direct link to 2. allocate（分配）">​</a></h3>
<p><strong>作用</strong>：为队列中的任务分配资源，并将它们调度到合适的节点上。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>根据队列权重和任务优先级对任务进行排序</li>
<li>使用插件对任务进行过滤和打分</li>
<li>为符合条件的任务分配资源并绑定到节点</li>
</ul>
<p><strong>示例</strong>：当多个队列中有多个任务时，<code>allocate</code>动作会首先将资源分配给高权重队列中的高优先级任务，然后再考虑低权重队列中的任务。</p>
<p><strong>注意</strong>：在 <code>Volcano</code> 调度器中，<code>allocate</code> <code>action</code> 是<strong>不可省略</strong>的核心组件，原因如下：</p>
<ol>
<li>
<p><strong>核心调度功能的实现者</strong>：</p>
<ul>
<li><code>allocate</code> 是实际执行资源分配和<code>Pod</code>绑定的关键<code>action</code></li>
<li>它负责将已入队的任务分配到具体的节点上，是调度过程的核心步骤</li>
<li>如果没有 <code>allocate</code>，任务会停留在队列中而不会被实际调度执行</li>
</ul>
</li>
<li>
<p><strong>调度决策的执行者</strong>：</p>
<ul>
<li>虽然其他<code>actions</code>（如<code>backfill</code>、<code>preempt</code>）也可以执行调度，但它们都是针对特殊场景的补充</li>
<li><code>allocate</code> 处理常规的资源分配，是最基本的调度机制</li>
<li>其他<code>actions</code>通常在<code>allocate</code>无法满足需求时才会被触发</li>
</ul>
</li>
<li>
<p><strong>插件系统的主要应用点</strong>：</p>
<ul>
<li>大多数调度插件（如<code>drf</code>、<code>predicates</code>、<code>nodeorder</code>等）主要在<code>allocate</code>阶段发挥作用</li>
<li>这些插件通过过滤和打分机制帮助<code>allocate</code>做出最优的调度决策</li>
</ul>
</li>
<li>
<p><strong>调度流程的核心环节</strong>：</p>
<ul>
<li>在典型的调度流程中，<code>enqueue</code>将任务放入队列，而<code>allocate</code>则负责实际分配资源</li>
<li>这两个<code>action</code>构成了调度的基本闭环，缺一不可</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-backfill回填>3. backfill（回填）<a href=#3-backfill回填 class=hash-link aria-label="Direct link to 3. backfill（回填）" title="Direct link to 3. backfill（回填）">​</a></h3>
<p><strong>作用</strong>：利用集群中的空闲资源来运行小型或低优先级的任务，提高资源利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>在主要的资源分配完成后执行</li>
<li>寻找集群中的碎片资源（小块未使用的资源）</li>
<li>将这些资源分配给可以快速完成的小任务</li>
</ul>
<p><strong>示例</strong>：当集群中有一些节点只剩下少量的CPU和内存时，这些资源可能不足以运行大型任务，但<code>backfill</code>动作可以将这些资源分配给小型的批处理任务。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-preempt抢占>4. preempt（抢占）<a href=#4-preempt抢占 class=hash-link aria-label="Direct link to 4. preempt（抢占）" title="Direct link to 4. preempt（抢占）">​</a></h3>
<p><strong>作用</strong>：当高优先级任务无法获得足够资源时，从低优先级任务中抢占资源。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>识别高优先级但无法调度的任务</li>
<li>查找可以被抢占的低优先级任务</li>
<li>终止被选中的低优先级任务，释放其资源</li>
<li>将释放的资源分配给高优先级任务</li>
</ul>
<p><strong>示例</strong>：当一个生产环境的关键任务（高优先级）需要运行，但集群资源已被开发环境的任务（低优先级）占用时，<code>preempt</code>动作会终止部分开发环境的任务，将资源让给生产环境的关键任务。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5-reclaim回收>5. reclaim（回收）<a href=#5-reclaim回收 class=hash-link aria-label="Direct link to 5. reclaim（回收）" title="Direct link to 5. reclaim（回收）">​</a></h3>
<p><strong>作用</strong>：从超出其公平份额的队列中回收资源，并将其重新分配给其他队列。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个队列的公平份额和实际使用情况</li>
<li>识别超额使用资源的队列</li>
<li>从这些队列中选择可回收的任务</li>
<li>终止这些任务以释放资源</li>
</ul>
<p><strong>示例</strong>：当集群中有多个队列，每个队列都有权重设置（如生产队列权重为60%，开发队列为30%，测试队列为10%）。如果开发队列使用了超过50%的集群资源，而生产队列需要更多资源时，<code>reclaim</code>动作会从开发队列中回收资源。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-中的-plugins>Volcano 中的 Plugins<a href=#volcano-中的-plugins class=hash-link aria-label="Direct link to Volcano 中的 Plugins" title="Direct link to Volcano 中的 Plugins">​</a></h2>
<p><code>Plugins</code>是<code>Volcano</code>调度器的决策模块，它们在不同的调度阶段提供特定的功能。在上面的配置中，插件被组织成两个层级（<code>tiers</code>），每个层级包含多个插件。层级的概念允许插件按照优先级顺序执行，高层级的插件优先级高于低层级的插件。</p>
<p>让我们逐一解释这些插件的作用：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=第一层级插件>第一层级插件<a href=#第一层级插件 class=hash-link aria-label="Direct link to 第一层级插件" title="Direct link to 第一层级插件">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=1-priority优先级>1. priority（优先级）<a href=#1-priority优先级 class=hash-link aria-label="Direct link to 1. priority（优先级）" title="Direct link to 1. priority（优先级）">​</a></h4>
<p><strong>作用</strong>：根据任务的优先级对其进行排序，确保高优先级任务先被调度。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>读取任务的<code>PriorityClass</code>或优先级注解</li>
<li>根据优先级值对任务进行排序</li>
<li>高优先级任务在资源分配时会被优先考虑</li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PriorityClass</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">value</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">globalDefault</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"This priority class is used for critical production jobs"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> critical</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 其他配置...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置将使<code>critical-job</code>获得高优先级，在资源竞争时优先被调度。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=2-gang成组>2. gang（成组）<a href=#2-gang成组 class=hash-link aria-label="Direct link to 2. gang（成组）" title="Direct link to 2. gang（成组）">​</a></h4>
<p><strong>作用</strong>：实现成组调度，确保任务的所有成员（Pod）可以同时运行。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>读取任务的<code>minAvailable</code>设置</li>
<li>检查是否有足够的资源来运行最小所需的Pod数量</li>
<li>只有当所有必要的Pod都能被调度时，才会进行调度</li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> distributed</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ps</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># Pod模板...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># Pod模板...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置要求至少4个Pod（1个ps和3个worker）同时可用才会开始调度。这对于分布式训练等需要多个组件协同工作的任务非常重要。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=3-conformance一致性>3. conformance（一致性）<a href=#3-conformance一致性 class=hash-link aria-label="Direct link to 3. conformance（一致性）" title="Direct link to 3. conformance（一致性）">​</a></h4>
<p><strong>作用</strong>：确保调度决策符合Kubernetes的标准和约定。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>检查调度决策是否符合Kubernetes的API约定</li>
<li>验证资源请求和限制</li>
<li>确保与标准Kubernetes调度器的行为兼容</li>
</ul>
<p><strong>示例</strong>：这个插件主要在后台工作，确保调度决策符合Kubernetes的规范，通常不需要特定的配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=第二层级插件>第二层级插件<a href=#第二层级插��件 class=hash-link aria-label="Direct link to 第二层级插件" title="Direct link to 第二层级插件">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=1-drf主导资源公平性>1. drf（主导资源公平性）<a href=#1-drf主导资源公平性 class=hash-link aria-label="Direct link to 1. drf（主导资源公平性）" title="Direct link to 1. drf（主导资源公平性）">​</a></h4>
<p><strong>作用</strong>：实现主导资源公平性（Dominant Resource Fairness）算法，确保资源在不同队列和任务之间公平分配。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个任务的主导资源（即任务所需的最多的资源类型）</li>
<li>根据主导资源的使用比例对任务进行排序</li>
<li>确保所有用户或队列都能获得公平的资源份额</li>
</ul>
<p><strong>示例</strong>：当一个任务需要大量的CPU而另一个任务需要大量的内存时，DRF算法会确保两个任务都能获得公平的资源分配，而不是简单地平均分配每种资源。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=2-predicates断言>2. predicates（断言）<a href=#2-predicates断言 class=hash-link aria-label="Direct link to 2. predicates（断言）" title="Direct link to 2. predicates（断言）">​</a></h4>
<p><strong>作用</strong>：检查节点是否满足运行特定任务的条件，类似于标准Kubernetes调度器的断言。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>检查节点资源是否满足任务需求</li>
<li>检查节点是否满足任务的亲和性、反亲和性要求</li>
<li>检查节点标签是否符合任务要求</li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">task</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nvidia/cuda</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置要求任务只能运行在标记为<code>gpu=true</code>的节点上，并且需要GPU资源。<code>predicates</code>插件会确保只有满足这些条件的节点才会被选中。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=3-proportion比例>3. proportion（比例）<a href=#3-proportion比例 class=hash-link aria-label="Direct link to 3. proportion（比例）" title="Direct link to 3. proportion（比例）">​</a></h4>
<p><strong>作用</strong>：根据队列的权重按比例分配资源，确保资源分配符合预定的比例。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个队列的目标资源份额（根据权重）</li>
<li>监控实际资源使用情况</li>
<li>调整资源分配以符合目标比例</li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>6</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> development</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> testing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置定义了三个队列，权重比例为<code>6:3:1</code>。<code>proportion</code>插件会确保资源分配大致符合这个比例，即生产队列获得<code>60%</code>的资源，开发队列获得<code>30%</code>，测试队列获得<code>10%</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=4-resourcequota资源配额>4. resourcequota（资源配额）<a href=#4-resourcequota资源配额 class=hash-link aria-label="Direct link to 4. resourcequota（资源配额）" title="Direct link to 4. resourcequota（资源配额）">​</a></h4>
<p><strong>作用</strong>：实现队列级别的资源配额限制，确保队列不会超过其分配的资源上限。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>计算每个队列的资源使用情况</li>
<li>检查是否超过配额限制</li>
<li>阻止超过配额的资源请求</li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> development</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 20Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个配置限制了开发队列最多可以使用10个CPU核心、20GB内存和2个GPU。如果队列中的任务请求超过这些限制，则新的任务将无法被调度。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=5-nodeorder节点排序>5. nodeorder（节点排序）<a href=#5-nodeorder节点排序 class=hash-link aria-label="Direct link to 5. nodeorder（节点排序）" title="Direct link to 5. nodeorder（节点排序）">​</a></h4>
<p><strong>作用</strong>：为任务选择最适合的节点，基于多种因素对节点进行打分和排序。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>考虑节点的资源利用率</li>
<li>考虑任务的亲和性和反亲和性要求</li>
<li>考虑节点的标签和条件</li>
<li>为每个节点计算分数，选择分数最高的节点</li>
</ul>
<p><strong>示例</strong>：当一个任务需要调度到集群中的节点时，<code>nodeorder</code>插件会考虑多种因素，如节点的当前负载、资源利用率、与其他任务的亲和性等，然后选择最适合的节点。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=6-binpack装箱>6. binpack（装箱）<a href=#6-binpack装箱 class=hash-link aria-label="Direct link to 6. binpack（装箱）" title="Direct link to 6. binpack（装箱）">​</a></h4>
<p><strong>作用</strong>：将任务紧密地打包到尽可能少的节点上，提高资源利用率。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>优先选择已经有高资源利用率的节点</li>
<li>尽量将任务集中在少数节点上</li>
<li>减少空闲节点的数量，提高能源效率</li>
</ul>
<p><strong>示例</strong>：当集群中有多个小型任务需要调度时，<code>binpack</code>插件会尽量将它们调度到同一个或少数几个节点上，而不是分散到多个节点。这样可以保持更多的节点处于空闲状态，可以关闭这些节点以节省能源，或者用于运行大型任务。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=总结>总结<a href=#总结 class=hash-link aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p><code>Volcano</code>调度器的<code>Actions</code>和<code>Plugins</code>机制提供了强大的灵活性，可以满足各种复杂场景的调度需求。通过合理配置这些机制，可以实现：</p>
<ol>
<li><strong>公平的资源分配</strong>：确保不同团队和任务类型获得合理的资源份额</li>
<li><strong>高效的资源利用</strong>：通过回填和装箱策略提高集群资源利用率</li>
<li><strong>智能的优先级处理</strong>：确保关键任务在资源紧张时优先获得服务</li>
<li><strong>特殊工作负载的支持</strong>：如机器学习、高性能计算等需要成组调度的任务</li>
</ol>
<p>对于不同的应用场景，可以通过调整<code>Actions</code>的顺序和启用不同的<code>Plugins</code>来定制调度器的行为，以满足特定的需求。这种灵活性使<code>Volcano</code>成为在Kubernetes上运行复杂工作负载的理想选择。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://volcano.sh/zh/docs/actions target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/actions</a></li>
<li><a href=https://volcano.sh/zh/docs/plugins target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/plugins</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano-annotations><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano注解介绍</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/dragonfly><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Dragonfly介绍</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#调度器配置示例 class="table-of-contents__link toc-highlight">调度器配置示例</a><ul><li><a href=#为什么使用多层级tiers的数组结构 class="table-of-contents__link toc-highlight">为什么使用多层级(tiers)的数组结构</a><li><a href=#与单一数组相比的优势 class="table-of-contents__link toc-highlight">与单一数组相比的优势</a></ul><li><a href=#volcano-中的-actions class="table-of-contents__link toc-highlight">Volcano 中的 Actions</a><ul><li><a href=#1-enqueue入队 class="table-of-contents__link toc-highlight">1. enqueue（入队）</a><li><a href=#2-allocate分配 class="table-of-contents__link toc-highlight">2. allocate（分配）</a><li><a href=#3-backfill回填 class="table-of-contents__link toc-highlight">3. backfill（回填）</a><li><a href=#4-preempt抢占 class="table-of-contents__link toc-highlight">4. preempt（抢占）</a><li><a href=#5-reclaim回收 class="table-of-contents__link toc-highlight">5. reclaim（回收）</a></ul><li><a href=#volcano-中的-plugins class="table-of-contents__link toc-highlight">Volcano 中的 Plugins</a><ul><li><a href=#第一层级插件 class="table-of-contents__link toc-highlight">第一层级插件</a><li><a href=#第二层级插件 class="table-of-contents__link toc-highlight">第二层级插件</a></ul><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>