<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Argo Workflow/Argo Workflow介绍" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Argo Workflow介绍 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/argo-workflow-introduction><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Argo Workflow介绍 | John's Blog"><meta data-rh=true name=description content="介绍 Argo Workflow 的基本概念、核心特性和使用场景，帮助读者理解这个基于 Kubernetes 的工作流引擎"><meta data-rh=true property=og:description content="介绍 Argo Workflow 的基本概念、核心特性和使用场景，帮助读者理解这个基于 Kubernetes 的工作流引擎"><meta data-rh=true name=keywords content="Argo Workflow,工作流,容器编排,Kubernetes,流程自动化,任务编排"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/argo-workflow-introduction><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/argo-workflow-introduction hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/argo-workflow-introduction hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.3251fb5b.js defer></script><script src=/assets/js/main.bf594746.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Collapse sidebar category 'Argo Workflow'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/argo-workflow-introduction>Argo Workflow介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-source-code>Argo Workflow源码解析</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow-faq>Argo Workflow常见问题</a><button aria-label="Expand sidebar category 'Argo Workflow常见问题'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/argo-workflow-development-setup>Argo Workflow开发环境搭建</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Expand sidebar category 'Volcano'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kind>Kind</a><button aria-label="Expand sidebar category 'Kind'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/argo-workflow><span itemprop=name>Argo Workflow</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Argo Workflow介绍</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=什么是流水线>什么是流水线<a href=#什么是流水线 class=hash-link aria-label="Direct link to 什么是流水线" title="Direct link to 什么是流水线">​</a></h2>
<p>在计算机中，<strong>流水线是把一个重复的过程分解为若干个子过程，使每个子过程与其他子过程并行进行的技术，也叫 Pipeline</strong>。由于这种工作方式与工厂中的生产流水线十分相似， 因此也被称为流水线技术。从本质上讲，流水线技术是一种时间并行技术。以“构建镜像”过程为例：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAk0lEQVR4nI2OQQ6CMAAE+1APJr7Lg5+A6AN8A1w8AFFToEAh0ELbMal6NHGTTfYwm13BnxLObRRlxTD04D2bmTFTh26fjEpinWf1ASFlzW5/IEnT2LxeziSnI71qMLollyM3tSCstWRZjtY6grJuqIoCs8xYu8YVgkf8+uS9w04Dj3Ela80bDCFEx/zxV6rvuEvJC//r5b8Ep/4IAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=362 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/3710404115-5fffb6e1af9bc.8dd5544.640.png srcset="/assets/ideal-img/3710404115-5fffb6e1af9bc.8dd5544.640.png 640w,/assets/ideal-img/3710404115-5fffb6e1af9bc.71885fd.645.png 645w" alt="" width=640 height=362></noscript></div>
<p>在每一次构建镜像中，我们都需要拉下代码仓库中的代码，进行代码编译，构建镜像，最后推往镜像仓库。在每一次代码更改过后，这一过程都是不变的。使用流水线工具可以极大的提升这一过程的效率，只需要进行简单的配置便可以轻松的完成重复性的工作。这样的过程也被称之为 CI。</p>
<p>上图流程中使用的是 Jenkins。Jenkins 作为老牌流水线框架被大家所熟知。在云原生时代，Jenkins 推出了 Jenkins X 作为基于 Kubernetes 的新一代流水线，另外云原生时代还诞生了两大流水线框架—— Argo 和 Tekton。本文就详细介绍了 Argo 的相关内容。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=argo是什么>Argo是什么<a href=#argo是什么 class=hash-link aria-label="Direct link to Argo是什么" title="Direct link to Argo是什么">​</a></h2>
<p><code>Argo Workflows</code> 是一个开源的容器原生的工作流引擎，可在 Kubernetes 上编排并行作业。Argo Workflows 通过 Kubernetes CRD方式实现。Argo 基于 Kubernetes，可以直接使用 <code>kubectl</code> 安装，安装的组件主要包括了一些 CRD 以及对应的 controller 和一个 server。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAK0lEQVR4nGMQExL8Lyki8l+En/8/LyfHf34urv98nJxgzMvBAaZ52Nn/AwDiOQt76F98egAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=71 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/974227319-5fffb6fd58599.0d0bd49.640.png srcset="/assets/ideal-img/974227319-5fffb6fd58599.0d0bd49.640.png 640w,/assets/ideal-img/974227319-5fffb6fd58599.a8756a9.1080.png 1080w" alt="" width=640 height=71></noscript></div>
<blockquote>
<p>注意，上述安装只会执行同 namespace 内的 Workflow，cluster install 详见文档。文档地址：<a href=https://argoproj.github.io/argo-workflows/ target=_blank rel="noopener noreferrer">https://argoproj.github.io/argo-workflows/</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=级定义>级定义<a href=#级定义 class=hash-link aria-label="Direct link to 级定义" title="Direct link to 级定义">​</a></h2>
<p>要了解 Argo 定义的 CRD，先从其中的三级定义入手。概念上的从大到小分别为 WorkflowTemplate、Workflow、Template，这些资源的命名有些相似，要注意分辨。<a href=https://argoproj.github.io/argo-workflows/workflow-concepts/ target=_blank rel="noopener noreferrer">https://argoproj.github.io/argo-workflows/workflow-concepts/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=template>Template<a href=#template class=hash-link aria-label="Direct link to Template" title="Direct link to Template">​</a></h3>
<p>从最简单的 template 说起，一个 template 有多种类型，分别为 <code>container</code>、<code>script</code>、<code>dag</code>、<code>steps</code>、<code>resource</code> 以及 <code>suspend</code>**。**对于 template，我们可以简单的将其理解为一个 Pod ——container/script/resource 类型的 template 都会去实际控制一个 Pod，而 dag/steps 类型的 template 则是由多个基础类型的 template （container/script/resource）组成的。</p>
<ul>
<li><strong>container</strong>：最常见的模板类型，与 Kubernetes container spec 保持一致。</li>
<li><strong>script</strong>：该类型基于 Container，支持用户在 template 定义一段脚本，另有一个 Source 字段来表示脚本的运行环境。</li>
<li><strong>resource</strong>：该类型支持我们在 template 中对 kubernetes 的资源进行操作，有一个 action 字段可以指定操作类型，如 create, apply, delete 等，并且支持设定相关的成功与失败条件用于判断该 template 的成功与失败。</li>
<li><strong>suspend</strong>：Suspend template 将在一段时间内或在手动恢复执行之前暂停执行。可以从 CLI （使用 argo resume）、API 或 UI 恢复执行。</li>
<li><strong>steps</strong>：Steps Template 允许用户以一系列步骤定义任务。在 Steps 中，[--] 代表顺序执行，[-] 代表并行执行。</li>
<li><strong>dag</strong>：DAG template 允许用户将任务定义为带依赖的有向无环图。在 DAG 中，通过 dependencies设置在特定任务开始之前必须完成的其他任务。没有任何依赖项的任务将立即运行。有关 DAG 的详细逻辑可见源码 <a href=https://github.com/argoproj/argo/blob/master/workflow/controller/dag.go#L204 target=_blank rel="noopener noreferrer">https://github.com/argoproj/a...</a>。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=workflow>Workflow<a href=#workflow class=hash-link aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h3>
<p>在一个 Workflow 中，其 spec 中有一个名为 templates 的字段，在其中至少需要一个 template 作为其组成的任务。</p>
<p>一个最简单的 hello world 例子如下：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVR4nFWOSW7EIAAEMUvMDgYbMlaizP8/WZE5RMqh1JduVYsrZl61cZ+dM2cO71cGY3BKLaxUiBEyP20wUuaKiVkKh3VEqYlKk7Qmao1o1jNDoe2OmTKnj9TdUfed+uHowXA4jajW8VXPpb9SXmu3bTi5EaRa+Ef9fLhz4z0/uXtn5EKPkcO7v+KDsFLSbGCmwPtV+B6JZAxRm3/FX5djRBTS7GDjAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=398 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2478719909-5fffb73379d3c.423c4d5.640.png srcset="/assets/ideal-img/2478719909-5fffb73379d3c.423c4d5.640.png 640w,/assets/ideal-img/2478719909-5fffb73379d3c.b205520.1080.png 1080w" alt="" width=640 height=398></noscript></div>
<p>在这个例子中，该 Workflow 的 templates 字段中指定了一个类型为 container 的 template，使用了 whalesay 镜像。</p>
<p>下面是一个稍微复杂的 workflow：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0klEQVR4nHWPWW6EMBAFwRuY9jIGk1mY5P63rJEtMkoi5aMkt1R+/XqokthTYg2B7D1e6zfzj/dQJbCHSJGFYCyL0gRtEK0JxvS5MWyy8LVnjjVyuyzs4iizITvDZTJErZEmBud4roWPlKgy8dyEa/ZUcUSr+ocuzkrzyCvHVohGE50mtSTTklSXutiK3nPh0cUmKJI9e57Smai4p8JRV6I1pJNwdnuLaXLcUmSPHjEjXo14PbL8YcjTzGettOtFjf8yiHVcc+KokSqW1f/u9r36BXIGboH04YrbAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=623 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2043671593-5fffb84536c0d.750f317.640.png srcset="/assets/ideal-img/2043671593-5fffb84536c0d.750f317.640.png 640w,/assets/ideal-img/2043671593-5fffb84536c0d.7b650db.1080.png 1080w" alt="" width=640 height=623></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=workflowtemplate>WorkflowTemplate<a href=#workflowtemplate class=hash-link aria-label="Direct link to WorkflowTemplate" title="Direct link to WorkflowTemplate">​</a></h3>
<p>WorkflowTemplate 相当于 Workflow 的模板库，和 Workflow 一样，也由 template 组成。用户在创建完 WorkflowTemplate 后，可以通过直接提交它们来执行 Workflow。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVR4nFXPyU7FMABD0TZJpzTN0AydeYgV//+DF7UgBAsvLB1ZcpVHyzkntph47TvFe6KdcFrT1YJeSgYpqaKeeIuZa1n4OA5e28pZMluMlBCwfU8vBJVpWq6Q2GxgcZ48TSzW4fuBUaonWkiqQSmiNg88UmILM0Y1DHXNKORvKq0Ui3Gs1pOdozjH6gPmXvsLWyFwbcfl44OLtU/XtfgPO/kNDzuzes+RM8U6pqZhrH/g/fqGU9OyGc+ZDJ/viSNpVt+wWMkeFK6TfAEYE1wRARqtewAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=537 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2381840871-5fffb856062a4.b25951b.640.png srcset="/assets/ideal-img/2381840871-5fffb856062a4.b25951b.640.png 640w,/assets/ideal-img/2381840871-5fffb856062a4.42c24e3.1080.png 1080w" alt="" width=640 height=537></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=workflow-overview>Workflow Overview<a href=#workflow-overview class=hash-link aria-label="Direct link to Workflow Overview" title="Direct link to Workflow Overview">​</a></h3>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVR4nD2PPU/CUAAA3/92M44uJg4umjg5mKCTkRC+5EObFgGJaAjWRsGUUlr6Sgu25Z1BhUtuu+WEUooNYShxHBt35uL5Hp7rsIwjtogkSUkVyDBC05+oFOo0qjrNnknHnND78PiaBYhlOCP+fCDybeqNAYUrnfylRk6bkHuJuGjP6Y8CRCynLN5rSHdM8fGJcu2G61Ke84aBPrS57Zq0zBHiO0lYo1imiopxj1E8onR3xmm9zNCyqHbbNF8HiCzLyNIVtvWMpR/zZpzQ73eYziW2H/66iFcI+LsOeof47X2C1h6ye7C73V1vw8SpEYx15FgjsctkCtb/boofHTcjWFUpHn4AAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=489 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/3008190936-5fffb8654df09.fe08c52.640.png srcset="/assets/ideal-img/3008190936-5fffb8654df09.fe08c52.640.png 640w,/assets/ideal-img/3008190936-5fffb8654df09.5213654.1020.png 1020w" alt="" width=640 height=489></noscript></div>
<p>在了解了 Argo 的三级定义后，我们首先来深入一下 Argo 中最为关键的定义，Workflow。<strong>Workflow 是 Argo 中最重要的资源，有两个重要的功能：</strong></p>
<ul>
<li><strong>定义了要执行的工作流。</strong></li>
<li><strong>存储了工作流的状态。</strong></li>
</ul>
<p>由于这些双重职责，Workflow 应该被视为一个 Active 的对象。它不仅是一个静态定义，也是上述定义的一个“实例”。</p>
<p>**Workflow Template 的定义与 Workflow 几乎一致，除了类型不同。**正因为 Workflow 既可以是一个定义也可以是一个实例，所以才需要 WorkflowTemplate 作为 Workflow 的模板，WorkflowTemplate 在定义后可以通过提交（Submit）来创建一个 Workflow。</p>
<p>而 <strong>Workflow</strong> 由一个 entrypoint 及一系列 template 组成，entrypoint 定义了这个 workflow 执行的入口，而 template 会实际去执行一个 Pod，其中，用户定义的内容会在 Pod 中以 Main Container 体现。此外，还有两个 <strong>Sidecar</strong> 来辅助运行。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=sidecar>Sidecar<a href=#sidecar class=hash-link aria-label="Direct link to Sidecar" title="Direct link to Sidecar">​</a></h2>
<p>在 Argo 中，这些 Sidecar 的镜像都是 <strong><code>argoexec</code></strong>。Argo 通过这个 executor 来完成一些流程控制。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=init>Init<a href=#init class=hash-link aria-label="Direct link to Init" title="Direct link to Init">​</a></h3>
<p>当用户的 template 中需要使用到 inputs 中的 <code>artifact</code> 或者是 script 类型时（script 类型需要注入脚本），Argo 都会为这个 pod 加上一个 <strong>InitContainer</strong> —— 其镜像为 argoexec，命令是 argoexec init。在这个 <code>Init Container</code> 中，主要工作就是加载 <code>artifact</code>：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0ElEQVR4nE1Q15KDMBBjUqim2RRjIJCDm0n+/wOV0XI49yDbq5W1JSjTFLVS6OoapihQZZnEeRwjvl49giwMhXxtG977jm154Hdd8do3/Mwzpr4/hNHlIo+2qtBpjV5rSQ5NI84qig4hj+R2gzUG6zhicQ4PN2BoWzynUXgvJNhbpRT2dRExBXTlXSTJ1zG938F+mbDaQOe5CDgseS/sjYZrWG7yTmPXwXWtVPOlz6FmazEPFk1ZyjDnQF7IHTJJkp+I8O8mApb93+c3PnAu/AMyanQIVZiUWgAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=624 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2657741167-5fffb8c009e45.76379fd.640.png srcset="/assets/ideal-img/2657741167-5fffb8c009e45.76379fd.640.png 640w,/assets/ideal-img/2657741167-5fffb8c009e45.9ac9e75.940.png 940w" alt="" width=640 height=624></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=wait>Wait<a href=#wait class=hash-link aria-label="Direct link to Wait" title="Direct link to Wait">​</a></h3>
<p>除了 Resource 类型外的 template，Argo 都会注入一个 Wait Container，用于等待 Main Container 的完成并结束所有 Sidecar。这个 Wait Container 的镜像同样为 <code>argoexec</code>，命令是 <code>argoexec wait</code>。（Resource 类型的不需要是因为 Resource 类型的 template 直接使用 <code>argoexec</code> 作为 Main Container 运行）</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAPCAYAAADd/14OAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVR4nHWS4W7DIAyEW4ILBAIESBradXv/p7zJjjpl7fbDgMSnO/vgFJ3DZ++4ryvWeYbTGnYY3urES18aHn3DVitaSnBEMGqQ+gWORJhDQPUBNQRMxmAiQnIangY4NeDEVtdSsJWCnmdUNyIQYdKEeCFMpBEGvStm7wXutWKJEclYpItBNlYq0mUHr7XgsV0FLKOHPyuMSmHk/azg2ZrBJWf0VrHmLD2yFV8ea1csBR8cT86YWfEF8k+w5YStFrQYEY2BV+ofxVrwdeu4tSbRPPt6A/lF7ssiip5IBvnbOqV96lJ+hnlVlcBz8Fhywuw9orUSdtBadjlz4JO12FqVl0nOSY+zdRJ0MnvoQdNuzTD35vgDHII+Bv4NdOKnceXNbj4AAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=962 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/143124495-5fffb8cd0ce29.d5c6e9b.640.png srcset="/assets/ideal-img/143124495-5fffb8cd0ce29.d5c6e9b.640.png 640w,/assets/ideal-img/143124495-5fffb8cd0ce29.6f91455.1080.png 1080w" alt="" width=640 height=962></noscript></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=inputs-and-outputs>Inputs and Outputs<a href=#inputs-and-outputs class=hash-link aria-label="Direct link to Inputs and Outputs" title="Direct link to Inputs and Outputs">​</a></h2>
<p>在运行 Workflow 时，一个常见的场景是输出产物的传递。通常，一个 Step 的输出产物可以用作后续步骤的输入产物。<strong>在 Argo 中，产物可以通过 Artifact 或是 Parameter 传递。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=artifact>Artifact<a href=#artifact class=hash-link aria-label="Direct link to Artifact" title="Direct link to Artifact">​</a></h3>
<p>**要使用 Argo 的 Artifact，首先必须配置和使用 Artifact 存储仓库。**具体的配置方式可以通过修改存有 Artifact Repository 信息的默认 Config Map 或者在 Workflow 中显示指定，详见 配置文档，在此不做赘述。下表为 Argo 支持的仓库类型。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAY0lEQVR4nE2OSwoAMQhDe//juujfZngBYYQ02CRqe+9p7617r845ZvrM1FrLwNN4IsLiGMPce3eAHtgoySINIpNgij9A2Tjn9AerMcIUgQrZyPi6CaHuYlOFbMSEABf+p2D8AKld7ODS54FTAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=360 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/368505397-5fffb8e6dbf65.5d8f111.640.png srcset="/assets/ideal-img/368505397-5fffb8e6dbf65.5d8f111.640.png 640w,/assets/ideal-img/368505397-5fffb8e6dbf65.b83d23f.1080.png 1080w" alt="" width=640 height=360></noscript></div>
<p>一个简单的使用了 Artifact 的例子如下：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR4nG2Q226DMBAFiS8Yg684JoQkrdr//8epMJWaNn0Y+WFHe3y2qy6wpkzxnnMIhGHASvlCt7jALc2cnWMJkWwtk5AvdL7vuYbM53bjsSyMJ/G/aKVk9ZG3urCVQtD991AxnmSjiUYIZmt4r4EtW9ZouOaBs+sJShG0xCtJ57RmDYk1B2oyFKfJVjI/kcz+R923Mlvx1GDJU08cJPMoieaI3mkb30rkXjy3PHGJA5do2pus/ikzKU31gftSKc4dZZTAScWoTkziuEKL3pKneksZe+ZB45RkFPuhn8Q9+lEyH9vKEh1O79Ix/CW26MlznR2XZBilaNv+il8wZYaCpaDdDAAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=762 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/3952974062-5fffb8f00b5dc.c771f3a.640.png srcset="/assets/ideal-img/3952974062-5fffb8f00b5dc.c771f3a.640.png 640w,/assets/ideal-img/3952974062-5fffb8f00b5dc.3612cf8.1080.png 1080w" alt="" width=640 height=762></noscript></div>
<p><strong>默认情况下，Artifact 被打包为 tgz(tar +gzip)包，我们也可以使用 archive 字段指定存档策略。</strong></p>
<p>在上面的例子里，名为 whalesay 的 template 使用 cowsay 命令生成一个名为 /tmp/hello-world.txt 的文件，然后将该文件作为一个名为 hello-art 的 Artifact 输出。名为 print-message 的 template 接受一个名为 message 的输入 Artifact，在 /tmp/message 的路径上解包它，然后使用 cat 命令打印 /tmp/message 的内容。</p>
<p>在前面 Sidecar 介绍中提到过，<strong>Init Container 主要用于拉取 Artifact 产物</strong>。这些 Sidecar 正是产物传递的关键。下面，我们通过介绍另一种产物传递的方式来体验 Argo 中传递产物的关键。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=script>Script<a href=#script class=hash-link aria-label="Direct link to Script" title="Direct link to Script">​</a></h3>
<p>先来看一个简单的例子：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVR4nGWP226DMBBEja/Y+IKxQ5OG9v//8lRAIgX1YbQj7czujFhjZi2FnjPFe0Yp8Ur9g1hT4Vkb363RYyRIyaQU4YU3F0FptqXzWBrVT4RBEaRikurkw8kP4f7+PieWYJhHzewM2RjKDmtIWiOSdWyt8aiZ7DTJKpJRFKspTh8zaoWowbImT/X2WGQrD3GfDD0aWtivK0QZR357Y+sLxTrCIC/53pnFZDQ/X55btocz7k1fZT4hsht5Lp3ZT3ghL00vwmgs9zlzKyPVa2rQLOEs8Wn4A289bp+QMVVoAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=631 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2992108274-5fffb90ac6e9e.0f92618.640.png srcset="/assets/ideal-img/2992108274-5fffb90ac6e9e.0f92618.640.png 640w,/assets/ideal-img/2992108274-5fffb90ac6e9e.61f65bc.1080.png 1080w" alt="" width=640 height=631></noscript></div>
<p>在上面的例子中，有两个类型为 script 的 template，script 允许使用 source 规范脚本主体。这将创建一个包含脚本主体的临时文件，然后将临时文件的名称作为最后一个参数传递给 command（执行脚本主体的解释器），这样便可以方便的执行不同类型的脚本（bash、python、js etc）。</p>
<p>Script template 会将脚本的标准输出分配给一个名为 result 的特殊输出参数从而被其他 template 调用。在这里，通过 <code>{{steps.generate.outputs.result}}</code> 即可获取到名为 generate 的 template 的脚本输出。</p>
<blockquote>
<p><code>{{xxx}}</code> 是 Argo 固定的变量替换格式：</p>
<ul>
<li>关于变量的格式详见文档，文档地址：<a href=https://github.com/argoproj/argo/blob/master/docs/variables.md target=_blank rel="noopener noreferrer">https://github.com/argoproj/a...</a></li>
<li>关于变量替换的逻辑详见源码，源码地址：<a href=https://github.com/argoproj/argo/blob/master/workflow/common/util.go#L305 target=_blank rel="noopener noreferrer">https://github.com/argoproj/a...</a></li>
</ul>
</blockquote>
<p>那么，容器内部应该如何获取这个脚本输出呢？我们回到 Sidecar，在 Wait Container 中，有这样一段逻辑：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVR4nE2QR27EMBAERTEnMShQNrzw/19ZBgV47UNhDlPoQc/Sc+Zqlb2UN33baClRYiA7h5OSJWjNvXdGT5zFcdVEdh4rBHZdcXIiWbxSXL0xWqV6Sw2eFuIzi/dkY/C/4lkrRyncvXNsG1HrN0GpP/HjPPgag9EaVy1P2lz+Z3FyJjbuvnO3Tp8lnCNqg1vlwyNGo7j3yvc4eJ07Z0kUb2jBkowiG0XUiiVbySiR19X47BtXS+zJUdxKtZLqJEnP90hJD5FkZoJ9Cvh5bhUEIfCTVfADNGBli2lkfCUAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=559 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/455755801-5fffb91c238b1.fc2cd32.640.png srcset="/assets/ideal-img/455755801-5fffb91c238b1.fc2cd32.640.png 640w,/assets/ideal-img/455755801-5fffb91c238b1.01fd6ae.1080.png 1080w" alt="" width=640 height=559></noscript></div>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcklEQVR4nAXBywrCMBBA0XRXcaMVxI1UQWprEsykMZmCWhc+/v+LrueYdV/YWKUZEtvLyKrPDFJ4TYW5RLzzxCCYZVfYyZP9qByj0DjFpju/94fv/KBkJSXF1KfM4jxRd0rV3qgOidYmogQkBJwXrL/yB8zCLYwBMg/NAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=223 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/4120955339-5fffb922eee06.f4455f8.640.png srcset="/assets/ideal-img/4120955339-5fffb922eee06.f4455f8.640.png 640w,/assets/ideal-img/4120955339-5fffb922eee06.96c156b.1080.png 1080w" alt="" width=640 height=223></noscript></div>
<p>再来看看这个 Wait Container 的 Volume Mount 情况：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgUlEQVR4nD2O2w6EIAxECYUFiiKImoXNXvz/j5wNTfThZPowPa2anUPlCdPDITEjxwi2Fk5reKIbFa3Ba1lxtoZfbzhyRmaG1xqB6EYF0uip4LNueG8VdZ6FJQQpXwuKSYvxux842xO9VuwpSbnEKDkuiLGEgDr+815MbIxYRl7zH2n1OKG8HogwAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=289 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/3976899563-5fffb9477dcc3.ec80ce7.640.png srcset="/assets/ideal-img/3976899563-5fffb9477dcc3.ec80ce7.640.png 640w,/assets/ideal-img/3976899563-5fffb9477dcc3.4b38afe.1080.png 1080w" alt="" width=640 height=289></noscript></div>
<p>现在就十分明确了，<strong>Wait Container 通过挂载 docker.sock 以及 service account，获取到 Main Container 中的输出结果，并保存到 Workflow 中</strong>。当然，因为 Workflow 中保存了大量的信息，当一个 Workflow 的 Step 过多时，整个 Workflow 的结构会过于庞大。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=parameter>Parameter<a href=#parameter class=hash-link aria-label="Direct link to Parameter" title="Direct link to Parameter">​</a></h3>
<p>**Parameter 提供了一种通用机制，可以将步骤的结果用作参数。**Parameter 的工作原理与脚本结果类似，除了输出参数的值会被设置为生成文件的内容，而不是 stdout 的内容。如：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWklEQVR4nEXFOw4DIQxAQSQbMBiWn1Jk9/7nfFHSpBhNGGbcZ7NbZZSMR6Hql+Kqv4sIYdXCsy5OM5YnjivblZH/XIXQc+Q9Bq/WmWZMS5yamKZcUZhJ6Kp8AOV2IXtaw9KwAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=200 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/946689225-5fffba4a1a03d.b587bd7.640.png srcset="/assets/ideal-img/946689225-5fffba4a1a03d.b587bd7.640.png 640w,/assets/ideal-img/946689225-5fffba4a1a03d.3033939.1080.png 1080w" alt="" width=640 height=200></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=volume>Volume<a href=#volume class=hash-link aria-label="Direct link to Volume" title="Direct link to Volume">​</a></h3>
<p>这并不是 Argo 处理产物传递的一种标准方式，但是通过共享存储，我们显然也能达到共通产物的结果。当然，如果使用 Volume，我们则无需借助 Inputs 和 Outputs。在 Workflow 的 Spec 中，我们定义一个 Volume 模板：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAb0lEQVR4nCWK2wrDIBAFRVdXxdsmNrTQ///NKWkehoEzx7364JqLPQZn75QQyN6T/e2He3NXG3yPzXsZZ210iVhOWEksjSxNzBRxQ5XPNKwquwZGElYWTIUugR5uC66IsGvDND9BAlOf41Khev/nByjQLH3kdskvAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=232 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2256174945-5fffba5dc767f.a12e9a1.640.png srcset="/assets/ideal-img/2256174945-5fffba5dc767f.a12e9a1.640.png 640w,/assets/ideal-img/2256174945-5fffba5dc767f.fdbded3.1080.png 1080w" alt="" width=640 height=232></noscript></div>
<p>并在其他的 template 中 mount 该 volume：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWklEQVR4nEXKMQ6DMAxAUZQ4cTDBaUAiSB1YuP8Vf9V2YHjbm9ZcGK9ON8OLYhJ/5q/4mPZauN8b11k5mnK4Mppy9sJe8xOXJAxf2cyYQ8CT0HKiqeASWcLfB+//IYPKUyyeAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=171 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/3085720282-5fffba6cb8ae6.e1c7010.640.png srcset="/assets/ideal-img/3085720282-5fffba6cb8ae6.e1c7010.640.png 640w,/assets/ideal-img/3085720282-5fffba6cb8ae6.be71e73.1080.png 1080w" alt="" width=640 height=171></noscript></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=流程控制功能>流程控制功能<a href=#流程控制功能 class=hash-link aria-label="Direct link to 流程控制功能" title="Direct link to 流程控制功能">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=循环>循环<a href=#循环 class=hash-link aria-label="Direct link to 循环" title="Direct link to 循环">​</a></h3>
<p>在编写 Workflow 时，能够循环迭代一组输入通常是非常有用的，如下例所示:</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZUlEQVR4nF3KywoDIRBEUcfWsRtf4xCFQMj//+UNSDbJ4nBrUe5S486ZqopJwEQ2/eNyiDz74PWYdFPScWDeY/LLqfes0nnPwciBlgL1FEr0297n9zhrY7VGEWHVxJUCLcrWdwMfzrUr5KB0JAIAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=227 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/1714551681-5fffba7f41974.2695c3f.640.png srcset="/assets/ideal-img/1714551681-5fffba7f41974.2695c3f.640.png 640w,/assets/ideal-img/1714551681-5fffba7f41974.e3bc456.1080.png 1080w" alt="" width=640 height=227></noscript></div>
<p>在源码实现中，将会去判断 withItems，如果存在，则对其中的每个元素进行一次 step 的扩展。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwUlEQVR4nCWO226DMBBETTD4AthWMIUY0lgK7UP6/993KpuHXa1mR3NGpGXhzJl87DwfG+lr4REj2zwTvcMZg+06xKgUSwgc28qZX9UYgyeMA0Pfo243VNsiyqHb9koInknrmmKkpG+aaix/UVYRo/e8UmJ2jjAYgtVMxuCMRUuJKHwrZY0/1pXPefJ5P/n7+eY3b+QUmZ1GFJS3tuLmaWKPsU6Kd/Z4x5ueoWsudDEtweONqR3HXjEpdfW7NZi24R/zWVG0vEr6kwAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=459 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/2164989231-5fffba8844abe.183d9dc.640.png srcset="/assets/ideal-img/2164989231-5fffba8844abe.183d9dc.640.png 640w,/assets/ideal-img/2164989231-5fffba8844abe.05072cf.1080.png 1080w" alt="" width=640 height=459></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=条件判断>条件判断<a href=#条件判断 class=hash-link aria-label="Direct link to 条件判断" title="Direct link to 条件判断">​</a></h3>
<p>通过 <code>when</code> 关键字指定：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVR4nE3Myw7CIABEUeQNRShYmpbGnf//i9dQNy5OMpNMRhTn2XMme4eXEq8U4c/sk1iMZtTMeFXaEklGE6TCP+Rt5igVImjNVVY+18bZIlsy7E/LkR1ncbRgWZ1BzPseE++e6MXQFslRDWd1jPYbFqv5AgBZLPczxEuMAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=269 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/1732212544-5fffbaa9f3a4f.6a1dbbe.640.png srcset="/assets/ideal-img/1732212544-5fffbaa9f3a4f.6a1dbbe.640.png 640w,/assets/ideal-img/1732212544-5fffbaa9f3a4f.d53ff00.1080.png 1080w" alt="" width=640 height=269></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=错误重试>错误重试<a href=#错误重试 class=hash-link aria-label="Direct link to 错误重试" title="Direct link to 错误重试">​</a></h3>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAV0lEQVR4nGXKOw7CMBAAUcve7MdYZm1IGu5/zkERJcWTppiSHpxjMk3xWvHa/kRrlAznk5trGjuUNGW5suwg/aaMQyirG+8evLqyH8rT5DeYsO42YUjjC8abISjgerdYAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=185 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/1488316399-5fffbab193435.c11ca39.640.png srcset="/assets/ideal-img/1488316399-5fffbab193435.c11ca39.640.png 640w,/assets/ideal-img/1488316399-5fffbab193435.4c8392d.1080.png 1080w" alt="" width=640 height=185></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=递归>递归<a href=#递归 class=hash-link aria-label="Direct link to 递归" title="Direct link to 递归">​</a></h3>
<p><strong>Template 可以递归地相互调用</strong>，这是一个非常实用的功能。例如在机器学习场景中：可以设定准确率必须满足一个值，否则就持续进行训练。在下面这个抛硬币例子中，我们可以持续抛硬币，直到出现正面才结束整个工作流。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3klEQVR4nD2Q2XLDIAwAbQSYKwaDncPJpDP9/3/cDjTtwz5II2klTS0kHnnjue88auW+bbSUKN6TjMWLDKbiPGcp1BiISghKDfw8E5SMXGeKVvNuma9r41gj6yIEUXiZB0GrweREuKWV77NxL57qhftqeVbHsy60aNmcYfJaM/askSMvtGS4ZsuRLftqSFa49InJLry2nbNVaoz0Rj/Uim5zfzv24NU876tnvyzUqGlJk51QvKY4/TnGGN5H5pYdUc0kUaxGk7Qayot8CoM2nLn/b2ULkezdvzqqzq/6B8U/ZPUjM5p2AAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=594 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/3566924783-5fffbabdcee62.c3f3e16.640.png srcset="/assets/ideal-img/3566924783-5fffbabdcee62.c3f3e16.640.png 640w,/assets/ideal-img/3566924783-5fffbabdcee62.d4ab97e.1080.png 1080w" alt="" width=640 height=594></noscript></div>
<p>以下是两次执行的结果，第一次执行直接抛到正面，结束流程；第二次重复三次后才抛到正面，结束流程。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoElEQVR4nE2ObQ/CIAyEgTHGywaD4XQz6v//lWeuxuiHpund9WlVWxbUecaWM/paUGLEqBSc1hi1RrAWyTmovVacl441JeQYcPQuS6xrayBIgl8SB27TLCkKmZfYF++haDyOm4gUSCD9P0iAIul5HHJqMkbCNHMIn3d8EF05Y4Tyup9Y54ReCvZWpfNfehL0wwBvLbaSf6Q5yZ8McZ4GgzeTk1ARslHmmQAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=421 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/124113011-5fffbacb91e93.af31ee9.640.png srcset="/assets/ideal-img/124113011-5fffbacb91e93.af31ee9.640.png 640w,/assets/ideal-img/124113011-5fffbacb91e93.6a38f31.1080.png 1080w" alt="" width=640 height=421></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=退出处理>退出处理<a href=#退出处理 class=hash-link aria-label="Direct link to 退出处理" title="Direct link to �退出处理">​</a></h3>
<p><strong>退出处理是一个指定在 workflow 结束时执行的 template，无论成功或失败。</strong></p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAYAAABhYU3QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQklEQVR4nCXLQQ6AIAxFQcNvU2kBE7j/WZ8xLmY518nk1GBXkWYMN1Y463Zm/LrEtavzRDDdSYlUY5goF/VFiWriBW3nFddoOKGTAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=114 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/1707708146-5fffbb107bb50.c2756ba.640.png srcset="/assets/ideal-img/1707708146-5fffbb107bb50.c2756ba.640.png 640w,/assets/ideal-img/1707708146-5fffbb107bb50.9d9f9e3.1080.png 1080w" alt="" width=640 height=114></noscript></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li>
<p><a href=https://segmentfault.com/a/1190000038979821 target=_blank rel="noopener noreferrer">https://segmentfault.com/a/1190000038979821</a></p>
</li>
<li>
<p><a href=https://github.com/argoproj/argo-workflows target=_blank rel="noopener noreferrer">https://github.com/argoproj/argo-workflows</a></p>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/argo-workflow><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Argo Workflow</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/argo-workflow-source-code><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Argo Workflow源码解析</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#什么是流水线 class="table-of-contents__link toc-highlight">什么是流水线</a><li><a href=#argo是什么 class="table-of-contents__link toc-highlight">Argo是什么</a><li><a href=#级定义 class="table-of-contents__link toc-highlight">级定义</a><ul><li><a href=#template class="table-of-contents__link toc-highlight">Template</a><li><a href=#workflow class="table-of-contents__link toc-highlight">Workflow</a><li><a href=#workflowtemplate class="table-of-contents__link toc-highlight">WorkflowTemplate</a><li><a href=#workflow-overview class="table-of-contents__link toc-highlight">Workflow Overview</a></ul><li><a href=#sidecar class="table-of-contents__link toc-highlight">Sidecar</a><ul><li><a href=#init class="table-of-contents__link toc-highlight">Init</a><li><a href=#wait class="table-of-contents__link toc-highlight">Wait</a></ul><li><a href=#inputs-and-outputs class="table-of-contents__link toc-highlight">Inputs and Outputs</a><ul><li><a href=#artifact class="table-of-contents__link toc-highlight">Artifact</a><li><a href=#script class="table-of-contents__link toc-highlight">Script</a><li><a href=#parameter class="table-of-contents__link toc-highlight">Parameter</a><li><a href=#volume class="table-of-contents__link toc-highlight">Volume</a></ul><li><a href=#流程控制功能 class="table-of-contents__link toc-highlight">流程控制功能</a><ul><li><a href=#循环 class="table-of-contents__link toc-highlight">循环</a><li><a href=#条件判断 class="table-of-contents__link toc-highlight">条件判断</a><li><a href=#错误重试 class="table-of-contents__link toc-highlight">错误重试</a><li><a href=#递归 class="table-of-contents__link toc-highlight">递归</a><li><a href=#退出处理 class="table-of-contents__link toc-highlight">退出处理</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>