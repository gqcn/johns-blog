<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano介绍" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano介绍 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-introduction><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano介绍 | John's Blog"><meta data-rh=true name=description content=Volcano是基于Kubernetes的高性能批处理系统，为机器学习、深度学习等大数据应用提供高级调度功能。><meta data-rh=true property=og:description content=Volcano是基于Kubernetes的高性能批处理系统，为机器学习、深度学习等大数据应用提供高级调度功能。><meta data-rh=true name=keywords content="Volcano,Kubernetes,调度器,Gang Scheduling,批处理,AI训练,机器学习,深度学习,Queue,PodGroup"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-introduction><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-introduction hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-introduction hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.208c11f9.css><script src=/assets/js/runtime~main.2488ebd0.js defer></script><script src=/assets/js/main.966ab8cd.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-introduction>Volcano介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano注解详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job>Volcano Queue&Job详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job-pod-preemption>Volcano Queue&Job&Pod资源抢占设计</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-actions-plugins>Volcano Actions&Plugins详解</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/docker-containerd-commands>Docker和Containerd常用命令对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-kind>使用Kubernetes Kind搭建本地测试集群</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernettes-kind-mock-ai-test-cluster>使用Kubernetes Kind模拟AI算力测试集群</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano介绍</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=基本介绍>基本介绍<a href=#基本介绍 class=hash-link aria-label="Direct link to 基本介绍" title="Direct link to 基本介绍">​</a></h2>
<p><a href=https://volcano.sh/zh/docs/ target=_blank rel="noopener noreferrer">Volcano</a> 是一个基于<code>Kubernetes</code>的批处理平台，提供了机器学习、深度学习、生物信息学、基因组学及其他大数据应用所需要而<code>Kubernetes</code>当前缺失的一系列特性，提供了高性能任务调度引擎、高性能异构芯片管理、高性能任务运行管理等通用计算能力。</p>
<p><img decoding=async loading=lazy alt=Volcano架构 src=/assets/images/arch_2-b7275156fa67c4f872b658ad99877b5c.PNG width=1217 height=593 class=img_ev3q></p>
<p><code>Volcano</code>具有以下关键特性：</p>
<ul>
<li>
<p><strong>统一调度</strong>：提供了统一的批处理调度引擎，整合了多种调度算法和策略，支持<code>Gang Scheduling</code>、优先级调度、公平调度等，确保一组相关的<code>Pod</code>要么全部调度成功，要么全部不调度，避免了<code>Kubernetes</code>原生调度器的资源死锁和碎片化问题。特别适用于机器学习、大数据处理等需要多<code>Pod</code>协同工作的场景。</p>
</li>
<li>
<p><strong>队列资源管理</strong>：通过<code>Queue</code>资源对象实现多租户场景下的资源隔离和配额管理。支持层级队列结构，可以为不同部门、团队或项目分配独立的资源池，并设置资源上限（<code>capability</code>）、应得资源（<code>deserved</code>）和保障资源（<code>guarantee</code>）三级资源管理机制，确保资源的公平分配和有效利用。</p>
</li>
<li>
<p><strong>GPU虚拟化</strong>：通过<code>deviceshare</code>插件支持<code>GPU</code>等异构资源的共享和虚拟化。可以将单个物理<code>GPU</code>分割成多个虚拟<code>GPU</code>，允许多个任务共享同一张<code>GPU</code>卡，提高<code>GPU</code>资源利用率。结合相应的<code>Device Plugin</code>，支持显存分片、算力隔离等高级功能，特别适用于<code>AI</code>推理、小规模训练等场景。</p>
</li>
<li>
<p><strong>云原生混部</strong>：通过云原生的方式将在线业务和离线业务部署在同一个集群。由于在线业务运行具有明显的波峰波谷特征，因此当在线业务运行在波谷时，离线业务可以利用这部分空闲的资源，当在线业务到达波峰时，通过在线作业优先级控制等手段压制离线作业的运行，保障在线作业的资源使用，从而提升集群的整体资源利用率，同时保障在线业务<code>SLO</code>。</p>
</li>
<li>
<p><strong>网络拓扑感知</strong>：通过<code>HyperNode CRD</code>和<code>network-topology-aware</code>插件，实现网络拓扑感知的智能调度。针对<code>AI</code>大模型训练中使用的<code>InfiniBand</code>（<code>IB</code>）、<code>RoCE</code>等高速网络技术，可以根据数据中心网络层级结构、节点间带宽和延迟特性，将通信密集型的分布式任务调度到网络性能最优的节点组合上，显著减少跨交换机通信开销，最大化利用高速网络的带宽优势，提升<code>AI</code>大模型训练等分布式计算的效率。</p>
</li>
<li>
<p><strong>负载感知重调度</strong>：通过<code>rescheduler</code>插件实现基于节点负载的智能重调度。系统会定期监控集群中各节点的资源利用率，当发现负载不均衡时，自动将高负载节点上的任务迁移到低负载节点，确保集群资源的均衡使用，提高整体性能和稳定性。</p>
</li>
<li>
<p><strong>多集群调度</strong>：基于<code>Karmada</code>，扩展了<code>Volcano</code>在单集群中的强大调度能力，为多集群AI作业提供了统一的调度平台，支持跨集群的任务分发、资源管理和优先级控制。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用广泛>使用广泛<a href=#使用广泛 class=hash-link aria-label="Direct link to 使用广泛" title="Direct link to 使用广泛">​</a></h3>
<p><code>Volcano</code>是业界首个云原生批量计算项目，<code>2019</code>年由华为云捐献给云原生计算基金会（<code>CNCF</code>），也是<code>CNCF</code>首个和唯一的孵化级容器批量计算项目。它源自于华为云<code>AI</code>容器，在支撑华为云一站式<code>AI</code>开发平台<code>ModelArts</code>、容器服务<code>CCI</code>等服务稳定运行中发挥重要作用。
<code>Volcano</code>作为<code>CNCF</code>云原生计算基金会的沙箱项目，在国内众多知名企业得到了广泛应用，以下是部分知名企业应用案例：</p>
<ul>
<li>
<p><strong>华为云</strong>：作为<code>Volcano</code>的初始开发者，华为在其云平台上采用<code>Volcano</code>管理<code>AI</code>训练和高性能计算工作负载。华为云的<code>CCE</code>和<code>CCI</code>产品以及容器批量计算解决方案都已应用<code>Volcano</code>。</p>
</li>
<li>
<p><strong>百度</strong>：百度飞桨团队与<code>Volcano</code>团队联合发布了"<code>PaddlePaddle on Volcano</code>"方案，用于提升飞桨框架的计算效率。百度利用<code>Volcano</code>解决了机器学习、深度学习、<code>HPC</code>和大数据计算等多个场景的问题。</p>
</li>
<li>
<p><strong>360</strong>：使用<code>Volcano</code>弥补了<code>Kubernetes</code>原生调度在机器学习、大数据计算任务上的能力缺失，通过丰富的调度插件解决不同场景下的任务调度问题，极大提升了集群整体利用率。</p>
</li>
<li>
<p><strong>唯品会</strong>：构建了基于<code>Volcano</code>的<code>AI</code>训练平台，利用队列动态资源共享、<code>gang-scheduling</code>等高阶调度能力，支持系统<code>10</code>多万核的节点调度，加速了业务创新步伐。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=核心组件>核心组件<a href=#核心组件 class=hash-link aria-label="Direct link to 核心组件" title="Direct link to 核心组件">​</a></h3>
<p><code>Volcano</code>由以下几个核心组件组成，各自承担不同的功能职责：</p>
<ol>
<li>
<p><strong><code>Volcano Controller Manager</code></strong>：负责管理<code>Volcano</code>自定义资源的生命周期，监控和处理<code>Job</code>、<code>Queue</code>、<code>PodGroup</code>等资源的状态变化。</p>
</li>
<li>
<p><strong><code>Volcano Scheduler</code></strong>：实现高级调度功能，如<code>Gang Scheduling</code>（组调度）、队列调度和优先级调度，通过插件化架构提供灵活的调度策略配置。</p>
</li>
<li>
<p><strong><code>Volcano Admission</code></strong>：验证<code>Volcano</code>资源对象的合法性，为资源对象设置默认值，实现准入控制，确保提交的作业符合系统策略。</p>
</li>
<li>
<p><strong><code>Volcano MutatingAdmission</code></strong>：修改资源对象的配置，如添加标签、注解等，自动注入环境变量和配置信息。</p>
</li>
<li>
<p><strong><code>Volcano Agent</code></strong>（可选组件）：在节点上收集资源使用情况和硬件信息，为调度器提供更精确的节点资源信息，支持<code>GPU</code>、<code>FPGA</code>等异构资源的管理。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=组件交互关系>组件交互关系<a href=#组件交互关系 class=hash-link aria-label="Direct link to 组件交互关系" title="Direct link to 组件交互关系">​</a></h3>
<p>下图展示了<code>Volcano</code>各组件之间的交互关系及数据流向：</p>
<!-- -->
<p><code>Volcano</code>的各个组件之间通过清晰的职责划分和有效的协作实现了完整的调度系统：</p>
<ol>
<li>
<p><strong>用户提交流程</strong>：用户提交作业→<code>Admission</code>验证 →<code>Controller</code>处理 →<code>Scheduler</code>调度 →<code>Kubelet</code>执行</p>
</li>
<li>
<p><strong>状态监控与管理</strong>：</p>
<ul>
<li><code>Controller Manager</code>监控所有<code>Volcano</code>自定义资源的状态变化</li>
<li>根据资源状态变化，触发相应的事件处理</li>
<li>当需要重调度或清理资源时，通知<code>Scheduler</code>进行相应操作</li>
</ul>
</li>
<li>
<p><strong>调度决策过程</strong>：</p>
<ul>
<li><code>Scheduler</code>根据<code>Queue</code>配置和系统状态，为<code>PodGroup</code>分配资源</li>
<li>通过插件化架构，实现不同的调度策略和算法</li>
<li>支持<code>Gang Scheduling</code>，确保相关联的<code>Pod</code>要么全部调度成功，要么全部失败</li>
</ul>
</li>
<li>
<p><strong>资源信息收集</strong>：</p>
<ul>
<li><code>Agent</code>(如果启用) 提供节点资源信息，辅助调度决策</li>
<li>特别是对于<code>GPU</code>、<code>FPGA</code>等异构资源，提供更精确的资源状态</li>
</ul>
</li>
<li>
<p><strong>资源对象之间的关系</strong>：</p>
<ul>
<li><code>Job</code>包含多个<code>Task</code>，每个<code>Task</code>对应一组相同角色的<code>Pod</code></li>
<li><code>PodGroup</code>作为调度的基本单位，表示一组需要同时调度的<code>Pod</code></li>
<li><code>Queue</code>容纳多个<code>PodGroup</code>，并控制这些<code>PodGroup</code>的资源分配和调度策略</li>
</ul>
</li>
</ol>
<p>这种组件化设计使<code>Volcano</code>能够灵活应对不同的工作负载需求，并且可以通过扩展插件来增强系统能力。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=scheduler>Scheduler<a href=#scheduler class=hash-link aria-label="Direct link to Scheduler" title="Direct link to Scheduler">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=kubernetes-scheduler>Kubernetes Scheduler<a href=#kubernetes-scheduler class=hash-link aria-label="Direct link to Kubernetes Scheduler" title="Direct link to Kubernetes Scheduler">​</a></h3>
<p><code>kubernetes</code>当然有默认的<code>pod</code>调度器，但是其并不适应<code>AI</code>作业任务需求。在多机训练任务中，一个<code>AI</code>作业可能需要同时创建数十个甚至数百个<code>pod</code>，而只有当所有<code>pod</code>当创建完成后，<code>AI</code>作业才能开始运行，而如果有几个<code>pod</code>创建失败，已经创建成功的<code>pod</code>就应该退出并释放资源，否则便会产生资源浪费的情况。因此<code>AI</code>作业的<code>pod</code>调度应该遵循<code>All or nothing</code>的理念，即要不全部调度成功，否则应一个也不调度。这便是<code>Volcano</code>项目的由来（前身是<code>kube-batch</code>项目），接下来便来介绍<code>Volcano</code>的调度。</p>
<p><img decoding=async loading=lazy src=/assets/images/20240330125540-1d59d400b42ca8ba735cb27769a71962.png width=1829 height=631 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-scheduler>Volcano Scheduler<a href=#volcano-scheduler class=hash-link aria-label="Direct link to Volcano Scheduler" title="Direct link to Volcano Scheduler">​</a></h3>
<p>值得注意的是，原生 <code>Kubernetes</code> 调度器（<code>kube-scheduler</code>）没有内置提供完整的 <code>Gang Scheduling</code>（组调度）能力。<code>Gang Scheduling</code> 是指将一组相关的任务作为一个整体进行调度，要么全部调度成功，要么全部不调度。</p>
<p><code>Kubernetes</code> 默认调度器主要关注单个 <code>Pod</code> 的调度，它会逐个处理 <code>Pod</code>，而不会考虑 <code>Pod</code> 之间的相互依赖关系或者需要同时调度的需求。这种设计对于无状态应用和独立工作负载很有效，但对于需要多个 <code>Pod</code> 协同工作的场景（如分布式机器学习、大数据处理等）就显得不足。</p>
<p><code>Volcano</code> 通过实现 <code>Gang Scheduling</code> 能力，确保一组相关的 <code>Pod</code> 要么全部被调度成功，要么全部不被调度，避免资源浪费和死锁情况。这是 <code>Volcano</code> 相对于原生 <code>Kubernetes</code> 调度器的一个关键优势。</p>
<p><img decoding=async loading=lazy src=/assets/images/zh-cn_image_0000002065638558-3f8e26a4366a07fed3803bfbb3056ed7.png width=1256 height=503 class=img_ev3q></p>
<p><code>Volcano Scheduler</code>是负责<code>Pod</code>调度的组件，它由一系列<code>action</code>和<code>plugin</code>组成。<code>action</code>定义了调度各环节中需要执行的动作；<code>plugin</code>根据不同场景提供了<code>action</code>中算法的具体实现细节。<code>Volcano Scheduler</code>具有高度的可扩展性，您可以根据需要实现自己的<code>action</code>和<code>plugin</code>。</p>
<p><code>Volcano Scheduler</code>的工作流程如下：</p>
<ol>
<li>客户端提交的<code>Job</code>被调度器识别到并缓存起来。</li>
<li>周期性开启会话（<code>Session</code>），一个调度周期开始。</li>
<li>将没有被调度的<code>Job</code>发送到会话的待调度队列中。</li>
<li>遍历所有的待调度<code>Job</code>，按照定义的次序依次执行<code>enqueue</code>、<code>allocate</code>、<code>preempt</code>、<code>reclaim</code>、<code>backfill</code>等动作，为每个<code>Job</code>找到一个最合适的节点。将该<code>Job</code>绑定到这个节点。<code>action</code>中执行的具体算法逻辑取决于注册的<code>plugin</code>中各函数的实现。</li>
<li>关闭本次会话。</li>
</ol>
<p>具体流程、<code>Actions</code>和<code>Plugins</code>介绍请参考：</p>
<ul>
<li><a href=https://volcano.sh/zh/docs/schduler_introduction target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/schduler_introduction</a></li>
<li><a href=https://volcano.sh/zh/docs/actions target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/actions</a></li>
<li><a href=https://volcano.sh/zh/docs/plugins target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/plugins</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=taskpod��状态转换>Task/Pod状态转换<a href=#taskpod状态转换 class=hash-link aria-label="Direct link to Task/Pod状态转换" title="Direct link to Task/Pod状态转换">​</a></h3>
<p><img decoding=async loading=lazy alt=Task/Pod状态转换 src=/assets/images/v2-0a38d4ee885e17ce828f581eab1d795b_1440w-d24ea98db1c11cbfbb5fee34d334fd54.jpg width=1319 height=611 class=img_ev3q></p>
<p><code>Volcano</code>在<code>Kubernetes</code>原生<code>Pod</code>状态的基础上，增加了更多的状态来优化调度性能。这些状态可以分为三类：</p>
<ol>
<li>
<p><strong>Kubernetes原生状态</strong>（图中蓝色部分）</p>
<ul>
<li>包括<code>Pending</code>、<code>Running</code>、<code>Succeeded</code>、<code>Failed</code>等</li>
<li>这些状态由<code>Kubernetes</code>系统维护，持久化存储在<code>etcd</code>中</li>
</ul>
</li>
<li>
<p><strong>调度会话状态</strong>（图中绿色部分）</p>
<ul>
<li>这些状态只在调度周期内有效</li>
<li>当<code>Volcano Scheduler</code>开始一个新的调度周期时，会创建一个新的会话（<code>session</code>）</li>
<li>会话结束后，这些状态就会失效</li>
<li>主要用于优化调度过程中的临时状态管理</li>
</ul>
</li>
<li>
<p><strong>缓存状态</strong>（图中黄色部分）</p>
<ul>
<li>这些状态存储在<code>Volcano</code>调度器的缓存中</li>
<li>用于减少与<code>Kubernetes API Server</code>的通信次数</li>
<li>提高调度性能</li>
</ul>
</li>
</ol>
<p>这些额外的状态设计带来以下好处：</p>
<ol>
<li>
<p><strong>性能优化</strong>：</p>
<ul>
<li>减少与<code>Kubernetes API Server</code>的通信</li>
<li>降低调度延迟</li>
<li>提高调度效率</li>
</ul>
</li>
<li>
<p><strong>更精细的调度控制</strong>：</p>
<ul>
<li>可以根据不同状态采取不同的调度策略</li>
<li>例如，驱逐<code>Binding</code>或<code>Bound</code>状态的<code>Pod</code>比驱逐<code>Running</code>状态的<code>Pod</code>代价更小</li>
</ul>
</li>
<li>
<p><strong>状态管理优化</strong>：</p>
<ul>
<li>通过缓存机制减少状态同步开销</li>
<li>提高系统整体性能</li>
</ul>
</li>
</ol>
<p>需要注意的是，目前<code>Volcano</code>调度器对某些状态的使用还比较保守。例如，在<code>preemption</code>（抢占）和<code>reclaim</code>（回收）操作中，只会驱逐<code>Running</code>状态的<code>Pod</code>。这是因为在分布式系统中，完全的状态同步比较困难，如果处理<code>Binding</code>和<code>Bound</code>状态的<code>Pod</code>，可能会遇到状态竞争问题。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano自定义资源>Volcano自定义资源<a href=#volcano自定义资源 class=hash-link aria-label="Direct link to Volcano自定义资源" title="Direct link to Volcano自定义资源">​</a></h2>
<ul>
<li>
<p><code>Queue</code>：容纳一组<code>PodGroup</code>的队列，也是该组<code>PodGroup</code>获取集群资源的划分依据。它允许用户根据业务需求或优先级，将作业分组到不同的队列中。
<img decoding=async loading=lazy src=/assets/images/20240420124730-18512109cb3dbe39d874ba9c3d6150ba.png width=1054 height=270 class=img_ev3q></p>
</li>
<li>
<p><code>Volcano Job</code>(<code>vcjob</code>）：<code>Volcano</code>自定义的<code>Job</code>资源类型，它扩展了<code>Kubernetes</code>的<code>Job</code>资源。区别于<code>Kubernetes Job</code>，<code>vcjob</code>提供了更多高级功能，如可指定调度器、支持最小运行<code>Pod</code>数、支持<code>task</code>、支持生命周期管理、支持指定队列、支持优先级调度等。<code>Volcano Job</code>更加适用于机器学习、大数据、科学计算等高性能计算场景。</p>
</li>
<li>
<p><code>PodGroup</code>：<code>Pod</code>组是<code>Volcano</code>自定义资源类型，代表一组强关联<code>Pod</code>的集合，主要用于批处理工作负载场景，比如<code>Tensorflow</code>中的一组<code>ps</code>和<code>worker</code>。这主要解决了<code>Kubernetes</code>原生调度器中单个<code>Pod</code>调度的限制。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=queue-资源队列>Queue 资源队列<a href=#queue-资源队列 class=hash-link aria-label="Direct link to Queue 资源队列" title="Direct link to Queue 资源队列">​</a></h3>
<p><code>Queue</code>是<code>Volcano</code>调度系统中的核心概念，用于管理和分配集群资源。
它充当了<strong>资源池</strong>的角色，允许管理员将集群资源划分给不同的用户组或应用场景。该自定义资源可以很好地用于多租户场景下的资源隔离。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-的作用>Queue 的作用<a href=#queue-的作用 class=hash-link aria-label="Direct link to Queue 的作用" title="Direct link to Queue 的作用">​</a></h4>
<ol>
<li>
<p><strong>资源隔离与划分</strong></p>
<ul>
<li>将集群资源划分给不同的用户组或业务线</li>
<li>防止一个应用或用户组消耗过多资源影响其他应用</li>
</ul>
</li>
<li>
<p><strong>资源配额与限制</strong></p>
<ul>
<li>为队列设置资源上限（<code>capability</code>）</li>
<li>控制队列可以使用的最大<code>CPU</code>、内存、<code>GPU</code>等资源量</li>
</ul>
</li>
<li>
<p><strong>优先级和权重管理</strong></p>
<ul>
<li>通过<code>weight</code>属性设置队列的相对重要性</li>
<li>当资源竞争时，根据权重比例分配资源</li>
</ul>
</li>
<li>
<p><strong>资源回收策略</strong></p>
<ul>
<li>通过<code>reclaimable</code>属性控制队列资源是否可被回收（被其他队列借用）</li>
<li>当集群资源紧张时，决定哪些队列的资源可以被抢占</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-配置示例>Queue 配置示例<a href=#queue-配置示例 class=hash-link aria-label="Direct link to Queue 配置示例" title="Direct link to Queue 配置示例">​</a></h4>
<p>下面是一个定义三个不同队列的示例，分别用于生产、开发和测试环境：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 高权重，资源竞争时获得更多资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源不可被回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 100 核 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 500Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 500Gi 内存</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 10 个 GPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> development</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">         </span><span class="token comment" style=color:#8292a2;font-style:italic># 中等权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源可被回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 50 核 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 200Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 200Gi 内存</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> testing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">         </span><span class="token comment" style=color:#8292a2;font-style:italic># 低权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源可被回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 20 核 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 100Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 100Gi 内存</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用-queue-的方法>使用 Queue 的方法<a href=#使用-queue-的方法 class=hash-link aria-label="Direct link to 使用 Queue 的方法" title="Direct link to 使用 Queue 的方法">​</a></h4>
<ol>
<li>
<p><strong>在 Pod 中指定队列</strong></p>
<p>通过注解指定：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">   </span><span class="token key atrule">volcano.sh/queue-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"production"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>在 PodGroup 中指定队列</strong></p>
<p>直接在<code>spec</code>中指定：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定使用 production 队列</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>在 Job 中指定队列</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定使用 production 队列</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-的实际应用场景>Queue 的实际应用场景<a href=#queue-的实际应用场景 class=hash-link aria-label="Direct link to Queue 的实际应用场景" title="Direct link to Queue 的实际应用场景">​</a></h4>
<ol>
<li>
<p><strong>多租户环境</strong></p>
<ul>
<li>为不同部门或团队创建独立队列</li>
<li>确保每个部门都有公平的资源分配</li>
</ul>
</li>
<li>
<p><strong>优先级划分</strong></p>
<ul>
<li>为关键业务创建高权重队列</li>
<li>为非关键任务创建可回收队列</li>
</ul>
</li>
<li>
<p><strong>资源限制</strong></p>
<ul>
<li>防止单个应用消耗过多集群资源</li>
<li>为不同类型的工作负载设置适当的资源上限</li>
</ul>
</li>
</ol>
<p><code>Queue</code>机制是<code>Volcano</code>实现多租户资源管理和公平调度的关键组件，它使得集群管理员可以更精细地控制资源分配策略，提高集群资源利用率和用户满意度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=job-资源任务>Job 资源任务<a href=#job-资源任务 class=hash-link aria-label="Direct link to Job 资源任务" title="Direct link to Job 资源任务">​</a></h3>
<p><code>Volcano Job</code>（简称 <code>vcjob</code>）是 <code>Volcano</code> 提供的一种高级作业资源类型，扩展了 <code>Kubernetes</code> 原生的 <code>Job</code> 资源，为高性能计算和批处理场景提供了更丰富的功能。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=job-的作用>Job 的作用<a href=#job-的作用 class=hash-link aria-label="Direct link to Job 的作用" title="Direct link to Job 的作用">​</a></h4>
<ol>
<li>
<p><strong>多任务类型支持</strong></p>
<ul>
<li>支持在一个作业中定义多种不同类型的任务（<code>task</code>）</li>
<li>每种任务类型可以有不同的镜像、资源需求和副本数</li>
</ul>
</li>
<li>
<p><strong>生命周期管理</strong></p>
<ul>
<li>支持在作业生命周期的不同阶段执行特定命令</li>
<li>包括启动前、运行中、完成后等阶段</li>
</ul>
</li>
<li>
<p><strong>高级调度策略</strong></p>
<ul>
<li>支持指定最小可用数量（<code>minAvailable</code>）</li>
<li>支持指定队列、优先级和调度策略</li>
</ul>
</li>
<li>
<p><strong>容错和恢复机制</strong></p>
<ul>
<li>提供多种重启策略（<code>RestartPolicy</code>）</li>
<li>支持在任务失败时的不同处理方式</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-job-配置示例>Volcano Job 配置示例<a href=#volcano-job-配置示例 class=hash-link aria-label="Direct link to Volcano Job 配置示例" title="Direct link to Volcano Job 配置示例">​</a></h4>
<p>下面是一个<code>TensorFlow</code>分布式训练任务的<code>Volcano Job</code>配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">jobs</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">policies</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">event</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodEvicted</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RestartJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">event</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodFailed</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RestartJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ps</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/ps.py"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">gpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/worker.py"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 8Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-job-的特性>Volcano Job 的特性<a href=#volcano-job-的特性 class=hash-link aria-label="Direct link to Volcano Job 的特性" title="Direct link to Volcano Job 的特性">​</a></h4>
<ol>
<li>
<p><strong>多任务类型</strong></p>
<ul>
<li>在上面的示例中，定义了两种任务类型：<code>ps</code>（参数服务器）和 <code>worker</code>（工作节点）</li>
<li>每种类型有不同的副本数和资源需求</li>
</ul>
</li>
<li>
<p><strong>事件处理策略</strong></p>
<ul>
<li>定义了当 <code>Pod</code> 被驱逐或失败时重启整个作业的策略</li>
<li>可以根据不同事件类型执行不同的操作</li>
</ul>
</li>
<li>
<p><strong>队列和调度器指定</strong></p>
<ul>
<li>指定使用 <code>volcano</code> 调度器和 <code>ml-jobs</code> 队列</li>
<li>确保作业在正确的资源池中运行</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-job-的实际应用场景>Volcano Job 的实际应用场景<a href=#volcano-job-的实际应用场景 class=hash-link aria-label="Direct link to Volcano Job 的实际应用场景" title="Direct link to Volcano Job 的实际应用场景">​</a></h4>
<ol>
<li>
<p><strong>分布式机器学习</strong></p>
<ul>
<li><code>TensorFlow</code>、<code>PyTorch</code> 等分布式训练任务</li>
<li>支持参数服务器和工作节点的协调调度</li>
</ul>
</li>
<li>
<p><strong>大数据处理</strong></p>
<ul>
<li><code>Spark</code>、<code>Flink</code> 等大数据处理框架</li>
<li>支持<code>Master</code>和<code>Worker</code>节点的组织管理</li>
</ul>
</li>
<li>
<p><strong>MPI 并行计算</strong></p>
<ul>
<li>高性能计算和科学模拟</li>
<li>支持多节点协同计算</li>
</ul>
</li>
</ol>
<p><code>Volcano Job</code> 为复杂的分布式工作负载提供了完整的生命周期管理和调度能力，是 <code>Volcano</code> 系统中最强大的资源类型之一。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-资源组>PodGroup 资源组<a href=#podgroup-资源组 class=hash-link aria-label="Direct link to PodGroup 资源组" title="Direct link to PodGroup 资源组">​</a></h3>
<p><code>PodGroup</code> 是 <code>Volcano</code> 中实现<code>Gang Scheduling</code>的核心资源对象，它将一组相关的 <code>Pod</code> 视为一个整体进行调度。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-的作用>PodGroup 的作用<a href=#podgroup-的作用 class=hash-link aria-label="Direct link to PodGroup 的作用" title="Direct link to PodGroup 的作用">​</a></h4>
<ol>
<li>
<p><strong>整体调度</strong></p>
<ul>
<li>确保一组相关的 <code>Pod</code> 要么全部调度成功，要么全部不调度</li>
<li>防止部分 <code>Pod</code> 调度成功而其他失败导致资源浪费</li>
</ul>
</li>
<li>
<p><strong>资源预留</strong></p>
<ul>
<li>可以为 <code>PodGroup</code> 设置最小成员数（<code>minMember</code>）</li>
<li>当可用资源不足以调度最小成员数时，整个组将等待而不是部分调度</li>
</ul>
</li>
<li>
<p><strong>状态跟踪</strong></p>
<ul>
<li>提供 <code>PodGroup</code> 的整体状态信息</li>
<li>包括已调度数量、运行状态等</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-配置示例>PodGroup 配置示例<a href=#podgroup-配置示例 class=hash-link aria-label="Direct link to PodGroup 配置示例" title="Direct link to PodGroup 配置示例">​</a></h4>
<p>下面是一个基本的 <code>PodGroup</code> 定义示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tf</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">group</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 最小需要 4 个 Pod 同时调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">jobs  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minResources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最小资源需求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 16Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用-podgroup-的方法>使用 PodGroup 的方法<a href=#使用-podgroup-的方法 class=hash-link aria-label="Direct link to 使用 PodGroup 的方法" title="Direct link to 使用 PodGroup 的方法">​</a></h4>
<ol>
<li>
<p><strong>直接创建 PodGroup 资源</strong></p>
<p>先创建 <code>PodGroup</code>，然后在 <code>Pod</code> 中引用它：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tf</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">worker</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/pod-group</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"tf-training-group"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 引用 PodGroup 名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano  </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用 Volcano 调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">gpu</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>通过 Volcano Job 自动创建</strong></p>
<p><code>Volcano Job</code> 会自动创建并管理 <code>PodGroup</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">jobs</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-的实际应用场景>PodGroup 的实际应用场景<a href=#podgroup-的实际应用场景 class=hash-link aria-label="Direct link to PodGroup 的实际应用场景" title="Direct link to PodGroup 的实际应用场景">​</a></h4>
<ol>
<li>
<p><strong>分布式机器学习</strong></p>
<ul>
<li>确保参数服务器和工作节点同时启动</li>
<li>避免资源浪费和训练任务失败</li>
</ul>
</li>
<li>
<p><strong>大数据处理</strong></p>
<ul>
<li>确保<code>Spark</code>或<code>Flink</code>集群的所有组件同时启动</li>
<li>提高数据处理效率</li>
</ul>
</li>
<li>
<p><strong>高性能计算</strong></p>
<ul>
<li>为<code>MPI</code>等高性能计算任务提供同步启动能力</li>
<li>确保计算节点的一致性</li>
</ul>
</li>
</ol>
<p><code>PodGroup</code> 是 <code>Volcano</code> 实现<code>Gang Scheduling</code>的基础，它使得复杂的分布式工作负载可以更可靠地运行在 <code>Kubernetes</code> 集群上。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://volcano.sh/ target=_blank rel="noopener noreferrer">https://volcano.sh/</a></li>
<li><a href=https://ericam.top/posts/understand-volcano-scheduler-from-zero/ target=_blank rel="noopener noreferrer">https://ericam.top/posts/understand-volcano-scheduler-from-zero/</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-annotations><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano注解详解</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#基本介绍 class="table-of-contents__link toc-highlight">基本介绍</a><ul><li><a href=#使用广泛 class="table-of-contents__link toc-highlight">使用广泛</a><li><a href=#核心组件 class="table-of-contents__link toc-highlight">核心组件</a><li><a href=#组件交互关系 class="table-of-contents__link toc-highlight">组件交互关系</a></ul><li><a href=#scheduler class="table-of-contents__link toc-highlight">Scheduler</a><ul><li><a href=#kubernetes-scheduler class="table-of-contents__link toc-highlight">Kubernetes Scheduler</a><li><a href=#volcano-scheduler class="table-of-contents__link toc-highlight">Volcano Scheduler</a><li><a href=#taskpod状态转换 class="table-of-contents__link toc-highlight">Task/Pod状态转换</a></ul><li><a href=#volcano自定义资源 class="table-of-contents__link toc-highlight">Volcano自定义资源</a><ul><li><a href=#queue-资源队列 class="table-of-contents__link toc-highlight">Queue 资源队列</a><li><a href=#job-资源任务 class="table-of-contents__link toc-highlight">Job 资源任务</a><li><a href=#podgroup-资源组 class="table-of-contents__link toc-highlight">PodGroup 资源组</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>