<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano介绍" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano介绍 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-introduction><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano介绍 | John's Blog"><meta data-rh=true name=description content=Volcano是基于Kubernetes的高性能批处理系统，为机器学习、深度学习等大数据应用提供高级调度功能。><meta data-rh=true property=og:description content=Volcano是基于Kubernetes的高性能批处理系统，为机器学习、深度学习等大数据应用提供高级调度功能。><meta data-rh=true name=keywords content="Volcano,Kubernetes,调度器,Gang Scheduling,批处理,AI训练,机器学习,深度学习,Queue,PodGroup"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-introduction><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-introduction hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-introduction hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.96de5670.css><script src=/assets/js/runtime~main.69a7861b.js defer></script><script src=/assets/js/main.29638405.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-introduction>Volcano介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-examples>Volcano使用示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano注解介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job>Volcano Queue&Job详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-actions-plugins>Volcano Actions&Plugins详解</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/docker-containerd-commands>Docker和Containerd常用命令对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/kubernetes-kind>使用Kubernetes Kind搭建本地测试集群</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano介绍</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=基本介绍>基本介绍<a href=#基本介绍 class=hash-link aria-label="Direct link to 基本介绍" title="Direct link to 基本介绍">​</a></h2>
<p><a href=https://volcano.sh/zh/docs/ target=_blank rel="noopener noreferrer">Volcano</a> 是一个基于<code>Kubernetes</code>的批处理平台，提供了机器学习、深度学习、生物信息学、基因组学及其他大数据应用所需要而<code>Kubernetes</code>当前缺失的一系列特性，提供了高性能任务调度引擎、高性能异构芯片管理、高性能任务运行管理等通用计算能力。</p>
<p><img decoding=async loading=lazy alt=Volcano架构 src=/assets/images/arch_2-b7275156fa67c4f872b658ad99877b5c.PNG width=1217 height=593 class=img_ev3q></p>
<p>相较于原生的调度器，<code>Volcano</code>具有的显著特点有：</p>
<ul>
<li>
<p><strong>支持 <code>Gang Scheduling</code></strong></p>
<p>对于批量作业的调度，容易碰到死锁的问题，比如两个作业都需要同时运行 10 个 Pod 才能启动，当两个作业同时提交时，可能都只有部分 Pod 被调度，两个作业都无法正常运行，而处于互相等待状态。<code>Gang Scheduling</code> 就是为了解决这个问题。</p>
</li>
<li>
<p><strong>调度队列</strong></p>
<p>配置不同的调度队列，能够实现对资源的抢占、配额的控制等。</p>
</li>
<li>
<p><strong>硬件感知</strong></p>
<p><code>Numa</code>、<code>GPU</code>等硬件资源的感知，能够让<code>Pod</code>对硬件资源更高效的使用。</p>
</li>
</ul>
<p><code>Volcano</code>是在 <code>Kubernetes</code>原生调度能力的基础上进行的扩展和优化，因此，对于基本的 <code>nodeSelector</code>、<code>nodeAffinity</code>等也是支持的。同时也支持 <code>Extended Resource</code>，这点对于<code>GPU</code>、<code>IB</code>网卡等资源的在调度层面的感知非常重要。</p>
<blockquote>
<p><code>Volcano</code>是业界首个云原生批量计算项目，<code>2019</code>年由华为云捐献给云原生计算基金会（<code>CNCF</code>），也是<code>CNCF</code>首个和唯一的孵化级容器批量计算项目。它源自于华为云AI容器，在支撑华为云一站式AI开发平台<code>ModelArts</code>、容器服务<code>CCI</code>等服务稳定运行中发挥重要作用。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=核心组件>核心组件<a href=#核心组件 class=hash-link aria-label="Direct link to 核心组件" title="Direct link to 核心组件">​</a></h3>
<p><code>Volcano</code>由以下几个核心组件组成，各自承担不同的功能职责：</p>
<ol>
<li>
<p><strong><code>Volcano Controller Manager</code></strong>：负责管理<code>Volcano</code>自定义资源的生命周期，监控和处理<code>Job</code>、<code>Queue</code>、<code>PodGroup</code>等资源的状态变化。</p>
</li>
<li>
<p><strong><code>Volcano Scheduler</code></strong>：实现高级调度功能，如<code>Gang Scheduling</code>（组调度）、队列调度和优先级调度，通过插件化架构提供灵活的调度策略配置。</p>
</li>
<li>
<p><strong><code>Volcano Admission</code></strong>：验证<code>Volcano</code>资源对象的合法性，为资源对象设置默认值，实现准入控制，确保提交的作业符合系统策略。</p>
</li>
<li>
<p><strong><code>Volcano MutatingAdmission</code></strong>：修改资源对象的配置，如添加标签、注解等，自动注入环境变量和配置信息。</p>
</li>
<li>
<p><strong><code>Volcano Agent</code></strong>（可选组件）：在节点上收集资源使用情况和硬件信息，为调度器提供更精确的节点资源信息，支持 GPU、FPGA 等异构资源的管理。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=组件交互关系>组件交互关系<a href=#组件交互关系 class=hash-link aria-label="Direct link to 组件交互关系" title="Direct link to 组件交互关系">​</a></h3>
<p>下图展示了<code>Volcano</code>各组件之间的交互关系及数据流向：</p>
<!-- -->
<p><code>Volcano</code>的各个组件之间通过清晰的职责划分和有效的协作实现了完整的调度系统：</p>
<ol>
<li>
<p><strong>用户提交流程</strong>：用户提交作业→<code>Admission</code>验证 →<code>Controller</code>处理 →<code>Scheduler</code>调度 →<code>Kubelet</code>执行</p>
</li>
<li>
<p><strong>状态监控与管理</strong>：
-<code>Controller Manager</code>监控所有<code>Volcano</code>自定义资源的状态变化</p>
<ul>
<li>根据资源状态变化，触发相应的事件处理</li>
<li>当需要重调度或清理资源时，通知<code>Scheduler</code>进行相应操作</li>
</ul>
</li>
<li>
<p><strong>调度决策过程</strong>：
-<code>Scheduler</code>根据<code>Queue</code>配置和系统状态，为<code>PodGroup</code>分配资源</p>
<ul>
<li>通过插件化架构，实现不同的调度策略和算法</li>
<li>支持<code>Gang Scheduling</code>，确保相关联的<code>Pod</code>要么全部调度成功，要么全部失败</li>
</ul>
</li>
<li>
<p><strong>资源信息收集</strong>：
-<code>Agent</code>(如果启用) 提供节点资源信息，辅助调度决策</p>
<ul>
<li>特别是对于 GPU、FPGA 等异构资源，提供更精确的资源状态</li>
</ul>
</li>
<li>
<p><strong>资源对象之间的关系</strong>：
-<code>Job</code>包含多个<code>Task</code>，每个<code>Task</code>对应一组相同角色的<code>Pod</code>
-<code>PodGroup</code>作为调度的基本单位，表示一组需要同时调度的<code>Pod</code>
-<code>Queue</code>容纳多个<code>PodGroup</code>，并控制这些<code>PodGroup</code>的资源分配和调度策略</p>
</li>
</ol>
<p>这种组件化设计使<code>Volcano</code>能够灵活应对不同的工作负载需求，并且可以通过扩展插件来增强系统能力。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=scheduler>Scheduler<a href=#scheduler class=hash-link aria-label="Direct link to Scheduler" title="Direct link to Scheduler">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=kubernetes-scheduler>Kubernetes Scheduler<a href=#kubernetes-scheduler class=hash-link aria-label="Direct link to Kubernetes Scheduler" title="Direct link to Kubernetes Scheduler">​</a></h3>
<p><code>kubernetes</code>当然有默认的pod调度器，但是其并不适应AI作业任务需求。在多机训练任务中，一个AI作业可能需要同时创建上千个甚至上万个pod，而只有当所有pod当创建完成后，AI作业才能开始运行，而如果有几个pod创建失败，已经创建成功的pod就应该退出并释放资源，否则便会产生资源浪费的情况。因此Ai作业的pod调度应该遵循<code>All or nothing</code>的理念，即要不全部调度成功，否则应一个也不调度。这便是<code>Volcano</code>项目的由来（前身是<code>kube-batch</code>项目），接下来便来介绍<code>Volcano</code>的调度。</p>
<p><img decoding=async loading=lazy src=/assets/images/20240330125540-1d59d400b42ca8ba735cb27769a71962.png width=1829 height=631 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-scheduler>Volcano Scheduler<a href=#volcano-scheduler class=hash-link aria-label="Direct link to Volcano Scheduler" title="Direct link to Volcano Scheduler">​</a></h3>
<p>值得注意的是，原生 <code>Kubernetes</code> 调度器（<code>kube-scheduler</code>）没有内置提供完整的 <code>Gang Scheduling</code>（组调度）能力。<code>Gang Scheduling</code> 是指将一组相关的任务作为一个整体进行调度，要么全部调度成功，要么全部不调度。</p>
<p><code>Kubernetes</code> 默认调度器主要关注单个 <code>Pod</code> 的调度，它会逐个处理 <code>Pod</code>，而不会考虑 <code>Pod</code> 之间的相互依赖关系或者需要同时调度的需求。这种设计对于无状态应用和独立工作负载很有效，但对于需要多个 <code>Pod</code> 协同工作的场景（如分布式机器学习、大数据处理等）就显得不足。</p>
<p><code>Volcano</code> 通过实现 <code>Gang Scheduling</code> 能力，确保一组相关的 <code>Pod</code> 要么全部被调度成功，要么全部不被调度，避免资源浪费和死锁情况。这是 <code>Volcano</code> 相对于原生 <code>Kubernetes</code> 调度器的一个关键优势。</p>
<p><img decoding=async loading=lazy src=/assets/images/zh-cn_image_0000002065638558-3f8e26a4366a07fed3803bfbb3056ed7.png width=1256 height=503 class=img_ev3q></p>
<p><code>Volcano Scheduler</code>是负责<code>Pod</code>调度的组件，它由一系列<code>action</code>和<code>plugin</code>组成。<code>action</code>定义了调度各环节中需要执行的动作；<code>plugin</code>根据不同场景提供了<code>action</code>中算法的具体实现细节。<code>Volcano Scheduler</code>具有高度的可扩展性，您可以根据需要实现自己的<code>action</code>和<code>plugin</code>。</p>
<p><code>Volcano Scheduler</code>的工作流程如下：</p>
<ol>
<li>客户端提交的<code>Job</code>被调度器识别到并缓存起来。</li>
<li>周期性开启会话（<code>Session</code>），一个调度周期开始。</li>
<li>将没有被调度的<code>Job</code>发送到会话的待调度队列中。</li>
<li>遍历所有的待调度<code>Job</code>，按照定义的次序依次执行<code>enqueue</code>、<code>allocate</code>、<code>preempt</code>、<code>reclaim</code>、<code>backfill</code>等动作，为每个<code>Job</code>找到一个最合适的节点。将该<code>Job</code>绑定到这个节点。<code>action</code>中执行的具体算法逻辑取决于注册的<code>plugin</code>中各函数的实现。</li>
<li>关闭本次会话。</li>
</ol>
<p>具体流程、<code>Actions</code>和<code>Plugins</code>介绍请参考：</p>
<ul>
<li><a href=https://volcano.sh/zh/docs/schduler_introduction target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/schduler_introduction</a></li>
<li><a href=https://volcano.sh/zh/docs/actions target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/actions</a></li>
<li><a href=https://volcano.sh/zh/docs/plugins target=_blank rel="noopener noreferrer">https://volcano.sh/zh/docs/plugins</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=taskpod状态转换>Task/Pod状态转换<a href=#taskpod状态转换 class=hash-link aria-label="Direct link to Task/Pod状态转换" title="Direct link to Task/Pod状态转换">​</a></h3>
<p><img decoding=async loading=lazy alt=Task/Pod状态转换 src=/assets/images/v2-0a38d4ee885e17ce828f581eab1d795b_1440w-d24ea98db1c11cbfbb5fee34d334fd54.jpg width=1319 height=611 class=img_ev3q></p>
<p><code>Volcano</code>在<code>Pod</code>和<code>Pod</code>的状态方面增加了很多状态:</p>
<ul>
<li>图中<strong>蓝色部分</strong>为<code>Kubernetes</code>自带的状态。</li>
<li><strong>绿色部分</strong>是<code>session</code>级别的状态，一个调度周期，<code>Volcano Scheduler</code>会创建一个<code>session</code>，它只在调度周期内发挥作用，一旦过了调度周期，这几个状态它是失效的。</li>
<li><strong>黄色部分</strong>的状态是放在<code>Cache</code>内的。</li>
</ul>
<p>我们加这些状态的目的是减少调度和API之间的一个交互，从而来优化调度性能。</p>
<p><code>Pod</code>的这些状态为调度器提供了更多优化的可能。例如，当进行<code>Pod</code>驱逐时，驱逐在<code>Binding</code>和<code>Bound</code>状态的<code>Pod</code>要比较驱逐<code>Running</code>状态的<code>Pod</code>的代价要小；并且状态都是记录在<code>Volcano</code>调度内部，减少了与<code>kube-apiserver</code>的通信。但目前<code>Volcano</code>调度器仅使用了状态的部分功能，比如现在的<code>preemption/reclaim</code>仅会驱逐<code>Running</code>状态下的<code>Pod</code>；这主要是由于分布式系统中很难做到完全的状态同步，在驱逐<code>Binding</code>和<code>Bound</code>状态的<code>Pod</code>会有很多的状态竞争。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano自定义资源>Volcano自定义资源<a href=#volcano自定义资源 class=hash-link aria-label="Direct link to Volcano自定义资源" title="Direct link to Volcano自定义资源">​</a></h2>
<ul>
<li>
<p><code>Pod</code>组（<code>PodGroup</code>）：<code>Pod</code>组是<code>Volcano</code>自定义资源类型，代表一组强关联<code>Pod</code>的集合，主要用于批处理工作负载场景，比如<code>Tensorflow</code>中的一组<code>ps</code>和<code>worker</code>。这主要解决了<code>Kubernetes</code>原生调度器中单个<code>Pod</code>调度的限制。</p>
</li>
<li>
<p>队列（<code>Queue</code>）：容纳一组<code>PodGroup</code>的队列，也是该组<code>PodGroup</code>获取集群资源的划分依据。它允许用户根据业务需求或优先级，将作业分组到不同的队列中。
<img decoding=async loading=lazy src=/assets/images/20240420124730-18512109cb3dbe39d874ba9c3d6150ba.png width=1054 height=270 class=img_ev3q></p>
</li>
<li>
<p>作业（<code>Volcano Job</code>，简称<code>vcjob</code>）：<code>Volcano</code>自定义的<code>Job</code>资源类型，它扩展了<code>Kubernetes</code>的<code>Job</code>资源。区别于<code>Kubernetes Job</code>，<code>vcjob</code>提供了更多高级功能，如可指定调度器、支持最小运行<code>Pod</code>数、支持<code>task</code>、支持生命周期管理、支持指定队列、支持优先级调度等。<code>Volcano Job</code>更加适用于机器学习、大数据、科学计算等高性能计算场景。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-资源组>PodGroup 资源组<a href=#podgroup-资源组 class=hash-link aria-label="Direct link to PodGroup 资源组" title="Direct link to PodGroup 资源组">​</a></h3>
<p><code>PodGroup</code> 是 <code>Volcano</code> 中实现<code>Gang Scheduling</code>的核心资源对象，它将一组相关的 <code>Pod</code> 视为一个整体进行调度。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-的作用>PodGroup 的作用<a href=#podgroup-的作用 class=hash-link aria-label="Direct link to PodGroup 的作用" title="Direct link to PodGroup 的作用">​</a></h4>
<ol>
<li>
<p><strong>整体调度</strong></p>
<ul>
<li>确保一组相关的 <code>Pod</code> 要么全部调度成功，要么全部不调度</li>
<li>防止部分 <code>Pod</code> 调度成功而其他失败导致资源浪费</li>
</ul>
</li>
<li>
<p><strong>资源预留</strong></p>
<ul>
<li>可以为 <code>PodGroup</code> 设置最小成员数（<code>minMember</code>）</li>
<li>当可用资源不足以调度最小成员数时，整个组将等待而不是部分调度</li>
</ul>
</li>
<li>
<p><strong>状态跟踪</strong></p>
<ul>
<li>提供 <code>PodGroup</code> 的整体状态信息</li>
<li>包括已调度数量、运行状态等</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-配置示例>PodGroup 配置示例<a href=#podgroup-配置示例 class=hash-link aria-label="Direct link to PodGroup 配置示例" title="Direct link to PodGroup 配置示例">​</a></h4>
<p>下面是一个基本的 <code>PodGroup</code> 定义示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tf</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">group</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最小需要 4 个 Pod 同时调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">jobs  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minResources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最小资源需求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 16Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用-podgroup-的方法>使用 PodGroup 的方法<a href=#使用-podgroup-的方法 class=hash-link aria-label="Direct link to 使用 PodGroup 的方法" title="Direct link to 使用 PodGroup 的方法">​</a></h4>
<ol>
<li>
<p><strong>直接创建 PodGroup 资源</strong></p>
<p>先创建 <code>PodGroup</code>，然后在 <code>Pod</code> 中引用它：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tf</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">worker</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">volcano.sh/pod-group</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"tf-training-group"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 引用 PodGroup 名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano  </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用 Volcano 调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">gpu</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>通过 Volcano Job 自动创建</strong></p>
<p><code>Volcano Job</code> 会自动创建并管理 <code>PodGroup</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">jobs</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=podgroup-的实际应用场景>PodGroup 的实际应用场景<a href=#podgroup-的实际应用场景 class=hash-link aria-label="Direct link to PodGroup 的实际应用场景" title="Direct link to PodGroup 的实际应用场景">​</a></h4>
<ol>
<li>
<p><strong>分布式机器学习</strong></p>
<ul>
<li>确保参数服务器和工作节点同时启动</li>
<li>避免资源浪费和训练任务失败</li>
</ul>
</li>
<li>
<p><strong>大数据处理</strong></p>
<ul>
<li>确保<code>Spark</code>或<code>Flink</code>集群的所有组件同时启动</li>
<li>提高数据处理效率</li>
</ul>
</li>
<li>
<p><strong>高性能计算</strong></p>
<ul>
<li>为<code>MPI</code>等高性能计算任务提供同步启动能力</li>
<li>确保计算节点的一致性</li>
</ul>
</li>
</ol>
<p><code>PodGroup</code> 是 <code>Volcano</code> 实现<code>Gang Scheduling</code>的基础，它使得复杂的分布式工作负载可以更可靠地运行在 <code>Kubernetes</code> 集群上。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=queue-资源队列>Queue 资源队列<a href=#queue-资源队列 class=hash-link aria-label="Direct link to Queue 资源队列" title="Direct link to Queue 资源队列">​</a></h3>
<p><code>Queue</code>是<code>Volcano</code>调度系统中的核心概念，用于管理和分配集群资源。
它充当了资源池的角色，允许管理员将集群资源划分给不同的用户组或应用场景。该自定义资源可以很好地用于多租户场景下的资源隔离。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-的作用>Queue 的作用<a href=#queue-的作用 class=hash-link aria-label="Direct link to Queue 的作用" title="Direct link to Queue 的作用">​</a></h4>
<ol>
<li>
<p><strong>资源隔离与划分</strong></p>
<ul>
<li>将集群资源划分给不同的用户组或业务线</li>
<li>防止一个应用或用户组消耗过多资源影响其他应用</li>
</ul>
</li>
<li>
<p><strong>资源配额与限制</strong></p>
<ul>
<li>为队列设置资源上限（<code>capability</code>）</li>
<li>控制队列可以使用的最大<code>CPU</code>、内存、<code>GPU</code>等资源量</li>
</ul>
</li>
<li>
<p><strong>优先级和权重管理</strong></p>
<ul>
<li>通过<code>weight</code>属性设置队列的相对重要性</li>
<li>当资源竞争时，根据权重比例分配资源</li>
</ul>
</li>
<li>
<p><strong>资源回收策略</strong></p>
<ul>
<li>通过<code>reclaimable</code>属性控制队列资源是否可被回收（被其他队列借用）</li>
<li>当集群资源紧张时，决定哪些队列的资源可以被抢占</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-配置示例>Queue 配置示例<a href=#queue-配置示例 class=hash-link aria-label="Direct link to Queue 配置示例" title="Direct link to Queue 配置示例">​</a></h4>
<p>下面是一个定义三个不同队列的示例，分别用于生产、开发和测试环境：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 高权重，资源竞争时获得更多资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源不可被回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 100 核 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 500Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 500Gi 内存</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 10 个 GPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> development</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 中等权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">   </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源可被回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 50 核 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 200Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 200Gi 内存</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> testing</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 低权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">   </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源可被回收</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 20 核 CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 100Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最多使用 100Gi 内存</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=使用-queue-的方法>使用 Queue 的方法<a href=#使用-queue-的方法 class=hash-link aria-label="Direct link to 使用 Queue 的方法" title="Direct link to 使用 Queue 的方法">​</a></h4>
<ol>
<li>
<p><strong>在 Pod 中指定队列</strong></p>
<p>通过注解指定：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">   </span><span class="token key atrule">volcano.sh/queue-name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"production"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>在 PodGroup 中指定队列</strong></p>
<p>直接在<code>spec</code>中指定：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodGroup</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minMember</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定使用 production 队列</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>在 Job 中指定队列</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定使用 production 队列</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-的实际应用场景>Queue 的实际应用场景<a href=#queue-的实际应用场景 class=hash-link aria-label="Direct link to Queue 的实际应用场景" title="Direct link to Queue 的实际应用场景">​</a></h4>
<ol>
<li>
<p><strong>多租户环境</strong></p>
<ul>
<li>为不同部门或团队创建独立队列</li>
<li>确保每个部门都有公平的资源分配</li>
</ul>
</li>
<li>
<p><strong>优先级划分</strong></p>
<ul>
<li>为关键业务创建高权重队列</li>
<li>为非关键任务创建可回收队列</li>
</ul>
</li>
<li>
<p><strong>资源限制</strong></p>
<ul>
<li>防止单个应用消耗过多集群资源</li>
<li>为不同类型的工作负载设置适当的资源上限</li>
</ul>
</li>
</ol>
<p><code>Queue</code>机制是<code>Volcano</code>实现多租户资源管理和公平调度的关键组件，它使得集群管理员可以更精细地控制资源分配策略，提高集群资源利用率和用户满意度。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=queue-对象详解>Queue 对象详解<a href=#queue-对象详解 class=hash-link aria-label="Direct link to Queue 对象详解" title="Direct link to Queue 对象详解">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> scheduling.volcano.sh/v1beta1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">queue  </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default   </span><span class="token comment" style=color:#8292a2;font-style:italic># 命名空间，可选</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">              </span><span class="token comment" style=color:#8292a2;font-style:italic># 标签，可选</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> production   </span><span class="token comment" style=color:#8292a2;font-style:italic># 自定义标签</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">         </span><span class="token comment" style=color:#8292a2;font-style:italic># 注释，可选</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">description</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Production workloads queue"</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 自定义注释</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列权重，影响资源分配优先级，数值越大优先级越高</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">capability</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">          </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列资源容量限制（上限）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain">           </span><span class="token comment" style=color:#8292a2;font-style:italic># CPU资源上限，单位为核心数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 100Gi      </span><span class="token comment" style=color:#8292a2;font-style:italic># 内存资源上限</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># GPU资源上限</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">huawei.com/npu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># NPU资源上限（如华为Ascend NPU）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">ephemeral-storage</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 500Gi  </span><span class="token comment" style=color:#8292a2;font-style:italic># 临时存储资源上限</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">deserved</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 应得资源量（多队列竞争时的资源分配基准）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>80</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 应得的CPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 80Gi       </span><span class="token comment" style=color:#8292a2;font-style:italic># 应得的内存资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 应得的GPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">guarantee</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">           </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列保障资源，即使在资源紧张情况下也会保证分配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 保障的CPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 50Gi       </span><span class="token comment" style=color:#8292a2;font-style:italic># 保障的内存资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 保障的GPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minResources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列最小资源，队列启动时必须满足的最小资源需求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># 最小CPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 10Gi       </span><span class="token comment" style=color:#8292a2;font-style:italic># 最小内存资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">maxResources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列最大资源，队列能够使用的最大资源上限</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>200</span><span class="token plain">           </span><span class="token comment" style=color:#8292a2;font-style:italic># 最大CPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 200Gi      </span><span class="token comment" style=color:#8292a2;font-style:italic># 最大内存资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 最大GPU资源量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">reclaimable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 是否允许回收资源，设为true时允许其他队列在空闲时借用该队列资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">state</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Open          </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列状态，可选值：Open(开放)、Closed(关闭)、Unknown(未知)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">hierarchy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> root.production.team</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">a  </span><span class="token comment" style=color:#8292a2;font-style:italic># 层级队列结构，定义队列在层级结构中的位置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority   </span><span class="token comment" style=color:#8292a2;font-style:italic># 优先级类名，引用集群中定义的PriorityClass</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 是否允许被抢占，设为true时允许高优先级队列抢占该队列资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">jobOrderPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> FIFO </span><span class="token comment" style=color:#8292a2;font-style:italic># 作业排序策略，可选值：FIFO(先进先出)、Priority(按优先级)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">timeToLiveSeconds</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3600</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 队列生存时间，超时后自动清理，单位为秒</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">resourceLimitPercent</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>80</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 资源限制百分比，控制队列可使用的集群资源比例</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">podGroupMinAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">   </span><span class="token comment" style=color:#8292a2;font-style:italic># PodGroup最小可用数，指定该队列中的PodGroup至少需要多少Pod可用</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">shareWeight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">       </span><span class="token comment" style=color:#8292a2;font-style:italic># 共享权重，影响队列在共享资源时的优先级</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=三级资源配置机制>三级资源配置机制<a href=#三级资源配置机制 class=hash-link aria-label="Direct link to 三级资源配置机制" title="Direct link to 三级资源配置机制">​</a></h5>
<p><code>Volcano</code>的<code>Queue</code>资源对象采用了一个灵活的三级资源配置机制，这三个级别分别是：<code>capability</code>（资源上限）、<code>deserved</code>（应得资源）和<code>guarantee</code>（保障资源）。这种设计允许集群管理员精细控制资源分配，特别适合多租户环境下的资源管理。</p>
<p><strong>1. capability（资源上限）</strong></p>
<p><strong>定义</strong>：队列能够使用的资源上限，队列中的所有作业使用的资源总和不能超过这个上限。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>代表队列能够使用的最大资源量</li>
<li>设置了资源使用的硬限制，防止单个队列过度消耗集群资源</li>
<li>可以针对多种资源类型设置（<code>CPU</code>、内存、<code>GPU</code>等）</li>
</ul>
<p><strong>示例场景</strong>： 假设一个生产队列设置了<code>capability.cpu=100</code>，那么即使集群有更多空闲资源，该队列中的所有作业使用的<code>CPU</code>总和也不能超过<code>100</code>核。</p>
<p><strong>2. deserved（应得资源）</strong></p>
<p><strong>定义</strong>：队列在资源竞争情况下应该获得的资源量，是资源分配和回收的基准线。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>当集群资源充足时，队列可以使用超过<code>deserved</code>的资源（但不超过<code>capability</code>）</li>
<li>当集群资源紧张时，超过<code>deserved</code>的资源可能被回收给其他队列使用</li>
<li>是资源借用和回收机制的核心参考值</li>
</ul>
<p><strong>配置建议</strong>：</p>
<ul>
<li>在同级队列场景下，所有队列的<code>deserved</code>值总和应等于集群总资源</li>
<li>在层级队列场景下，子队列的<code>deserved</code>值总和应等于父队列的<code>deserved</code>值</li>
</ul>
<p><strong>示例场景</strong>： 假设队列<code>A</code>设置了<code>deserved.cpu=80</code>，当资源充足时，它可以使用多达<code>100</code>核（<code>capability</code>上限）；但当资源紧张时，它只能保证获得<code>80</code>核，超出部分可能被回收。当资源极度紧张时，会保证后续介绍的队列<code>guarantee</code>资源，</p>
<p><strong>3. guarantee（保障资源）</strong></p>
<p><strong>定义</strong>：队列被保证能够使用的最小资源量，即使在集群资源紧张的情况下也不会被回收。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>提供了资源使用的最低保障</li>
<li>这部分资源专属于该队列，不会被其他队列借用或抢占</li>
<li>即使在资源紧张的情况下，调度器也会确保队列能获得这些资源</li>
</ul>
<p><strong>示例场景</strong>： 假设关键业务队列设置了<code>guarantee.cpu=50</code>，即使集群资源非常紧张，该队列也能保证获得<code>50</code>核CPU资源用于运行关键业务。</p>
<p><strong>三者之间的关系</strong></p>
<ol>
<li><strong>资源层级关系：guarantee ≤ deserved ≤ capability</strong></li>
</ol>
<ul>
<li><code>guarantee</code>是最低保障</li>
<li><code>deserved</code>是正常情况下（资源不是极度紧张情况下）应得的资源</li>
<li><code>capability</code>是最高上限</li>
</ul>
<ol start=2>
<li><strong>资源分配优先级</strong>：</li>
</ol>
<ul>
<li>首先保证所有队列的<code>guarantee</code>资源</li>
<li>然后按照<code>deserved</code>值和权重分配剩余资源</li>
<li>最后允许队列使用空闲资源，但不超过<code>capability</code></li>
</ul>
<ol start=3>
<li>
<p><strong>资源回收顺序</strong>：</p>
<ol>
<li>首先回收超出<code>capability</code>的资源</li>
</ol>
<ul>
<li>
<p>这种情况通常不会发生，因为调度器会确保队列使用的资源不超过<code>capability</code>上限</p>
</li>
</ul>
<ol start=2>
<li>然后回收超出<code>deserved</code>但未超出<code>capability</code>的资源</li>
</ol>
<ul>
<li>
<p>当资源紧张时，队列使用的超过<code>deserved</code>值的资源可能被回收</p>
</li>
<li>
<p>这部分资源被视为"借用"的资源，在资源紧张时需要"归还"</p>
</li>
</ul>
<ol start=3>
<li>最后考虑回收超出<code>guarantee</code>但未超出<code>deserved</code>的资源</li>
</ol>
<ul>
<li>
<p>只有在极度资源紧张的情况下，且有更高优先级的队列需要资源时</p>
</li>
<li>
<p>这种回收通常通过抢占（<code>preemption</code>）机制实现，而不是简单的资源回收</p>
</li>
</ul>
<ol start=4>
<li><code>guarantee</code>资源永远不会被回收</li>
</ol>
<ul>
<li><code>guarantee</code>资源是队列的最低保障，即使在极度资源紧张的情况下也不会被回收</li>
<li>这是保证关键业务稳定运行的基础</li>
</ul>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=资源抢占机制>资源抢占机制<a href=#资源抢占机制 class=hash-link aria-label="Direct link to 资源抢占机制" title="Direct link to 资源抢占机制">​</a></h5>
<p>在<code>Volcano</code>中，队列的资源抢占（强占）机制主要基于<code>priorityClassName</code>属性配置，而不是<code>weight</code>属性。这两个属性在资源管理中有不同的作用。</p>
<p><strong>1. priorityClassName与资源抢占</strong></p>
<p><strong>定义</strong>：<code>priorityClassName</code>是<code>Queue</code>对象中用于定义队列优先级的属性，它直接关联到<code>Kubernetes</code>的<code>PriorityClass</code>资源。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>当集群资源紧张时，高优先级队列可以抢占低优先级队列的资源</li>
<li>抢占决策主要基于队列的<code>priorityClassName</code>所指定的优先级值</li>
<li>优先级值越高的队列可以抢占优先级值较低的队列资源</li>
</ul>
<p><strong>工作原理</strong>：</p>
<ul>
<li>每个<code>priorityClassName</code>对应一个整数值，这个值在<code>PriorityClass</code>资源中定义</li>
<li>调度器在资源紧张时，会比较不同队列的优先级值</li>
<li>高优先级队列的作业可以抢占低优先级队列中的作业资源</li>
</ul>
<p><strong>抢占条件</strong>：</p>
<ul>
<li>被抢占队列的<code>preemptable</code>属性必须设置为<code>true</code></li>
<li>抢占通常只发生在资源极度紧张且无法满足高优先级队列需求的情况下</li>
</ul>
<p><strong>2. weight与资源分配</strong></p>
<p><strong>定义</strong>：<code>weight</code>属性主要用于正常资源分配过程中的权重计算。</p>
<p><strong>特点</strong>：</p>
<ul>
<li><code>weight</code>影响队列在正常资源分配过程中的权重</li>
<li>当有多个队列竞争资源但资源足够分配时，<code>weight</code>值较高的队列会获得更多资源</li>
<li>这主要应用于<code>deserved</code>资源的分配过程</li>
</ul>
<p><strong>非抢占性质</strong>：</p>
<ul>
<li><code>weight</code>不直接触发资源抢占</li>
<li>它只影响资源分配的比例，而不会导致已分配资源的重新分配</li>
</ul>
<p><strong>3. 两者的区别与联系</strong></p>
<p><strong>作用时机不同</strong>：</p>
<ul>
<li><code>priorityClassName</code>在资源紧张需要抢占时起作用</li>
<li><code>weight</code>在正常资源分配过程中起作用</li>
</ul>
<p><strong>影响方式不同</strong>：</p>
<ul>
<li><code>priorityClassName</code>可能导致已运行作业被终止（抢占）</li>
<li><code>weight</code>只影响新资源的分配比例，不会终止已运行的作业</li>
</ul>
<p><strong>配合使用</strong>：</p>
<ul>
<li>在完整的资源管理策略中，这两个属性通常配合使用</li>
<li>高优先级队列通常也会设置较高的<code>weight</code>值</li>
<li>但它们解决的是不同的资源管理问题</li>
</ul>
<p><strong>4. 实际应用示例</strong></p>
<p>假设有三个队列：</p>
<ol>
<li>
<p><strong>关键业务队列</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> high</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 对应优先级值1000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>false</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 不允许被抢占</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>常规业务队列</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> normal</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 对应优先级值500</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 允许被抢占</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>批处理队列</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">priorityClassName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> low</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">priority  </span><span class="token comment" style=color:#8292a2;font-style:italic># 对应优先级值100</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">preemptable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 允许被抢占</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<p><strong>资源分配与抢占行为</strong>：</p>
<ul>
<li>在资源充足时，三个队列按照<code>10:5:2</code>的比例分配资源（基于<code>weight</code>）</li>
<li>在资源紧张时，关键业务队列可以抢占常规业务队列和批处理队列的资源（基于<code>priorityClassName</code>）</li>
<li>常规业务队列可以抢占批处理队列的资源，但不能抢占关键业务队列的资源</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=job-资源任务>Job 资源任务<a href=#job-资源任务 class=hash-link aria-label="Direct link to Job 资源任务" title="Direct link to Job 资源任务">​</a></h3>
<p><code>Volcano Job</code>（简称 <code>vcjob</code>）是 <code>Volcano</code> 提供的一种高级作业资源类型，扩展了 <code>Kubernetes</code> 原生的 <code>Job</code> 资源，为高性能计算和批处理场景提供了更丰富的功能。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=job-的作用>Job 的作用<a href=#job-的作用 class=hash-link aria-label="Direct link to Job 的作用" title="Direct link to Job 的作用">​</a></h4>
<ol>
<li>
<p><strong>多任务类型支持</strong></p>
<ul>
<li>支持在一个作业中定义多种不同类型的任务（<code>task</code>）</li>
<li>每种任务类型可以有不同的镜像、资源需求和副本数</li>
</ul>
</li>
<li>
<p><strong>生命周期管理</strong></p>
<ul>
<li>支持在作业生命周期的不同阶段执行特定命令</li>
<li>包括启动前、运行中、完成后等阶段</li>
</ul>
</li>
<li>
<p><strong>高级调度策略</strong></p>
<ul>
<li>支持指定最小可用数量（<code>minAvailable</code>）</li>
<li>支持指定队列、优先级和调度策略</li>
</ul>
</li>
<li>
<p><strong>容错和恢复机制</strong></p>
<ul>
<li>提供多种重启策略（<code>RestartPolicy</code>）</li>
<li>支持在任务失败时的不同处理方式</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-job-配置示例>Volcano Job 配置示例<a href=#volcano-job-配置示例 class=hash-link aria-label="Direct link to Volcano Job 配置示例" title="Direct link to Volcano Job 配置示例">​</a></h4>
<p>下面是一个<code>TensorFlow</code>分布式训练任务的<code>Volcano Job</code>配置示例：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ml</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">jobs</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">policies</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">event</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodEvicted</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RestartJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">event</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> PodFailed</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">action</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RestartJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ps</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/ps.py"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 4Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">gpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tensorflow</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"python"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/app/worker.py"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 8Gi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-job-的特性>Volcano Job 的特性<a href=#volcano-job-的特性 class=hash-link aria-label="Direct link to Volcano Job 的特性" title="Direct link to Volcano Job 的特性">​</a></h4>
<ol>
<li>
<p><strong>多任务类型</strong></p>
<ul>
<li>在上面的示例中，定义了两种任务类型：<code>ps</code>（参数服务器）和 <code>worker</code>（工作节点）</li>
<li>每种类型有不同的副本数和资源需求</li>
</ul>
</li>
<li>
<p><strong>事件处理策略</strong></p>
<ul>
<li>定义了当 <code>Pod</code> 被驱逐或失败时重启整个作业的策略</li>
<li>可以根据不同事件类型执行不同的操作</li>
</ul>
</li>
<li>
<p><strong>队列和调度器指定</strong></p>
<ul>
<li>指定使用 <code>volcano</code> 调度器和 <code>ml-jobs</code> 队列</li>
<li>确保作业在正确的资源池中运行</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-job-的实际应用场景>Volcano Job 的实际应用场景<a href=#volcano-job-的实际应用场景 class=hash-link aria-label="Direct link to Volcano Job 的实际应用场景" title="Direct link to Volcano Job 的实际应用场景">​</a></h4>
<ol>
<li>
<p><strong>分布式机器学习</strong></p>
<ul>
<li><code>TensorFlow</code>、<code>PyTorch</code> 等分布式训练任务</li>
<li>支持参数服务器和工作节点的协调调度</li>
</ul>
</li>
<li>
<p><strong>大数据处理</strong></p>
<ul>
<li><code>Spark</code>、<code>Flink</code> 等大数据处理框架</li>
<li>支持<code>Master</code>和<code>Worker</code>节点的组织管理</li>
</ul>
</li>
<li>
<p><strong>MPI 并行计算</strong></p>
<ul>
<li>高性能计算和科学模拟</li>
<li>支持多节点协同计算</li>
</ul>
</li>
</ol>
<p><code>Volcano Job</code> 为复杂的分布式工作负载提供了完整的生命周期管理和调度能力，是 <code>Volcano</code> 系统中最强大的资源类型之一。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://volcano.sh/ target=_blank rel="noopener noreferrer">https://volcano.sh/</a></li>
<li><a href=https://ericam.top/posts/understand-volcano-scheduler-from-zero/ target=_blank rel="noopener noreferrer">https://ericam.top/posts/understand-volcano-scheduler-from-zero/</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-examples><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano使用示例</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#基本介绍 class="table-of-contents__link toc-highlight">基本介绍</a><ul><li><a href=#核心组件 class="table-of-contents__link toc-highlight">核心组件</a><li><a href=#组件交互关系 class="table-of-contents__link toc-highlight">组件交互关系</a></ul><li><a href=#scheduler class="table-of-contents__link toc-highlight">Scheduler</a><ul><li><a href=#kubernetes-scheduler class="table-of-contents__link toc-highlight">Kubernetes Scheduler</a><li><a href=#volcano-scheduler class="table-of-contents__link toc-highlight">Volcano Scheduler</a><li><a href=#taskpod状态转换 class="table-of-contents__link toc-highlight">Task/Pod状态转换</a></ul><li><a href=#volcano自定义资源 class="table-of-contents__link toc-highlight">Volcano自定义资源</a><ul><li><a href=#podgroup-资源组 class="table-of-contents__link toc-highlight">PodGroup 资源组</a><li><a href=#queue-资源队列 class="table-of-contents__link toc-highlight">Queue 资源队列</a><li><a href=#job-资源任务 class="table-of-contents__link toc-highlight">Job 资源任务</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>