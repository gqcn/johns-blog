<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/云原生/Volcano/Volcano Session Plugins方法介绍" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Volcano Session Plugins方法介绍 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/cloud-native/volcano-session-plugins-fns><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Volcano Session Plugins方法介绍 | John's Blog"><meta data-rh=true name=description content=本文详细介绍了Volcano调度器框架中Session对象的31个Add*Fn方法，包括排序、调度决策、抢占回收、作业状态检查等各类插件扩展点的作用、使用场景和代码示例，为Volcano插件开发提供完整的技术参考。><meta data-rh=true property=og:description content=本文详细介绍了Volcano调度器框架中Session对象的31个Add*Fn方法，包括排序、调度决策、抢占回收、作业状态检查等各类插件扩展点的作用、使用场景和代码示例，为Volcano插件开发提供完整的技术参考。><meta data-rh=true name=keywords content=Volcano,Kubernetes,Session,Plugins,调度器,AddFn,插件开发,调度逻辑,扩展点,PredicateFn,NodeOrderFn,JobOrderFn><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/cloud-native/volcano-session-plugins-fns><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-session-plugins-fns hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/cloud-native/volcano-session-plugins-fns hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.667035e4.css><script src=/assets/js/runtime~main.ac68b0e3.js defer></script><script src=/assets/js/main.7b246a3f.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/ai>AI技术</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/cloud-native>云原生</a><button aria-label="Collapse sidebar category '云原生'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/container>Container</a><button aria-label="Expand sidebar category 'Container'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kubernetes>Kubernetes</a><button aria-label="Expand sidebar category 'Kubernetes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/argo-workflow>Argo Workflow</a><button aria-label="Expand sidebar category 'Argo Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/cloud-native/volcano>Volcano</a><button aria-label="Collapse sidebar category 'Volcano'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-introduction>Volcano基本介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-startup-parameters>Volcano启动参数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-examples>Volcano使用示例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-annotations>Volcano常用注解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue>Volcano Queue详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-job-task-podgroup-pod>Volcano Job/Task/PodGroup/Pod详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-queue-job-pod-preemption>Volcano Queue&Job&Pod资源抢占设计</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-scheduler-actions-plugins>Volcano Actions&Plugins详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/cloud-native/volcano-session-plugins-fns>Volcano Session Plugins方法介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-hierarchy-queue-scheduling-issue>Volcano层级队列配置引发的调度器系统性故障问题</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-hierarchy-queue-notes>Volcano层级队列使用的一些笔记</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/volcano-accelerator-card-quota-improvement>Volcano调度器支持智算卡Quota改进方案</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/cloud-native/kind>Kind</a><button aria-label="Expand sidebar category 'Kind'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/helm>Helm常用指令</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/cloud-native/dragonfly>Dragonfly介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native><span itemprop=name>云原生</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/cloud-native/volcano><span itemprop=name>Volcano</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Volcano Session Plugins方法介绍</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>Volcano</code>调度器框架中的<code>Session</code>对象提供了丰富的插件扩展点，通过各种<code>Add*Fn</code>方法允许插件注册自定义的调度逻辑。这些方法是<code>Volcano</code>调度器插件开发的核心接口，本文档详细介绍每个方法的作用、使用场景和代码示例。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=排序相关方法>排序相关方法<a href=#排序相关方法 class=hash-link aria-label="Direct link to 排序相关方法" title="Direct link to 排序相关方法">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjoborderfn---作业排序函数>AddJobOrderFn - 作业排序函数<a href=#addjoborderfn---作业排序函数 class=hash-link aria-label="Direct link to AddJobOrderFn - 作业排序函数" title="Direct link to AddJobOrderFn - 作业排序函数">​</a></h3>
<p><strong>作用</strong>: 注册作业排序函数，用于确定作业的调度优先级顺序。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> cf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CompareFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>CompareFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> CompareFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.JobInfo</code> 类型，表示左侧作业信息</li>
<li>第二个参数: <code>*api.JobInfo</code> 类型，表示右侧作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>-1</code>: 表示左侧作业优先级高于右侧作业</li>
<li>返回 <code>1</code>: 表示右侧作业优先级高于左侧作业</li>
<li>返回 <code>0</code>: 表示两个作业优先级相等</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现基于优先级的作业调度</li>
<li>实现基于资源需求的作业排序</li>
<li>实现基于提交时间的<code>FIFO</code>调度</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 在插件的OnSessionOpen方法中注册</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">priorityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册基于优先级的作业排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">l</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> r </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lv </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> l</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rv </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 获取作业优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lPriority </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> lv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PodGroup</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PriorityClassName</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rPriority </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> rv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PodGroup</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PriorityClassName</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 高优先级作业排在前面</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lPriority </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> rPriority </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lPriority </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> rPriority </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addqueueorderfn---队列排序函数>AddQueueOrderFn - 队列排序函数<a href=#addqueueorderfn---队列排序函数 class=hash-link aria-label="Direct link to AddQueueOrderFn - 队列排序函数" title="Direct link to AddQueueOrderFn - 队列排序函数">​</a></h3>
<p><strong>作用</strong>: 注册队列排序函数，用于确定队列的调度优先级顺序。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddQueueOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> qf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CompareFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>CompareFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> CompareFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.QueueInfo</code> 类型，表示左侧队列信息</li>
<li>第二个参数: <code>*api.QueueInfo</code> 类型，表示右侧队列信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>-1</code>: 表示左侧队列优先级高于右侧队列</li>
<li>返回 <code>1</code>: 表示右侧队列优先级高于左侧队列</li>
<li>返回 <code>0</code>: 表示两个队列优先级相等</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现基于权重的队列调度</li>
<li>实现基于资源使用率的队列排序</li>
<li>实现多租户资源公平分配</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">dp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">drfPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册基于DRF算法的队列排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddQueueOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">dp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">l</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> r </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lv </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> l</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rv </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算队列的主导资源份额</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lShare </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateDominantResourceShare</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">lv</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rShare </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateDominantResourceShare</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rv</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 主导资源份额小的队列优先调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lShare </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> rShare </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lShare </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> rShare </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateDominantResourceShare</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>float64</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// DRF算法实现逻辑</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算CPU和内存的资源份额，返回较大值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    cpuShare </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    memShare </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> cpuShare </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> memShare </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> cpuShare</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> memShare</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addvictimqueueorderfn---受害者队列排序函数>AddVictimQueueOrderFn - 受害者队列排序函数<a href=#addvictimqueueorderfn---受害者队列排序函数 class=hash-link aria-label="Direct link to AddVictimQueueOrderFn - 受害者队列排序函数" title="Direct link to AddVictimQueueOrderFn - 受害者队列排序函数">​</a></h3>
<p><strong>作用</strong>: 注册受害者队列排序函数，用于在抢占场景中确定队列的优先级顺序。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddVictimQueueOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> vcf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">VictimCompareFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>VictimCompareFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> VictimCompareFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.QueueInfo</code> 类型，表示左侧候选受害者队列</li>
<li>第二个参数: <code>*api.QueueInfo</code> 类型，表示右侧候选受害者队列</li>
<li>第三个参数: <code>*api.QueueInfo</code> 类型，表示抢占者队列</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>-1</code>: 表示左侧队列更适合作为受害者（优先被抢占）</li>
<li>返回 <code>1</code>: 表示右侧队列更适合作为受害者（优先被抢占）</li>
<li>返回 <code>0</code>: 表示两个队列作为受害者的优先级相等</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现抢占时的队列选择策略</li>
<li>实现多租户抢占优先级</li>
<li>实现基于资源使用情况的抢占顺序</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">preemptPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册受害者队列排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddVictimQueueOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">l</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> preemptor </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lQueue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> l</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rQueue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        preemptorQueue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> preemptor</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 优先抢占资源使用超出保证的队列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lOverGuarantee </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isQueueOverGuarantee</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">lQueue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rOverGuarantee </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isQueueOverGuarantee</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rQueue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lOverGuarantee </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">rOverGuarantee </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">lOverGuarantee </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> rOverGuarantee </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addclusterorderfn---集群排序函数>AddClusterOrderFn - 集群排序函数<a href=#addclusterorderfn---集群排序函数 class=hash-link aria-label="Direct link to AddClusterOrderFn - 集群排序函数" title="Direct link to AddClusterOrderFn - 集群排序函数">​</a></h3>
<p><strong>作用</strong>: 注册集群排序函数，用于多集群调度场景中确定集群的优先级顺序。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddClusterOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> qf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CompareFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>CompareFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> CompareFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*scheduling.Cluster</code> 类型，表示左侧集群信息</li>
<li>第二个参数: <code>*scheduling.Cluster</code> 类型，表示右侧集群信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>-1</code>: 表示左侧集群优先级高于右侧集群</li>
<li>返回 <code>1</code>: 表示右侧集群优先级高于左侧集群</li>
<li>返回 <code>0</code>: 表示两个集群优先级相等</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现多集群资源调度</li>
<li>实现集群负载均衡</li>
<li>实现基于集群性能的排序</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">clusterPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册集群排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddClusterOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">l</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> r </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lCluster </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> l</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">scheduling</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Cluster</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rCluster </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">scheduling</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Cluster</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 基于集群资源利用率排序</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lUtilization </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getClusterUtilization</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">lCluster</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rUtilization </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getClusterUtilization</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rCluster</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 优先选择利用率较低的集群</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lUtilization </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> rUtilization </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lUtilization </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> rUtilization </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addtaskorderfn---任务排序函数>AddTaskOrderFn - 任务排序函数<a href=#addtaskorderfn---任务排序函数 class=hash-link aria-label="Direct link to AddTaskOrderFn - 任务排序函数" title="Direct link to AddTaskOrderFn - 任务排序函数">​</a></h3>
<p><strong>作用</strong>: 注册任务排序函数，用于确定同一作业内任务的调度顺序。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddTaskOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> cf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CompareFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>CompareFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> CompareFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示左侧任务信息</li>
<li>第二个参数: <code>*api.TaskInfo</code> 类型，表示右侧任务信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>-1</code>: 表示左侧任务优先级高于右侧任务</li>
<li>返回 <code>1</code>: 表示右侧任务优先级高于左侧任务</li>
<li>返回 <code>0</code>: 表示两个任务优先级相等</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现基于任务类型的排序（如<code>master</code>优先于<code>worker</code>）</li>
<li>实现基于资源需求的任务排序</li>
<li>实现基于任务依赖关系的排序</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">gp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">gangPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册基于任务角色的排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddTaskOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">gp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">l</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> r </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lv </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> l</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rv </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 获取任务角色</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lRole </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskRole</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">lv</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        rRole </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskRole</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rv</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// master任务优先调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lRole </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"master"</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> rRole </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"master"</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> lRole </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"master"</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> rRole </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"master"</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskRole</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> role</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Labels</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"role"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> role</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"worker"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=调度决策相关方法>调度决策相关方法<a href=#调度决策相关方法 class=hash-link aria-label="Direct link to 调度决策相关方法" title="Direct link to 调度决策相关方法">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addpredicatefn---节点过滤函数>AddPredicateFn - 节点过滤函数<a href=#addpredicatefn---节点过滤函数 class=hash-link aria-label="Direct link to AddPredicateFn - 节点过滤函数" title="Direct link to AddPredicateFn - 节点过滤函数">​</a></h3>
<p><strong>作用</strong>: 注册节点过滤函数，用于判断任务是否可以调度到特定节点。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddPredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PredicateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>PredicateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> PredicateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>*api.NodeInfo</code> 类型，表示候选节点信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示任务可以调度到该节点</li>
<li>返回 <code>error</code>: 表示任务不能调度到该节点，错误信息说明原因</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现节点资源充足性检查</li>
<li>实现节点亲和性和反亲和性</li>
<li>实现<code>GPU</code>类型匹配检查</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">np </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">nodeAffinityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册节点亲和性检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddPredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">np</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查节点标签是否满足任务要求</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> requiredLabels</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeSelector</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> key</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> value </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> requiredLabels </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> nodeValue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> hasLabel </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Labels</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">hasLabel </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> nodeValue </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> value </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"node %s doesn't match required label %s=%s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                        node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> key</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> value</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查GPU类型匹配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> gpuType </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getRequiredGPUType</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> gpuType </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>""</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            nodeGPUType </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getNodeGPUType</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> nodeGPUType </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> gpuType </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"node %s GPU type %s doesn't match required %s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodeGPUType</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> gpuType</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getRequiredGPUType</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> gpuType</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"volcano.sh/gpu-type"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> gpuType</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>""</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getNodeGPUType</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">node </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> gpuType</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Labels</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"accelerator"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> gpuType</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>""</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addprepredicatefn---预过滤函数>AddPrePredicateFn - 预过滤函数<a href=#addprepredicatefn---预过滤函数 class=hash-link aria-label="Direct link to AddPrePredicateFn - 预过滤��函数" title="Direct link to AddPrePredicateFn - 预过滤函数">​</a></h3>
<p><strong>作用</strong>: 注册预过滤函数，在节点过滤之前进行任务级别的预检查。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddPrePredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PrePredicateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>PrePredicateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> PrePredicateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示任务通过预过滤检查</li>
<li>返回 <code>error</code>: 表示任务不通过预过滤检查，错误信息说明原因</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现任务级别的资源检查</li>
<li>实现任务状态预验证</li>
<li>实现调度前的快速过滤</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">resourcePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册预过滤函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddPrePredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查任务资源请求是否合理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>&lt;=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>&lt;=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"task %s has invalid resource request"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查任务状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Status </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pending </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"task %s is not in pending state"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addbestnodefn---最佳节点选择函数>AddBestNodeFn - 最佳节点选择函数<a href=#addbestnodefn---最佳节点选择函数 class=hash-link aria-label="Direct link to AddBestNodeFn - 最佳节点选择函数" title="Direct link to AddBestNodeFn - 最佳节点选择函数">​</a></h3>
<p><strong>作用</strong>: 注册最佳节点选择函数，从候选节点中选择最优节点。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddBestNodeFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">BestNodeFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>BestNodeFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> BestNodeFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>[]*api.NodeInfo</code> 类型，表示候选节点列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>*api.NodeInfo</code>: 表示选中的最佳节点</li>
<li>返回 <code>nil</code>: 表示没有找到合适的节点</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现自定义节点选择策略</li>
<li>实现基于业务逻辑的节点选择</li>
<li>实现多维度节点评估</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">bestNodePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册最佳节点选择函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddBestNodeFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodeScores </span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 从最高分的节点中选择CPU利用率最低的</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> bestScore </span><span class="token builtin" style=color:#e6db74>float64</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> score </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> nodeScores </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> score </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> bestScore </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                bestScore </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> score</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> bestScore </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        bestNodes </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> nodeScores</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">bestScore</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bestNodes</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 选择CPU利用率最低的节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> bestNode </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> minCPUUtilization </span><span class="token builtin" style=color:#e6db74>float64</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> bestNodes </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            utilization </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Allocatable</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> utilization </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> minCPUUtilization </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                minCPUUtilization </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> utilization</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                bestNode </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> bestNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addnodeorderfn---节点打分函数>AddNodeOrderFn - 节点打分函数<a href=#addnodeorderfn---节点打分函数 class=hash-link aria-label="Direct link to AddNodeOrderFn - 节点打分函数" title="Direct link to AddNodeOrderFn - 节点打分函数">​</a></h3>
<p><strong>作用</strong>: 注册节点打分函数，用于为节点计算优先级分数。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>NodeOrderFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> NodeOrderFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>*api.NodeInfo</code> 类型，表示候选节点信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>第一个返回值: <code>float64</code> 类型，表示节点的优先级分数（分数越高优先级越高）</li>
<li>第二个返回值: <code>error</code> 类型，表示打分过程中的错误信息</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现基于资源利用率的节点打分</li>
<li>实现基于网络拓扑的节点打分</li>
<li>实现负载均衡策略</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">binpackPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册BinPack节点打分函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算资源利用率分数，优先选择资源利用率高的节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        cpuScore </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateResourceScore</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Allocatable</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        memScore </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateResourceScore</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Allocatable</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 返回加权平均分数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cpuScore </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> memScore</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2.0</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateResourceScore</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">requested</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> allocatable</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> used </span><span class="token builtin" style=color:#e6db74>int64</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>float64</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> allocatable </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算调度后的利用率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    utilization </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">used</span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain">requested</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">allocatable</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// BinPack策略：利用率越高分数越高</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> utilization </span><span class="token operator" style=color:#66d9ef>&lt;=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> utilization </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 超出容量则返回负分</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>-</span><span class="token number" style=color:#ae81ff>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addhypernodeorderfn---超级节点排序函数>AddHyperNodeOrderFn - 超级节点排序函数<a href=#addhypernodeorderfn---超级节点排序函数 class=hash-link aria-label="Direct link to AddHyperNodeOrderFn - 超级节点排序函数" title="Direct link to AddHyperNodeOrderFn - 超级节点排序函数">​</a></h3>
<p><strong>作用</strong>: 注册超级节点排序函数，用于对超级节点组进行排序和打分。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddHyperNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">HyperNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>HyperNodeOrderFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> HyperNodeOrderFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>[]*api.NodeInfo</code> 类型，表示候选节点列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>第一个返回值: <code>map[string]float64</code> 类型，表示节点ID到分数的映射（分数越高优先级越高）</li>
<li>第二个返回值: <code>error</code> 类型，表示打分过程中的错误信息</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现多节点组合的调度策略</li>
<li>实现拓扑感知的节点组选择</li>
<li>实现大规模分布式任务的节点分配</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">tp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">topologyPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册超级节点排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddHyperNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">tp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> hyperNodes </span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        scores </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>make</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> groupName</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodes </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> hyperNodes </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算节点组的拓扑分数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            topologyScore </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateTopologyScore</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">nodes</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算节点组的资源利用率分数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            utilizationScore </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateGroupUtilization</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">nodes</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 综合评分</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            scores</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">groupName</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> topologyScore</span><span class="token operator" style=color:#66d9ef>*</span><span class="token number" style=color:#ae81ff>0.6</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> utilizationScore</span><span class="token operator" style=color:#66d9ef>*</span><span class="token number" style=color:#ae81ff>0.4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> scores</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addbatchnodeorderfn---批量节点排序函数>AddBatchNodeOrderFn - 批量节点排序函数<a href=#addbatchnodeorderfn---批量节点排序函数 class=hash-link aria-label="Direct link to AddBatchNodeOrderFn - 批量节点排序函数" title="Direct link to AddBatchNodeOrderFn - 批量节点排序函数">​</a></h3>
<p><strong>作用</strong>: 注册批量节点排序函数，用于批量计算多个节点的优先级分数。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddBatchNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">BatchNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>BatchNodeOrderFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> BatchNodeOrderFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>[]*api.NodeInfo</code> 类型，表示候选节点列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>第一个返回值: <code>map[string]float64</code> 类型，表示节点名称到分数的映射（分数越高优先级越高）</li>
<li>第二个返回值: <code>error</code> 类型，表示打分过程中的错误信息</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现批量节点评分优化</li>
<li>实现并行节点打分计算</li>
<li>实现大规模集群的性能优化</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">batchPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册批量节点排序函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddBatchNodeOrderFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">bp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodes </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        scores </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>make</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">nodes</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 并行计算所有节点的分数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> nodes </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            scores</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateBatchNodeScore</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> scores</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addnodemapfn---节点映射函数>AddNodeMapFn - 节点映射函数<a href=#addnodemapfn---节点映射函数 class=hash-link aria-label="Direct link to AddNodeMapFn - 节点映射函数" title="Direct link to AddNodeMapFn - 节点映射函数">​</a></h3>
<p><strong>作用</strong>: 注册节点映射函数，用于将节点信息映射为特定的分数值。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddNodeMapFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeMapFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>NodeMapFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> NodeMapFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>*api.NodeInfo</code> 类型，表示候选节点信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>第一个返回值: <code>float64</code> 类型，表示节点的映射分数值</li>
<li>第二个返回值: <code>error</code> 类型，表示映射过程中的错误信息</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现节点特征提取</li>
<li>实现自定义节点评分维度</li>
<li>实现节点分类和标记</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">mp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">mapPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册节点映射函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddNodeMapFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">mp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token builtin" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        score </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// GPU节点加分</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> gpuCount</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Status</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capacity</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"nvidia.com/gpu"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> gpuCount</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Value</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                score </span><span class="token operator" style=color:#66d9ef>+=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>20.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> score</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addnodereducefn---节点归约函数>AddNodeReduceFn - 节点归约函数<a href=#addnodereducefn---节点归约函数 class=hash-link aria-label="Direct link to AddNodeReduceFn - 节点归约函数" title="Direct link to AddNodeReduceFn - 节点归约函数">​</a></h3>
<p><strong>作用</strong>: 注册节点归约函数，用于将多个节点分数归约为最终结果。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddNodeReduceFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> pf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeReduceFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>NodeReduceFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> NodeReduceFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> k8sframework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeScoreList</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待调度的任务信息</li>
<li>第二个参数: <code>k8sframework.NodeScoreList</code> 类型，表示节点分数列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示归约处理成功</li>
<li>返回 <code>error</code>: 表示归约处理失败，错误信息说明原因</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现多维度分数的聚合</li>
<li>实现分数标准化处理</li>
<li>实现最终节点排序逻辑</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">reducePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册节点归约函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddNodeReduceFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodeScores k8sframework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeScoreList</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 标准化分数处理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addallocatablefn---资源分配检查函数>AddAllocatableFn - 资源分配检查函数<a href=#addallocatablefn---资源分配检查函数 class=hash-link aria-label="Direct link to AddAllocatableFn - 资源分配检查函数" title="Direct link to AddAllocatableFn - 资源分配检查函数">​</a></h3>
<p><strong>作用</strong>: 注册资源分配检查函数，用于判断队列是否可以为任务分配资源。该函数将会允许<code>Pending</code>的<code>Pod</code>继续进行调度（分配资源），随后<code>Pod</code>将会从<code>Pending</code>状态转换到<code>Running</code>状态。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddAllocatableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">AllocatableFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>AllocatableFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> AllocatableFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.QueueInfo</code> 类型，表示队列信息</li>
<li>第二个参数: <code>*api.TaskInfo</code> 类型，表示待分配的任务信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>true</code>: 表示队列可以为任务分配资源</li>
<li>返回 <code>false</code>: 表示队列无法为任务分配资源</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现队列容量检查</li>
<li>实现资源配额管理</li>
<li>实现多租户资源隔离</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">capacityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册资源分配检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddAllocatableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> candidate </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查队列是否超出容量限制</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        afterCPU </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> candidate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        afterMemory </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> candidate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> afterCPU </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> afterMemory </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addoverusedfn---队列超用检查函数>AddOverusedFn - 队列超用检查函数<a href=#addoverusedfn---队列超用检查函数 class=hash-link aria-label="Direct link to AddOverusedFn - 队列超用检查函数" title="Direct link to AddOverusedFn - 队列超用检查函数">​</a></h3>
<p><strong>作用</strong>: 注册队列超用检查函数，用于判断队列是否超出资源使用限制。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddOverusedFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>ValidateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ValidateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.QueueInfo</code> 类型，表示队列信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>true</code>: 表示队列超出资源使用限制</li>
<li>返回 <code>false</code>: 表示队列未超出资源使用限制</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现队列资源监控</li>
<li>实现资源回收触发条件</li>
<li>实现弹性资源管理</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">capacityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册队列超用检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddOverusedFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        queue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否超出保证资源的150%</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        cpuOverused </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Guarantee</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token operator" style=color:#66d9ef>*</span><span class="token number" style=color:#ae81ff>3</span><span class="token operator" style=color:#66d9ef>/</span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        memOverused </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Guarantee</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token operator" style=color:#66d9ef>*</span><span class="token number" style=color:#ae81ff>3</span><span class="token operator" style=color:#66d9ef>/</span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> cpuOverused </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> memOverused</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=抢占和回收相关方法>抢占和回收相关方法<a href=#抢占和回收相关方法 class=hash-link aria-label="Direct link to 抢占和回收相关方法" title="Direct link to 抢占和回收相关方法">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addpreemptablefn---抢占判断函数>AddPreemptableFn - 抢占判断函数<a href=#addpreemptablefn---抢占判断函数 class=hash-link aria-label="Direct link to AddPreemptableFn - 抢占判断函数" title="Direct link to AddPreemptableFn - 抢占判断函数">​</a></h3>
<p><strong>作用</strong>: 注册抢占判断函数，用于确定哪些任务可以被抢占。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddPreemptableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> cf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">EvictableFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>EvictableFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> EvictableFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示抢占者任务信息</li>
<li>第二个参数: <code>[]*api.TaskInfo</code> 类型，表示候选被抢占任务列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>第一个返回值: <code>[]*api.TaskInfo</code> 类型，表示最终被抢占的任务列表</li>
<li>第二个返回值: <code>int</code> 类型，表示抢占的任务数量</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现基于优先级的任务抢占</li>
<li>实现基于资源使用时间的抢占策略</li>
<li>实现多租户间的资源抢占</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">priorityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册基于优先级的抢占函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddPreemptableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">preemptor </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> preemptees </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> victims </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        preemptorPriority </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskPriority</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">preemptor</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> preemptee </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> preemptees </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            preempteePriority </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskPriority</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">preemptee</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 只能抢占优先级更低的任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> preemptorPriority </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> preempteePriority </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否标记为可抢占</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isPreemptable</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">preemptee</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    victims </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>append</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">victims</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> preemptee</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 返回可抢占的任务列表和投票权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> victims</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskPriority</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int32</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Priority </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isPreemptable</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> preemptable</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"volcano.sh/preemptable"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> preemptable </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addpreemptivefn---抢占能力检查函数>AddPreemptiveFn - 抢占能力检查函数<a href=#addpreemptivefn---抢占能力检查函数 class=hash-link aria-label="Direct link to AddPreemptiveFn - 抢占能力检查函数" title="Direct link to AddPreemptiveFn - 抢占能力检查函数">​</a></h3>
<p><strong>作用</strong>: 注册抢占能力检查函数，用于判断队列是否能为指定任务执行抢占其他队列任务。在该函数的实现中，通常判断该任务的资源是否会超过队列的配额。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddPreemptiveFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateWithCandidateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>ValidateWithCandidateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ValidateWithCandidateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>interface{}</code> 类型，通常为 <code>*api.QueueInfo</code> 类型，表示队列信息</li>
<li>第二个参数: <code>interface{}</code> 类型，通常为 <code>*api.TaskInfo</code> 类型，表示候选任务信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>true</code>: 表示队列可以为该任务执行抢占</li>
<li>返回 <code>false</code>: 表示队列不能为任务执行抢占逻辑</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现抢占权限控制</li>
<li>实现基于优先级的抢占策略</li>
<li>实现多租户抢占管理</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">priorityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册抢占能力检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddPreemptiveFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> candidate </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查队列是否有抢占权限</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> preemptive</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"volcano.sh/preemptive"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> preemptive </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"true"</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查任务优先级是否足够高</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> candidate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Priority </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>||</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">candidate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Spec</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Priority </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addreclaimablefn---资源回收函数>AddReclaimableFn - 资源回收函数<a href=#addreclaimablefn---资源回收函数 class=hash-link aria-label="Direct link to AddReclaimableFn - 资源回收函数" title="Direct link to AddReclaimableFn - 资源回收函数">​</a></h3>
<p><strong>作用</strong>: 注册资源回收函数，用于确定哪些任务的资源可以被回收。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddReclaimableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> rf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">EvictableFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>EvictableFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> EvictableFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示请求资源的任务信息</li>
<li>第二个参数: <code>[]*api.TaskInfo</code> 类型，表示候选回收任务列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>第一个返回值: <code>[]*api.TaskInfo</code> 类型，表示最终被回收的任务列表</li>
<li>第二个返回值: <code>int</code> 类型，表示回收的任务数量</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现队列间的资源回收</li>
<li>实现基于资源保证的回收策略</li>
<li>实现弹性资源管理</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">capacityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册资源回收函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddReclaimableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">reclaimer </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> reclaimees </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> victims </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        reclaimerQueue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Jobs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">reclaimer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Job</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> reclaimee </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> reclaimees </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            reclaimeeQueue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Jobs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">reclaimee</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Job</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 不能回收同一队列的资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> reclaimerQueue </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> reclaimeeQueue </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>continue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查队列是否超出保证资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            queueInfo </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queues</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">reclaimeeQueue</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isQueueOverGuarantee</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                victims </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>append</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">victims</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> reclaimee</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> victims</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isQueueOverGuarantee</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查队列是否超出保证资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Guarantee</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Guarantee</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=作业状态检查相关方法>作业状态检查相关方法<a href=#作业状态检查相关方法 class=hash-link aria-label="Direct link to 作业状态检查相关方法" title="Direct link to 作业状态检查相关方法">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjobpipelinedfn---作业流水线检查函数>AddJobPipelinedFn - 作业流水线检查函数<a href=#addjobpipelinedfn---作业流水线检查函数 class=hash-link aria-label="Direct link to AddJobPipelinedFn - 作业流水线检查函数" title="Direct link to AddJobPipelinedFn - 作业流水线检查函数">​</a></h3>
<p><strong>作用</strong>: 注册作业流水线检查函数，用于判断作业是否已经绑定到节点上，但是节点上暂无资源分配，等待节点上的其他任务释放资源。主要用于<code>allocate</code>和<code>preempt</code>两个<code>action</code>。目前在<code>gang/sla/tdm</code>中有注册该方法。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobPipelinedFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> vf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">VoteFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>VoteFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> VoteFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.JobInfo</code> 类型，表示作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回<code>util.Permit</code>(<code>1</code>): 表示支持作业进行流水线调度。</li>
<li>返回<code>util.Abstain</code>(<code>0</code>): 表示中性票，不影响决策。</li>
<li>返回<code>util.Reject</code>(<code>-1</code>): 表示不允许作业进行流水线调度。</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现流水线作业调度</li>
<li>实现资源预分配检查</li>
<li>实现作业启动条件控制</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">pipelinePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册作业流水线检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobPipelinedFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查作业是否满足流水线调度条件</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        minResource </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateMinResourceForPipeline</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        availableResource </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getAvailableResourceForJob</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> availableResource</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>>=</span><span class="token plain"> minResource</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">           availableResource</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>>=</span><span class="token plain"> minResource</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> util</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Permit </span><span class="token comment" style=color:#8292a2;font-style:italic>// 允许流水线调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> util</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Reject </span><span class="token comment" style=color:#8292a2;font-style:italic>// 暂不允许</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateMinResourceForPipeline</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resource </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算流水线调度所需的最小资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resource</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MinAvailable </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 每个任务最少100m CPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        Memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">   job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MinAvailable </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>128</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1024</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1024</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 每个任务最少128Mi内存</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjobvalidfn---作业有效性检查函数>AddJobValidFn - 作业有效性检查函数<a href=#addjobvalidfn---作业有效性检查函数 class=hash-link aria-label="Direct link to AddJobValidFn - 作业有效性检查函数" title="Direct link to AddJobValidFn - 作业有效性检查函数">​</a></h3>
<p><strong>作用</strong>: 注册作业有效性检查函数，用于验证作业配置的合法性。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobValidFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateExFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>ValidateExFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ValidateExFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">ValidateResult</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.JobInfo</code> 类型，表示作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>*ValidateResult</code>: 包含验证结果的结构体，包括是否通过验证和错误信息</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现作业配置验证</li>
<li>实现资源请求合理性检查</li>
<li>实现业务规则验证</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">vp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">validationPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册作业有效性检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobValidFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">vp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateResult </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查作业资源请求是否合理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        totalCPU </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>int64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        totalMemory </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>int64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Tasks </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            totalCPU </span><span class="token operator" style=color:#66d9ef>+=</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            totalMemory </span><span class="token operator" style=color:#66d9ef>+=</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否超出队列限制</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        queue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queues</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> totalCPU </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateResult</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                Pass</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">   </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                Reason</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprintf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Job CPU request %d exceeds queue capability %d"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    totalCPU</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateResult</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">Pass</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjobstarvingfns---作业饥饿检查函数>AddJobStarvingFns - 作业饥饿检查函数<a href=#addjobstarvingfns---作业饥饿检查函数 class=hash-link aria-label="Direct link to AddJobStarvingFns - 作业饥饿检查函数" title="Direct link to AddJobStarvingFns - 作业饥饿检查函数">​</a></h3>
<p><strong>作用</strong>: 注册作业饥饿检查函数，用于判断作业是否处于资源饥饿状态。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobStarvingFns</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>ValidateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ValidateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.JobInfo</code> 类型，表示作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>true</code>: 表示作业处于饥饿状态</li>
<li>返回 <code>false</code>: 表示作业未处于饥饿状态</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现作业饥饿检测</li>
<li>实现优先级提升策略</li>
<li>实现公平调度保障</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">starvationPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册作业饥饿检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobStarvingFns</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查作业等待时间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        waitTime </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Since</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CreationTimestamp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Time</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        starvationThreshold </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Minute</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> waitTime </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> starvationThreshold </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否有任务在运行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            runningTasks </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskStatusIndex</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Running</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> runningTasks </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 作业处于饥饿状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjobreadyfn---作业就绪检查函数>AddJobReadyFn - 作业就绪检查函数<a href=#addjobreadyfn---作业就绪检查函数 class=hash-link aria-label="Direct link to AddJobReadyFn - 作业就绪检查函数" title="Direct link to AddJobReadyFn - 作业就绪检查函数">​</a></h3>
<p><strong>作用</strong>: 注册作业就绪检查函数，用于判断作业是否准备好进行调度。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobReadyFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> vf api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ValidateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>ValidateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ValidateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.JobInfo</code> 类型，表示作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>true</code>: 表示作业已准备好进行调度</li>
<li>返回 <code>false</code>: 表示作业尚未准备好进行调度</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现Gang调度的就绪检查</li>
<li>实现依赖作业的状态检查</li>
<li>实现资源预检查</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">gp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">gangPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册Gang调度就绪检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobReadyFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">gp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否达到最小运行任务数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MinAvailable </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 统计可调度的任务数量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        schedulableCount </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskStatusIndex</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pending</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>canScheduleTask</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                schedulableCount</span><span class="token operator" style=color:#66d9ef>++</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否满足Gang调度条件</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> schedulableCount </span><span class="token operator" style=color:#66d9ef>>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MinAvailable</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>canScheduleTask</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否有节点可以调度该任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Nodes </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">State </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Ready </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>continue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 执行预选检查</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>PredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>continue</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=高级调度功能方法>高级调度功能方法<a href=#高级调度功能方法 class=hash-link aria-label="Direct link to 高级调度功能方法" title="Direct link to 高级调度功能方法">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjobenqueueablefn---作业入队检查函数>AddJobEnqueueableFn - 作业入队检查函数<a href=#addjobenqueueablefn---作业入队检查函数 class=hash-link aria-label="Direct link to AddJobEnqueueableFn - 作业入队检查函数" title="Direct link to AddJobEnqueueableFn - 作业入队检查函数">​</a></h3>
<p><strong>作用</strong>: 注册作业入队检查函数，用于判断作业是否可以进入调度队列。该函数将会把<code>Pending</code>状态的<code>PodGroup</code>转换为<code>Inqueue</code>状态，随后<code>PodHGroup</code>对应的<code>Pod</code>将会创建出来，新建出来的<code>Pod</code>处于<code>Pending</code>状态。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobEnqueueableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">VoteFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>VoteFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> VoteFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.JobInfo</code> 类型，表示作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回<code>util.Permit</code>(<code>1</code>): 表示支持作业入队的票数</li>
<li>返回<code>util.Abstain</code>(<code>0</code>): 表示中性票，不影响决策</li>
<li>返回<code>util.Reject</code>(<code>-1</code>): 表示反对作业入队的票数</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现作业依赖检查</li>
<li>实现资源预分配检查</li>
<li>实现调度策略控制</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">dp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">dependencyPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册作业依赖检查函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobEnqueueableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">dp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查作业依赖</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        dependencies </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getJobDependencies</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dep </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> dependencies </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            depJob </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>findJobByName</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dep</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> depJob </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> util</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Reject </span><span class="token comment" style=color:#8292a2;font-style:italic>// 拒绝入队</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> util</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Permit </span><span class="token comment" style=color:#8292a2;font-style:italic>// 允许入队</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addjobenqueuedfn---作业入队完成回调函数>AddJobEnqueuedFn - 作业入队完成回调函数<a href=#addjobenqueuedfn---作业入队完成回调函数 class=hash-link aria-label="Direct link to AddJobEnqueuedFn - 作业入队完成回调函数" title="Direct link to AddJobEnqueuedFn - 作业入队完成回调函数">​</a></h3>
<p><strong>作用</strong>: 注册作业入队完成回调函数，在作业成功入队后执行相关操作。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddJobEnqueuedFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobEnqueuedFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>JobEnqueuedFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> JobEnqueuedFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>interface{}</code> 类型，通常为 <code>*api.JobInfo</code> 类型，表示已入队的作业信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>无返回值，仅执行回调操作</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现作业入队后的状态更新</li>
<li>实现作业入队统计和监控</li>
<li>实现作业入队后的资源预留</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">mp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">monitorPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册作业入队完成回调函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddJobEnqueuedFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">mp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">obj </span><span class="token keyword" style=color:#66d9ef>interface</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> obj</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 记录作业入队时间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PodGroup</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PodGroup</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>make</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">PodGroup</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"volcano.sh/enqueued-time"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Now</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Format</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RFC3339</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 发送入队事件</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        klog</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>V</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Infof</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Job %s/%s has been enqueued to queue %s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Namespace</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addreservednodesfn---节点预留函数>AddReservedNodesFn - 节点预留函数<a href=#addreservednodesfn---节点预留函数 class=hash-link aria-label="Direct link to AddReservedNodesFn - 节点预留函数" title="Direct link to AddReservedNodesFn - 节点预留函数">​</a></h3>
<p><strong>作用</strong>: 注册节点预留函数，用于为特定作业预留节点资源。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddReservedNodesFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ReservedNodesFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>ReservedNodesFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> ReservedNodesFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>*api.TaskInfo</code> 类型，表示需要预留节点的任务信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示节点预留成功</li>
<li>返回 <code>error</code>: 表示节点预留失败，错误信息说明原因</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现节点资源预留</li>
<li>实现专用节点管理</li>
<li>实现资源隔离策略</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">reservationPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册节点预留函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddReservedNodesFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 为高优先级队列预留节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queues </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>isHighPriorityQueue</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token function" style=color:#e6db74>reserveNodesForQueue</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>reserveNodesForQueue</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    reservedCount </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    targetReserved </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>calculateReservedNodes</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">queue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Nodes </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> reservedCount </span><span class="token operator" style=color:#66d9ef>>=</span><span class="token plain"> targetReserved </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>break</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>canReserveNode</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 标记节点为预留状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>make</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>map</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Annotations</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"volcano.sh/reserved-for"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            reservedCount</span><span class="token operator" style=color:#66d9ef>++</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addvictimtasksfns---受害者任务选择函数>AddVictimTasksFns - 受害者任务选择函数<a href=#addvictimtasksfns---受害者任务选择函数 class=hash-link aria-label="Direct link to AddVictimTasksFns - 受害者任务选择函数" title="Direct link to AddVictimTasksFns - 受害者任务选择函数">​</a></h3>
<p><strong>作用</strong>: 注册受害者任务选择函数，用于选择需要被抢占或回收的任务。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddVictimTasksFns</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fns </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">VictimTasksFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>VictimTasksFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> VictimTasksFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>[]*api.TaskInfo</code> 类型，表示候选受害者任务列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>[]*api.TaskInfo</code>: 表示最终选中的受害者任务列表</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现任务抢占策略</li>
<li>实现资源回收策略</li>
<li>实现多维度任务选择</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">vp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">victimPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册受害者任务选择函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    victimFns </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">VictimTasksFn</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 按优先级选择受害者</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">tasks </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> victims </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            minPriority </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>int32</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>1000</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> tasks </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                priority </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskPriority</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> priority </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> minPriority </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    minPriority </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    victims </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> priority </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> minPriority </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    victims </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>append</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">victims</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> victims</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 按运行时间选择受害者</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">tasks </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> victims </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> shortestRunTime time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Duration </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Hour </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>24</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> tasks </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                runTime </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getTaskRunTime</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> runTime </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> shortestRunTime </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    shortestRunTime </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> runTime</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    victims </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> runTime </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> shortestRunTime </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                    victims </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>append</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">victims</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> victims</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddVictimTasksFns</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">vp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> victimFns</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addtargetjobfn---目标作业选择函数>AddTargetJobFn - 目标作业选择函数<a href=#addtargetjobfn---目标作业选择函数 class=hash-link aria-label="Direct link to AddTargetJobFn - 目标作业选择函数" title="Direct link to AddTargetJobFn - 目标作业选择函数">​</a></h3>
<p><strong>作用</strong>: 注册目标作业选择函数，用于从作业列表中选择特定的目标作业。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddTargetJobFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TargetJobFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>TargetJobFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> TargetJobFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">JobInfo</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>参数: <code>[]*api.JobInfo</code> 类型，表示候选作业列表</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>*api.JobInfo</code>: 表示选中的目标作业</li>
<li>返回 <code>nil</code>: 表示没有找到合适的目标作业</li>
</ul>
<p><strong>使用场景</strong>:</p>
<ul>
<li>实现作业优先级选择</li>
<li>实现负载均衡策略</li>
<li>实现特殊调度策略</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">starvationPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册饥饿作业选择函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddTargetJobFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">jobs </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> targetJob </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">JobInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        maxWaitTime </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Duration</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> jobs </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 计算作业等待时间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            waitTime </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Since</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CreationTimestamp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Time</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否为饥饿作业</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> waitTime </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> maxWaitTime </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                targetJob </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                maxWaitTime </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> waitTime</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> targetJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addsimulateaddtaskfn---模拟添加任务函数>AddSimulateAddTaskFn - 模拟添加任务函数<a href=#addsimulateaddtaskfn---模拟添加任务函数 class=hash-link aria-label="Direct link to AddSimulateAddTaskFn - �模拟添加任务函数" title="Direct link to AddSimulateAddTaskFn - 模拟添加任务函数">​</a></h3>
<p><strong>作用</strong>: 注册模拟添加任务函数，用于在不实际调度的情况下模拟任务添加的效果。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddSimulateAddTaskFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">SimulateAddTaskFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>SimulateAddTaskFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> SimulateAddTaskFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待模拟添加的任务信息</li>
<li>第二个参数: <code>*api.NodeInfo</code> 类型，表示目标节点信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示模拟添加成功</li>
<li>返回 <code>error</code>: 表示模拟添加失败，错误信息说明原因</li>
</ul>
<p><strong>核心使用场景</strong>:</p>
<ul>
<li><strong>抢占调度验证</strong>：在<code>preempt action</code>中验证高优先级任务是否能在释放资源后成功调度</li>
<li><strong>避免实际操作副作用</strong>：在确定抢占策略前，不实际执行<code>Pod</code>调度操作</li>
<li><strong>提高抢占决策准确性</strong>：通过模拟验证抢占方案的可行性</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">simulatePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册模拟添加任务函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddSimulateAddTaskFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> state </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">k8sframework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CycleState</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> taskToSchedule </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> taskToAdd </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodeInfo </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 模拟将任务添加到节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        nodeInfo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddTask</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">taskToAdd</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查资源是否足够</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> nodeInfo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> nodeInfo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Allocatable</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"simulated CPU overcommit on node %s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodeInfo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addsimulateremovetaskfn---模拟移除任务函数>AddSimulateRemoveTaskFn - 模拟移除任务函数<a href=#addsimulateremovetaskfn---模拟移除任务函数 class=hash-link aria-label="Direct link to AddSimulateRemoveTaskFn - 模拟移除任务函数" title="Direct link to AddSimulateRemoveTaskFn - 模拟移除任务函数">​</a></h3>
<p><strong>作用</strong>: 注册模拟移除任务函数，用于在不实际移除的情况下模拟任务移除的效果。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddSimulateRemoveTaskFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">SimulateRemoveTaskFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>SimulateRemoveTaskFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> SimulateRemoveTaskFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待模拟移除的任务信息</li>
<li>第二个参数: <code>*api.NodeInfo</code> 类型，表示目标节点信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示模拟移除成功</li>
<li>返回 <code>error</code>: 表示模拟移除失败，错误信息说明原因</li>
</ul>
<p><strong>核心使用场景</strong>:</p>
<ul>
<li><strong>抢占资源释放模拟</strong>：在<code>preempt action</code>中模拟驱逐低优先级任务后的资源状态</li>
<li><strong>避免不必要的Pod驱逐</strong>：验证移除某些任务后是否能释放足够资源</li>
<li><strong>减少资源浪费</strong>：避免驱逐Pod后发现无法调度目标任务的情况</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">simulatePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册模拟移除任务函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddSimulateRemoveTaskFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> state </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">k8sframework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CycleState</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> taskToSchedule </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> taskToRemove </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> nodeInfo </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 模拟从节点移除任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        nodeInfo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>RemoveTask</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">taskToRemove</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addsimulateallocatablefn---模拟资源分配函数>AddSimulateAllocatableFn - 模拟资源分配函数<a href=#addsimulateallocatablefn---模拟资源分配函数 class=hash-link aria-label="Direct link to AddSimulateAllocatableFn - 模拟资源分配函数" title="Direct link to AddSimulateAllocatableFn - 模拟资源分配函数">​</a></h3>
<p><strong>作用</strong>: 注册模拟资源分配函数，用于在模拟环境中检查资源分配的可行性。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddSimulateAllocatableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">SimulateAllocatableFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>SimulateAllocatableFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> SimulateAllocatableFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.QueueInfo</code> 类型，表示队列信息</li>
<li>第二个参数: <code>*api.TaskInfo</code> 类型，表示待分配的任务信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>true</code>: 表示在模拟环境中队列可以为任务分配资源</li>
<li>返回 <code>false</code>: 表示在模拟环境中队列无法为任务分配资源</li>
</ul>
<p><strong>核心使用场景</strong>:</p>
<ul>
<li><strong>队列资源配额验证</strong>：在<code>preempt action</code>抢占过程中验证队列是否有足够配额来调度任务</li>
<li><strong>多轮抢占决策支持</strong>：为复杂的抢占算法提供模拟环境</li>
<li><strong>资源分配预检查</strong>：确保只有在确认可以成功调度时才执行实际抢占操作</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">simulatePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册模拟资源分配函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddSimulateAllocatableFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> state </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">k8sframework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CycleState</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> queue </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">QueueInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 在模拟环境中检查队列资源分配</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        simulatedUsed </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resource</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            Memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">   queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 检查是否超出队列容量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> simulatedUsed</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>&lt;=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">               simulatedUsed</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>&lt;=</span><span class="token plain"> queue</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Capability</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addsimulatepredicatefn---模拟预选函数>AddSimulatePredicateFn - 模拟预选函数<a href=#addsimulatepredicatefn---模拟预选函数 class=hash-link aria-label="Direct link to AddSimulatePredicateFn - 模拟预选函数" title="Direct link to AddSimulatePredicateFn - 模拟预选函数">​</a></h3>
<p><strong>作用</strong>: 注册模拟预选函数，用于在模拟环境中进行节点过滤检查。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddSimulatePredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">name </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> fn api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">SimulatePredicateFn</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>SimulatePredicateFn类型定义</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> SimulatePredicateFn </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li>第一个参数: <code>*api.TaskInfo</code> 类型，表示待模拟调度的任务信息</li>
<li>第二个参数: <code>*api.NodeInfo</code> 类型，表示候选节点信息</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>返回 <code>nil</code>: 表示在模拟环境中任务可以调度到该节点</li>
<li>返回 <code>error</code>: 表示在模拟环境中任务不能调度到该节点，错误信息说明原因</li>
</ul>
<p><strong>核心使用场景</strong>:</p>
<ul>
<li><strong>抢占节点约束验证</strong>：在<code>preempt action</code>抢占过程中验证任务在模拟环境中是否满足节点约束条件</li>
<li><strong>拓扑约束检查</strong>：在抢占场景中维护拓扑约束的同时验证调度可行性</li>
<li><strong>智能抢占决策</strong>：确保抢占后的任务能满足所有节点级别的调度要求</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">simulatePlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册模拟预选函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddSimulatePredicateFn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ctx context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Context</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> state </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">k8sframework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CycleState</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeInfo</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 在模拟环境中检查节点适配性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        availableCPU </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Allocatable</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        availableMemory </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Allocatable</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Used</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">MilliCPU </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> availableCPU </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"simulated CPU insufficient on node %s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Memory </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> availableMemory </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Errorf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"simulated memory insufficient on node %s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=事件处理相关方法>事件处理相关方法<a href=#事件处理相关方法 class=hash-link aria-label="Direct link to 事件处理相关方法" title="Direct link to 事件处理相关方法">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=addeventhandler---事件处理器注册函数>AddEventHandler - 事件处理器注册函数<a href=#addeventhandler---事件处理器注册函数 class=hash-link aria-label="Direct link to AddEventHandler - 事件处理器注册函数" title="Direct link to AddEventHandler - 事件处理器注册函数">​</a></h3>
<p><strong>作用</strong>: 注册事件处理器，用于在任务分配和释放过程中执行自定义的回调逻辑。这是插件中对资源分配管理的关键方法。</p>
<p><strong>函数签名</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>AddEventHandler</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">eh </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">EventHandler</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>EventHandler结构</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> EventHandler </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    AllocateFunc   </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    DeallocateFunc </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> Event </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Task </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TaskInfo</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Err  </span><span class="token builtin" style=color:#e6db74>error</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>参数详解</strong>:</p>
<ul>
<li><code>AllocateFunc</code>: 任务被正式分配到节点时（<code>Allocate</code>操作）、进入流水线调度时（<code>Pipeline</code>操作）、被驱逐的任务恢复运行时（<code>Unevict</code>操作），参数为包含任务和节点信息的事件</li>
<li><code>DeallocateFunc</code>: 任务被抢占驱逐（<code>Evict</code>操作）、调度决策被撤销（<code>UnPipeline</code>操作）、任务分配被取消（<code>UnAllocate</code>操作）时，参数为包含任务和节点信息的事件</li>
</ul>
<p><strong>返回值含义</strong>:</p>
<ul>
<li>无返回值，仅执行事件处理逻辑</li>
</ul>
<p><strong>核心使用场景</strong>:</p>
<ul>
<li><strong>资源分配跟踪</strong>：在任务成功分配到节点时执行资源统计和状态更新</li>
<li><strong>资源释放管理</strong>：在任务从节点释放时执行资源清理和状态恢复</li>
<li><strong>插件状态同步</strong>：维护插件内部的资源分配状态与调度器状态一致</li>
<li><strong>多租户资源管理</strong>：实现队列级别的资源使用统计和配额管理</li>
</ul>
<p><strong>调用时机</strong>:</p>
<ul>
<li><code>AllocateFunc</code>：在<code>ssn.Allocate()</code>、<code>ssn.Pipeline()</code>等分配操作成功后调用</li>
<li><code>DeallocateFunc</code>：在<code>ssn.Evict()</code>、<code>ssn.UpdateTaskStatus()</code>等释放操作后调用</li>
</ul>
<p><strong>代码示例</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cp </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">capacityPlugin</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OnSessionOpen</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">ssn </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Session</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic>// 注册事件处理器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddEventHandler</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">EventHandler</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        AllocateFunc</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Jobs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Job</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            attr </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> cp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">queueOpts</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 更新队列已使用资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Add</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            klog</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>V</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Infof</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Capacity allocated &lt;%v> to queue &lt;%v>, total allocated &lt;%v>"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        DeallocateFunc</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Jobs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Job</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            attr </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> cp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">queueOpts</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic>// 释放队列已使用资源</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sub</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            klog</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>V</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Infof</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Capacity deallocated &lt;%v> from queue &lt;%v>, total allocated &lt;%v>"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>实际应用场景</strong>:</p>
<ol>
<li>
<p><strong>DRF插件中的资源份额管理</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddEventHandler</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">EventHandler</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    AllocateFunc</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        attr </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> drf</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">jobAttrs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Job</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Add</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 重新计算主导资源份额</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">share </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> drf</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>calculateShare</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">request</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Proportion插件中的权重调整</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddEventHandler</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">EventHandler</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    AllocateFunc</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        job </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Jobs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Job</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        attr </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">queueOpts</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 更新队列资源使用情况</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        attr</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">allocated</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Add</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Resreq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 重新计算队列权重</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>updateQueueWeight</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Queue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> attr</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>NUMA感知插件中的拓扑状态管理</strong>:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">ssn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>AddEventHandler</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>&</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">EventHandler</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    AllocateFunc</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">event </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Event</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        node </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">nodeResSets</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeName</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 更新NUMA节点资源分配状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">assignRes</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">UID</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> pp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>allocateNumaResource</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">node</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        klog</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>V</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Infof</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"NUMA resource allocated for task %s on node %s"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Name</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> event</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">NodeName</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<p><strong>重要特性</strong>:</p>
<ul>
<li><strong>自动触发</strong>：无需手动调用，调度器在资源分配/释放时自动触发</li>
<li><strong>状态同步</strong>：确保插件内部状态与调度器实际状态保持一致</li>
<li><strong>错误处理</strong>：<code>Event</code>结构包含错误信息，支持异常情况处理</li>
<li><strong>多插件支持</strong>：多个插件可以注册不同的事件处理器，按注册顺序执行</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/cloud-native/volcano-scheduler-actions-plugins><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Volcano Actions&Plugins详解</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/cloud-native/volcano-hierarchy-queue-scheduling-issue><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Volcano层级队列配置引发的调度器系统性故障问题</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#排序相关方法 class="table-of-contents__link toc-highlight">排序相关方法</a><ul><li><a href=#addjoborderfn---作业排序函数 class="table-of-contents__link toc-highlight">AddJobOrderFn - 作业排序函数</a><li><a href=#addqueueorderfn---队列排序函数 class="table-of-contents__link toc-highlight">AddQueueOrderFn - 队列排序函数</a><li><a href=#addvictimqueueorderfn---受害者队列排序函数 class="table-of-contents__link toc-highlight">AddVictimQueueOrderFn - 受害者队列排序函数</a><li><a href=#addclusterorderfn---集群排序函数 class="table-of-contents__link toc-highlight">AddClusterOrderFn - 集群排序函数</a><li><a href=#addtaskorderfn---任务排序函数 class="table-of-contents__link toc-highlight">AddTaskOrderFn - 任务排序函数</a></ul><li><a href=#调度决策相关方法 class="table-of-contents__link toc-highlight">调度决策相关方法</a><ul><li><a href=#addpredicatefn---节点过滤函数 class="table-of-contents__link toc-highlight">AddPredicateFn - 节点过滤函数</a><li><a href=#addprepredicatefn---预过滤函数 class="table-of-contents__link toc-highlight">AddPrePredicateFn - 预过滤函数</a><li><a href=#addbestnodefn---最佳节点选择函数 class="table-of-contents__link toc-highlight">AddBestNodeFn - 最佳节点选择函数</a><li><a href=#addnodeorderfn---节点打分函数 class="table-of-contents__link toc-highlight">AddNodeOrderFn - 节点打分函数</a><li><a href=#addhypernodeorderfn---超级节点排序函数 class="table-of-contents__link toc-highlight">AddHyperNodeOrderFn - 超级节点排序函数</a><li><a href=#addbatchnodeorderfn---批��量节点排序函数 class="table-of-contents__link toc-highlight">AddBatchNodeOrderFn - 批量节点排序函数</a><li><a href=#addnodemapfn---节点映射函数 class="table-of-contents__link toc-highlight">AddNodeMapFn - 节点映射函数</a><li><a href=#addnodereducefn---节点归约函数 class="table-of-contents__link toc-highlight">AddNodeReduceFn - 节点归约函数</a><li><a href=#addallocatablefn---资源分配检查函数 class="table-of-contents__link toc-highlight">AddAllocatableFn - 资源分配检查函数</a><li><a href=#addoverusedfn---队列超用检查函数 class="table-of-contents__link toc-highlight">AddOverusedFn - 队列超用检查函数</a></ul><li><a href=#抢占和回收相关方法 class="table-of-contents__link toc-highlight">抢占和回收相关方法</a><ul><li><a href=#addpreemptablefn---抢占判断函数 class="table-of-contents__link toc-highlight">AddPreemptableFn - 抢占判断函数</a><li><a href=#addpreemptivefn---抢占能力检查函数 class="table-of-contents__link toc-highlight">AddPreemptiveFn - 抢占能力检查函数</a><li><a href=#addreclaimablefn---资源回收函数 class="table-of-contents__link toc-highlight">AddReclaimableFn - 资源回收函数</a></ul><li><a href=#作业状态检查相关方法 class="table-of-contents__link toc-highlight">作业状态检查相关方法</a><ul><li><a href=#addjobpipelinedfn---作业流水线检查函数 class="table-of-contents__link toc-highlight">AddJobPipelinedFn - 作业流水线检查函数</a><li><a href=#addjobvalidfn---作业有效性检查函数 class="table-of-contents__link toc-highlight">AddJobValidFn - 作业有效性检查函数</a><li><a href=#addjobstarvingfns---作业饥饿检查函数 class="table-of-contents__link toc-highlight">AddJobStarvingFns - 作业饥饿检查函数</a><li><a href=#addjobreadyfn---作业就绪检查函数 class="table-of-contents__link toc-highlight">AddJobReadyFn - 作业就绪检查函数</a></ul><li><a href=#高级调度功能方法 class="table-of-contents__link toc-highlight">高级调度功能方法</a><ul><li><a href=#addjobenqueueablefn---作业入队检查函数 class="table-of-contents__link toc-highlight">AddJobEnqueueableFn - 作业入队检查函数</a><li><a href=#addjobenqueuedfn---作业入队完成回调函数 class="table-of-contents__link toc-highlight">AddJobEnqueuedFn - 作业入队完成回调函数</a><li><a href=#addreservednodesfn---节点预留函数 class="table-of-contents__link toc-highlight">AddReservedNodesFn - 节点预留函数</a><li><a href=#addvictimtasksfns---受害者任务选择函数 class="table-of-contents__link toc-highlight">AddVictimTasksFns - 受害者任务选择函数</a><li><a href=#addtargetjobfn---目标作业选择函数 class="table-of-contents__link toc-highlight">AddTargetJobFn - 目标作业选择函数</a><li><a href=#addsimulateaddtaskfn---模拟添加任务函数 class="table-of-contents__link toc-highlight">AddSimulateAddTaskFn - 模拟添加任务函数</a><li><a href=#addsimulateremovetaskfn---模拟移除任务函数 class="table-of-contents__link toc-highlight">AddSimulateRemoveTaskFn - 模拟移除任务函数</a><li><a href=#addsimulateallocatablefn---模拟资源分配函数 class="table-of-contents__link toc-highlight">AddSimulateAllocatableFn - 模拟资源分配函数</a><li><a href=#addsimulatepredicatefn---模拟预选函数 class="table-of-contents__link toc-highlight">AddSimulatePredicateFn - 模拟预选函数</a></ul><li><a href=#事件处理相关方法 class="table-of-contents__link toc-highlight">事件处理相关方法</a><ul><li><a href=#addeventhandler---事件处理器注册函数 class="table-of-contents__link toc-highlight">AddEventHandler - 事件处理器注册函数</a></ul></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>