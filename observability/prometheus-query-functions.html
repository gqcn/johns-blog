<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/可观测性/监控技术/Prometheus: 查询函数" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Prometheus: 查询函数 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/observability/prometheus-query-functions><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Prometheus: 查询函数 | John's Blog"><meta data-rh=true name=description content=详细介绍Prometheus的完整查询函数列表及其用法，包括数学函数、时间函数、聚合函数、直方图函数等，以及Grafana中查询Prometheus数据时的特有变量和函数。><meta data-rh=true property=og:description content=详细介绍Prometheus的完整查询函数列表及其用法，包括数学函数、时间函数、聚合函数、直方图函数等，以及Grafana中查询Prometheus数据时的特有变量和函数。><meta data-rh=true name=keywords content=Prometheus,PromQL,查询函数,监控,Grafana,时间序列,聚合函数,rate,increase,histogram><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/observability/prometheus-query-functions><link data-rh=true rel=alternate href=https://johng.cn/observability/prometheus-query-functions hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/observability/prometheus-query-functions hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.c68b3aea.js defer></script><script src=/assets/js/main.d4848e10.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a class="navbar__item navbar__link" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/ai>AI技术</a><button aria-label="Expand sidebar category 'AI技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/observability>可观测性</a><button aria-label="Collapse sidebar category '可观测性'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/observability/tracing>链路跟踪</a><button aria-label="Expand sidebar category '链路跟踪'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/observability/monitoring>监控技术</a><button aria-label="Collapse sidebar category '监控技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/observability/prometheus-query-functions>Prometheus: 查询函数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/prometheus-rate-irate>Prometheus: rate与irate</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/prometheus-alert-rules>Prometheus: 常用告警PromeQL</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/prometheus-exporter-metrics-samples>常用exporter指标samples及指标说明</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/opentelemetry-metrics-introduction>OpenTelemetry Metrics介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/linux-memory-cgroup-statistics>Linux中进程内存及cgroup内存统计差异</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/cadvisor-working-set-bytes-oom-killer>Cadvisor working set bytes与linux oom killer</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/kubelet-cadvisor-metrics-missing>从kubelet获取cadvisor指标偶现丢失container*相关指标</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/kubelet-cadvisor-metrics-collection>如何从kubelet拉取cadvisor指标</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/observability/ebpf-learning-guide>eBPF学习资料</a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/observability><span itemprop=name>可观测性</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/observability/monitoring><span itemprop=name>监控技术</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Prometheus: 查询函数</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p>参考<code>Prometheus</code>官网文档：<a href=https://prometheus.io/docs/prometheus/latest/querying/functions/ target=_blank rel="noopener noreferrer">https://prometheus.io/docs/prometheus/latest/querying/functions/</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=数学函数>数学函数<a href=#数学函数 class=hash-link aria-label="Direct link to 数学函数" title="Direct link to 数学函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>abs()</code><td>返回输入向量中所有浮点样本的绝对值<td>包含绝对值的向量<tr><td><code>ceil()</code><td>向上取整到最接近的整数<td>向上取整后的向量<tr><td><code>floor()</code><td>向下取整到最接近的整数<td>向下取整后的向量<tr><td><code>round()</code><td>四舍五入到最接近的整数<td>四舍五入后的向量<tr><td><code>exp()</code><td>计算指数函数<code>e^x</code><td>指数值向量<tr><td><code>ln()</code><td>计算自然对数<td>自然对数向量<tr><td><code>log2()</code><td>计算以<code>2</code>为底的对数<td>对数向量<tr><td><code>log10()</code><td>计算以<code>10</code>为底的对数<td>对数向量<tr><td><code>sqrt()</code><td>计算平方根<td>平方根向量<tr><td><code>sgn()</code><td>返回符号：正数返回<code>1</code>，负数返回<code>-1</code>，零返回<code>0</code><td>符号向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 取绝对值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">abs</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">temperature</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 向上取整</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ceil</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cpu_usage</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 1.49 → 2.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 向下取整</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">floor</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">memory_usage</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 1.78 → 1.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 四舍五入到最接近的0.5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">round</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">latency, </span><span class="token number" style=color:#ae81ff>0.5</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=限制函数>限制函数<a href=#限制函数 class=hash-link aria-label="Direct link to 限制函数" title="Direct link to 限制函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>clamp()</code><td>将值限制在指定的最小值和最大值之间<td>限制后的向量<tr><td><code>clamp_max()</code><td>将值限制在指定的最大值以下<td>限制后的向量<tr><td><code>clamp_min()</code><td>将值限制在指定的最小值以上<td>限制后的向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 将CPU使用率限制在0-100之间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">clamp</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cpu_usage, </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">, </span><span class="token number" style=color:#ae81ff>100</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 将内存使用限制在1024以下</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">clamp_max</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">memory_usage_bytes, </span><span class="token number" style=color:#ae81ff>1024</span><span class="token plain">*1024*1024</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 确保磁盘使用率不为负数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">clamp_min</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">disk_usage, </span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=时间和日期函数>时间和日期函数<a href=#时间和日期函数 class=hash-link aria-label="Direct link to 时间和日期函数" title="Direct link to 时间和日期函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>time()</code><td>返回自<code>1970年1月1日UTC</code>以来的秒数<td>当前时间戳（秒）<tr><td><code>timestamp()</code><td>返回向量中每个样本的时间戳<td>时间戳向量<tr><td><code>minute()</code><td>返回时间戳的分钟部分（<code>0-59</code>）<td>分钟值向量<tr><td><code>hour()</code><td>返回时间戳的小时部分（<code>0-23</code>）<td>小时值向量<tr><td><code>day_of_week()</code><td>返回星期几（<code>0-6</code>，<code>0</code>表示星期日）<td>星期值向量<tr><td><code>day_of_month()</code><td>返回月份中的第几天（<code>1-31</code>）<td>日期值向量<tr><td><code>day_of_year()</code><td>返回一年中的第几天（<code>1-365/366</code>）<td>天数值向量<tr><td><code>days_in_month()</code><td>返回月份的天数（<code>28-31</code>）<td>天数值向量<tr><td><code>month()</code><td>返回月份（<code>1-12</code>）<td>月份值向量<tr><td><code>year()</code><td>返回年份<td>年份值向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 获取当前小时（0-23）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">hour</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取指标的时间戳</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">timestamp</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 只在工作日（周一到周五）执行告警</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">day_of_week</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>></span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> and day_of_week</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>6</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取当前月份</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">month</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=变化率和增长函数>变化率和增长函数<a href=#变化率和增长函数 class=hash-link aria-label="Direct link to 变化率和增长函数" title="Direct link to 变化率和增长函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>rate()</code><td>计算时间序列的每秒平均增长率（用于<code>Counter</code>）<td>每秒增长率向量<tr><td><code>irate()</code><td>计算时间序列的瞬时增长率（基于最后两个数据点）<td>瞬时增长率向量<tr><td><code>increase()</code><td>计算时间范围内的增长量（用于<code>Counter</code>）<td>增长量向量<tr><td><code>delta()</code><td>计算时间范围内的差值（用于<code>Gauge</code>）<td>差值向量<tr><td><code>idelta()</code><td>计算最后两个样本之间的差值（用于<code>Gauge</code>）<td>差值向量<tr><td><code>deriv()</code><td>计算时间序列的每秒导数（使用简单线性回归）<td>导数向量<tr><td><code>predict_linear()</code><td>基于线性回归预测未来值<td>预测值向量<tr><td><code>changes()</code><td>返回时间范围内值变化的次数<td>变化次数向量<tr><td><code>resets()</code><td>返回<code>Counter</code>重置的次数<td>重置次数向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 计算HTTP请求的每秒速率</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rate</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_requests_total</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 计算过去5分钟的请求增长量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">increase</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_requests_total</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 计算CPU温度在2小时内的变化</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">delta</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cpu_temp_celsius</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">2h</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 预测1小时后的磁盘使用量（3600秒后）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">predict_linear</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">disk_usage_bytes</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">1h</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">, </span><span class="token number" style=color:#ae81ff>3600</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=聚合函数时间范围>聚合函数（时间范围）<a href=#聚合函数时间范围 class=hash-link aria-label="Direct link to 聚合函数（时间范围）" title="Direct link to 聚合函数（时间范围）">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>avg_over_time()</code><td>计算时间范围内的平均值<td>平均值向量<tr><td><code>min_over_time()</code><td>计算时间范围内的最小值<td>最小值向量<tr><td><code>max_over_time()</code><td>计算时间范围内的最大值<td>最大值向量<tr><td><code>sum_over_time()</code><td>计算时间范围内的总和<td>总和向量<tr><td><code>count_over_time()</code><td>计算时间范围内的样本数量<td>样本数量向量<tr><td><code>quantile_over_time()</code><td>计算时间范围内的分位数<td>分位数向量<tr><td><code>stddev_over_time()</code><td>计算时间范围内的标准差<td>标准差向量<tr><td><code>stdvar_over_time()</code><td>计算时间范围内的方差<td>方差向量<tr><td><code>last_over_time()</code><td>返回时间范围内的最后一个样本<td>最后样本向量<tr><td><code>present_over_time()</code><td>如果时间范围内有任何样本则返回1<td>0或1的向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 计算过去5分钟CPU使用率的平均值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">avg_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cpu_usage</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取过去1小时温度的最大值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">max_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">temperature</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">1h</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 计算过去5分钟的95分位延迟</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">quantile_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0.95</span><span class="token plain">, http_request_duration_seconds</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 检查指标在过去5分钟内是否有数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">present_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=实验性聚合函数需要启用特性标志>实验性聚合函数（需要启用特性标志）<a href=#实验性聚合函数需要启用特性标志 class=hash-link aria-label="Direct link to 实验性聚合函数（需要启用特性标志）" title="Direct link to 实验性聚合函数（需要启用特性标志）">​</a></h2>
<p>这些函数需要通过 <code>--enable-feature=promql-experimental-functions</code> 启用。</p>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>mad_over_time()</code><td>计算时间范围内的中位数绝对偏差<td><code>MAD</code>值向量<tr><td><code>first_over_time()</code><td>返回时间范围内的第一个样本<td>第一个样本向量<tr><td><code>ts_of_first_over_time()</code><td>返回第一个样本的时间戳<td>时间戳向量<tr><td><code>ts_of_last_over_time()</code><td>返回最后一个样本的时间戳<td>时间戳向量<tr><td><code>ts_of_min_over_time()</code><td>返回最小值样本的时间戳<td>时间戳向量<tr><td><code>ts_of_max_over_time()</code><td>返回最大值样本的时间戳<td>时间戳向量<tr><td><code>double_exponential_smoothing()</code><td>双指数平滑（<code>Holt Linear</code>）<td>平滑值向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 获取时间范围内的第一个样本</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">first_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">metric</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取最大值出现的时间戳</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ts_of_max_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">cpu_usage</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">1h</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 双指数平滑（平滑因子0.5，趋势因子0.5）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">double_exponential_smoothing</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">metric</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">, </span><span class="token number" style=color:#ae81ff>0.5</span><span class="token plain">, </span><span class="token number" style=color:#ae81ff>0.5</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=��直方图函数>直方图函数<a href=#直方图函数 class=hash-link aria-label="Direct link to 直方图函数" title="Direct link to 直方图函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>histogram_count()</code><td>返回直方图中的观测数量<td>计数向量<tr><td><code>histogram_sum()</code><td>返回直方图中的观测总和<td>总和向量<tr><td><code>histogram_avg()</code><td>返回直方图的算术平均值<td>平均值向量<tr><td><code>histogram_quantile()</code><td>计算直方图的分位数<td>分位数向量<tr><td><code>histogram_fraction()</code><td>计算指定范围内的观测比例<td>比例向量<tr><td><code>histogram_stddev()</code><td>返回直方图的标准差估计值<td>标准差向量<tr><td><code>histogram_stdvar()</code><td>返回直方图的方差估计值<td>方差向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 计算90分位的请求延迟（经典直方图）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">histogram_quantile</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0.9</span><span class="token plain">, rate</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_request_duration_seconds_bucket</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">10m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>))</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 计算平均请求延迟（原生直方图）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">histogram_avg</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rate</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_request_duration_seconds</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">5m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>))</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 计算200ms以内请求的比例</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">histogram_fraction</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">, </span><span class="token number" style=color:#ae81ff>0.2</span><span class="token plain">, rate</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_request_duration_seconds</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">1h</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>))</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 按job聚合计算90分位延迟</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">histogram_quantile</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0.9</span><span class="token plain">, </span><span class="token function" style=color:#e6db74>sum</span><span class="token plain"> by </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">job, le</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rate</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_request_duration_seconds_bucket</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">10m</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>))</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=标签操作函数>标签操作函数<a href=#标签操作函数 class=hash-link aria-label="Direct link to 标签操作函数" title="Direct link to 标签操作函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>label_join()</code><td>将多个标签的值连接成新标签<td>带新标签的向量<tr><td><code>label_replace()</code><td>使用正则表达式替换标签值<td>替换后的向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 将多个标签连接成新标签</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">label_join</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">job</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"api-server"</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"endpoint"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>":"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"instance"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"port"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 使用正则提取标签的一部分</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">label_replace</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">service</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"api:v1"</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"version"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"</span><span class="token string variable" style=color:#f8f8f2>$1</span><span class="token string" style=color:#a6e22e>"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"service"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>".*:(.*)"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 从instance标签中提取主机名</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">label_replace</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up, </span><span class="token string" style=color:#a6e22e>"host"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"</span><span class="token string variable" style=color:#f8f8f2>$1</span><span class="token string" style=color:#a6e22e>"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"instance"</span><span class="token plain">, </span><span class="token string" style=color:#a6e22e>"([^:]+):.*"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=排序函数>排序函数<a href=#排序函数 class=hash-link aria-label="Direct link to 排序函数" title="Direct link to 排序函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>sort()</code><td>按样本值升序排序<td>排序后的向量<tr><td><code>sort_desc()</code><td>按样本值降序排序<td>排序后的向量<tr><td><code>sort_by_label()</code><td>按标签值升序排序（实验性）<td>排序后的向量<tr><td><code>sort_by_label_desc()</code><td>按标签值降序排序（实验性）<td>排序后的向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 按请求数降序排列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">sort_desc</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">http_requests_total</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 按instance标签升序排列</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">sort_by_label</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up, </span><span class="token string" style=color:#a6e22e>"instance"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=缺失值检测函数>缺失值检测函数<a href=#缺失值检测函数 class=hash-link aria-label="Direct link to 缺失值检测函数" title="Direct link to 缺失值检测函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>absent()</code><td>如果向量为空则返回<code>1</code>，否则返回空向量<td><code>0</code>或<code>1</code>的向量<tr><td><code>absent_over_time()</code><td>如果时间范围内向量为空则返回<code>1</code><td><code>0</code>或<code>1</code>的向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 检测指标是否不存在（用于告警）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">absent</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">job</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"api-server"</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 检测过去1小时内是否没有数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">absent_over_time</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">job</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"api-server"</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">1h</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=类型转换函数>类型转换函数<a href=#��类型转换函数 class=hash-link aria-label="Direct link to 类型转换函数" title="Direct link to 类型转换函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>scalar()</code><td>将单元素向量转换为标量<td>标量值或<code>NaN</code><tr><td><code>vector()</code><td>将标量转换为向量<td>单元素向量</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 将聚合结果转换为标量用于计算</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">scalar</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sum</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>))</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 将常量转换为向量</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">vector</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>100</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=元数据函数>元数据函数<a href=#元数据函数 class=hash-link aria-label="Direct link to 元数据函数" title="Direct link to 元数据函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>info()</code><td>返回包含<code>info</code>标签的指标信息<td><code>info</code>类型指标</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 获取目标的元数据信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">target_info</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=三角函数>三角函数<a href=#三角函数 class=hash-link aria-label="Direct link to 三角函数" title="Direct link to 三角函数">​</a></h2>
<table><thead><tr><th>函数名称<th>函数描述<th>返回值<tbody><tr><td><code>acos()</code><td>反余弦函数<td>反余弦值向量<tr><td><code>acosh()</code><td>反双曲余弦函数<td>反双曲余弦值向量<tr><td><code>asin()</code><td>反正弦函数<td>反正弦值向量<tr><td><code>asinh()</code><td>反双曲正弦函数<td>反双曲正弦值向量<tr><td><code>atan()</code><td>反正切函数<td>反正切值向量<tr><td><code>atanh()</code><td>反双曲正切函数<td>反双曲正切值向量<tr><td><code>cos()</code><td>余弦函数<td>余弦值向量<tr><td><code>cosh()</code><td>双曲余弦函数<td>双曲余弦值向量<tr><td><code>sin()</code><td>正弦函数<td>正弦值向量<tr><td><code>sinh()</code><td>双曲正弦函数<td>双曲正弦值向量<tr><td><code>tan()</code><td>正切函数<td>正切值向量<tr><td><code>tanh()</code><td>双曲正切函数<td>双曲正切值向量<tr><td><code>deg()</code><td>将弧度转换为角度<td>角度值向量<tr><td><code>rad()</code><td>将角度转换为弧度<td>弧度值向量<tr><td><code>pi()</code><td>返回<code>π</code>的值<td><code>π</code>值</table>
<p><strong>常用示例：</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 获取π的值</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">pi</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 将角度转换为弧度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rad</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>90</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 结果约为1.5708</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 将弧度转换为角度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">deg</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">pi</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>))</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 结果为180</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/observability/monitoring><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>监控技术</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/observability/prometheus-rate-irate><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Prometheus: rate与irate</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#数学函数 class="table-of-contents__link toc-highlight">数学函数</a><li><a href=#限制函数 class="table-of-contents__link toc-highlight">限制函数</a><li><a href=#时间和日期函数 class="table-of-contents__link toc-highlight">时间和日期函数</a><li><a href=#变化率和增长函数 class="table-of-contents__link toc-highlight">变化率和增长函数</a><li><a href=#�聚合函数时间范围 class="table-of-contents__link toc-highlight">聚合函数（时间范围）</a><li><a href=#实验性聚合函数需要启用特性标志 class="table-of-contents__link toc-highlight">实验性聚合函数（需要启用特性标志）</a><li><a href=#直方图函数 class="table-of-contents__link toc-highlight">直方图函数</a><li><a href=#标签操作函数 class="table-of-contents__link toc-highlight">标签操作函数</a><li><a href=#排序函数 class="table-of-contents__link toc-highlight">排序函数</a><li><a href=#缺失值检测函数 class="table-of-contents__link toc-highlight">缺失值检测函数</a><li><a href=#类型转换函数 class="table-of-contents__link toc-highlight">类型转换函数</a><li><a href=#元数据函数 class="table-of-contents__link toc-highlight">元数据函数</a><li><a href=#三角函数 class="table-of-contents__link toc-highlight">三角函数</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>