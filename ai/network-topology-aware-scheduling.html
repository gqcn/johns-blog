<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/基础架构/算力调度/网络拓扑感知调度" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>网络拓扑感知调度（汇总分享） | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/network-topology-aware-scheduling><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="网络拓扑感知调度（汇总分享） | John's Blog"><meta data-rh=true name=description content="循序渐进地介绍网络拓扑感知调度的技术背景，从单机场景的GPU Direct技术出发，延伸到多机场景的RDMA技术（对比InfiniBand、RoCE、iWARP三种实现方案），再深入剖析跨交换机通信延迟、带宽损耗等痛点，最终详细讲解如何通过Volcano的network-topology-aware插件实现网络拓扑感知调度，包含HyperNode配置、调度原理及PD分离推理场景的完整实践示例。"><meta data-rh=true property=og:description content="循序渐进地介绍网络拓扑感知调度的技术背景，从单机场景的GPU Direct技术出发，延伸到多机场景的RDMA技术（对比InfiniBand、RoCE、iWARP三种实现方案），再深入剖析跨交换机通信延迟、带宽损耗等痛点，最终详细讲解如何通过Volcano的network-topology-aware插件实现网络拓扑感知调度，包含HyperNode配置、调度原理及PD分离推理场景的完整实践示例。"><meta data-rh=true name=keywords content="网络拓扑感知调度,Network Topology Aware Scheduling,GPU Direct,RDMA,InfiniBand,RoCE,iWARP,NVLink,NVSwitch,Volcano,HyperNode,network-topology-aware,多机多卡,分布式训练,AI训练,大模型,高性能计算,HPC,跨交换机通信,调度优化,PD分离,KV Cache,GPU集群,带宽优化,延迟优化"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/network-topology-aware-scheduling><link data-rh=true rel=alternate href=https://johng.cn/ai/network-topology-aware-scheduling hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/network-topology-aware-scheduling hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2ece4f8a.css><script src=/assets/js/runtime~main.ba8776ac.js defer></script><script src=/assets/js/main.d69f8fc0.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/agents-deep-dive-from-llm-to-autonomous-agents>智能体</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/copilot-skills-guide>应用开发</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/online-offline-batch-inference>推理服务</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/hpc-development-training-platform>训练微调</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/model-development>模型开发</a><button aria-label="Expand sidebar category '模型开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/rdma-brief>基础架构</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/rdma-brief>RDMA</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/nfd-gfd>NVIDIA</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/hybrid-scheduling-affinity-toleration>算力调度</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/hybrid-scheduling-affinity-toleration>混合调度的亲和性、污点容忍设计思考</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/hybrid-scheduling-scale-down-control>混部调度中如何控制在线服务的缩容逻辑</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/cpu-numa-affinity-scheduling>CPU亲和性与NUMA亲和性调度</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/cpu-numa-affinity-in-docker>Docker中的CPU&NUMA亲和性配置</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/cpu-numa-affinity-in-kubernetes>Kubernetes中CPU&NUMA亲和性配置</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/network-topology-aware-scheduling>网络拓扑感知调度（汇总分享）</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/vgpu-introduction-and-comparison>GPU虚拟化</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/what-is-llmops-mlops>LLMOps介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-acceleration-cards>常见智算加速卡汇总</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ai-training-inference-scenarios>AI基础架构中常见业务场景痛点</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/cpu-gpu>CPU&GPU架构差异及AI场景中的应用</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/basic-terminology>入门知识</a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li class=breadcrumbs__item><span class=breadcrumbs__link>基础架构</span><meta itemprop=position content=2><li class=breadcrumbs__item><span class=breadcrumbs__link>算力调度</span><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>网络拓扑感知调度（汇总分享）</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"/></svg></span>注意</div><div class=admonitionContent_BuS1><p>本文还在完善中，后续会持续更新内容和示例，完善后再删除该提示。</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=背景从单机到多机的通信挑战>背景：从单机到多机的通信挑战<a href=#背景从单机到多机的通信挑战 class=hash-link aria-label="Direct link to 背景：从单机到多机的通信挑战" title="Direct link to 背景：从单机到多机的通信挑战">​</a></h2>
<p>随着<code>AI</code>大模型规模的持续扩大，单台机器（即使配备多张高端<code>GPU</code>）已难以满足训练和推理的需求，分布式多机多卡成为常态。然而，当计算从单机扩展到多机时，通信架构面临根本性的变化——节点间的网络性能成为制约整体效率的关键瓶颈。</p>
<p>理解网络拓扑感知调度，需要先从单机场景的<code>GPU Direct</code>技术说起，再延伸到多机场景下的<code>RDMA</code>技术，最终引出网络拓扑感知调度的核心价值。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=gpu-direct单机场景的通信加速>GPU Direct：单机场景的通信加速<a href=#gpu-direct单机场景的通信加速 class=hash-link aria-label="Direct link to GPU Direct：单机场景的通信加速" title="Direct link to GPU Direct：单机场景的通信加速">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=什么是gpu-direct>什么是GPU Direct？<a href=#什么是gpu-direct class=hash-link aria-label="Direct link to 什么是GPU Direct？" title="Direct link to 什么是GPU Direct？">​</a></h3>
<p><code>GPU Direct</code>是<code>NVIDIA</code>开发的一系列高性能通信技术，旨在实现<code>GPU</code>与其他设备（网络接口卡<code>NIC</code>、存储设备、其他<code>GPU</code>）之间的<strong>直接数据传输</strong>，绕过<code>CPU</code>和主机内存，消除传统数据传输路径中的性能瓶颈。</p>
<p>在传统架构中，<code>GPU</code>与外部设备之间的数据传输必须经过<code>CPU</code>和主机内存，存在多次内存拷贝、<code>CPU</code>参与数据搬运等问题，导致延迟高、带宽受限。<code>GPU Direct</code>通过直接内存访问（<code>DMA</code>）技术，让设备绕过<code>CPU</code>直接与<code>GPU</code>显存通信。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=gpu-direct核心子技术>GPU Direct核心子技术<a href=#gpu-direct核心子技术 class=hash-link aria-label="Direct link to GPU Direct核心子技术" title="Direct link to GPU Direct核心子技术">​</a></h3>
<table><thead><tr><th>技术<th>场景<th>核心功能<tbody><tr><td><code>GPU Direct Storage</code><td><code>GPU ↔ 存储</code><td><code>GPU</code>直接访问<code>NVMe/SSD</code>，绕过<code>CPU</code>加载数据<tr><td><code>GPU Direct P2P</code><td><code>GPU ↔ GPU</code>（同节点<code>PCIe</code>）<td>同服务器内<code>GPU</code>间点对点通信，绕过<code>CPU</code><tr><td><code>GPU Direct RDMA</code><td><code>GPU ↔ 网络</code><td><code>GPU</code>直接与网卡通信，实现远程直接内存访问</table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=gpu-direct-p2p与nvlink>GPU Direct P2P与NVLink<a href=#gpu-direct-p2p与nvlink class=hash-link aria-label="Direct link to GPU Direct P2P与NVLink" title="Direct link to GPU Direct P2P与NVLink">​</a></h3>
<p><code>GPU Direct P2P</code>允许同一物理服务器上共享<code>PCIe</code>总线的<code>GPU</code>之间直接访问彼此显存，消除了经过<code>CPU</code>的两次拷贝，延迟降低约<code>50%</code>。但<code>P2P</code>受限于<code>PCIe</code>带宽（<code>PCIe 4.0</code>仅约<code>128 GB/s</code>双向），且受拓扑约束只适用于同一<code>PCIe</code>交换机下的<code>GPU</code>。</p>
<p>为突破<code>PCIe</code>带宽瓶颈，<code>NVIDIA</code>推出了<code>NVLink</code>高速点对点互联技术。以第四代<code>NVLink</code>（<code>Hopper</code>架构）为例，单<code>GPU</code>总带宽可达<code>900 GB/s</code>，是<code>PCIe 5.0</code>的<code>7</code>倍。进一步地，<code>NVSwitch</code>交换芯片实现了单机<code>8</code>张<code>GPU</code>的<strong>全互联</strong>，任意两<code>GPU</code>间均有直达路径，彻底解决了单机多卡通信瓶颈。</p>
<table><thead><tr><th>架构<th>全互联<th>典型总带宽<th>延迟<tbody><tr><td><code>PCIe P2P</code><td>否<td><code>~128 GB/s</code><td>高<tr><td><code>NVLink</code>（点对点）<td>否<td><code>~900 GB/s</code><td>低<tr><td><code>NVLink + NVSwitch</code><td><strong>是</strong><td><code>900 GB/s</code><td><strong>极低</strong></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=单机的局限无法解决多机问题>单机的局限：无法解决多机问题<a href=#单机的局限无法解决多机问题 class=hash-link aria-label="Direct link to 单机的局限：无法解决多机问题" title="Direct link to 单机的局限：无法解决多机问题">​</a></h3>
<p><code>NVLink</code>和<code>NVSwitch</code>解决了单机内部的高速互联，但<strong>仅限于同一物理服务器内部</strong>。当训练规模扩展到多台服务器时，节点间的通信必须借助网络实现。此时，普通以太网（<code>TCP/IP</code>传统协议栈）因大量内存拷贝、<code>CPU</code>参与、内核协议处理等原因，成为明显的性能瓶颈，这正是<code>RDMA</code>技术的用武之地。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=rdma多机场景的高性能通信基石>RDMA：多机场景的高性能通信基石<a href=#rdma多机场景的高性能通信基石 class=hash-link aria-label="Direct link to RDMA：多机场景的高性能通信基石" title="Direct link to RDMA：多机场景的高性能通信基石">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=什么是rdma>什么是RDMA？<a href=#什么是rdma class=hash-link aria-label="Direct link to 什么是RDMA？" title="Direct link to 什么是RDMA？">​</a></h3>
<p><code>RDMA</code>（<code>Remote Direct Memory Access</code>，远程直接内存访问）是一种绕过远程主机操作系统内核、直接访问其内存数据的技术。与传统<code>TCP/IP</code>通信相比，<code>RDMA</code>具有三大核心特性：</p>
<ul>
<li><strong><code>CPU Offload</code></strong>：无需<code>CPU</code>干预，数据传输不消耗远程主机的<code>CPU</code>资源</li>
<li><strong><code>Kernel Bypass</code></strong>：应用程序通过专有<code>Verbs</code>接口直接在用户态执行数据传输，无需内核态与用户态之间的上下文切换</li>
<li><strong><code>Zero Copy</code></strong>：数据直接从发送端缓冲区传输到接收端缓冲区，无需经过网络软件协议栈</li>
</ul>
<p>传统<code>TCP/IP</code>通信需要经过「用户空间→内核<code>Socket Buffer</code>→<code>NIC Buffer</code>→网络→<code>NIC Buffer</code>→内核<code>Socket Buffer</code>→用户空间」等多次内存拷贝，而<code>RDMA</code>将这一过程压缩为<strong>直接内存到内存的传输</strong>，大幅降低延迟、提升带宽利用率。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=rdma三种实现方案对比>RDMA三种实现方案对比<a href=#rdma三种实现方案对比 class=hash-link aria-label="Direct link to RDMA三种实现方案对比" title="Direct link to RDMA三种实现方案对比">​</a></h3>
<p>目前市场上主流的<code>RDMA</code>实现方案有三种，均使用相同的<code>Verbs API</code>，但物理层和链路层有所不同：</p>
<table><thead><tr><th>维度<th><code>InfiniBand（IB）</code><th><code>RoCE（RoCE v2）</code><th><code>iWARP</code><tbody><tr><td><strong>基础协议</strong><td>专有<code>IB</code>协议栈<td>以太网承载<code>IB</code>传输层<td><code>TCP/IP</code>承载<code>RDMA</code><tr><td><strong>网卡要求</strong><td>专用<code>IB HCA</code>网卡<td>支持<code>RoCE</code>的网卡<td>支持<code>iWARP</code>的网卡<tr><td><strong>交换机要求</strong><td>专用<code>IB</code>交换机<td>标准以太网交换机（需支持无损以太网）<td>标准以太网交换机<tr><td><strong>典型带宽</strong><td><code>NDR 400Gbps</code><td><code>100~400Gbps</code><td><code>10~100Gbps</code><tr><td><strong>端到端延迟</strong><td><code>&lt;1μs</code>（最低）<td><code>1~3μs</code><td><code>5~10μs</code>（受<code>TCP</code>影响）<tr><td><strong>无损网络</strong><td>原生支持（基于信用流控）<td>需配置<code>PFC/ECN</code><td><code>TCP</code>重传机制<tr><td><strong>成本</strong><td>高（网卡+交换机均昂贵）<td>中（仅网卡需支持<code>RoCE</code>）<td>低（标准以太网即可）<tr><td><strong>扩展性</strong><td>强（支持数万<code>GPU</code>卡集群）<td>中（支持数千<code>GPU</code>卡集群）<td>弱<tr><td><strong>运维复杂度</strong><td>高（需子网管理器<code>SM</code>）<td>中（需精细化流控配置）<td>低<tr><td><strong>典型应用</strong><td>大规模<code>HPC</code>、超算、顶级<code>AI</code>集群<td>数据中心<code>AI</code>训练集群<td>存储网络</table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=infiniband>InfiniBand<a href=#infiniband class=hash-link aria-label="Direct link to InfiniBand" title="Direct link to InfiniBand">​</a></h4>
<p><code>InfiniBand</code>是性能最强的<code>RDMA</code>实现，采用<strong>集中式子网管理</strong>架构：子网管理器（<code>SM</code>）负责发现拓扑、分配本地<code>ID</code>（<code>LID</code>）、配置交换机转发表。凭借原生的基于信用的流量控制（<code>Credit-Based Flow Control</code>），<code>IB</code>网络本质上是无损的，无需额外配置即可避免丢包。同时支持自适应路由，每个数据包均可动态选择最优路径，在大规模部署下性能稳定。</p>
<p><code>NVIDIA</code>（收购<code>Mellanox</code>后）占据<code>IB</code>市场<code>70%</code>以上份额，最新的<code>NDR</code>技术已实现单端口<code>400Gbps</code>速率。其代价是部署成本高——既需要专用<code>IB HCA</code>网卡，又需要专用<code>IB</code>交换机。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=roce-v2>RoCE v2<a href=#roce-v2 class=hash-link aria-label="Direct link to RoCE v2" title="Direct link to RoCE v2">​</a></h4>
<p><code>RoCE</code>（<code>RDMA over Converged Ethernet</code>）在以太网上承载<code>IB</code>的传输层协议，性能与<code>IB</code>相当，但可以复用现有以太网基础设施，仅要求服务器侧安装支持<code>RoCE</code>的网卡。<code>RoCE v2</code>基于<code>UDP/IP</code>，支持三层路由，已成为数据中心<code>AI</code>集群的主流选择。</p>
<p><code>RoCE</code>的关键挑战在于：以太网本身不是无损网络，丢包会导致大量重传，严重影响<code>RDMA</code>性能。因此部署时需要在交换机上精细配置<code>PFC</code>（优先级流量控制）和<code>ECN</code>（显式拥塞通知），运维复杂度相对较高。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=iwarp>iWARP<a href=#iwarp class=hash-link aria-label="Direct link to iWARP" title="Direct link to iWARP">​</a></h4>
<p><code>iWARP</code>基于<code>TCP/IP</code>，对网络基础设施要求最低，标准以太网即可使用。但由于受<code>TCP</code>协议的影响（序列号、确认、重传等机制），延迟比<code>IB</code>和<code>RoCE</code>高出数倍，通常用于存储网络而非大规模<code>AI</code>训练集群。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=rdma在ai大模型训练推理中的价值>RDMA在AI大模型训练推理中的价值<a href=#rdma在ai大模型训练推理中的价值 class=hash-link aria-label="Direct link to RDMA在AI大模型训练推理中的价值" title="Direct link to RDMA在AI大模型训练推理中的价值">​</a></h3>
<p>在<code>AI</code>大模型训练场景下，多机多卡分布式训练中的梯度同步（<code>AllReduce</code>）、参数更新、<code>KV Cache</code>传输等操作均涉及大量跨节点数据交换。以<code>LLM</code>训练为例：</p>
<ul>
<li><strong>梯度同步</strong>：数十亿参数的梯度需要在每个训练步骤内完成多机同步</li>
<li><strong>模型并行</strong>：不同节点负责不同的模型层，中间激活值频繁跨节点传递</li>
<li><strong><code>PD</code>分离推理</strong>：<code>Prefill</code>节点产生的<code>KV Cache</code>需要实时传输给<code>Decode</code>节点</li>
</ul>
<p>若使用传统以太网（<code>TCP/IP</code>），仅<code>CPU</code>开销和内存拷贝就会消耗大量资源，成为训练效率的天花板。<code>RDMA</code>技术通过<code>CPU Offload</code>和<code>Zero Copy</code>，将跨节点通信开销降至接近本地内存访问的水平，使<code>GPU</code>算力得到充分释放。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=网络拓扑感知调度多机场景的调度优化>网络拓扑感知调度：多机场景的调度优化<a href=#网络拓扑感知调度多机场景的调度优化 class=hash-link aria-label="Direct link to 网络拓扑感知调度：多机场景的调度优化" title="Direct link to 网络拓扑感知调度：多机场景的调度优化">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=多机网络环境的痛点>多机网络环境的痛点<a href=#多机网络环境的痛点 class=hash-link aria-label="Direct link to 多机网络环境的痛点" title="Direct link to 多机网络环境的痛点">​</a></h3>
<p>有了<code>RDMA</code>硬件之后，是否就万事大吉了？答案是否定的。在真实的数据中心环境中，<code>RDMA</code>设备的组网拓扑本身极为复杂，不同节点之间的实际网络性能差异显著。若调度系统对此毫无感知，盲目地将任务分配到任意节点上，将带来以下痛点：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=跨交换机通信延迟>跨交换机通信延迟<a href=#跨交换机通信延迟 class=hash-link aria-label="Direct link to 跨交换机通信延迟" title="Direct link to 跨交换机通信延迟">​</a></h4>
<p>现代数据中心通常采用多层交换机架构（<code>Spine-Leaf</code>、<code>Fat-Tree</code>等）。同一接入层交换机下的节点通信路径最短，延迟最低；跨越的交换机层级越多，延迟越高，带宽竞争越激烈：</p>
<table><thead><tr><th>通信场景<th>延迟<th>带宽<th>说明<tbody><tr><td>同一接入层<code>IB</code>交换机内<td><code>&lt;2μs</code><td><code>200Gbps</code><td>路径最短，性能最优<tr><td>跨<code>IB</code>接入层（同<code>IB</code>汇聚层）<td><code>2~5μs</code><td><code>200Gbps</code><td>经过一级汇聚交换机<tr><td>跨<code>IB</code>到以太网<td><code>5~10μs</code><td><code>~100Gbps</code>（损失约<code>50%</code>）<td>跨越不同类型网络<tr><td>以太网交换机间<td><code>>10μs</code><td><code>10~100Gbps</code>（损失<code>50~95%</code>）<td>无<code>RDMA</code>加速</table>
<p>对于时延敏感的大模型训练，延迟从<code>2μs</code>增加到<code>10μs</code>意味着<code>5</code>倍的通信性能差距，直接影响训练吞吐量。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=跨rdma与非rdma网络的性能悬崖>跨RDMA与非RDMA网络的性能悬崖<a href=#跨rdma与非rdma网络的性能悬崖 class=hash-link aria-label="Direct link to 跨RDMA与非RDMA网络的性能悬崖" title="Direct link to 跨RDMA与非RDMA网络的性能悬崖">​</a></h4>
<p><code>RDMA</code>设备（<code>IB</code>网卡、<code>RoCE</code>网卡）通常只覆盖集群中的部分节点，并非全量部署。若调度器不了解网络类型，可能将<code>RDMA</code>任务的一部分<code>Pod</code>调度到非<code>RDMA</code>节点上：</p>
<ul>
<li>那些<code>Pod</code>只能通过普通<code>TCP/IP</code>通信</li>
<li>由于<code>RDMA</code>集合通信（如<code>AllReduce</code>）要求所有参与节点均使用相同通信路径，任何一个节点回落到<code>TCP/IP</code>都会拖累整体性能</li>
<li>极端情况下，整个任务的通信性能会降级至普通以太网水平，<code>RDMA</code>加速形同虚设</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=网络带宽争用与资源碎片>网络带宽争用与资源碎片<a href=#网络带宽争用与资源碎片 class=hash-link aria-label="Direct link to 网络带宽争用与资源碎片" title="Direct link to 网络带宽争用与资源碎片">​</a></h4>
<p>在没有拓扑感知的调度下，多个大型分布式任务可能各自占用跨越不同网络域的节点，导致上行链路（汇聚层、核心层交换机）的带宽被严重争用。高层链路带宽通常是接入层的瓶颈，多任务竞争会造成「同一链路被多个任务争用」的网络代码（<code>Hot Spot</code>）问题，最终所有任务都受到影响。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=网络代码hot-spot问题>网络代码（Hot Spot）问题<a href=#网络代码hot-spot问题 class=hash-link aria-label="Direct link to 网络代码（Hot Spot）问题" title="Direct link to 网络代码（Hot Spot）问题">​</a></h4>
<p>当大量通信流量汇聚在少数几条跨层链路上时，这些链路成为热点（<code>Hot Spot</code>）。热点链路上的数据包排队延迟急剧上升，严重时触发<code>PFC</code>（优先级流量控制）暂停，甚至引发死锁，导致整个<code>RDMA</code>网络性能大幅下降。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=网络拓扑感知调度的核心价值>网络拓扑感知调度的核心价值<a href=#网络拓扑感知调度的核心价值 class=hash-link aria-label="Direct link to 网络拓扑感知调度的核心价值" title="Direct link to 网络拓扑感知调度的核心价值">​</a></h3>
<p>网络拓扑感知调度的核心思想是：<strong>调度器在分配计算节点时，感知集群的网络拓扑结构，优先将同一任务的多个<code>Pod</code>调度到网络距离近（即在同一交换机域内）的节点上</strong>，从而最大化利用高速网络，降低跨层通信开销。</p>
<p>主要收益包括：</p>
<ul>
<li><strong>降低通信延迟</strong>：将同一任务的<code>Pod</code>集中在同一接入层或汇聚层交换机下，避免不必要的跨层路由</li>
<li><strong>保障带宽</strong>：减少跨层链路的流量，避免带宽竞争和热点问题</li>
<li><strong>充分利用高速网络</strong>：确保<code>RDMA</code>任务的所有<code>Pod</code>都调度在<code>RDMA</code>网络覆盖的节点上</li>
<li><strong>提升训练效率</strong>：实践数据显示，大规模模型训练中网络拓扑优化可将训练时间缩短<code>40~60%</code>，<code>GPU</code>利用率提升<code>20~30%</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano网络拓扑感知调度实现>Volcano网络拓扑感知调度实现<a href=#volcano网络拓扑感知调度实现 class=hash-link aria-label="Direct link to Volcano网络拓扑感知调度实现" title="Direct link to Volcano网络拓扑感知调度实现">​</a></h2>
<p><code>Volcano</code>是一款面向<code>AI</code>和<code>HPC</code>场景的<code>Kubernetes</code>批量调度系统，其<code>network-topology-aware</code>插件提供了完整的网络拓扑感知调度能力。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>版本说明</div><div class=admonitionContent_BuS1><p>以下内容基于<code>Volcano v1.13.0</code>版本，网络拓扑插件后续版本可能有所更新。</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=设计�原理>设计原理<a href=#设计原理 class=hash-link aria-label="Direct link to 设计原理" title="Direct link to 设计原理">​</a></h3>
<p><code>Volcano</code>的网络拓扑感知调度基于三个核心设计：</p>
<ol>
<li><strong>统一的网络拓扑<code>API</code></strong>：通过<code>HyperNode CRD</code>标准化描述集群网络拓扑</li>
<li><strong>拓扑感知调度策略</strong>：基于<code>HyperNode</code>层级信息进行智能调度打分</li>
<li><strong>灵活的约束模式</strong>：支持<code>Hard</code>（硬约束）和<code>Soft</code>（软约束）两种调度模式</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=hypernode-crd>HyperNode CRD<a href=#hypernode-crd class=hash-link aria-label="Direct link to HyperNode CRD" title="Direct link to HyperNode CRD">​</a></h4>
<p><code>HyperNode</code>是<code>Volcano</code>定义的自定义资源，用于表示一个<strong>性能域（Performance Domain）</strong>，即一组具有相同网络带宽和延迟特性的节点或子性能域，通常映射到一个物理交换机或机架顶部交换机（<code>ToR</code>）。</p>
<p><code>HyperNode</code>通过<code>Tier</code>（层级）字段区分不同性能域：<code>Tier</code>值越小，节点间网络带宽越高、延迟越低；<code>Tier</code>值越大，代表越高层级的汇聚或核心交换机。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">          </span><span class="token comment" style=color:#8292a2;font-style:italic># Tier层级，越小网络性能越好</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node   </span><span class="token comment" style=color:#8292a2;font-style:italic># 成员类型：Node（真实节点）或HyperNode（子性能域）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node0   </span><span class="token comment" style=color:#8292a2;font-style:italic># 精确匹配节点名</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>HyperNode</code>的<code>members</code>字段支持三种选择器：</p>
<table><thead><tr><th>选择器类型<th>说明<th>适用范围<tbody><tr><td><code>exactMatch</code><td>精确匹配节点名称<td>叶子及非叶子<code>HyperNode</code><tr><td><code>regexMatch</code><td>正则表达式匹配节点名称<td>仅叶子<code>HyperNode</code><tr><td><code>labelMatch</code><td>基于节点标签匹配<td>仅叶子<code>HyperNode</code></table>
<p>多个<code>HyperNode</code>通过层级连接，形成一棵网络拓扑树：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">tier3                                     s6</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                          /                                \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tier2                   s4                                  s5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                /               \                    /               \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tier1         s0                s1                  s2               s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">           /      \          /      \            /      \         /      \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        node0    node1    node2    node3      node4    node5    node6    node7</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这棵树中，<code>node0</code>和<code>node1</code>同属<code>s0</code>（<code>tier1</code>），通信效率最高；<code>node0</code>和<code>node4</code>需经过<code>s0→s4→s5→s2</code>，通信效率最低。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=调度模式hard与soft>调度模式：Hard与Soft<a href=#调度模式hard与soft class=hash-link aria-label="Direct link to 调度模式：Hard与Soft" title="Direct link to 调度模式：Hard与Soft">​</a></h4>
<p><code>Volcano Job</code>和<code>PodGroup</code>通过<code>networkTopology</code>字段设置拓扑约束：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">networkTopology</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">mode</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> hard          </span><span class="token comment" style=color:#8292a2;font-style:italic># 调度模式：hard（硬约束）或 soft（软约束）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">highestTierAllowed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 允许的最高Tier层级</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<table><thead><tr><th>参数<th>类型<th>说明<tbody><tr><td><code>mode</code><td><code>string</code><td><code>hard</code>：所有任务必须调度在指定<code>Tier</code>内的同一<code>HyperNode</code>中；<code>soft</code>：尽力而为，允许降级调度<tr><td><code>highestTierAllowed</code><td><code>int</code><td>允许的最高<code>Tier</code>层级，值越小网络性能要求越高</table>
<p><strong>Hard模式</strong>：作业的所有任务必须被调度到<code>Tier ≤ highestTierAllowed</code>的同一个<code>HyperNode</code>内。若不满足条件，作业保持<code>Pending</code>状态。适用于对网络延迟极其敏感的大规模分布式训练。</p>
<p><strong>Soft模式</strong>：调度器尽最大努力将任务集中调度在同一<code>HyperNode</code>内，若资源不足则允许跨<code>HyperNode</code>调度。保证作业能够尽快启动，适用于希望优化网络性能但可接受一定调度灵活性的场景。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=调度打分逻辑>调度打分逻辑<a href=#调度打分逻辑 class=hash-link aria-label="Direct link to 调度打分逻辑" title="Direct link to 调度打分逻辑">​</a></h4>
<p><code>network-topology-aware</code>插件采用以下打分策略选择最优<code>HyperNode</code>：</p>
<p><strong>基于Tier的打分</strong>（<code>Tier</code>越低得分越高）：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">tierScore </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">maxTier </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain"> currentTier</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">maxTier </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain"> minTier</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>基于任务分布的打分</strong>（已调度的同作业<code>Pod</code>越多得分越高）：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">taskNumScore </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">hyperNodeTaskNum </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> totalTaskNum</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>100</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>综合得分</strong>：首次调度时各候选<code>HyperNode</code>得分为<code>0</code>，后续调度计算候选<code>HyperNode</code>与已分配节点的最低公共祖先（<code>LCA</code>）的<code>Tier</code>的得分，再叠加任务分布得分，优先将同一任务的<code>Pod</code>集中调度到同一<code>HyperNode</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=配置方式>配置方式<a href=#配置方式 class=hash-link aria-label="Direct link to 配置方式" title="Direct link to 配置方式">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=启用volcano调度插件>启用Volcano调度插件<a href=#启用volcano调度插件 class=hash-link aria-label="Direct link to 启用Volcano调度插件" title="Direct link to 启用Volcano调度插件">​</a></h4>
<p>修改<code>Volcano</code>调度器的<code>ConfigMap</code>，启用<code>network-topology-aware</code>插件：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_Ktv7>volcano-scheduler.conf</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue, allocate, backfill"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> network</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">topology</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">aware   </span><span class="token comment" style=color:#8292a2;font-style:italic># 启用网络拓扑感知插件</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">weight</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 插件权重，决定该插件在总分中的占比</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> binpack</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=手动配置hypernode>手动配置HyperNode<a href=#手动配置hypernode class=hash-link aria-label="Direct link to 手动配置HyperNode" title="Direct link to 手动配置HyperNode">​</a></h4>
<p>以下展示与上述网络拓扑树对应的完整<code>HyperNode</code>配置：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># Tier1：叶子HyperNode，包含真实节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node4</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node6</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> node7</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Tier2：汇聚层HyperNode，组合Tier1的HyperNode</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s4</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Tier3：根HyperNode</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s6</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s4</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s5</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=自动发现hypernode推荐>自动发现HyperNode（推荐）<a href=#自动发现hypernode推荐 class=hash-link aria-label="Direct link to 自动发现HyperNode（推荐）" title="Direct link to 自动发现HyperNode（推荐）">​</a></h4>
<p>对于<code>InfiniBand</code>网络，<code>Volcano</code>支持通过<code>UFM</code>（<code>Unified Fabric Manager</code>）自动发现网络拓扑并管理<code>HyperNode</code>。修改<code>volcano controller</code>的配置（支持热更新，无需重启）：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_Ktv7>volcano-controller.conf</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">networkTopologyDiscovery</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># UFM发现源（适用于InfiniBand网络）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">source</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ufm</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">interval</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> 10m</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">credentials</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">secretRef</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ufm</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">credentials</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">namespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">endpoint</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> https</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">//ufm</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">server</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token number" style=color:#ae81ff>8080</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">insecureSkipVerify</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 基于节点标签的发现源（通用方案）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">source</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> label</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">networkTopologyTypes</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">topologyA2</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">nodeLabel</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"volcano.sh/tor"</span><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 接入层交换机标签</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">nodeLabel</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"kubernetes.io/hostname"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">topologyA3</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">nodeLabel</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"volcano.sh/hypercluster"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">nodeLabel</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"volcano.sh/hypernode"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">nodeLabel</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"kubernetes.io/hostname"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=使用示例分布式训练场景>使用示例：分布式训练场景<a href=#使用示例分布式训练场景 class=hash-link aria-label="Direct link to 使用示例：分布式训练场景" title="Direct link to 使用示例：分布式训练场景">​</a></h3>
<p>以下通过一个分布式训练场景，结合前文已定义的网络拓扑树，展示如何使用<code>Volcano</code>网络拓扑感知调度将训练任务集中调度到同一网络域内。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=场景背景>场景背景<a href=#场景背景 class=hash-link aria-label="Direct link to 场景背景" title="Direct link to 场景背景">​</a></h4>
<p>现有一个集群，拥有<code>8</code>个工作节点，网络拓扑结构如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">tier3                                     s6</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                          /                                \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tier2                   s4                                  s5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                /               \                    /               \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tier1         s0                s1                  s2               s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">           /      \          /      \            /      \         /      \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        node0    node1    node2    node3      node4    node5    node6    node7</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li><code>s0~s3</code>（<code>tier1</code>）：接入层交换机，每个交换机下有<code>2</code>个节点，同交换机内延迟最低</li>
<li><code>s4、s5</code>（<code>tier2</code>）：汇聚层交换机，分别管理<code>2</code>个<code>tier1</code> <code>HyperNode</code></li>
<li><code>s6</code>（<code>tier3</code>）：核心层交换机，管理所有<code>tier2</code> <code>HyperNode</code></li>
</ul>
<p>现需要提交一个<code>4</code>个<code>worker</code>的<code>PyTorch</code>分布式训练任务，要求所有<code>worker</code>必须调度在同一<code>tier2 HyperNode</code>内（即<code>s4</code>或<code>s5</code>下），以确保<code>AllReduce</code>梯度同步的通信延迟不超过跨汇聚层水平。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=节点标签配置>节点标签配置<a href=#节点标签配置 class=hash-link aria-label="Direct link to 节点标签配置" title="Direct link to 节点标签配置">​</a></h4>
<p>首先为节点打上交换机归属标签，以便<code>HyperNode</code>通过<code>labelMatch</code>自动关联节点：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node0 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node1 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node2 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node3 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node4 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node5 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node6 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl label </span><span class="token function" style=color:#e6db74>node</span><span class="token plain"> node7 </span><span class="token assign-left variable" style=color:#f8f8f2>switch</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">s3</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=hypernode配置>HyperNode配置<a href=#hypernode配置 class=hash-link aria-label="Direct link to HyperNode配置" title="Direct link to HyperNode配置">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># Tier1：叶子HyperNode，通过labelMatch关联节点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">labelMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">switch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">labelMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">switch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">labelMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">switch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Node</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">labelMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">switch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Tier2：汇聚层HyperNode</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s4</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s3</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>---</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Tier3：核心层HyperNode</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> topology.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s6</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">members</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s4</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> HyperNode</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">selector</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">exactMatch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> s5</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=分布式训练任务配置>分布式训练任务配置<a href=#分布式训练任务配置 class=hash-link aria-label="Direct link to 分布式训练任务配置" title="Direct link to 分布式训练任务配置">​</a></h4>
<p>使用<code>Hard</code>模式，将<code>4</code>个<code>worker</code>强制约束在同一<code>tier2 HyperNode</code>内：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> batch.volcano.sh/v1alpha1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Job</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> pytorch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">distributed</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">minAvailable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 网络拓扑约束：硬约束，所有worker必须在同一个tier2 HyperNode内</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">networkTopology</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">mode</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> hard</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">highestTierAllowed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">tasks</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">labels</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">app</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> pytorch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">training</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> pytorch</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">worker</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> pytorch/pytorch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">2.1.0</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cuda11.8</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cudnn8</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">runtime</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">command</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"sh"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"-c"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                  torchrun \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                    --nproc_per_node=1 \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                    --nnodes=$WORLD_SIZE \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                    --node_rank=$RANK \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                    --master_addr=$MASTER_ADDR \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                    --master_port=23456 \</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>                    /workspace/train.py</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"4"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"16Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"4"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"16Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> OnFailure</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=调度效果说明>调度效果说明<a href=#调度效果说明 class=hash-link aria-label="Direct link to 调度效果说明" title="Direct link to 调度效果说明">​</a></h4>
<p>提交上述训练任务后，<code>Volcano</code>调度器的处理逻辑如下：</p>
<ol>
<li><strong>过滤阶段</strong>：插件检查<code>highestTierAllowed: 2</code>，筛选出能容纳<code>4</code>个<code>worker</code>的<code>tier2 HyperNode</code>候选（<code>s4</code>或<code>s5</code>），跨越<code>tier2</code>的调度方案被直接排除</li>
<li><strong>打分阶段</strong>：根据<code>Tier</code>打分和已分配<code>Pod</code>数量打分，优先将后续<code>worker</code>调度到与已分配节点同一<code>HyperNode</code>下</li>
<li><strong>最终结果</strong>：<code>4</code>个<code>worker</code>全部落在<code>s4</code>（<code>node0~node3</code>）或<code>s5</code>（<code>node4~node7</code>）下，不会跨越核心层交换机<code>s6</code></li>
</ol>
<p>在<code>Hard</code>模式下，若<code>s4</code>和<code>s5</code>均无法容纳<code>4</code>个<code>worker</code>（例如节点资源不足），任务将保持<code>Pending</code>状态直到资源就绪，而不会将<code>worker</code>分散到<code>s4</code>和<code>s5</code>两侧——这保证了训练任务始终运行在低延迟的网络域内。</p>
<p>若希望在资源紧张时允许跨<code>tier2</code>调度（牺牲部分网络性能以换取更快的任务启动），可将<code>mode</code>改为<code>soft</code>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">networkTopology</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">mode</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> soft</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">highestTierAllowed</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=注意事项>注意事项<a href=#注意事项 class=hash-link aria-label="Direct link to 注意事项" title="Direct link to 注意事项">​</a></h3>
<p><strong>必须设置资源请求和限制</strong>：网络拓扑感知调度依赖任务的资源请求信息。若任务为<code>BestEffort</code>类型（未设置<code>requests</code>/<code>limits</code>），即使启用了插件，该任务也不会触发网络拓扑调度。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"4"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"16Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"4"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"16Gi"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>集群中不存在HyperNode时</strong>：若任务指定了网络拓扑调度配置，但集群中不存在任何<code>HyperNode</code>资源，调度器按默认逻辑进行调度，不会受到拓扑约束影响。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=/ai/gpu-direct>GPU Direct通信技术</a></li>
<li><a href=/ai/rdma-brief>RDMA技术架构深度解析</a></li>
<li><a href=/ai/rdma-infiniband-vs-roce>RDMA：InfiniBand vs RoCE</a></li>
<li><a href=/cloud-native/volcano-network-topology-scheduling>Volcano网络拓扑感知调度</a></li>
<li><a href=https://volcano.sh/zh/docs/network_topology_aware_scheduling/ target=_blank rel="noopener noreferrer">Volcano官方文档 - 网络拓扑感知调度</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/cpu-numa-affinity-in-kubernetes><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Kubernetes中CPU&NUMA亲和性配置</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/vgpu-introduction-and-comparison><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>vGPU介绍及主流方案对比</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#背景从单机到多机的通信挑战 class="table-of-contents__link toc-highlight">背景：从单机到多机的通信挑战</a><li><a href=#gpu-direct单机场景的通信加速 class="table-of-contents__link toc-highlight">GPU Direct：单机场景的通信加速</a><ul><li><a href=#什么是gpu-direct class="table-of-contents__link toc-highlight">什么是GPU Direct？</a><li><a href=#gpu-direct核心子技术 class="table-of-contents__link toc-highlight">GPU Direct核心子技术</a><li><a href=#gpu-direct-p2p与nvlink class="table-of-contents__link toc-highlight">GPU Direct P2P与NVLink</a><li><a href=#单机的局限无法解决多机问题 class="table-of-contents__link toc-highlight">单机的局限：无法解决多机问题</a></ul><li><a href=#rdma多机场景的高性能通信基石 class="table-of-contents__link toc-highlight">RDMA：多机场景的高性能通信基石</a><ul><li><a href=#什么是rdma class="table-of-contents__link toc-highlight">什么是RDMA？</a><li><a href=#rdma三种实现方案对比 class="table-of-contents__link toc-highlight">RDMA三种实现方案对比</a><li><a href=#rdma在ai大模型训练推理中的价值 class="table-of-contents__link toc-highlight">RDMA在AI大模型训练推理中的价值</a></ul><li><a href=#网络拓扑感知调度多机场景的调度优化 class="table-of-contents__link toc-highlight">网络拓扑感知调度：多机场景的调度优化</a><ul><li><a href=#多机网络环境的痛点 class="table-of-contents__link toc-highlight">多机网络环境的痛点</a><li><a href=#网络拓扑感知调度的核心价值 class="table-of-contents__link toc-highlight">网络拓扑感知调度的核心价值</a></ul><li><a href=#volcano网络拓扑感知调度实现 class="table-of-contents__link toc-highlight">Volcano网络拓扑感知调度实现</a><ul><li><a href=#设计原理 class="table-of-contents__link toc-highlight">设计原理</a><li><a href=#配置方式 class="table-of-contents__link toc-highlight">配置方式</a><li><a href=#使用示例分布式训练场景 class="table-of-contents__link toc-highlight">使用示例：分布式训练场景</a><li><a href=#注意事项 class="table-of-contents__link toc-highlight">注意事项</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>