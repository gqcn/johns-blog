<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/vGPU/HAMi CUDA Driver API" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>HAMi CUDA Driver API | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/vgpu-hami-cuda-driver-api><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="HAMi CUDA Driver API | John's Blog"><meta data-rh=true name=description content="深入解析HAMi Core通过LD_PRELOAD机制劫持的198个CUDA Driver API，涵盖设备管理、显存分配、内核启动、CUDA Graph等15个分类。详细说明20个核心劫持API如何实现显存配额检查和算力限制控制，以及178个透传API的作用。"><meta data-rh=true property=og:description content="深入解析HAMi Core通过LD_PRELOAD机制劫持的198个CUDA Driver API，涵盖设备管理、显存分配、内核启动、CUDA Graph等15个分类。详细说明20个核心劫持API如何实现显存配额检查和算力限制控制，以及178个透传API的作用。"><meta data-rh=true name=keywords content="HAMi Core,CUDA Driver API,API劫持,LD_PRELOAD,显存配额,算力限制,GPU虚拟化,CUDA拦截,vGPU实现原理"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/vgpu-hami-cuda-driver-api><link data-rh=true rel=alternate href=https://johng.cn/ai/vgpu-hami-cuda-driver-api hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/vgpu-hami-cuda-driver-api hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.b3f7724c.css><script src=/assets/js/runtime~main.6c3231ae.js defer></script><script src=/assets/js/main.274cd4c0.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/ai>AI技术</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/nvidia>NVIDIA</a><button aria-label="Expand sidebar category 'NVIDIA'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/distributed-inference>分布式推理</a><button aria-label="Expand sidebar category '分布式推理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/scheduling>算力资源调度</a><button aria-label="Expand sidebar category '算力资源调度'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/rdma>RDMA</a><button aria-label="Expand sidebar category 'RDMA'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/vgpu>vGPU</a><button aria-label="Collapse sidebar category 'vGPU'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/vgpu-survey>vGPU方案调研</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/vgpu-hami>HAMi vGPU调研</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/vgpu-hami-cuda-driver-api>HAMi CUDA Driver API</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-acceleration-cards>常见智算加速卡汇总</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/general-ai-model-and-reasoning-ai-model-difference>通用大模型和推理大模型区别</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-ai-model-training-inference-framework>常见AI模型训练推理框架对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ai-training-inference-scenarios>AI模型训练推理常见业务场景痛点</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/vgpu><span itemprop=name>vGPU</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>HAMi CUDA Driver API</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>HAMi Core</code>通过<code>LD_PRELOAD</code>机制劫持<code>CUDA Driver API</code>调用，实现显存隔离和算力限制。以下是完整的劫持<code>API</code>列表：</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-初始化与设备管理-18个>1. 初始化与设备管理 (18个)<a href=#1-初始化与设备管理-18个 class=hash-link aria-label="Direct link to 1. 初始化与设备管理 (18个)" title="Direct link to 1. 初始化与设备管理 (18个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuInit</code><td>初始化<code>CUDA</code>驱动<td>初始化<code>HAMi</code>运行环境<tr><td><code>cuDeviceGet</code><td>获取设备句柄<td>设备虚拟化映射<tr><td><code>cuDeviceGetCount</code><td>获取设备数量<td>返回虚拟设备数量<tr><td><code>cuDeviceGetName</code><td>获取设备名称<td>透传设备信息<tr><td><code>cuDeviceGetAttribute</code><td>获取设备属性<td>修改显存等属性<tr><td><code>cuDeviceCanAccessPeer</code><td>检查<code>P2P</code>访问能力<td>透传<tr><td><code>cuDeviceGetP2PAttribute</code><td>获取<code>P2P</code>属性<td>透传<tr><td><code>cuDeviceGetByPCIBusId</code><td>通过<code>PCI Bus ID</code>获取设备<td>设备映射<tr><td><code>cuDeviceGetPCIBusId</code><td>获取<code>PCI Bus ID</code><td>透传<tr><td><code>cuDeviceGetUuid</code><td>获取设备<code>UUID</code><td>透传<tr><td><code>cuDeviceGetDefaultMemPool</code><td>获取默认内存池<td>透传<tr><td><code>cuDeviceGetLuid</code><td>获取设备<code>LUID</code><td>透传<tr><td><code>cuDeviceGetMemPool</code><td>获取内存池<td>透传<tr><td><code>cuDeviceTotalMem_v2</code><td>获取总显存<td><strong>返回配额限制的显存</strong><tr><td><code>cuDriverGetVersion</code><td>获取驱动版本<td>透传<tr><td><code>cuDeviceGetTexture1DLinearMaxWidth</code><td>获取纹理最大宽度<td>透传<tr><td><code>cuDeviceSetMemPool</code><td>设置内存池<td>透传<tr><td><code>cuFlushGPUDirectRDMAWrites</code><td>刷新<code>RDMA</code>写入<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-上下文管理-23个>2. 上下文管理 (23个)<a href=#2-上下文管理-23个 class=hash-link aria-label="Direct link to 2. 上下文管理 (23个)" title="Direct link to 2. 上下文管理 (23个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuDevicePrimaryCtxGetState</code><td>获取主上下文状态<td>透传<tr><td><code>cuDevicePrimaryCtxRetain</code><td>保持主上下文<td>透传<tr><td><code>cuDevicePrimaryCtxSetFlags_v2</code><td>设置主上下文标志<td>透传<tr><td><code>cuDevicePrimaryCtxRelease_v2</code><td>释放主上下文<td>透传<tr><td><code>cuCtxGetDevice</code><td>获取当前上下文设备<td>返回虚拟设备<tr><td><code>cuCtxCreate_v2</code><td>创建上下文<td>透传<tr><td><code>cuCtxCreate_v3</code><td>创建上下文(<code>v3</code>)<td>透传<tr><td><code>cuCtxDestroy_v2</code><td>销毁上下文<td>透传<tr><td><code>cuCtxGetApiVersion</code><td>获取<code>API</code>版本<td>透传<tr><td><code>cuCtxGetCacheConfig</code><td>获取缓存配置<td>透传<tr><td><code>cuCtxGetCurrent</code><td>获取当前上下文<td>透传<tr><td><code>cuCtxGetFlags</code><td>获取上下文标志<td>透传<tr><td><code>cuCtxGetLimit</code><td>获取上下文限制<td>透传<tr><td><code>cuCtxGetSharedMemConfig</code><td>获取共享内存配置<td>透传<tr><td><code>cuCtxGetStreamPriorityRange</code><td>获取流优先级范围<td>透传<tr><td><code>cuCtxPopCurrent_v2</code><td>弹出当前上下文<td>透传<tr><td><code>cuCtxPushCurrent_v2</code><td>压入当前上下文<td>透传<tr><td><code>cuCtxSetCacheConfig</code><td>设置缓存配置<td>透传<tr><td><code>cuCtxSetCurrent</code><td>设置当前上下文<td>透传<tr><td><code>cuCtxSetLimit</code><td>设置上下文限制<td>透传<tr><td><code>cuCtxSetSharedMemConfig</code><td>设置共享内存配置<td>透传<tr><td><code>cuCtxSynchronize</code><td>同步上下文<td>透传<tr><td><code>cuGetExportTable</code><td>获取导出表<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-流管理-3个>3. 流管理 (3个)<a href=#3-流管理-3个 class=hash-link aria-label="Direct link to 3. 流管理 (3个)" title="Direct link to 3. 流管理 (3个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuStreamCreate</code><td>创建流<td>透传<tr><td><code>cuStreamDestroy_v2</code><td>销毁流<td>透传<tr><td><code>cuStreamSynchronize</code><td>同步流<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-显存分配与释放-18个>4. 显存分配与释放 (18个)<a href=#4-显存分配与释放-18个 class=hash-link aria-label="Direct link to 4. 显存分配与释放 (18个)" title="Direct link to 4. 显存分配与释放 (18个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuMemAlloc_v2</code><td>分配显存<td><strong>检查配额并记录分配</strong><tr><td><code>cuMemAllocHost_v2</code><td>分配主机固定内存<td><strong>检查配额</strong><tr><td><code>cuMemAllocManaged</code><td>分配统一内存<td><strong>检查配额并记录</strong><tr><td><code>cuMemAllocPitch_v2</code><td>分配对齐显存<td><strong>检查配额并记录</strong><tr><td><code>cuMemFree_v2</code><td>释放显存<td><strong>更新使用记录</strong><tr><td><code>cuMemFreeHost</code><td>释放主机内存<td>透传<tr><td><code>cuMemHostAlloc</code><td>分配主机内存<td><strong>检查配额</strong><tr><td><code>cuMemHostRegister_v2</code><td>注册主机内存<td><strong>检查配额</strong><tr><td><code>cuMemHostUnregister</code><td>注销主机内存<td>透传<tr><td><code>cuArray3DCreate_v2</code><td>创建3D数组<td><strong>计算并检查显存</strong><tr><td><code>cuArrayCreate_v2</code><td>创建数组<td><strong>计算并检查显存</strong><tr><td><code>cuArrayDestroy</code><td>销毁数组<td><strong>更新使用记录</strong><tr><td><code>cuMipmappedArrayCreate</code><td>创建多级纹理数组<td><strong>检查配额</strong><tr><td><code>cuMipmappedArrayDestroy</code><td>销毁多级纹理数组<td>透传<tr><td><code>cuMemGetInfo_v2</code><td>获取显存信息<td><strong>返回虚拟显存信息</strong><tr><td><code>cuMemGetAddressRange_v2</code><td>获取地址范围<td>透传<tr><td><code>cuMemAllocAsync</code><td>异步分配显存<td><strong>检查配额并记录</strong><tr><td><code>cuMemFreeAsync</code><td>异步释放显存<td><strong>更新使用记录</strong></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=5-显存拷贝-20个>5. 显存拷贝 (20个)<a href=#5-显存拷贝-20个 class=hash-link aria-label="Direct link to 5. 显存拷贝 (20个)" title="Direct link to 5. 显存拷贝 (20个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuMemcpy</code><td>显存拷贝<td>透传<tr><td><code>cuMemcpyAsync</code><td>异步显存拷贝<td>透传<tr><td><code>cuMemcpyDtoH_v2</code><td>设备到主机拷贝<td>透传<tr><td><code>cuMemcpyHtoD_v2</code><td>主机到设备拷贝<td>透传<tr><td><code>cuMemcpyDtoD_v2</code><td>设备到设备拷贝<td>透传<tr><td><code>cuMemcpyDtoHAsync_v2</code><td>异步设备到主机<td>透传<tr><td><code>cuMemcpyHtoDAsync_v2</code><td>异步主机到设备<td>透传<tr><td><code>cuMemcpyDtoDAsync_v2</code><td>异步设备到设备<td>透传<tr><td><code>cuMemcpyAtoD_v2</code><td>数组到设备拷贝<td>透传<tr><td><code>cuMemcpyDtoA_v2</code><td>设备到数组拷贝<td>透传<tr><td><code>cuMemcpyPeer</code><td>跨设备拷贝<td>透传<tr><td><code>cuMemcpyPeerAsync</code><td>异步跨设备拷贝<td>透传<tr><td><code>cuMemcpy2D_v2</code><td>2D拷贝<td>透传<tr><td><code>cuMemcpy2DUnaligned_v2</code><td>2D非对齐拷贝<td>透传<tr><td><code>cuMemcpy2DAsync_v2</code><td>异步2D拷贝<td>透传<tr><td><code>cuMemcpy3D_v2</code><td>3D拷贝<td>透传<tr><td><code>cuMemcpy3DAsync_v2</code><td>异步3D拷贝<td>透传<tr><td><code>cuMemcpy3DPeer</code><td>跨设备3D拷贝<td>透传<tr><td><code>cuMemcpy3DPeerAsync</code><td>异步跨设备3D拷贝<td>透传<tr><td><code>cuMemPrefetchAsync</code><td>异步预取内存<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=6-显存设置-12个>6. 显存设置 (12个)<a href=#6-显存设置-12个 class=hash-link aria-label="Direct link to 6. 显存设置 (12个)" title="Direct link to 6. 显存设置 (12个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuMemsetD8_v2</code><td>设置8位值<td>透传<tr><td><code>cuMemsetD16_v2</code><td>设置16位值<td>透传<tr><td><code>cuMemsetD32_v2</code><td>设置32位值<td>透传<tr><td><code>cuMemsetD8Async</code><td>异步设置8位值<td>透传<tr><td><code>cuMemsetD16Async</code><td>异步设置16位值<td>透传<tr><td><code>cuMemsetD32Async</code><td>异步设置32位值<td>透传<tr><td><code>cuMemsetD2D8_v2</code><td>2D设置8位值<td>透传<tr><td><code>cuMemsetD2D16_v2</code><td>2D设置16位值<td>透传<tr><td><code>cuMemsetD2D32_v2</code><td>2D设置32位值<td>透传<tr><td><code>cuMemsetD2D8Async</code><td>异步2D设置8位<td>透传<tr><td><code>cuMemsetD2D16Async</code><td>异步2D设置16位<td>透传<tr><td><code>cuMemsetD2D32Async</code><td>异步2D设置32位<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=7-内核启动-7个>7. 内核启动 (7个)<a href=#7-内核启动-7个 class=hash-link aria-label="Direct link to 7. 内核启动 (7个)" title="Direct link to 7. 内核启动 (7个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuLaunchKernel</code><td>启动内核<td><strong>算力限制控制</strong><tr><td><code>cuLaunchCooperativeKernel</code><td>启动协作内核<td><strong>算力限制控制</strong><tr><td><code>cuFuncSetCacheConfig</code><td>设置函数缓存配置<td>透传<tr><td><code>cuFuncSetSharedMemConfig</code><td>设置共享内存配置<td>透传<tr><td><code>cuFuncGetAttribute</code><td>获取函数属性<td>透传<tr><td><code>cuFuncSetAttribute</code><td>设置函数属性<td>透传<tr><td><code>cuMemAdvise</code><td>内存建议<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=8-事件管理-2个>8. 事件管理 (2个)<a href=#8-事件管理-2个 class=hash-link aria-label="Direct link to 8. 事件管理 (2个)" title="Direct link to 8. 事件管理 (2个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuEventCreate</code><td>创建事件<td>透传<tr><td><code>cuEventDestroy_v2</code><td>销毁事件<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=9-模块加载-11个>9. 模块加载 (11个)<a href=#9-模块加载-11个 class=hash-link aria-label="Direct link to 9. 模块加载 (11个)" title="Direct link to 9. 模块加载 (11个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuModuleLoad</code><td>加载模块<td>透传<tr><td><code>cuModuleLoadData</code><td>从数据加载模块<td>透传<tr><td><code>cuModuleLoadDataEx</code><td>扩展加载模块<td>透传<tr><td><code>cuModuleLoadFatBinary</code><td>加载<code>Fat Binary</code><td>透传<tr><td><code>cuModuleGetFunction</code><td>获取函数<td>透传<tr><td><code>cuModuleUnload</code><td>卸载模块<td>透传<tr><td><code>cuModuleGetGlobal_v2</code><td>获取全局变量<td>透传<tr><td><code>cuModuleGetTexRef</code><td>获取纹理引用<td>透传<tr><td><code>cuModuleGetSurfRef</code><td>获取表面引用<td>透传<tr><td><code>cuLinkCreate_v2</code><td>创建链接<td>透传<tr><td><code>cuLinkDestroy</code><td>销毁链接<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=10-虚拟内存管理-5个>10. 虚拟内存管理 (5个)<a href=#10-虚拟内存管理-5个 class=hash-link aria-label="Direct link to 10. 虚拟内存管理 (5个)" title="Direct link to 10. 虚拟内存管理 (5个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuMemAddressReserve</code><td>预留地址空间<td>透传<tr><td><code>cuMemCreate</code><td>创建内存对象<td><strong>检查配额并记录</strong><tr><td><code>cuMemRelease</code><td>释放内存对象<td><strong>更新使用记录</strong><tr><td><code>cuMemMap</code><td>映射内存<td>透传<tr><td><code>cuMemImportFromShareableHandle</code><td>导入共享句柄<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=11-内存池管理-14个>11. 内存池管理 (14个)<a href=#11-内存池管理-14个 class=hash-link aria-label="Direct link to 11. 内存池管理 (14个)" title="Direct link to 11. 内存池管理 (14个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuMemHostGetDevicePointer_v2</code><td>获取设备指针<td>透传<tr><td><code>cuMemHostGetFlags</code><td>获取主机内存标志<td>透传<tr><td><code>cuMemPoolTrimTo</code><td>修剪内存池<td>透传<tr><td><code>cuMemPoolSetAttribute</code><td>设置内存池属性<td>透传<tr><td><code>cuMemPoolGetAttribute</code><td>获取内存池属性<td>透传<tr><td><code>cuMemPoolSetAccess</code><td>设置内存池访问权限<td>透传<tr><td><code>cuMemPoolGetAccess</code><td>获取内存池访问权限<td>透传<tr><td><code>cuMemPoolCreate</code><td>创建内存池<td>透传<tr><td><code>cuMemPoolDestroy</code><td>销毁内存池<td>透传<tr><td><code>cuMemAllocFromPoolAsync</code><td>从池异步分配<td>透传<tr><td><code>cuMemPoolExportToShareableHandle</code><td>导出内存池句柄<td>透传<tr><td><code>cuMemPoolImportFromShareableHandle</code><td>导入内存池句柄<td>透传<tr><td><code>cuMemPoolExportPointer</code><td>导出内存池指针<td>透传<tr><td><code>cuMemPoolImportPointer</code><td>导入内存池指针<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=12-指针属性-6个>12. 指针属性 (6个)<a href=#12-指针属性-6个 class=hash-link aria-label="Direct link to 12. 指针属性 (6个)" title="Direct link to 12. 指针属性 (6个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuPointerGetAttribute</code><td>获取指针属性<td>透传<tr><td><code>cuPointerGetAttributes</code><td>获取多个指针属性<td>修改内存类型信息<tr><td><code>cuPointerSetAttribute</code><td>设置指针属性<td>透传<tr><td><code>cuMemRangeGetAttribute</code><td>获取内存范围属性<td>透传<tr><td><code>cuMemRangeGetAttributes</code><td>获取多个范围属性<td>透传<tr><td><code>cuIpcCloseMemHandle</code><td>关闭<code>IPC</code>内存句柄<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=13-外部资源互操作-8个>13. 外部资源互操作 (8个)<a href=#13-外部资源互操作-8个 class=hash-link aria-label="Direct link to 13. 外部资源互操作 (8个)" title="Direct link to 13. 外部资源互操作 (8个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuImportExternalMemory</code><td>导入外部内存<td>透传<tr><td><code>cuExternalMemoryGetMappedBuffer</code><td>获取映射缓冲区<td>透传<tr><td><code>cuExternalMemoryGetMappedMipmappedArray</code><td>获取映射纹理数组<td>透传<tr><td><code>cuDestroyExternalMemory</code><td>销毁外部内存<td>透传<tr><td><code>cuImportExternalSemaphore</code><td>导入外部信号量<td>透传<tr><td><code>cuSignalExternalSemaphoresAsync</code><td>异步信号外部信号量<td>透传<tr><td><code>cuWaitExternalSemaphoresAsync</code><td>异步等待外部信号量<td>透传<tr><td><code>cuDestroyExternalSemaphore</code><td>销毁外部信号量<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=14-cuda-graph-47个>14. CUDA Graph (47个)<a href=#14-cuda-graph-47个 class=hash-link aria-label="Direct link to 14. CUDA Graph (47个)" title="Direct link to 14. CUDA Graph (47个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuGraphCreate</code><td>创建图<td>透传<tr><td><code>cuGraphAddKernelNode_v2</code><td>添加内核节点<td>透传<tr><td><code>cuGraphKernelNodeGetParams_v2</code><td>获取内核节点参数<td>透传<tr><td><code>cuGraphKernelNodeSetParams_v2</code><td>设置内核节点参数<td>透传<tr><td><code>cuGraphAddMemcpyNode</code><td>添加拷贝节点<td>透传<tr><td><code>cuGraphMemcpyNodeGetParams</code><td>获取拷贝节点参数<td>透传<tr><td><code>cuGraphMemcpyNodeSetParams</code><td>设置拷贝节点参数<td>透传<tr><td><code>cuGraphAddMemsetNode</code><td>添加设置节点<td>透传<tr><td><code>cuGraphMemsetNodeGetParams</code><td>获取设置节点参数<td>透传<tr><td><code>cuGraphMemsetNodeSetParams</code><td>设置设置节点参数<td>透传<tr><td><code>cuGraphAddHostNode</code><td>添加主机节点<td>透传<tr><td><code>cuGraphHostNodeGetParams</code><td>获取主机节点参数<td>透传<tr><td><code>cuGraphHostNodeSetParams</code><td>设置主机节点参数<td>透传<tr><td><code>cuGraphAddChildGraphNode</code><td>添加子图节点<td>透传<tr><td><code>cuGraphChildGraphNodeGetGraph</code><td>获取子图<td>透传<tr><td><code>cuGraphAddEmptyNode</code><td>添加空节点<td>透传<tr><td><code>cuGraphAddEventRecordNode</code><td>添加事件记录节点<td>透传<tr><td><code>cuGraphEventRecordNodeGetEvent</code><td>获取事件记录节点事件<td>透传<tr><td><code>cuGraphEventRecordNodeSetEvent</code><td>设置事件记录节点事件<td>透传<tr><td><code>cuGraphAddEventWaitNode</code><td>添加事件等待节点<td>透传<tr><td><code>cuGraphEventWaitNodeGetEvent</code><td>获取事件等待节点事件<td>透传<tr><td><code>cuGraphEventWaitNodeSetEvent</code><td>设置事件等待节点事件<td>透传<tr><td><code>cuGraphAddExternalSemaphoresSignalNode</code><td>添加外部信号量信号节点<td>透传<tr><td><code>cuGraphExternalSemaphoresSignalNodeGetParams</code><td>获取外部信号量信号参数<td>透传<tr><td><code>cuGraphExternalSemaphoresSignalNodeSetParams</code><td>设置外部信号量信号参数<td>透传<tr><td><code>cuGraphAddExternalSemaphoresWaitNode</code><td>添加外部信号量等待节点<td>透传<tr><td><code>cuGraphExternalSemaphoresWaitNodeGetParams</code><td>获取外部信号量等待参数<td>透传<tr><td><code>cuGraphExternalSemaphoresWaitNodeSetParams</code><td>设置外部信号量等待参数<td>透传<tr><td><code>cuGraphExecExternalSemaphoresSignalNodeSetParams</code><td>执行外部信号量信号参数设置<td>透传<tr><td><code>cuGraphExecExternalSemaphoresWaitNodeSetParams</code><td>执行外部信号量等待参数设置<td>透传<tr><td><code>cuGraphClone</code><td>克隆图<td>透传<tr><td><code>cuGraphNodeFindInClone</code><td>在克隆中查找节点<td>透传<tr><td><code>cuGraphNodeGetType</code><td>获取节点类型<td>透传<tr><td><code>cuGraphGetNodes</code><td>获取所有节点<td>透传<tr><td><code>cuGraphGetRootNodes</code><td>获取根节点<td>透传<tr><td><code>cuGraphGetEdges</code><td>获取边<td>透传<tr><td><code>cuGraphNodeGetDependencies</code><td>获取节点依赖<td>透传<tr><td><code>cuGraphNodeGetDependentNodes</code><td>获取依赖节点<td>透传<tr><td><code>cuGraphAddDependencies</code><td>添加依赖<td>透传<tr><td><code>cuGraphRemoveDependencies</code><td>移除依赖<td>透传<tr><td><code>cuGraphDestroyNode</code><td>销毁节点<td>透传<tr><td><code>cuGraphInstantiate</code><td>实例化图<td>透传<tr><td><code>cuGraphInstantiateWithFlags</code><td>带标志实例化图<td>透传<tr><td><code>cuGraphUpload</code><td>上传图<td>透传<tr><td><code>cuGraphLaunch</code><td>启动图<td>透传<tr><td><code>cuGraphExecDestroy</code><td>销毁图执行<td>透传<tr><td><code>cuGraphDestroy</code><td>销毁图<td>透传</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=15-其他-4个>15. 其他 (4个)<a href=#15-其他-4个 class=hash-link aria-label="Direct link to 15. 其他 (4个)" title="Direct link to 15. 其他 (4个)">​</a></h2>
<table><thead><tr><th>API名称<th>功能说明<th>劫持目的<tbody><tr><td><code>cuIpcGetMemHandle</code><td>获取<code>IPC</code>内存句柄<td>透传<tr><td><code>cuIpcOpenMemHandle_v2</code><td>打开<code>IPC</code>内存句柄<td>透传<tr><td><code>cuGetProcAddress</code><td>获取函数地址<td><strong>劫持动态加载的API</strong><tr><td><code>cuGetProcAddress_v2</code><td>获取函数地址(<code>v2</code>)<td><strong>劫持动态加载的API</strong></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=16-统计汇总>16. 统计汇总<a href=#16-统计汇总 class=hash-link aria-label="Direct link to 16. 统计汇总" title="Direct link to 16. 统计汇总">​</a></h2>
<table><thead><tr><th>分类<th>API数量<th>核心劫持<th>透传<tbody><tr><td>初始化与设备管理<td>18<td>1<td>17<tr><td>上下文管理<td>23<td>1<td>22<tr><td>流管理<td>3<td>0<td>3<tr><td>显存分配与释放<td>18<td>11<td>7<tr><td>显存拷贝<td>20<td>0<td>20<tr><td>显存设置<td>12<td>0<td>12<tr><td>内核启动<td>7<td>2<td>5<tr><td>事件管理<td>2<td>0<td>2<tr><td>模块加载<td>11<td>0<td>11<tr><td>虚拟内存管理<td>5<td>2<td>3<tr><td>内存池管理<td>14<td>0<td>14<tr><td>指针属性<td>6<td>1<td>5<tr><td>外部资源互操作<td>8<td>0<td>8<tr><td><code>CUDA Graph</code><td>47<td>0<td>47<tr><td>其他<td>4<td>2<td>2<tr><td><strong>总计</strong><td><strong>198</strong><td><strong>20</strong><td><strong>178</strong></table>
<p><strong>核心劫持说明</strong>：</p>
<ul>
<li><strong>显存管理</strong>：所有显存分配/释放<code>API</code>都会检查配额并记录使用情况</li>
<li><strong>算力控制</strong>：内核启动<code>API</code>会进行算力限制控制</li>
<li><strong>信息伪装</strong>：<code>cuDeviceTotalMem_v2</code>、<code>cuMemGetInfo_v2</code>返回虚拟显存信息</li>
<li><strong>动态劫持</strong>：<code>cuGetProcAddress</code>系列确保动态加载的<code>API</code>也被劫持</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=17-参考资料>17. 参考资料<a href=#17-参考资料 class=hash-link aria-label="Direct link to 17. 参考资料" title="Direct link to 17. 参考资料">​</a></h2>
<ul>
<li><a href=https://github.com/Project-HAMi/HAMi-core target=_blank rel="noopener noreferrer">https://github.com/Project-HAMi/HAMi-core</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/vgpu-hami><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>HAMi vGPU调研</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/common-acceleration-cards><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>常见智算加速卡汇总</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-初始化与设备管理-18个 class="table-of-contents__link toc-highlight">1. 初始化与设备管理 (18个)</a><li><a href=#2-上下文管理-23个 class="table-of-contents__link toc-highlight">2. 上下文管理 (23个)</a><li><a href=#3-流管理-3个 class="table-of-contents__link toc-highlight">3. 流管理 (3个)</a><li><a href=#4-显存分配与释放-18个 class="table-of-contents__link toc-highlight">4. 显存分配与释放 (18个)</a><li><a href=#5-显存拷贝-20个 class="table-of-contents__link toc-highlight">5. 显存拷贝 (20个)</a><li><a href=#6-显存设置-12个 class="table-of-contents__link toc-highlight">6. 显存设置 (12个)</a><li><a href=#7-内核启动-7个 class="table-of-contents__link toc-highlight">7. 内核启动 (7个)</a><li><a href=#8-事件管理-2个 class="table-of-contents__link toc-highlight">8. 事件管理 (2个)</a><li><a href=#9-模块加载-11个 class="table-of-contents__link toc-highlight">9. 模块加载 (11个)</a><li><a href=#10-虚拟内存管理-5个 class="table-of-contents__link toc-highlight">10. 虚拟内存管理 (5个)</a><li><a href=#11-内存池管理-14个 class="table-of-contents__link toc-highlight">11. 内存池管理 (14个)</a><li><a href=#12-指针属性-6个 class="table-of-contents__link toc-highlight">12. 指针属性 (6个)</a><li><a href=#13-外部资源互操作-8个 class="table-of-contents__link toc-highlight">13. 外部资源互操作 (8个)</a><li><a href=#14-cuda-graph-47个 class="table-of-contents__link toc-highlight">14. CUDA Graph (47个)</a><li><a href=#15-其他-4个 class="table-of-contents__link toc-highlight">15. 其他 (4个)</a><li><a href=#16-统计汇总 class="table-of-contents__link toc-highlight">16. 统计汇总</a><li><a href=#17-参考资料 class="table-of-contents__link toc-highlight">17. 参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>