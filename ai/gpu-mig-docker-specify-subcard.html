<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/NVIDIA/GPU MIG拆卡后使用docker指定子卡执行" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>GPU MIG拆卡后使用docker指定子卡执行 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/gpu-mig-docker-specify-subcard><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="GPU MIG拆卡后使用docker指定子卡执行 | John's Blog"><meta data-rh=true name=description content="详细介绍NVIDIA GPU通过MIG拆卡后，如何在Docker容器中指定特定MIG子卡执行任务的两种方法：通过docker device参数和NVIDIA_VISIBLE_DEVICES环境变量，支持UUID和索引两种方式"><meta data-rh=true property=og:description content="详细介绍NVIDIA GPU通过MIG拆卡后，如何在Docker容器中指定特定MIG子卡执行任务的两种方法：通过docker device参数和NVIDIA_VISIBLE_DEVICES环境变量，支持UUID和索引两种方式"><meta data-rh=true name=keywords content="GPU MIG,MIG拆卡,docker,NVIDIA H200,子卡指定,NVIDIA_VISIBLE_DEVICES,MIG Manager,GPU虚拟化,容器GPU调度,MIG UUID,MIG索引,nvidia-container-runtime"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/gpu-mig-docker-specify-subcard><link data-rh=true rel=alternate href=https://johng.cn/ai/gpu-mig-docker-specify-subcard hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/gpu-mig-docker-specify-subcard hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.208c11f9.css><script src=/assets/js/runtime~main.dc0f2d2a.js defer></script><script src=/assets/js/main.ef9f2d13.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/ai>AI技术</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/nvidia>NVIDIA</a><button aria-label="Collapse sidebar category 'NVIDIA'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-operator>GPU Operator</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-dcgm-exporter>GPU DCGM-Exporter监控方案</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-share-mps-mig>GPU Share MPS&MIG具体操作与注意事项</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/gpu-mig-docker-specify-subcard>GPU MIG拆卡后使用docker指定子卡执行</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-mig-pod-pending-terminating-troubleshooting>GPU MIG拆卡后Pod偶发Pending/Terminating状态阻塞问题排查</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/distributed-inference>分布式推理</a><button aria-label="Expand sidebar category '分布式推理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/scheduling>算力资源调度</a><button aria-label="Expand sidebar category '算力资源调度'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/nfd-gfd>NFD&GFD</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-acceleration-cards>常见智算加速卡汇总</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/rdma>RDMA技术架构深度解析</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/general-ai-model-and-reasoning-ai-model-difference>通用大模型和推理大模型区别</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-ai-model-training-inference-framework>常见AI模型训练推理框架对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ai-training-inference-scenarios>AI模型训练推理常见业务场景痛点</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/nvidia><span itemprop=name>NVIDIA</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>GPU MIG拆卡后使用docker指定子卡执行</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-背景介绍>1. 背景介绍<a href=#1-背景介绍 class=hash-link aria-label="Direct link to 1. 背景介绍" title="Direct link to 1. 背景介绍">​</a></h2>
<p>对<code>H200</code>进行<code>MIG</code>拆卡，拆分为<code>1</code>张<code>2g35gb</code>，<code>5</code>张<code>1g18gb</code>，拆卡已经通过<code>Kubernetes MIG Manager</code>实现。在节点上使用<code>nvidia-smi -L</code>查看，如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ nvidia-smi </span><span class="token parameter variable" style=color:#f8f8f2>-L</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-b2acda36-db78-a209-f9ef-d07b4336c449</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  MIG 2g.35gb     Device  </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">: </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: MIG-b05c0034-4d0e-5d3c-a25c-e6795d1779df</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  MIG 1g.18gb     Device  </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">: </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: MIG-be041b89-b751-5c96-84aa-85315833c669</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  MIG 1g.18gb     Device  </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">: </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: MIG-605bf89c-7be6-586e-a729-a2369e833b3e</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  MIG 1g.18gb     Device  </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain">: </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: MIG-02b4e55e-29a1-5d28-b9ee-8e9445e355f0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  MIG 1g.18gb     Device  </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain">: </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: MIG-dc7ad5d3-20d8-5dcb-adf7-fb22c2459352</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  MIG 1g.18gb     Device  </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">: </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: MIG-148a1759-0dd2-59c6-9605-26206ae0e79b</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-af5e38ec-d1d6-1c20-67c8-c8001109e6d8</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-da9f3cba-5f87-5830-26d6-b3f5a545ae34</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>3</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-f2c60745-001d-1948-52bb-c9616b34da97</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>4</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-7b8f55d1-e1d9-30a2-590b-3eff9b86ae05</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-a73089ba-c8f9-f9dc-bd1e-9da99cb2104b</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>6</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-4e19f7d9-e5d6-1223-e9d2-983f01ef45f6</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">GPU </span><span class="token number" style=color:#ae81ff>7</span><span class="token plain">: NVIDIA H200 </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">UUID: GPU-5b73e21c-9b5d-4156-8b8d-aed96f9f8d86</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-解决方案>2. 解决方案<a href=#2-解决方案 class=hash-link aria-label="Direct link to 2. 解决方案" title="Direct link to 2. 解决方案">​</a></h2>
<p>参考官方文档：<a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html target=_blank rel="noopener noreferrer">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=21-使用镜像>2.1 使用镜像<a href=#21-使用镜像 class=hash-link aria-label="Direct link to 2.1 使用镜像" title="Direct link to 2.1 使用镜像">​</a></h3>
<p>这里使用到了公司测试环境的内网镜像：<code>aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128</code>
如果需要使用公网镜像，那么可以使用<code>nvidia</code>官方提供的镜像：<code>nvidia/cuda</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=22-指定runtime>2.2 指定runtime<a href=#22-指定runtime class=hash-link aria-label="Direct link to 2.2 指定runtime" title="Direct link to 2.2 指定runtime">​</a></h3>
<p>首先需要保证<code>docker</code>的<code>runtime</code>配置为<code>nvidia</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ </span><span class="token function" style=color:#e6db74>cat</span><span class="token plain"> /etc/docker/daemon.json</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token string" style=color:#a6e22e>"bip"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token string" style=color:#a6e22e>"192.168.99.1/16"</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token string" style=color:#a6e22e>"exec-opts"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"native.cgroupdriver=cgroupfs"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token string" style=color:#a6e22e>"default-runtime"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token string" style=color:#a6e22e>"nvidia"</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token string" style=color:#a6e22e>"runtimes"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token string" style=color:#a6e22e>"nvidia"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token string" style=color:#a6e22e>"path"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/usr/bin/nvidia-container-runtime"</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token string" style=color:#a6e22e>"runtimeArgs"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token string" style=color:#a6e22e>"data-root"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"/home/docker/data"</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token string" style=color:#a6e22e>"insecure-registries"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"harbor.maip.io"</span><span class="token plain">,</span><span class="token string" style=color:#a6e22e>"aiharbor.msxf.local"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token string" style=color:#a6e22e>"experimental"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> true,</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token string" style=color:#a6e22e>"live-restore"</span><span class="token builtin class-name" style=color:#e6db74>:</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>如果没有配置<code>default-runtime</code>为<code>nvidia</code>，那么在<code>docker</code>执行命令中需要增加指定<code>runtime</code>的参数，例如：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--runtime</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">nvidia </span><span class="token parameter variable" style=color:#f8f8f2>-e</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>NVIDIA_VISIBLE_DEVICES</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>2,3</span><span class="token plain"> aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=23-指定使用mig子卡>2.3 指定使用MIG子卡<a href=#23-指定使用mig子卡 class=hash-link aria-label="Direct link to 2.3 指定使用MIG子卡" title="Direct link to 2.3 指定使用MIG子卡">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=231-通过docker-device指定子卡>2.3.1 通过docker device指定子卡<a href=#231-通过docker-device指定子卡 class=hash-link aria-label="Direct link to 2.3.1 通过docker device指定子卡" title="Direct link to 2.3.1 通过docker device指定子卡">​</a></h4>
<p>指定子卡执行<code>docker</code>镜像。可以通过子卡的<code>UUID</code>或者<code>索引号</code>来指定。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2311-通过指定uuid>2.3.1.1 通过指定UUID<a href=#2311-通过指定uuid class=hash-link aria-label="Direct link to 2.3.1.1 通过指定UUID" title="Direct link to 2.3.1.1 通过指定UUID">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--gpus</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>device</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">MIG-b05c0034-4d0e-5d3c-a25c-e6795d1779df aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行后，终端输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">Mon Jul 28 01:58:33 2025</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| NVIDIA-SMI 570.86.15              Driver Version: 570.86.15      CUDA Version: 12.8     |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |               MIG M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================+========================+======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|   0  NVIDIA H200                    Off |   00000000:2A:00.0 Off |                   On |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| N/A   30C    P0             76W /  700W |                  N/A   |     N/A      Default |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |              Enabled |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| MIG devices:                                                                            |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  GI  CI  MIG |                     Memory-Usage |        Vol|        Shared         |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|      ID  ID  Dev |                       BAR1-Usage | SM     Unc| CE ENC  DEC  OFA  JPG |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                                  |        ECC|                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|==================+==================================+===========+=======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    5   0   0  |              29MiB / 33280MiB    | 32      0 |  2   0    2    0    2 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 65535MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Processes:                                                                              |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|        ID   ID                                                               Usage      |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================================================================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  No running processes found                                                             |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2312-通过指定子卡索引>2.3.1.2 通过指定子卡索引<a href=#2312-通过指定子卡索引 class=hash-link aria-label="Direct link to 2.3.1.2 通过指定子卡索引" title="Direct link to 2.3.1.2 通过指定子卡索引">​</a></h5>
<p>注意这里指定的子卡索引:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--gpus</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'"device=0:0,0:1"'</span><span class="token plain"> aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行后，终端输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">Mon Jul 28 02:00:04 2025</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| NVIDIA-SMI 570.86.15              Driver Version: 570.86.15      CUDA Version: 12.8     |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |               MIG M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================+========================+======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|   0  NVIDIA H200                    Off |   00000000:2A:00.0 Off |                   On |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| N/A   31C    P0             76W /  700W |                  N/A   |     N/A      Default |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |              Enabled |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| MIG devices:                                                                            |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  GI  CI  MIG |                     Memory-Usage |        Vol|        Shared         |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|      ID  ID  Dev |                       BAR1-Usage | SM     Unc| CE ENC  DEC  OFA  JPG |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                                  |        ECC|                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|==================+==================================+===========+=======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    5   0   0  |              29MiB / 33280MiB    | 32      0 |  2   0    2    0    2 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 65535MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    7   0   1  |              15MiB / 16384MiB    | 16      0 |  1   0    1    0    1 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 32767MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Processes:                                                                              |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|        ID   ID                                                               Usage      |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================================================================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  No running processes found                                                             |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=232-通过环境变量指定子卡>2.3.2 通过环境变量指定子卡<a href=#232-通过环境变量指定子卡 class=hash-link aria-label="Direct link to 2.3.2 通过环境变量指定子卡" title="Direct link to 2.3.2 通过环境变量指定子卡">​</a></h3>
<p>也可以通过<code>NVIDIA_VISIBLE_DEVICES</code>环境变量来指定使用的子卡，当然该环境变量也支持使用子卡的<code>UUID</code>或者<code>索引号</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=2321-通过指定uuid>2.3.2.1 通过指定UUID<a href=#2321-通过指定uuid class=hash-link aria-label="Direct link to 2.3.2.1 通过指定UUID" title="Direct link to 2.3.2.1 通过指定UUID">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>-e</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>NVIDIA_VISIBLE_DEVICES</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">MIG-b05c0034-4d0e-5d3c-a25c-e6795d1779df,MIG-be041b89-b751-5c96-84aa-85315833c669 aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行后，终端输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">Mon Jul 28 02:04:51 2025</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| NVIDIA-SMI 570.86.15              Driver Version: 570.86.15      CUDA Version: 12.8     |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |               MIG M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================+========================+======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|   0  NVIDIA H200                    Off |   00000000:2A:00.0 Off |                   On |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| N/A   31C    P0             77W /  700W |                  N/A   |     N/A      Default |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |              Enabled |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| MIG devices:                                                                            |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  GI  CI  MIG |                     Memory-Usage |        Vol|        Shared         |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|      ID  ID  Dev |                       BAR1-Usage | SM     Unc| CE ENC  DEC  OFA  JPG |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                                  |        ECC|                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|==================+==================================+===========+=======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    5   0   0  |              29MiB / 33280MiB    | 32      0 |  2   0    2    0    2 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 65535MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    7   0   1  |              15MiB / 16384MiB    | 16      0 |  1   0    1    0    1 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 32767MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Processes:                                                                              |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|        ID   ID                                                               Usage      |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================================================================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  No running processes found                                                             |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=2322-通过指定子卡索引>2.3.2.2 通过指定子卡索引<a href=#2322-通过指定子卡索引 class=hash-link aria-label="Direct link to 2.3.2.2 通过指定子卡索引" title="Direct link to 2.3.2.2 通过指定子卡索引">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>-e</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>NVIDIA_VISIBLE_DEVICES</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">:0,0:1 aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行后，终端输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">Mon Jul 28 02:02:51 2025</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| NVIDIA-SMI 570.86.15              Driver Version: 570.86.15      CUDA Version: 12.8     |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |               MIG M. |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================+========================+======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|   0  NVIDIA H200                    Off |   00000000:2A:00.0 Off |                   On |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| N/A   31C    P0             76W /  700W |                  N/A   |     N/A      Default |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                                         |                        |              Enabled |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------+------------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| MIG devices:                                                                            |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| GPU  GI  CI  MIG |                     Memory-Usage |        Vol|        Shared         |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|      ID  ID  Dev |                       BAR1-Usage | SM     Unc| CE ENC  DEC  OFA  JPG |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                                  |        ECC|                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|==================+==================================+===========+=======================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    5   0   0  |              29MiB / 33280MiB    | 32      0 |  2   0    2    0    2 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 65535MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  0    7   0   1  |              15MiB / 16384MiB    | 16      0 |  1   0    1    0    1 |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|                  |                 0MiB / 32767MiB  |           |                       |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+------------------+----------------------------------+-----------+-----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">| Processes:                                                                              |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|        ID   ID                                                               Usage      |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|=========================================================================================|</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">|  No running processes found                                                             |</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------------------------------------------------------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-相关问题>3. 相关问题<a href=#3-相关问题 class=hash-link aria-label="Direct link to 3. 相关问题" title="Direct link to 3. 相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=31-sglang-v049post4以下版本不支持指定mig子卡>3.1 sglang v0.4.9.post4以下版本不支持指定MIG子卡<a href=#31-sglang-v049post4以下版本不支持指定mig子卡 class=hash-link aria-label="Direct link to 3.1 sglang v0.4.9.post4以下版本不支持指定MIG子卡" title="Direct link to 3.1 sglang v0.4.9.post4以下版本不支持指定MIG子卡">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=311-问题描述>3.1.1 问题描述<a href=#311-问题描述 class=hash-link aria-label="Direct link to 3.1.1 问题描述" title="Direct link to 3.1.1 问题描述">​</a></h4>
<p>尝试在<code>H200</code>的节点上指定<code>MIG</code>子卡，执行以下命令运行推理服务：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>-it</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token parameter variable" style=color:#f8f8f2>--name</span><span class="token plain"> Qwen2.5-7b-fp8 </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token parameter variable" style=color:#f8f8f2>--gpus</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>'"device=MIG-b05c0034-4d0e-5d3c-a25c-e6795d1779df"'</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token parameter variable" style=color:#f8f8f2>-v</span><span class="token plain"> /share:/share </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token parameter variable" style=color:#f8f8f2>-p</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>9800</span><span class="token plain">:8000 </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">python3 </span><span class="token parameter variable" style=color:#f8f8f2>-m</span><span class="token plain"> sglang.launch_server </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        --model-path /share/global/models/Qwen2.5-7B-Instruct/ </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token parameter variable" style=color:#f8f8f2>--host</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0.0</span><span class="token plain">.0.0 </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token parameter variable" style=color:#f8f8f2>--port</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8000</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        --disable-radix-cache </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        --served-model-name Qwen2.5-7b-fp8 </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        --tensor-parallel-size </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token parameter variable" style=color:#f8f8f2>--quantization</span><span class="token plain"> fp8 </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token parameter variable" style=color:#f8f8f2>--dtype</span><span class="token plain"> auto</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行后，将会出现报错：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">2025-07-28 06:24:08.068 | INFO     | vllm.platforms:resolve_current_platform_cls_qualname:244 - Automatically detected platform cuda.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">/tmp/pinpointdxbgbm_2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Traceback (most recent call last):</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "&lt;frozen runpy>", line 198, in _run_module_as_main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "&lt;frozen runpy>", line 88, in _run_code</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "/usr/local/python3/lib/python3.12/site-packages/sglang/launch_server.py", line 16, in &lt;module></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    server_args = prepare_server_args(sys.argv[1:])</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "/usr/local/python3/lib/python3.12/site-packages/sglang/srt/server_args.py", line 1689, in prepare_server_args</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    server_args = ServerArgs.from_cli_args(raw_args)</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "/usr/local/python3/lib/python3.12/site-packages/sglang/srt/server_args.py", line 1632, in from_cli_args</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    return cls(**{attr: getattr(args, attr) for attr in attrs})</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "&lt;string>", line 165, in __init__</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "/usr/local/python3/lib/python3.12/site-packages/sglang/srt/server_args.py", line 273, in __post_init__</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    gpu_mem = get_device_memory_capacity(self.device)</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "/usr/local/python3/lib/python3.12/site-packages/sglang/srt/utils.py", line 1316, in get_device_memory_capacity</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    gpu_mem = get_nvgpu_memory_capacity()</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              ^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  File "/usr/local/python3/lib/python3.12/site-packages/sglang/srt/utils.py", line 1263, in get_nvgpu_memory_capacity</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    raise ValueError("No GPU memory values found.")</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ValueError: No GPU memory values found.</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=312-问题原因>3.1.2 问题原因<a href=#312-问题原因 class=hash-link aria-label="Direct link to 3.1.2 问题原因" title="Direct link to 3.1.2 问题原因">​</a></h4>
<p>根据社区检索和源码排查，最终确定问题出在<code>sglang</code>上，相关连接：<a href=https://github.com/sgl-project/sglang/pull/8167 target=_blank rel="noopener noreferrer">https://github.com/sgl-project/sglang/pull/8167</a></p>
<p>问题原因是<code>sglang</code>当前版本（<code>v0.4.8</code>）默认通过命令行的方式去获取<code>GPU</code>卡的内存信息，然后整卡的内存获取和<code>MIG</code>子卡的内存获取方式会不太一样，具体源码在这里：<a href=https://github.com/sgl-project/sglang/blob/7c3a12c0002e33fed1e72f4157e74a64a998f251/python/sglang/srt/utils.py#L1235 target=_blank rel="noopener noreferrer">https://github.com/sgl-project/sglang/blob/7c3a12c0002e33fed1e72f4157e74a64a998f251/python/sglang/srt/utils.py#L1235</a></p>
<p>这种显存获取方式比较原始，通过命令行子进程的方式获取，感觉这里<code>sglang</code>的源码可以改进下，通过<code>nvml</code>获取靠谱一些。</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-4c2ed68e7ee41f6892a8745c75ddf384.png width=1918 height=1218 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=313-验证方式>3.1.3 验证方式<a href=#313-验证方式 class=hash-link aria-label="Direct link to 3.1.3 验证方式" title="Direct link to 3.1.3 验证方式">​</a></h4>
<p>根据源码分析，当前<code>sglang</code>版本也就是通过以下方式获取显存大小：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--gpus</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'"device=MIG-b05c0034-4d0e-5d3c-a25c-e6795d1779df"'</span><span class="token plain">  aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 nvidia-smi --query-gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">memory.total </span><span class="token parameter variable" style=color:#f8f8f2>--format</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">csv,noheader,nounits</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>当直接将该命令在节点上执行后，终端会输出<code>Insufficient Permissions</code>的错误，因此<code>sglang</code>源码中获取显存也就失败了，直接退出执行。</p>
<p>可以通过以下方式验证<code>Github</code>上<code>PR</code>方案的可行性：</p>
<ol>
<li>手动执行进入容器<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>-it</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--gpus</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'"device=MIG-b05c0034-4d0e-5d3c-a25c-e6795d1779df"'</span><span class="token plain"> aiharbor.msxf.local/test/sglang:0.4.8.post1-cu128 </span><span class="token function" style=color:#e6db74>bash</span><span class="token plain"> </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>执行以下<code>python</code>脚本验证<!-- -->
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">python3 </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain">c "</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'CUDA available:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">is_available</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'Device count:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">device_count</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">is_available</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'Device name:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get_device_name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'Memory:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get_device_properties</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">total_memory </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1024</span><span class="token operator" style=color:#66d9ef>**</span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'GB'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->终端输出：<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">CUDA available: True</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Device count: 1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Device name: NVIDIA H200 MIG 2g.35gb</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Memory: 32.5 GB</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>也可以通过另外<code>python</code>脚本验证，该脚本实现方式来源于<code>PR</code>提交内容<!-- -->
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">python3 </span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain">c "</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'CUDA available:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">is_available</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'Device count:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">device_count</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">is_available</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'Device name:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get_device_name</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>'Memory:'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">mem_get_info</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>/</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1024</span><span class="token operator" style=color:#66d9ef>**</span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'GB'</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->终端输出：<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">CUDA available: True</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Device count: 1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Device name: NVIDIA H200 MIG 2g.35gb</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Memory: 32.5 GB</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=314-解决方案>3.1.4 解决方案<a href=#314-解决方案 class=hash-link aria-label="Direct link to 3.1.4 解决方案" title="Direct link to 3.1.4 解决方案">​</a></h4>
<ul>
<li>【推荐】升级使用的<code>sglang</code>版本到<code>v0.4.9.post4</code>或以上解决该问题。</li>
<li>考虑切换到<code>vllm</code>框架，并参考<code>vllm</code>框架解决方案。</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/gpu-share-mps-mig><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>GPU Share MPS&MIG具体操作与注意事项</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/gpu-mig-pod-pending-terminating-troubleshooting><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>GPU MIG拆卡后Pod偶发Pending/Terminating状态阻塞问题排查</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-背景介绍 class="table-of-contents__link toc-highlight">1. 背景介绍</a><li><a href=#2-解决方案 class="table-of-contents__link toc-highlight">2. 解决方案</a><ul><li><a href=#21-使用镜像 class="table-of-contents__link toc-highlight">2.1 使用镜像</a><li><a href=#22-指定runtime class="table-of-contents__link toc-highlight">2.2 指定runtime</a><li><a href=#23-指定使用mig子卡 class="table-of-contents__link toc-highlight">2.3 指定使用MIG子卡</a><li><a href=#232-通过环境变量指定子卡 class="table-of-contents__link toc-highlight">2.3.2 通过环境变量指定子卡</a></ul><li><a href=#3-相关问题 class="table-of-contents__link toc-highlight">3. 相关问题</a><ul><li><a href=#31-sglang-v049post4以下版本不支持指定mig子卡 class="table-of-contents__link toc-highlight">3.1 sglang v0.4.9.post4以下版本不支持指定MIG子卡</a></ul></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>