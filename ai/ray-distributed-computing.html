<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/训练微调/Ray分布式计算引擎/Ray分布式计算引擎介绍" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Ray分布式计算引擎介绍 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/ray-distributed-computing><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Ray分布式计算引擎介绍 | John's Blog"><meta data-rh=true name=description content="介绍Ray分布式计算引擎在AI模型训练场景中的应用。讲解Ray的核心概念，包括Tasks任务、Actors参与者、Objects对象等基础组件，阐述Ray与PyTorch等框架的区别与协作关系。介绍Ray Train在分布式训练、超大模型训练中的实际应用，展示如何通过简单的API实现复杂的分布式计算。"><meta data-rh=true property=og:description content="介绍Ray分布式计算引擎在AI模型训练场景中的应用。讲解Ray的核心概念，包括Tasks任务、Actors参与者、Objects对象等基础组件，阐述Ray与PyTorch等框架的区别与协作关系。介绍Ray Train在分布式训练、超大模型训练中的实际应用，展示如何通过简单的API实现复杂的分布式计算。"><meta data-rh=true name=keywords content="Ray,分布式计算,分布式训练,Ray Train,Ray Core,Ray Cluster,KubeRay,Kubernetes,机器学习,深度学习,PyTorch,模型训练,超参数调优,批量推理,分布式系统,并行计算,GPU训练,大模型训练,任务调度,资源管理"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/ray-distributed-computing><link data-rh=true rel=alternate href=https://johng.cn/ai/ray-distributed-computing hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/ray-distributed-computing hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.d14e1eeb.css><script src=/assets/js/runtime~main.7c7fade2.js defer></script><script src=/assets/js/main.4c5f7df7.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/agents-deep-dive-from-llm-to-autonomous-agents>智能体</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/copilot-skills-guide>应用开发</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/online-offline-batch-inference>推理服务</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/hpc-development-training-platform>训练微调</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/hpc-development-training-platform>开发训练平台</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/pytorch-intro>开发训练框架</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/kubeflow-trainer-in-hpc>Kubeflow Trainer</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/ray-distributed-computing>Ray分布式计算引擎</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/ray-distributed-computing>Ray分布式计算引擎介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/kuberay-guide>KubeRay基本介绍与使用</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/kuberay-rayjob-configuration>KubeRay RayJob配置详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/volcano-ray-plugin>通过Volcano Job插件部署使用Ray Cluster</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/machine-learning-fundamentals>AI模型与机器学习</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/training>AI模型训练技术详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/fine-tuning>AI模型微调技术详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/training-parallel-strategies>AI模型训练并行策略介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/model-development>模型开发</a><button aria-label="Expand sidebar category '模型开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/rdma-brief>基础架构</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/basic-terminology>入门知识</a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统��和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li class=breadcrumbs__item><span class=breadcrumbs__link>训练微调</span><meta itemprop=position content=2><li class=breadcrumbs__item><span class=breadcrumbs__link>Ray分布式计算引擎</span><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Ray分布式计算引擎介绍</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=ray是什么>Ray是什么<a href=#ray是什么 class=hash-link aria-label="Direct link to Ray是什么" title="Direct link to Ray是什么">​</a></h2>
<p><code>Ray</code>是一个开源的分布式计算框架，由<code>UC Berkeley RISELab</code>开发，专为简化<code>Python</code>应用程序的分布式执行而设计。它提供了简单易用的<code>API</code>，让开发者能够轻松地将单机<code>Python</code>代码扩展到集群环境中运行。</p>
<p><strong>核心特点</strong>：</p>
<ul>
<li><strong>简单易用</strong>：通过<code>@ray.remote</code>装饰器即可将普通<code>Python</code>函数和类转换为分布式任务</li>
<li><strong>通用性强</strong>：不仅支持机器学习，还可用于数据处理、科学计算等多种场景</li>
<li><strong>性能优越</strong>：基于共享内存和零拷贝技术，实现高效的数据传输</li>
<li><strong>生态丰富</strong>：提供<code>Ray Train</code>（训练）、<code>Ray Data</code>（数据处理）、<code>Ray Serve</code>（模型服务）等完整的生态库</li>
</ul>
<p><strong>通俗理解</strong>：</p>
<p><code>Ray</code>就像一个"任务分发器"。想象你有一家餐厅，原本只有一个厨师做菜，效率很低。使用<code>Ray</code>后，你可以轻松雇佣多个厨师，每个厨师负责不同的菜品，大家并行工作，效率成倍提升。而且，你不需要关心厨师之间如何协调，<code>Ray</code>会自动帮你管理。</p>
<p><img decoding=async loading=lazy alt=Ray是一个开源的分布式计算框架 src=/assets/images/image-f8c61332e5d21ae837a123cac5750c98.png width=901 height=632 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=ray解决什么问题>Ray解决什么问题<a href=#ray解决什么问题 class=hash-link aria-label="Direct link to Ray解决什么问题" title="Direct link to Ray解决什么问题">​</a></h2>
<p>在<code>AI</code>模型训练和大规模数据处理场景中，开发者经常面临以下挑战：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=单机资源瓶颈>单机资源瓶颈<a href=#单机资源瓶颈 class=hash-link aria-label="Direct link to 单机资源瓶颈" title="Direct link to 单机资源瓶颈">​</a></h3>
<p>当模型规模增大或数据量增加时，单台机器的<code>CPU</code>、<code>GPU</code>、内存等资源会成为瓶颈，导致训练时间过长甚至无法完成。</p>
<p><strong>传统方案的问题</strong>：</p>
<ul>
<li>手动编写分布式代码复杂度高，需要处理进程通信、数据同步等底层细节</li>
<li>不同框架的分布式实现方式各异，学习成本高</li>
<li>调试和监控困难，出问题难以定位</li>
</ul>
<p><strong>Ray的解决方案</strong>：</p>
<ul>
<li>提供统一的分布式抽象，开发者只需添加几行代码即可实现分布式执行</li>
<li>自动处理任务调度、负载均衡和容错</li>
<li>内置监控面板，实时查看集群状态和任务执行情况</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=资源利用率低>资源利用率低<a href=#资源利用率低 class=hash-link aria-label="Direct link to 资源利用率低" title="Direct link to 资源利用率低">​</a></h3>
<p>在多<code>GPU</code>训练场景中，如果代码没有正确并行化，可能导致部分<code>GPU</code>空闲，资源浪费严重。</p>
<p><strong>Ray的解决方案</strong>：</p>
<ul>
<li>智能任务调度，根据资源可用性自动分配任务</li>
<li>支持细粒度的资源配置，可以指定每个任务需要的<code>CPU</code>、<code>GPU</code>、内存等</li>
<li>动态资源扩缩容，根据工作负载自动调整集群规模</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=代码维护困难>代码维护困难<a href=#代码维护困难 class=hash-link aria-label="Direct link to 代码维护困难" title="Direct link to 代码维护困难">​</a></h3>
<p>传统分布式代码往往需要大量样板代码，难以维护和迁移。</p>
<p><strong>Ray的解决方案</strong>：</p>
<ul>
<li>代码侵入性小，原有单机代码只需少量修改即可分布式运行</li>
<li>提供统一的编程接口，在本地和集群上运行体验一致</li>
<li>支持增量迁移，可以逐步将单机代码改造为分布式</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=ray的核心组件>Ray的核心组件<a href=#ray的核心组件 class=hash-link aria-label="Direct link to Ray的核心组件" title="Direct link to Ray的核心组件">​</a></h2>
<p><code>Ray</code>提供了从底层分布式计算到高层应用的完整技术栈，包括<code>Ray Core</code>作为基础层，以及构建在其上的各种高级库，形成了丰富的生态体系。</p>
<p><code>Ray</code>各组件的定位和关系如下：</p>
<table><thead><tr><th>组件<th>层次<th>主要功能<th>适用人群<tbody><tr><td><strong>Ray Core</strong><td>基础层<td>分布式计算原语（<code>Tasks</code>、<code>Actors</code>、<code>Objects</code>）<td>需要自定义分布式应用的开发者<tr><td><strong>Ray Data</strong><td>应用层<td>分布式数据处理和<code>ETL</code><td>数据工程师、<code>ML</code>工程师<tr><td><strong>Ray Train</strong><td>应用层<td>分布式模型训练<td>机器学习工程师、研究员<tr><td><strong>Ray Tune</strong><td>应用层<td>超参数调优和实验管理<td>机器学习工程师、研究员<tr><td><strong>Ray Serve</strong><td>应用层<td>模型服务部署<td><code>ML</code>工程师、后端工程师<tr><td><strong>Ray RLlib</strong><td>应用层<td>强化学习算法库<td>强化学习研究员、游戏<code>AI</code>开发者</table>
<p>这些组件可以独立使用，也可以组合使用，形成端到端的机器学习工作流：</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ray-core---分布式计算基础层>Ray Core - 分布式计算基础层<a href=#ray-core---分布式计算基础层 class=hash-link aria-label="Direct link to Ray Core - 分布式计算基础层" title="Direct link to Ray Core - 分布式计算基础层">​</a></h3>
<p><code>Ray Core</code>是<code>Ray</code>的基础层，提供以下核心能力：</p>
<ul>
<li><strong>任务调度</strong>：智能的分布式任务调度器</li>
<li><strong>资源管理</strong>：细粒度的<code>CPU</code>、<code>GPU</code>、内存资源分配</li>
<li><strong>对象存储</strong>：高效的分布式共享内存系统</li>
<li><strong>容错机制</strong>：自动故障检测和任务重试</li>
</ul>
<p><strong>任务调度特性</strong>：</p>
<table><thead><tr><th>特性<th>说明<th>优势<tbody><tr><td><strong>负载均衡</strong><td>将任务均匀分配到各个节点<td>避免某些节点过载，提高资源利用率<tr><td><strong>数据本地性</strong><td>优先将任务调度到数据所在节点<td>减少网络传输，提升性能<tr><td><strong>资源感知</strong><td>根据任务的资源需求选择合适节点<td>确保任务有足够资源运行<tr><td><strong>容错处理</strong><td>自动重试失败的任务<td>保证计算的可靠性</table>
<p>它通过三个核心原语（<code>Primitives</code>）构建了完整的分布式计算能力。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=tasks任务>Tasks（任务）<a href=#tasks任务 class=hash-link aria-label="Direct link to Tasks（任务）" title="Direct link to Tasks（任务）">​</a></h4>
<p><strong>定义</strong>：<code>Tasks</code>是<code>Ray</code>中最基本的并行执行单元，代表一个无状态的远程函数调用。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>无状态：每次调用都是独立的，不保存任何状态</li>
<li>异步执行：调用后立即返回，不阻塞主程序</li>
<li>自动调度：<code>Ray</code>会自动选择空闲的节点执行</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 初始化Ray</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">init</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 定义一个普通函数</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#f8f8f2>@ray</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>.</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>remote</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>square</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">x</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> x </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> x</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 并行执行4个任务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">futures </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">square</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">remote</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">i</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> i </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取结果</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">results </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">futures</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">results</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># [0, 1, 4, 9]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=actors参与者>Actors（参与者）<a href=#actors参与者 class=hash-link aria-label="Direct link to Actors（参与者）" title="Direct link to Actors（参与者）">​</a></h4>
<p><strong>定义</strong>：<code>Actors</code>是<code>Ray</code>中的有状态计算单元，它将<code>Python</code>类转换为分布式的长期运行进程。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>有状态：可以在多次方法调用之间保持内部状态</li>
<li>独占进程：每个<code>Actor</code>实例运行在专属的工作进程中</li>
<li>串行执行：同一个<code>Actor</code>的方法调用按顺序执行，保证状态一致性</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#f8f8f2>@ray</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>.</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>remote</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>class</span><span class="token plain"> </span><span class="token class-name" style=color:#e6db74>Counter</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__init__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">count </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>increment</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> value</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">count </span><span class="token operator" style=color:#66d9ef>+=</span><span class="token plain"> value</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>get_count</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">count</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 创建Actor实例</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">counter </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> Counter</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">remote</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 多次调用Actor方法</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> _ </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    counter</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">increment</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">remote</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取最终状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">counter</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get_count</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">remote</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">result</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 10</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=objects对象>Objects（对象）<a href=#objects对象 class=hash-link aria-label="Direct link to Objects（对象）" title="Direct link to Objects（对象）">​</a></h4>
<p><strong>定义</strong>：<code>Objects</code>是<code>Ray</code>的分布式对象存储，用于在任务和<code>Actor</code>之间高效传递数据。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>零拷贝：使用共享内存技术，避免数据序列化和拷贝的开销</li>
<li>自动管理：<code>Ray</code>自动处理对象的生命周期和垃圾回收</li>
<li>透明传递：对象引用可以在任务之间传递，数据在需要时才传输</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> numpy </span><span class="token keyword" style=color:#66d9ef>as</span><span class="token plain"> np</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#f8f8f2>@ray</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>.</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>remote</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>process_matrix</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">matrix_ref</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 自动获取对象数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    matrix </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">matrix_ref</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> np</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token builtin" style=color:#e6db74>sum</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">matrix</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 将大对象存入对象存储</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">large_matrix </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> np</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ones</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>1000</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1000</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">matrix_ref </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">put</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">large_matrix</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 传递对象引用而非对象本身</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">process_matrix</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">remote</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">matrix_ref</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">result</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 1000000.0</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=ray集群ray-cluster>Ray集群（Ray Cluster）<a href=#ray集群ray-cluster class=hash-link aria-label="Direct link to Ray集群（Ray Cluster）" title="Direct link to Ray集群（Ray Cluster）">​</a></h4>
<p><code>Ray</code>集群是<code>Ray</code>分布式计算的基础运行环境，由多个节点组成的分布式系统。</p>
<p><strong>集群架构</strong>：</p>
<p>一个<code>Ray</code>集群由一个<code>Head</code>节点和任意数量的<code>Worker</code>节点组成：</p>
<p><img decoding=async loading=lazy alt=Ray集群 src=/assets/images/image-1-e5ec2302d0bc74da916fe09c0f17672d.png width=3278 height=1574 class=img_ev3q></p>
<p><strong>Head节点（主节点）</strong>：</p>
<p><code>Head</code>节点是集群的控制中心，它<strong>具备<code>Worker</code>节点的所有职责</strong>，并且<strong>额外运行集群管理进程</strong>。</p>
<table><thead><tr><th>职责类型<th>具体功能<th>说明<tbody><tr><td><strong>基础执行能力</strong><br>（与<code>Worker</code>相同）<td>运行<code>Raylet</code>进程<td>执行任务调度和分布式调度<tr><td><td>运行<code>Object Store</code><td>存储和分发<code>Ray</code>对象<tr><td><td>执行任务和<code>Actor</code><td>与<code>Worker</code>一样可以执行用户代码<tr><td><strong>管控能力</strong><br>（<code>Head</code>特有）<td><code>GCS</code>全局控制存储<td>管理集群元数据和状态信息<tr><td><td>自动伸缩器<td>根据资源需求动态增减<code>Worker</code>节点<tr><td><td><code>Dashboard</code><td>提供<code>Web</code>界面监控集群状态<tr><td><td><code>Driver</code>进程<td>运行<code>Ray Job</code>的主程序</table>
<p><strong>Worker节点（工作节点）</strong>：</p>
<p><code>Worker</code>节点专注于执行计算任务，<strong>不运行任何集群管理进程</strong>。</p>
<table><thead><tr><th>职责<th>功能描述<tbody><tr><td><strong>任务执行</strong><td>运行<code>Ray</code>任务和<code>Actor</code>中的用户代码<tr><td><strong>分布式调度</strong><td>参与任务分配和负载均衡<tr><td><strong>对象存储</strong><td>存储和分发<code>Ray</code>对象到集群内存<tr><td><strong>资源共享</strong><td>与其他节点协同完成分布式计算</table>
<p><strong>重要说明</strong>：</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Head节点与Worker节点的关系</div><div class=admonitionContent_BuS1><ul>
<li><code>Head</code>节点 = <code>Worker</code>节点的所有能力 + 集群管控能力</li>
<li><code>Ray</code>可以在<code>Head</code>节点上调度任务和<code>Actor</code>，就像在普通<code>Worker</code>节点上一样</li>
<li>在大型集群中，建议配置<code>Head</code>节点专注于管理，不执行计算密集型任务</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ray-data---分布式数据处理>Ray Data - 分布式数据处理<a href=#ray-data---分布式数据处理 class=hash-link aria-label="Direct link to Ray Data - 分布式数据处理" title="Direct link to Ray Data - 分布式数据处理">​</a></h3>
<p><code>Ray Data</code>是<code>Ray</code>生态中的数据处理库，提供了类似<code>Apache Spark</code>的分布式数据处理能力，但更适合机器学习工作负载。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>流式处理</strong>：支持大规模数据集的流式读取和处理</li>
<li><strong>多格式支持</strong>：支持<code>CSV</code>、<code>Parquet</code>、<code>JSON</code>、图片、视频等多种格式</li>
<li><strong>与训练集成</strong>：无缝对接<code>Ray Train</code>，实现数据预处理和训练的一体化</li>
<li><strong>高性能</strong>：针对<code>ML</code>工作负载优化，比传统数据处理框架更快</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 创建分布式数据集</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ds </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">data</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">read_csv</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"s3://bucket/data.csv"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 并行数据转换</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ds </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ds</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token builtin" style=color:#e6db74>map</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>lambda</span><span class="token plain"> row</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"value"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> row</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"value"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 批量处理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ds </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ds</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">map_batches</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>lambda</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> preprocess</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">batch</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 写入结果</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ds</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">write_parquet</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"s3://bucket/output"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ray-train---分布式训练>Ray Train - 分布式训练<a href=#ray-train---分布式训练 class=hash-link aria-label="Direct link to Ray Train - 分布式训练" title="Direct link to Ray Train - 分布式训练">​</a></h3>
<p><code>Ray Train</code>是<code>Ray</code>生态中的分布式训练库，简化了多框架的分布式训练实现。</p>
<p><strong>支持的框架</strong>：</p>
<table><thead><tr><th>框架类别<th>支持的框架<tbody><tr><td><strong>深度学习</strong><td><code>PyTorch</code>、<code>TensorFlow</code>、<code>Keras</code><tr><td><strong>深度学习工具</strong><td><code>PyTorch Lightning</code>、<code>Hugging Face Transformers</code>、<code>DeepSpeed</code>、<code>Horovod</code><tr><td><strong>传统机器学习</strong><td><code>XGBoost</code>、<code>LightGBM</code></table>
<p><strong>核心优势</strong>：</p>
<ul>
<li><strong>统一接口</strong>：所有框架使用相同的<code>API</code>风格，降低学习成本</li>
<li><strong>弹性训练</strong>：支持容错和动态扩缩容</li>
<li><strong>检查点管理</strong>：自动保存和恢复训练状态</li>
<li><strong>实验追踪</strong>：内置指标记录和可视化</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> TorchTrainer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ScalingConfig</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>train_func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 训练代码</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>pass</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置分布式训练</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">scaling_config </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ScalingConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_workers</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> use_gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">trainer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> TorchTrainer</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">train_func</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> scaling_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">scaling_config</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> trainer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">fit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ray-tune---超参数调优>Ray Tune - 超参数调优<a href=#ray-tune---超参数调优 class=hash-link aria-label="Direct link to Ray Tune - 超参数调优" title="Direct link to Ray Tune - 超参数调优">​</a></h3>
<p><code>Ray Tune</code>是业界领先的超参数调优库，支持多种搜索算法和早停策略，可以高效地找到最优的模型配置。</p>
<p><strong>支持的搜索算法</strong>：</p>
<table><thead><tr><th>算法类型<th>具体算法<th>特点<tbody><tr><td><strong>基础搜索</strong><td>网格搜索、随机搜索<td>简单易用，适合小规模搜索<tr><td><strong>贝叶斯优化</strong><td><code>Optuna</code>、<code>HyperOpt</code><td>智能采样，适合昂贵的评估<tr><td><strong>进化算法</strong><td><code>PBT(Population Based Training)</code><td>动态调整，适合长时间训练<tr><td><strong>早停策略</strong><td><code>ASHA</code>、<code>Median Stopping</code><td>提前终止表现差的试验</table>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>并行搜索</strong>：同时运行多个试验，充分利用集群资源</li>
<li><strong>智能调度</strong>：根据中间结果动态分配资源</li>
<li><strong>实验管理</strong>：自动记录所有试验的配置和结果</li>
<li><strong>可视化</strong>：通过<code>TensorBoard</code>等工具可视化搜索过程</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> tune</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">schedulers </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ASHAScheduler</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>train_model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">config</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用config中的超参数训练模型</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> epoch </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        accuracy </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> train_epoch</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">config</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"lr"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> config</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"batch_size"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">report</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">accuracy</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">accuracy</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置搜索空间和调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tuner </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Tuner</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    train_model</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    tune_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TuneConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        num_samples</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>100</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        scheduler</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">ASHAScheduler</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">metric</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"accuracy"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> mode</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"max"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    param_space</span><span class="token operator" style=color:#66d9ef>=</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token string" style=color:#a6e22e>"lr"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">loguniform</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>1e-4</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1e-1</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token string" style=color:#a6e22e>"batch_size"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">choice</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token number" style=color:#ae81ff>32</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>128</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">results </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> tuner</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">fit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"Best config: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">results</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">get_best_result</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">config</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ray-serve---模型服务部署>Ray Serve - 模型服务部署<a href=#ray-serve---模型服务部署 class=hash-link aria-label="Direct link to Ray Serve - 模型服务部署" title="Direct link to Ray Serve - 模型服务部署">​</a></h3>
<p><code>Ray Serve</code>是<code>Ray</code>生态中的模型服务框架，用于将训练好的模型部署为高性能、可扩展的在线服务。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>多模型部署</strong>：在同一集群中部署多个不同的模型</li>
<li><strong>动态扩缩容</strong>：根据请求负载自动调整服务副本数</li>
<li><strong>模型组合</strong>：支持模型链式调用和复杂的推理流水线</li>
<li><strong>框架无关</strong>：支持任何<code>Python</code>模型（<code>PyTorch</code>、<code>TensorFlow</code>、<code>Scikit-learn</code>等）</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> serve</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#f8f8f2>@serve</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>.</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>deployment</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_replicas</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>class</span><span class="token plain"> </span><span class="token class-name" style=color:#e6db74>TextClassifier</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__init__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">load</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"model.pt"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>async</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__call__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> request</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        text </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>await</span><span class="token plain"> request</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">json</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        prediction </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">text</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"input"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"result"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> prediction</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">tolist</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 部署服务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">serve</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">TextClassifier</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">bind</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> route_prefix</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"/classify"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>高级特性</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 模型组合和流水线</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#f8f8f2>@serve</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>.</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>deployment</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>class</span><span class="token plain"> </span><span class="token class-name" style=color:#e6db74>Preprocessor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>process</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> text</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> tokenize</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">text</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#f8f8f2>@serve</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>.</span><span class="token decorator annotation punctuation" style=color:#f8f8f2>deployment</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>class</span><span class="token plain"> </span><span class="token class-name" style=color:#e6db74>Model</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__init__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> preprocessor</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">preprocessor </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> preprocessor</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> load_model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>async</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__call__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> request</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        text </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>await</span><span class="token plain"> request</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">json</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        tokens </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">preprocessor</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">process</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">remote</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">text</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        prediction </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>await</span><span class="token plain"> tokens</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"prediction"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> prediction</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 部署带依赖的服务</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">preprocessor </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> Preprocessor</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">bind</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> Model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">bind</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">preprocessor</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">serve</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">run</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ray-rllib---强化学习>Ray RLlib - 强化学习<a href=#ray-rllib---强化学习 class=hash-link aria-label="Direct link to Ray RLlib - 强化学习" title="Direct link to Ray RLlib - 强化学习">​</a></h3>
<p><code>Ray RLlib</code>是<code>Ray</code>生态中的强化学习库，提供了工业级的强化学习算法实现和训练框架。</p>
<p><strong>支持的算法</strong>：</p>
<table><thead><tr><th>算法类别<th>具体算法<tbody><tr><td><strong>策略梯度</strong><td><code>PPO</code>、<code>A3C</code>、<code>A2C</code>、<code>IMPALA</code><tr><td><strong>Q学习</strong><td><code>DQN</code>、<code>Rainbow</code>、<code>APEX-DQN</code><tr><td><strong>Actor-Critic</strong><td><code>SAC</code>、<code>TD3</code>、<code>DDPG</code><tr><td><strong>模型based</strong><td><code>Dreamer</code>、<code>MBMPO</code><tr><td><strong>多智能体</strong><td><code>QMIX</code>、<code>MADDPG</code></table>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>分布式训练</strong>：支持大规模并行采样和训练</li>
<li><strong>环境支持</strong>：兼容<code>Gym</code>、<code>Unity ML-Agents</code>等主流环境</li>
<li><strong>算法库丰富</strong>：内置数十种经典和前沿算法</li>
<li><strong>可定制性强</strong>：支持自定义环境、模型、策略</li>
</ul>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">rllib</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">algorithms</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ppo </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> PPOConfig</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置PPO算法</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">config </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    PPOConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">environment</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"CartPole-v1"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">framework</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"torch"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">training</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        lr</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>0.0001</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        num_sgd_iter</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        train_batch_size</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>4000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">resources</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_gpus</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">rollouts</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_rollout_workers</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 创建并训练算法</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">algo </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> config</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">build</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> i </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> algo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"Iteration </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>: reward=</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>[</span><span class="token string-interpolation interpolation string" style=color:#a6e22e>'episode_reward_mean'</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>]</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 保存模型</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">algo</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">save</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"checkpoint"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=ray与pytorch的区别>Ray与PyTorch的区别<a href=#ray与pytorch的区别 class=hash-link aria-label="Direct link to Ray与PyTorch的区别" title="Direct link to Ray与PyTorch的区别">​</a></h2>
<p>很多人会混淆<code>Ray</code>和<code>PyTorch</code>，认为它们是竞争关系。实际上，它们是<strong>互补关系</strong>，各自解决不同层次的问题。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=本质区别>本质区别<a href=#本质区别 class=hash-link aria-label="Direct link to 本质区别" title="Direct link to 本质区别">​</a></h3>
<table><thead><tr><th>维度<th>PyTorch<th>Ray<tbody><tr><td><strong>定位</strong><td>深度学习框架<td>分布式计算框架<tr><td><strong>核心功能</strong><td>构建和训练神经网络<td>分布式任务调度和资源管理<tr><td><strong>抽象层次</strong><td>张量计算、自动求导<td>任务并行、数据共享、集群管理<tr><td><strong>应用范围</strong><td>主要用于深度学习<td>通用分布式计算（包括深度学习）<tr><td><strong>使用方式</strong><td>定义模型、前向传播、反向传播<td>定义分布式任务和参与者</table>
<p><strong>通俗类比</strong>：</p>
<ul>
<li><strong>PyTorch</strong>：就像一个"厨师"，专门负责做菜（训练模型）</li>
<li><strong>Ray</strong>：就像一个"餐厅管理系统"，负责调度多个厨师、分配任务、管理资源</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=协作关系>协作关系<a href=#协作关系 class=hash-link aria-label="Direct link to 协作关系" title="Direct link to 协作关系">​</a></h3>
<p><code>Ray</code>和<code>PyTorch</code>通常一起使用，形成完整的分布式训练解决方案：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> TorchTrainer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># PyTorch负责定义模型和训练逻辑</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>train_func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">nn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Linear</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    optimizer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">optim</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">SGD</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">parameters</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> lr</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>0.01</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用Ray的API进行分布式训练</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">prepare_model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> epoch </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># PyTorch的训练逻辑</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        loss </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> train_one_epoch</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> optimizer</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># Ray负责收集和同步结果</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">report</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"loss"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> loss</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Ray负责分布式调度</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">scaling_config </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ScalingConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_workers</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> use_gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">trainer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> TorchTrainer</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">train_func</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> scaling_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">scaling_config</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> trainer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">fit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=如何选择>如何选择<a href=#如何选择 class=hash-link aria-label="Direct link to 如何选择" title="Direct link to 如何选择">​</a></h3>
<p>何时使用<code>PyTorch</code>分布式，何时使用<code>Ray</code>？</p>
<ul>
<li>团队已熟悉<code>PyTorch</code>的分布式<code>API</code></li>
<li>主要在同构集群上运行（所有节点配置相同）</li>
</ul>
<p><strong>使用Ray + PyTorch的场景</strong>：</p>
<ul>
<li>需要同时进行训练、推理、数据处理等多种任务</li>
<li>需要动态调整集群规模（自动扩缩容）</li>
<li>需要在异构集群上运行（不同节点有不同的硬件配置）</li>
<li>需要与其他<code>Python</code>库（如<code>Pandas</code>、<code>NumPy</code>）深度集成</li>
<li>需要统一的分布式抽象，便于代码维护</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=ray在ai模型训练场景中的应用>Ray在AI模型训练场景中的应用<a href=#ray在ai模型训练场景中的应用 class=hash-link aria-label="Direct link to Ray在AI模型训练场景中的应用" title="Direct link to Ray在AI模型训练场景中的应用">​</a></h2>
<p><code>Ray Train</code>是<code>Ray</code>生态中专门为机器学习训练设计的库，它简化了分布式训练的实现，让开发者可以专注于模型本身，而不用担心分布式的复杂性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=分布式数据并行训练>分布式数据并行训练<a href=#分布式数据并行训练 class=hash-link aria-label="Direct link to 分布式数据并行训练" title="Direct link to 分布式数据并行训练">​</a></h3>
<p><strong>应用场景</strong>：当单个<code>GPU</code>无法容纳足够大的<code>batch size</code>，或者希望加速训练时，可以使用多个<code>GPU</code>并行训练。</p>
<p><strong>工作原理</strong>：</p>
<ol>
<li>每个<code>worker</code>持有完整的模型副本</li>
<li>数据集被自动分片，每个<code>worker</code>处理不同的数据子集</li>
<li>各<code>worker</code>独立计算梯度</li>
<li>通过<code>All-Reduce</code>算法同步梯度</li>
<li>所有<code>worker</code>使用相同的梯度更新模型参数</li>
</ol>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> torch </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> nn</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> TorchTrainer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ScalingConfig</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>train_func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 定义模型</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> nn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Linear</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>128</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># Ray自动处理设备放置和DDP包装</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">prepare_model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    optimizer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">optim</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Adam</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">parameters</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    loss_fn </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> nn</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">CrossEntropyLoss</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 准备数据加载器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    train_loader </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">utils</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">data</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">DataLoader</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    train_loader </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">prepare_data_loader</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">train_loader</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 训练循环</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> epoch </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> batch </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> train_loader</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            loss </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> train_one_batch</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> loss_fn</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> optimizer</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 报告指标</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">report</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"loss"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> loss</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">item</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"epoch"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> epoch</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置4个GPU worker</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">scaling_config </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ScalingConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_workers</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> use_gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">trainer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> TorchTrainer</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">train_func</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> scaling_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">scaling_config</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> trainer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">fit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>优势</strong>：</p>
<ul>
<li>代码改动最小，只需添加几行<code>Ray API</code>调用</li>
<li>自动处理进程组初始化和设备管理</li>
<li>内置容错机制，训练失败时自动重试</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=大模型训练>大模型训练<a href=#大模型训练 class=hash-link aria-label="Direct link to 大模型训练" title="Direct link to 大模型训练">​</a></h3>
<p><strong>应用场景</strong>：当模型参数量超过单个<code>GPU</code>显存容量时（如<code>GPT</code>、<code>LLaMA</code>等大语言模型），需要将模型切分到多个<code>GPU</code>上。</p>
<p><strong>支持的策略</strong>：</p>
<table><thead><tr><th>并行策略<th>说明<th>适用场景<tbody><tr><td><strong>Pipeline Parallelism</strong><br>流水线并行<td>将模型按层切分到不同<code>GPU</code><td>模型层数多，单层显存占用不大<tr><td><strong>Tensor Parallelism</strong><br>张量并行<td>将模型的每一层切分到不同<code>GPU</code><td>单层参数量大，需要细粒度切分<tr><td><strong>Fully Sharded Data Parallel (FSDP)</strong><td>将模型参数、梯度、优化器状态切分到不同<code>GPU</code><td>超大模型训练，需要最大化显存利用</table>
<p><strong>与DeepSpeed和Megatron集成</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> TorchTrainer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ScalingConfig</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> RunConfig</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>train_func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> deepspeed</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 大模型定义</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 使用DeepSpeed进行模型并行</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model_engine</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> optimizer</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> _</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> _ </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> deepspeed</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">initialize</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        model</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token string" style=color:#a6e22e>"train_batch_size"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>64</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token string" style=color:#a6e22e>"fp16"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"enabled"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token string" style=color:#a6e22e>"zero_optimization"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"stage"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 训练循环</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> batch </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> train_loader</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        loss </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> model_engine</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">batch</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        model_engine</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">backward</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">loss</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        model_engine</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">step</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">report</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"loss"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> loss</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">item</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 配置多节点训练</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">scaling_config </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ScalingConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    num_workers</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>16</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 跨4个节点，每节点4个GPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    use_gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    resources_per_worker</span><span class="token operator" style=color:#66d9ef>=</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"GPU"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"CPU"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">trainer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> TorchTrainer</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    train_func</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    scaling_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">scaling_config</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    run_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">RunConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">storage_path</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"s3://bucket/checkpoints"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> trainer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">fit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>优势</strong>：</p>
<ul>
<li>无缝集成<code>DeepSpeed</code>、<code>Megatron-LM</code>等主流大模型训练框架</li>
<li>统一的分布式抽象，简化多节点训练配置</li>
<li>自动管理检查点存储和恢复</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=超参数调优>超参数调优<a href=#超参数调优 class=hash-link aria-label="Direct link to 超参数调优" title="Direct link to 超参数调优">​</a></h3>
<p><strong>应用场景</strong>：需要测试多组超参数，找到最优配置。</p>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> tune</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">torch </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> TorchTrainer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ScalingConfig</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>train_func</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">config</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> build_model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">config</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"hidden_size"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> config</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"num_layers"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    optimizer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">optim</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Adam</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">parameters</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> lr</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">config</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"lr"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> epoch </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        loss </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> train_epoch</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> optimizer</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">train</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">report</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token string" style=color:#a6e22e>"loss"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> loss</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 定义搜索空间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">param_space </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"train_loop_config"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token string" style=color:#a6e22e>"lr"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">loguniform</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>1e-5</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1e-2</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token string" style=color:#a6e22e>"hidden_size"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">choice</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token number" style=color:#ae81ff>256</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>512</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1024</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token string" style=color:#a6e22e>"num_layers"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">choice</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token number" style=color:#ae81ff>4</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>12</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 并行搜索</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tuner </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Tuner</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    TorchTrainer</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        train_func</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        scaling_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">ScalingConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_workers</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> use_gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    param_space</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">param_space</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    tune_config</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">tune</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">TuneConfig</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">num_samples</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>20</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">results </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> tuner</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">fit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">best_result </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> results</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">get_best_result</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">metric</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"loss"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> mode</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"min"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"Best config: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">best_result</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">config</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=分布式批量推理>分布式批量推理<a href=#分布式批量推理 class=hash-link aria-label="Direct link to 分布式批量推理" title="Direct link to 分布式批量推理">​</a></h3>
<p><strong>应用场景</strong>：对大量样本进行模型推理，充分利用多<code>GPU</code>资源。</p>
<p><strong>代码示例</strong>：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> numpy </span><span class="token keyword" style=color:#66d9ef>as</span><span class="token plain"> np</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 创建数据集</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">ds </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">data</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">from_numpy</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">np</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">array</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"text1"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"text2"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 定义推理类</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>class</span><span class="token plain"> </span><span class="token class-name" style=color:#e6db74>ModelPredictor</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__init__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> load_model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 加载模型</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>__call__</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> batch</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        predictions </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">batch</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"data"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        batch</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"output"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> predictions</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> batch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 并行推理，使用2个GPU</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">predictions </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> ds</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">map_batches</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ModelPredictor</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    compute</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">ray</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">data</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ActorPoolStrategy</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">size</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    num_gpus</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 获取结果</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">predictions</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">show</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">limit</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>10</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://github.com/ray-project/ray target=_blank rel="noopener noreferrer">https://github.com/ray-project/ray</a></li>
<li><a href=https://docs.ray.io/en/latest/index.html target=_blank rel="noopener noreferrer">https://docs.ray.io/en/latest/index.html</a></li>
<li><a href=https://docs.rayai.org.cn/en/latest/index.html target=_blank rel="noopener noreferrer">https://docs.rayai.org.cn/en/latest/index.html</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/kubeflow-trainer-deploy-usage><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Kubeflow Trainer 安装、部署及使用</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/kuberay-guide><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>KubeRay基本介绍与使用</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#ray是什么 class="table-of-contents__link toc-highlight">Ray是什么</a><li><a href=#ray解决什么问题 class="table-of-contents__link toc-highlight">Ray解决什么问题</a><ul><li><a href=#单机资源瓶颈 class="table-of-contents__link toc-highlight">单机资源瓶颈</a><li><a href=#资源利用率低 class="table-of-contents__link toc-highlight">资源利用率低</a><li><a href=#代码维护困难 class="table-of-contents__link toc-highlight">代码维护困难</a></ul><li><a href=#ray的核心组件 class="table-of-contents__link toc-highlight">Ray的核心组件</a><ul><li><a href=#ray-core---分布式计算基础层 class="table-of-contents__link toc-highlight">Ray Core - 分布式计算基础层</a><li><a href=#ray-data---分布式数据处理 class="table-of-contents__link toc-highlight">Ray Data - 分布式数据处理</a><li><a href=#ray-train---分布式训练 class="table-of-contents__link toc-highlight">Ray Train - 分布式训练</a><li><a href=#ray-tune---超参数调优 class="table-of-contents__link toc-highlight">Ray Tune - 超参数调优</a><li><a href=#ray-serve---模型服务部署 class="table-of-contents__link toc-highlight">Ray Serve - 模型服务部署</a><li><a href=#ray-rllib---强化学习 class="table-of-contents__link toc-highlight">Ray RLlib - 强化学习</a></ul><li><a href=#ray与pytorch的区别 class="table-of-contents__link toc-highlight">Ray与PyTorch的区别</a><ul><li><a href=#本质区别 class="table-of-contents__link toc-highlight">本质区别</a><li><a href=#协作关系 class="table-of-contents__link toc-highlight">协作关系</a><li><a href=#如何选择 class="table-of-contents__link toc-highlight">如何选择</a></ul><li><a href=#ray在ai模型训练场景中的应用 class="table-of-contents__link toc-highlight">Ray在AI模型训练场景中的应用</a><ul><li><a href=#分布式数据并行训练 class="table-of-contents__link toc-highlight">分布式数据并行训练</a><li><a href=#大模型训练 class="table-of-contents__link toc-highlight">大模型训练</a><li><a href=#超参数调优 class="table-of-contents__link toc-highlight">超参数调优</a><li><a href=#分布式批量推理 class="table-of-contents__link toc-highlight">分布式批量推理</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>