<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/模型开发/Jupyter/JupyterHub/JupyterHub基本介绍" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>JupyterHub基本介绍 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/jupyterhub-intro><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="JupyterHub基本介绍 | John's Blog"><meta data-rh=true name=description content="全面深入介绍JupyterHub的核心概念、系统架构、解决的问题以及各个核心组件（Hub、Proxy、Singleuser Server、User Scheduler、Autohttps）的详细作用和技术实现"><meta data-rh=true property=og:description content="全面深入介绍JupyterHub的核心概念、系统架构、解决的问题以及各个核心组件（Hub、Proxy、Singleuser Server、User Scheduler、Autohttps）的详细作用和技术实现"><meta data-rh=true name=keywords content="JupyterHub,Kubernetes,多用户,Jupyter Notebook,容器化,云原生,微服务架构,Hub组件,Proxy代理,KubeSpawner,Authenticator,资源管理,动态路由,持久化存储,PVC,多租户,JupyterLab,数据科学平台,AI开发环境,协作平台,教育平台,Configurable HTTP Proxy,Let's Encrypt,HTTPS,用户隔离,Pod调度"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/jupyterhub-intro><link data-rh=true rel=alternate href=https://johng.cn/ai/jupyterhub-intro hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/jupyterhub-intro hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.d14e1eeb.css><script src=/assets/js/runtime~main.138ef0e8.js defer></script><script src=/assets/js/main.4c5f7df7.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/agents-deep-dive-from-llm-to-autonomous-agents>智能体</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/copilot-skills-guide>应用开发</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/online-offline-batch-inference>推理服务</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/hpc-development-training-platform>训练微调</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/model-development>模型开发</a><button aria-label="Collapse sidebar category '模型开发'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/jupyterhub-intro>Jupyter</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/jupyterhub-intro>JupyterHub</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/jupyterhub-intro>JupyterHub基本介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/ai/jupyterhub-deployment>JupyterHub安装部署</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/ai/jupyterhub-configuration>JupyterHub配置管理</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/jupyter-intro-usage>Jupyter基本介绍与使用</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/jupyter-prebuild-docker-install-extra-tools>Jupyter扩展镜像与工具</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/jupyter-case>Jupyter使用案例</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/jupyter-server-configuration>Jupyter Server配置</a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/rdma-brief>基础架构</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/basic-terminology>入门知识</a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/model-development><span itemprop=name>模型开发</span></a><meta itemprop=position content=2><li class=breadcrumbs__item><span class=breadcrumbs__link>Jupyter</span><meta itemprop=position content=3><li class=breadcrumbs__item><span class=breadcrumbs__link>JupyterHub</span><meta itemprop=position content=4><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>JupyterHub基本介绍</span><meta itemprop=position content=5></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=什么是jupyterhub>什么是JupyterHub<a href=#什么是jupyterhub class=hash-link aria-label="Direct link to 什么是JupyterHub" title="Direct link to 什么是JupyterHub">​</a></h2>
<p><code>JupyterHub</code> 是一个多用户的<code>Jupyter Notebook</code>服务器，它允许多个用户通过<code>Web</code>浏览器访问和使用独立的<code>Jupyter</code>计算环境。<code>JupyterHub</code> 为每个用户提供了一个独立的、可定制的<code>Jupyter Notebook</code>环境，使得为一个群体（如一个班级的学生、一个研究团队或企业的数据科学团队）提供和标准化计算环境变得简单易行。</p>
<p>简单来说，<code>JupyterHub</code> 就是一个"<code>Jupyter</code>即服务"的平台，它通过<code>Web</code>界面为用户提供访问，让用户无需在本地安装和配置复杂的开发环境。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=jupyterhub解决的问题>JupyterHub解决的问题<a href=#jupyterhub解决的问题 class=hash-link aria-label="Direct link to JupyterHub解决的问题" title="Direct link to JupyterHub解决的问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=环境配置和管理问题>环境配置和管理问题<a href=#环境配置和管理问题 class=hash-link aria-label="Direct link to 环境配置和管理问题" title="Direct link to 环境配置和管理问题">​</a></h3>
<p><strong>传统痛点</strong>：</p>
<ul>
<li>每个用户需要在自己的机器上安装和配置 <code>Jupyter</code>、<code>Python</code>、各种库和依赖</li>
<li>不同机器上的环境配置往往不一致，导致"在我机器上能运行"的问题</li>
<li>环境配置错误会消耗大量的时间和精力</li>
</ul>
<p><strong><code>JupyterHub</code> 的解决方案</strong>：</p>
<ul>
<li>提供统一的、预配置的计算环境</li>
<li>用户只需要一个浏览器就能访问完整的开发环境</li>
<li>管理员可以集中管理和更新所有用户的环境</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=计算资源分配问题>计算资源分配问题<a href=#计算资源分配问题 class=hash-link aria-label="Direct link to 计算资源分配问题" title="Direct link to 计算资源分配问题">​</a></h3>
<p><strong>传统痛点</strong>：</p>
<ul>
<li>个人电脑的计算资源有限，无法处理大规模数据和复杂模型</li>
<li>购买和维护高性能计算设备成本高昂</li>
<li>资源利用率低，造成浪费</li>
</ul>
<p><strong><code>JupyterHub</code> 的解决方案</strong>：</p>
<ul>
<li>可以部署在云端或本地集群上，提供强大的计算能力</li>
<li>支持资源的动态分配，根据需求自动扩缩容</li>
<li>多个用户共享计算资源，提高利用率</li>
<li>可以为不同用户配置不同级别的资源（<code>CPU</code>、内存、<code>GPU</code>等）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=多用户协作和管理问题>多用户协作和管理问题<a href=#多用户协作和管理问题 class=hash-link aria-label="Direct link to 多用户协作和管理问题" title="Direct link to 多用户协作和管理问题">​</a></h3>
<p><strong>传统痛点</strong>：</p>
<ul>
<li>难以为大量用户（如整个班级或团队）快速提供统一的工作环境</li>
<li>用户管理、权限控制、资源配额管理复杂</li>
<li>缺乏对用户活动的监控和管理能力</li>
</ul>
<p><strong><code>JupyterHub</code> 的解决方案</strong>：</p>
<ul>
<li>支持多种身份认证方式（<code>OAuth</code>、<code>LDAP</code>、本地认证等）</li>
<li>提供管理界面，可以查看所有用户和他们的服务器状态</li>
<li>支持用户权限管理和资源配额限制</li>
<li>可以批量创建和管理用户环境</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=数据持久化和共享问题>数据持久化和共享问题<a href=#数据持久化和共享问题 class=hash-link aria-label="Direct link to 数据持久化和共享问题" title="Direct link to 数据持久化和共享问题">​</a></h3>
<p><strong>传统痛点</strong>：</p>
<ul>
<li>用户数据分散在各自的机器上，难以备份和共享</li>
<li>数据安全和隐私保护难以保障</li>
</ul>
<p><strong><code>JupyterHub</code> 的解决方案</strong>：</p>
<ul>
<li>为每个用户提供持久化存储，数据不会因会话结束而丢失</li>
<li>支持集中式的数据备份和恢复</li>
<li>可以配置共享存储，方便团队协作</li>
<li>统一的安全策略和访问控制</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=jupyterhub系统架构>JupyterHub系统架构<a href=#jupyterhub系统架构 class=hash-link aria-label="Direct link to JupyterHub系统架构" title="Direct link to JupyterHub系统架构">​</a></h2>
<p><code>JupyterHub</code> 采用分层的微服务架构设计，在<code>Kubernetes</code>环境中通过多个独立的组件协同工作，实现多用户<code>Jupyter Notebook</code>服务。整体架构遵循关注点分离的原则，每个组件负责特定的功能。</p>
<p><img decoding=async loading=lazy alt=JupyterHub系统架构 src=/assets/images/image-63e3a82e8697162d1a031af677e3b656.png width=960 height=540 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=架构设计特点>架构设计特点<a href=#架构设计特点 class=hash-link aria-label="Direct link to 架构设计特点" title="Direct link to 架构设计特点">​</a></h3>
<ol>
<li>
<p><strong>分层架构</strong>：清晰的三层结构</p>
<ul>
<li><strong>接入层</strong>：<code>Proxy</code> 和<code>Autohttps</code>负责流量接入和路由</li>
<li><strong>控制层</strong>：<code>Hub</code> 负责认证、授权和资源编排</li>
<li><strong>服务层</strong>：<code>Singleuser Server</code> 提供实际的计算服务</li>
</ul>
</li>
<li>
<p><strong>松耦合设计</strong>：组件之间通过标准接口通信</p>
<ul>
<li><code>Hub</code>通过<code>REST API</code>与<code>Proxy</code>通信</li>
<li><code>Hub</code>通过<code>Kubernetes API</code>管理用户 <code>Pod</code></li>
<li>各组件可以独立升级和扩展</li>
</ul>
</li>
<li>
<p><strong>云原生特性</strong>：充分利用<code>Kubernetes</code>能力</p>
<ul>
<li>容器化部署，易于扩展和维护</li>
<li>声明式配置，使用<code>Helm Chart</code>管理</li>
<li>自动故障恢复和健康检查</li>
<li>支持动态扩缩容</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=架构关系图>架构关系图<a href=#架构关系图 class=hash-link aria-label="Direct link to 架构关系图" title="Direct link to 架构关系图">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">┌──────────────────────────────────────────────────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">│                              User Browser                                │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">└─────────────────────────────────┬────────────────────────────────────────┘</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                                  │ HTTPS/HTTP Request</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                                  ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   ┌────────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  Autohttps Pod (Optional)      │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  - Traefik Proxy               │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  - Let's Encrypt Cert Manager  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   └──────────────┬─────────────────┘</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                                  │ HTTPS Termination</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                                  ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   ┌────────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  Proxy Pod                     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  - Configurable HTTP Proxy     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  - Dynamic Routing Table       │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  - Port 8000 (Public)          │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   │  - Port 8001 (API)             │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                   └────────┬──────────────┬────────┘</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │              │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │              │ REST API (Route Management)</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              Route to Hub  │              ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              or User Pod   │    ┌─────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │   Hub Pod                   │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  ┌───────────────────────┐  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  │ JupyterHub Core       │  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  ├───────────────────────┤  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  │ Authenticator         │  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  ├───────────────────────┤  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  │ KubeSpawner           │  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  ├───────────────────────┤  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  │ Admin Panel           │  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  └───────────────────────┘  │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    └──────────┬──────────────────┘</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               │ Kubernetes API</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    ┌─────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  Kubernetes API Server       │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    └──────────┬──────────────────┘</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               │ Create/Manage Pods</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    ┌──────────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  User Scheduler Pod (Optional)   │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    │  - Optimize Pod Scheduling       │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │    └──────────────────────────────────┘</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                            │               ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         ┌──────────────────┴──────────────────────────────────────┐</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │                   User Pod Cluster                      │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │jupyter-user1│  │jupyter-user2│  │jupyter-...   │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │             │  │             │  │              │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │ Jupyter     │  │ Jupyter     │  │ Jupyter      │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │ Server      │  │ Server      │  │ Server       │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │             │  │             │  │              │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │ + PVC       │  │ + PVC       │  │ + PVC        │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  │ (Storage)   │  │ (Storage)   │  │ (Storage)    │     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         │  └─────────────┘  └─────────────┘  └──────────────┘     │</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">         └─────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=数据流说明>数据流说明<a href=#数据流说明 class=hash-link aria-label="Direct link to 数据流说明" title="Direct link to 数据流说明">​</a></h3>
<p><strong>用户登录和环境创建流程</strong>：</p>
<ol>
<li>用户通过浏览器访问 → <code>Autohttps</code>（可选） → <code>Proxy</code></li>
<li><code>Proxy</code>发现用户未登录 → 转发到 <code>Hub</code></li>
<li><code>Hub</code>的<code>Authenticator</code>验证用户身份</li>
<li>认证成功后，<code>Hub</code> 通过<code>KubeSpawner</code>调用 <code>Kubernetes API</code></li>
<li><code>Kubernetes</code>根据<code>User Scheduler</code>的策略创建用户 <code>Pod</code></li>
<li>用户<code>Pod</code>启动后，<code>Hub</code> 通知<code>Proxy</code>更新路由表</li>
<li><code>Proxy</code>将用户请求转发到对应的用户 <code>Pod</code></li>
</ol>
<p><strong>用户再次访问流程</strong>：</p>
<ol>
<li>用户访问 →<code>Autohttps</code>→ <code>Proxy</code></li>
<li><code>Proxy</code>通过<code>Cookie</code>识别用户，查找路由表</li>
<li>直接将请求转发到用户的 <code>Pod</code>（跳过 <code>Hub</code>）</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=jupyterhub的核心组件>JupyterHub的核心组件<a href=#jupyterhub的核心组件 class=hash-link aria-label="Direct link to JupyterHub的核心组件" title="Direct link to JupyterHub的核心组件">​</a></h2>
<p><code>JupyterHub</code> 在<code>Kubernetes</code>环境中主要由以下核心组件构成：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=hub核心控制器>Hub（核心控制器）<a href=#hub核心控制器 class=hash-link aria-label="Direct link to Hub（核心控制器）" title="Direct link to Hub（核心控制器）">​</a></h3>
<p><strong>作用</strong>：
<code>Hub</code> 是<code>JupyterHub</code>的大脑和核心控制中心，负责整个系统的协调和管理。它是用户认证、资源分配、路由管理的中枢，所有的控制逻辑都在这里执行。</p>
<p><strong>核心子组件</strong>：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=authenticator认证器>Authenticator（认证器）<a href=#authenticator认证器 class=hash-link aria-label="Direct link to Authenticator（认证器）" title="Direct link to Authenticator（认证器）">​</a></h4>
<p>负责验证用户身份，支持多种认证方式：</p>
<ul>
<li><strong><code>DummyAuthenticator</code></strong>：用于测试环境，允许任意用户名密码登录，不建议生产使用</li>
<li><strong><code>OAuthAuthenticator</code></strong>：支持<code>OAuth 2.0</code>认证协议<!-- -->
<ul>
<li><code>GitHubOAuthenticator</code>：通过<code>GitHub</code>账号登录</li>
<li><code>GoogleOAuthenticator</code>：通过<code>Google</code>账号登录</li>
<li><code>GenericOAuthenticator</code>：支持任意<code>OAuth</code>提供商</li>
</ul>
</li>
<li><strong><code>LDAPAuthenticator</code></strong>：企业<code>LDAP/AD</code>认证，适合企业内部部署</li>
<li><strong><code>NativeAuthenticator</code></strong>：本地用户数据库认证，支持用户注册和密码管理</li>
<li><strong>自定义认证器</strong>：可以继承基类实现自己的认证逻辑</li>
</ul>
<p>认证器的职责：</p>
<ul>
<li>验证用户凭据（用户名/密码、<code>Token</code>等）</li>
<li>获取用户信息（用户名、<code>Email</code>、权限等）</li>
<li>确定用户是否有管理员权限</li>
<li>支持用户白名单和黑名单</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=spawner环境生成器>Spawner（环境生成器）<a href=#spawner环境生成器 class=hash-link aria-label="Direct link to Spawner（环境生成器）" title="Direct link to Spawner（环境生成器）">​</a></h4>
<p>负责为用户创建和管理独立的计算环境，在<code>Kubernetes</code>环境中使用 <code>KubeSpawner</code>：</p>
<p><strong>主要职责</strong>：</p>
<ul>
<li><strong>Pod 生命周期管理</strong>：<!-- -->
<ul>
<li>创建：根据配置创建用户 <code>Pod</code></li>
<li>启动：等待<code>Pod</code>启动并就绪</li>
<li>停止：停止不活跃的用户 <code>Pod</code></li>
<li>删除：清理用户<code>Pod</code>和相关资源</li>
</ul>
</li>
<li><strong>资源配置</strong>：<!-- -->
<ul>
<li><code>CPU</code>和内存限制（<code>requests</code> 和 <code>limits</code>）</li>
<li><code>GPU</code>资源分配（如果集群支持）</li>
<li>存储卷配置（<code>PVC</code> 持久化存储）</li>
<li>环境变量设置</li>
</ul>
</li>
<li><strong>镜像管理</strong>：<!-- -->
<ul>
<li>指定用户<code>Pod</code>使用的<code>Docker</code>镜像</li>
<li>支持多镜像选择（让用户选择不同的环境）</li>
<li>镜像拉取策略配置</li>
</ul>
</li>
<li><strong>网络配置</strong>：<!-- -->
<ul>
<li><code>Pod</code>网络策略</li>
<li>服务端口配置</li>
<li><code>NodePort</code>或<code>LoadBalancer</code>配置</li>
</ul>
</li>
</ul>
<p><strong>高级特性</strong>：</p>
<ul>
<li><strong>ProfileList</strong>：为用户提供多个规格配置选择（小型、中型、大型、<code>GPU</code>等预置规格）</li>
<li><strong>动态配置</strong>：根据用户属性动态调整资源配置</li>
<li><strong>Pre-spawn Hook</strong>：在创建<code>Pod</code>前执行自定义逻辑</li>
<li><strong>Post-stop Hook</strong>：在停止<code>Pod</code>后执行清理工作</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=数据库>数据库<a href=#数据库 class=hash-link aria-label="Direct link to 数据库" title="Direct link to 数据库">​</a></h4>
<p><code>Hub</code> 使用数据库存储用户信息和服务器状态：</p>
<p><strong>存储内容</strong>：</p>
<ul>
<li>用户账号信息（用户名、认证信息等）</li>
<li>用户服务器状态（运行中、已停止等）</li>
<li><code>OAuth</code>令牌和会话信息</li>
<li><code>API</code>令牌</li>
<li>服务（<code>Service</code>）配置</li>
</ul>
<p><strong>支持的数据库</strong>：</p>
<ul>
<li><strong>SQLite</strong>：默认选项，适合小规模部署<!-- -->
<ul>
<li><code>sqlite-pvc</code>：使用持久化卷存储（推荐）</li>
<li><code>sqlite-memory</code>：内存数据库（仅测试用）</li>
</ul>
</li>
<li><strong>PostgreSQL</strong>：推荐用于生产环境</li>
<li><strong>MySQL</strong>：也支持，但<code>PostgreSQL</code>更常用</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=管理界面>管理界面<a href=#管理界面 class=hash-link aria-label="Direct link to 管理界面" title="Direct link to 管理界面">​</a></h4>
<p>提供<code>Web</code>管理控制台：</p>
<p><strong>管理功能</strong>：</p>
<ul>
<li>查看所有用户列表</li>
<li>查看每个用户的服务器状态（运行中/已停止）</li>
<li>为用户启动/停止服务器</li>
<li>访问用户的<code>Notebook</code>环境（以管理员身份）</li>
<li>添加/删除用户</li>
<li>管理用户权限（设置管理员）</li>
<li>查看服务器日志</li>
</ul>
<p><strong>访问路径</strong>：<code>&lt;jupyterhub-url>/hub/admin</code></p>
<p><strong>技术实现</strong>：</p>
<ul>
<li>运行在单个<code>Kubernetes Pod</code>中</li>
<li>包含<code>JupyterHub</code>主进程、<code>KubeSpawner</code>、<code>Authenticator</code> 等组件</li>
<li>通过<code>Kubernetes Service</code>暴露内部 <code>API</code>（端口 <code>8081</code>）</li>
<li>使用<code>ConfigMap</code>存储配置</li>
<li>使用<code>Secret</code>存储敏感信息（数据库密码、<code>API Token</code>等）</li>
<li>支持水平扩展（但通常只运行单个实例）</li>
</ul>
<p><strong>重要配置项</strong>：</p>
<ul>
<li><code>hub.config.JupyterHub</code>：<code>JupyterHub</code> 核心配置</li>
<li><code>hub.config.Authenticator</code>：认证器配置</li>
<li><code>hub.config.KubeSpawner</code>：<code>Spawner</code> 配置</li>
<li><code>hub.db</code>：数据库配置</li>
<li><code>hub.resources</code>：<code>Pod</code> 资源限制</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=proxy代理服务器>Proxy（代理服务器）<a href=#proxy代理服务器 class=hash-link aria-label="Direct link to Proxy（代理服务器）" title="Direct link to Proxy（代理服务器）">​</a></h3>
<p><strong>作用</strong>：
<code>Proxy</code> 是用户访问的入口点，是整个<code>JupyterHub</code>系统对外的门户，负责将用户请求智能路由到正确的目标（<code>Hub</code> 或用户 <code>Pod</code>）。它基于 <code>Configurable HTTP Proxy</code>（<code>CHP</code>）实现。</p>
<p><strong>核心功能</strong>：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=流量路由和分发>流量路由和分发<a href=#流量路由和分发 class=hash-link aria-label="Direct link to 流量路由和分发" title="Direct link to 流量路由和分发">​</a></h4>
<p><code>Proxy</code> 接收所有用户的<code>HTTP/HTTPS</code>请求，并根据请求路径和用户身份进行智能路由：</p>
<p><strong>路由规则</strong>：</p>
<ul>
<li><code>/hub/*</code>：所有以<code>/hub/</code>开头的请求转发到 <code>Hub Pod</code>
<ul>
<li><code>/hub/login</code>：登录页面</li>
<li><code>/hub/admin</code>：管理界面</li>
<li><code>/hub/api/*</code>：<code>Hub API</code> 接口</li>
</ul>
</li>
<li><code>/user/&lt;username>/*</code>：转发到对应用户的 <code>Pod</code>
<ul>
<li>如：<code>/user/alice/lab</code> →<code>alice</code>的 <code>Notebook Pod</code></li>
<li>如：<code>/user/bob/tree</code> →<code>bob</code>的文件浏览器</li>
</ul>
</li>
<li><code>/</code>：根路径，重定向到<code>/hub/</code>或用户的 <code>Notebook</code></li>
</ul>
<p><strong>智能判断</strong>：</p>
<ul>
<li>检查用户是否已登录（通过 <code>Cookie</code>）</li>
<li>检查用户的<code>Pod</code>是否存在并运行中</li>
<li>未登录用户 → 转发到<code>Hub</code>的登录页面</li>
<li>已登录但无<code>Pod</code>→ 转发到<code>Hub</code>启动环境</li>
<li>已登录且有<code>Pod</code>→ 直接转发到用户 <code>Pod</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=动态路由表管理>动态路由表管理<a href=#动态路由表管理 class=hash-link aria-label="Direct link to 动态路由表管理" title="Direct link to 动态路由表管理">​</a></h4>
<p><code>Proxy</code> 维护一个内存中的路由映射表：</p>
<p><strong>路由表结构</strong>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">/user/alice → http://jupyter-alice.namespace.svc:8888</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">/user/bob   → http://jupyter-bob.namespace.svc:8888</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">/hub        → http://hub.namespace.svc:8081</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>路由更新机制</strong>：</p>
<ul>
<li><code>Hub</code>通过 <code>REST API</code>（端口 <code>8001</code>）向<code>Proxy</code>发送路由更新</li>
<li>当用户<code>Pod</code>创建完成时，<code>Hub</code> 添加路由规则</li>
<li>当用户<code>Pod</code>停止时，<code>Hub</code> 删除路由规则</li>
<li>路由表实时更新，无需重启 <code>Proxy</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=会话保持和连接管理>会话保持和连接管理<a href=#会话保持和连接管理 class=hash-link aria-label="Direct link to 会话保持和连接管理" title="Direct link to 会话保持和连接管理">​</a></h4>
<p><strong>Cookie 管理</strong>：</p>
<ul>
<li>使用加密的<code>Cookie</code>存储用户身份信息</li>
<li><code>Cookie</code>名称：<code>jupyterhub-session-id</code></li>
<li>支持跨域访问（CORS）配置</li>
</ul>
<p><strong>WebSocket 支持</strong>：</p>
<ul>
<li><code>Jupyter Notebook</code>需要<code>WebSocket</code>连接来实现实时交互</li>
<li><code>Proxy</code>正确处理<code>WebSocket</code>升级请求</li>
<li>保持长连接，支持<code>Notebook Kernel</code>通信</li>
</ul>
<p><strong>连接超时</strong>：</p>
<ul>
<li>配置空闲超时时间</li>
<li>超时后不会立即断开，而是标记为不活跃</li>
<li>配合 <code>jupyterhub-idle-culler</code> 清理不活跃的用户 <code>Pod</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=技术实现细节>技术实现细节<a href=#技术实现细节 class=hash-link aria-label="Direct link to 技术实现细节" title="Direct link to 技术实现细节">​</a></h4>
<p><strong>基于 Configurable HTTP Proxy（CHP）</strong>：</p>
<ul>
<li><code>Node.js</code>实现的高性能<code>HTTP</code>代理</li>
<li>支持动态配置路由规则</li>
<li>提供<code>REST API</code>用于路由管理</li>
</ul>
<p><strong>容器配置</strong>：</p>
<ul>
<li>运行在独立的<code>Kubernetes Pod</code>中</li>
<li>通常配置为单副本（状态在内存中）</li>
<li>使用<code>Recreate</code>部署策略而非 <code>RollingUpdate</code></li>
</ul>
<p><strong>网络端口</strong>：</p>
<ul>
<li><strong>公共端口（8000）</strong>：接收用户请求，通过<code>Service</code>暴露</li>
<li><strong>API 端口（8001）</strong>：接收<code>Hub</code>的路由管理命令，仅集群内访问</li>
</ul>
<p><strong>Service 配置</strong>：</p>
<ul>
<li><code>proxy-public Service</code>：对外暴露，类型可以是 <code>LoadBalancer</code>、<code>NodePort</code> 或 <code>ClusterIP</code></li>
<li><code>proxy-api Service</code>：仅集群内部访问，类型为 <code>ClusterIP</code></li>
</ul>
<p><strong>安全配置</strong>：</p>
<ul>
<li><code>API</code>端口使用认证 <code>Token</code>（<code>proxy.secretToken</code>）</li>
<li>与<code>Hub</code>共享相同的 <code>Token</code></li>
<li>防止未授权的路由修改</li>
</ul>
<p><strong>性能优化</strong>：</p>
<ul>
<li>使用异步 <code>I/O</code>，支持大量并发连接</li>
<li>内存中维护路由表，查找速度快</li>
<li>支持<code>HTTP/2</code>和 <code>Keep-Alive</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=singleuser-server用户notebook服务器>Singleuser Server（用户Notebook服务器）<a href=#singleuser-server用户notebook服务器 class=hash-link aria-label="Direct link to Singleuser Server（用户Notebook服务器）" title="Direct link to Singleuser Server（用户Notebook服务器）">​</a></h3>
<p><strong>作用</strong>：
<code>Singleuser Server</code> 为每个用户提供独立的<code>Jupyter Notebook</code>运行环境，是用户实际工作的计算空间。每个用户对应一个独立的 <code>Kubernetes Pod</code>。</p>
<p><strong>核心功能</strong>：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=jupyter-notebook-服务>Jupyter Notebook 服务<a href=#jupyter-notebook-服务 class=hash-link aria-label="Direct link to Jupyter Notebook 服务" title="Direct link to Jupyter Notebook 服务">​</a></h4>
<p><strong>基础服务</strong>：</p>
<ul>
<li>运行<code>Jupyter Server</code>或 <code>JupyterLab</code>，提供<code>Web</code>界面</li>
<li>支持多种编程语言（通过 <code>Kernel</code>）：<!-- -->
<ul>
<li><code>Python（IPython Kernel）</code></li>
<li><code>R（IRkernel）</code></li>
<li><code>Julia</code>、<code>Scala</code>、<code>JavaScript</code> 等</li>
</ul>
</li>
<li>提供文件管理、终端、文本编辑器等功能</li>
</ul>
<p><strong>用户体验</strong>：</p>
<ul>
<li>支持<code>Jupyter Notebook</code>经典界面</li>
<li>支持<code>JupyterLab</code>现代化界面</li>
<li>支持<code>Jupyter Server</code>扩展和插件</li>
<li>支持多种主题和界面定制</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=计算资源管理>计算资源管理<a href=#计算资源管理 class=hash-link aria-label="Direct link to 计算资源管理" title="Direct link to 计算资源管理">​</a></h4>
<p><strong>资源配置</strong>：</p>
<ul>
<li><strong>CPU</strong>：<!-- -->
<ul>
<li><code>requests</code>：保证的最小<code>CPU</code>资源</li>
<li><code>limits</code>：最大可使用的<code>CPU</code>资源</li>
<li>示例：<code>requests: 0.5</code>，<code>limits: 2</code></li>
</ul>
</li>
<li><strong>内存</strong>：<!-- -->
<ul>
<li><code>requests</code>：保证的最小内存</li>
<li><code>limits</code>：最大可使用内存，超出会被 <code>OOM Kill</code></li>
<li>示例：<code>requests: 1Gi</code>，<code>limits: 4Gi</code></li>
</ul>
</li>
<li><strong>GPU</strong>（可选）：<!-- -->
<ul>
<li>使用 <code>NVIDIA GPU Operator</code></li>
<li>配置 <code>nvidia.com/gpu: 1</code></li>
<li>支持<code>CUDA</code>和深度学习框架</li>
</ul>
</li>
</ul>
<p><strong>资源隔离</strong>：</p>
<ul>
<li>每个用户<code>Pod</code>在独立的命名空间或使用 <code>ResourceQuota</code></li>
<li>用户之间的计算资源完全隔离</li>
<li>不会相互影响性能</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=数据持久化>数据持久化<a href=#数据持久化 class=hash-link aria-label="Direct link to 数据持久化" title="Direct link to 数据持久化">​</a></h4>
<p><strong>存储卷配置</strong>：</p>
<ul>
<li>使用 <code>PersistentVolumeClaim</code>（<code>PVC</code>）挂载用户目录</li>
<li>默认挂载点：<code>/home/jovyan</code>（<code>jovyan</code> 是默认用户名）</li>
<li>存储类（<code>StorageClass</code>）：根据集群配置选择</li>
</ul>
<p><strong>持久化内容</strong>：</p>
<ul>
<li><code>Notebook</code>文件（<code>.ipynb</code>）</li>
<li>数据文件和数据集</li>
<li>用户安装的<code>Python</code>包（<code>pip install --user</code>）</li>
<li>配置文件（<code>.jupyter/</code>、<code>.bashrc</code> 等）</li>
<li>代码和脚本文件</li>
</ul>
<p><strong>共享存储（可选）</strong>：</p>
<ul>
<li>配置只读共享卷，用于团队共享数据</li>
<li>配置读写共享卷，用于协作项目</li>
<li>使用 <code>NFS</code>、<code>Ceph</code> 或云存储服务</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=镜像和环境>镜像和环境<a href=#镜像和环境 class=hash-link aria-label="Direct link to 镜像和环境" title="Direct link to 镜像和环境">​</a></h4>
<p><strong>Docker 镜像</strong>：</p>
<ul>
<li>基础镜像：<code>jupyter/base-notebook</code></li>
<li>数据科学镜像：<code>jupyter/scipy-notebook</code>、<code>jupyter/datascience-notebook</code></li>
<li>深度学习镜像：<code>jupyter/tensorflow-notebook</code>、<code>jupyter/pytorch-notebook</code></li>
<li>自定义镜像：可以构建包含特定库的镜像</li>
</ul>
<p><strong>环境定制</strong>：</p>
<ul>
<li>在镜像中预装常用库和工具</li>
<li>使用<code>requirements.txt</code>或 <code>conda environment.yml</code></li>
<li>配置 <code>JUPYTER_ENABLE_LAB=yes</code> 启用 <code>JupyterLab</code></li>
<li>设置环境变量（<code>API</code> 密钥、配置路径等）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=网络和安全>网络和安全<a href=#网络和安全 class=hash-link aria-label="Direct link to 网络和安全" title="Direct link to 网络和安全">​</a></h4>
<p><strong>网络配置</strong>：</p>
<ul>
<li>每个<code>Pod</code>有独立的<code>IP</code>地址</li>
<li>通过<code>Service</code>暴露端口（默认 <code>8888</code>）</li>
<li><code>Proxy</code>通过<code>Service</code>名称访问用户 <code>Pod</code></li>
</ul>
<p><strong>安全特性</strong>：</p>
<ul>
<li>运行在非<code>root</code>用户下（<code>jovyan</code>，<code>UID 1000</code>）</li>
<li>使用<code>SecurityContext</code>限制权限</li>
<li>支持<code>NetworkPolicy</code>网络隔离</li>
<li>禁用特权容器（<code>privilege escalation</code>）</li>
</ul>
<p><strong>技术实现</strong>：</p>
<ul>
<li>每个用户对应一个独立的 <code>Kubernetes Pod</code></li>
<li><code>Pod</code>名称格式：<code>jupyter-&lt;username></code>（可自定义）</li>
<li>由<code>Hub</code>通过<code>KubeSpawner</code>动态创建和销毁</li>
<li>支持多种镜像选择（<code>ProfileList</code>）</li>
<li>使用<code>Init Containers</code>进行环境初始化</li>
<li>支持<code>Sidecar</code>容器（如日志收集、监控等）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=user-scheduler可选用户调度器>User Scheduler（可选，用户调度器）<a href=#user-scheduler可选用户调度器 class=hash-link aria-label="Direct link to User Scheduler（可选，用户调度器）" title="Direct link to User Scheduler（可选，用户调度器）">​</a></h3>
<p><strong>作用</strong>：
<code>User Scheduler</code>是一个可选的优化组件，提供更智能的<code>Pod</code>调度策略，优化用户<code>Pod</code>在<code>Kubernetes</code>集群中的分布和资源利用。</p>
<p><strong>核心功能</strong>：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=智能调度策略>智能调度策略<a href=#智能调度策略 class=hash-link aria-label="Direct link to 智能调度策略" title="Direct link to 智能调度策略">​</a></h4>
<p><strong>均衡分布</strong>：</p>
<ul>
<li>避免所有用户<code>Pod</code>集中在少数节点上</li>
<li>实现跨节点的负载均衡</li>
<li>考虑节点的资源使用情况（<code>CPU</code>、<code>内存</code>、<code>GPU</code>）</li>
<li>优先选择资源充足的节点</li>
</ul>
<p><strong>亲和性和反亲和性</strong>：</p>
<ul>
<li><strong>Pod 反亲和性</strong>：避免将过多用户<code>Pod</code>调度到同一节点</li>
<li><strong>节点亲和性</strong>：优先调度到特定标签的节点（如<code>GPU</code>节点）</li>
<li><strong>拓扑域分散</strong>：跨可用区（<code>AZ</code>）分散 <code>Pod</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=资源优化>资源优化<a href=#资源优化 class=hash-link aria-label="Direct link to 资源优化" title="Direct link to 资源优化">​</a></h4>
<p><strong>集群自动扩缩容支持</strong>：</p>
<ul>
<li>配合<code>Cluster Autoscaler</code>工作</li>
<li>当集群资源不足时，触发节点扩容</li>
<li>当集群资源过剩时，协助节点缩容</li>
<li>优化新<code>Pod</code>在扩容后节点上的放置</li>
</ul>
<p><strong>资源碎片优化</strong>：</p>
<ul>
<li>考虑节点剩余资源，避免资源碎片化</li>
<li><code>Bin Packing</code>策略：优先填满部分节点</li>
<li>或<code>Spread</code>策略：均匀分散到所有节点</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=优先级和抢占>优先级和抢占<a href=#优先级和抢占 class=hash-link aria-label="Direct link to 优先级和抢占" title="Direct link to 优先级和抢占">​</a></h4>
<p><strong>Pod 优先级</strong>：</p>
<ul>
<li>为用户<code>Pod</code>设置优先级</li>
<li>高优先级用户可以抢占低优先级用户的资源</li>
<li>适合区分不同等级的用户或服务</li>
</ul>
<p><strong>公平调度</strong>：</p>
<ul>
<li>确保所有用户有公平的资源获取机会</li>
<li>防止某些用户占用过多资源</li>
<li>配合资源配额（<code>ResourceQuota</code>）使用</li>
</ul>
<p><strong>技术实现</strong>：</p>
<ul>
<li>独立的<code>Kubernetes Scheduler</code>实现</li>
<li>运行在专门的<code>Pod</code>中</li>
<li>通常配置为多副本（<code>2-3</code>个）以保证高可用</li>
<li>用户<code>Pod</code>通过<code>schedulerName</code>字段指定使用此调度器</li>
<li>基于 <code>kube-scheduler</code> 扩展，添加自定义策略</li>
</ul>
<p><strong>配置示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">scheduling</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">userScheduler</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=autohttps可选自动https>Autohttps（可选，自动HTTPS）<a href=#autohttps可选自动https class=hash-link aria-label="Direct link to Autohttps（可选，自动HTTPS）" title="Direct link to Autohttps（可选，自动HTTPS）">​</a></h3>
<p><strong>作用</strong>：
<code>Autohttps</code> 自动管理<code>HTTPS</code>证书，为<code>JupyterHub</code>提供安全的加密访问通道，基于<code>Let's Encrypt</code>实现证书的自动申请和续期。</p>
<p><strong>核心功能</strong>：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=证书管理>证书管理<a href=#证书管理 class=hash-link aria-label="Direct link to 证书管理" title="Direct link to 证书管理">​</a></h4>
<p><strong>自动申请</strong>：</p>
<ul>
<li>使用<code>Let's Encrypt</code>免费<code>SSL/TLS</code>证书</li>
<li>通过<code>ACME</code>协议自动完成域名验证</li>
<li>支持 <code>HTTP-01</code> 和 <code>TLS-ALPN-01</code> 验证方式</li>
<li>几分钟内完成证书申请</li>
</ul>
<p><strong>自动续期</strong>：</p>
<ul>
<li>证书有效期通常为<code>90</code>天</li>
<li>在证书过期前<code>30</code>天自动续期</li>
<li>无需人工干预，完全自动化</li>
<li>续期失败会有告警和重试机制</li>
</ul>
<p><strong>多域名支持</strong>：</p>
<ul>
<li>支持同时管理多个域名的证书</li>
<li>支持通配符证书（需要 <code>DNS-01</code> 验证）</li>
<li>每个域名独立申请和续期</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=https-代理>HTTPS 代理<a href=#https-代理 class=hash-link aria-label="Direct link to HTTPS 代理" title="Direct link to HTTPS 代理">​</a></h4>
<p><strong>流量终止</strong>：</p>
<ul>
<li>在<code>Proxy</code>前面提供<code>HTTPS</code>终止（<code>TLS Termination</code>）</li>
<li>接收加密的<code>HTTPS</code>请求（端口 <code>443</code>）</li>
<li>解密后转发到后端 <code>Proxy</code>（端口 <code>8000</code>）</li>
<li>后端通信可以是 <code>HTTP</code>（简化内部配置）</li>
</ul>
<p><strong>安全特性</strong>：</p>
<ul>
<li>强制<code>HTTPS</code>访问，自动将<code>HTTP</code>重定向到 <code>HTTPS</code></li>
<li>支持 <code>HSTS</code>（<code>HTTP Strict Transport Security</code>）</li>
<li>使用现代化的<code>TLS</code>协议（<code>TLS 1.2+</code>）</li>
<li>配置安全的加密套件</li>
</ul>
<p><strong>端口配置</strong>：</p>
<ul>
<li><strong>端口 80（HTTP）</strong>：用于<code>ACME</code>验证和重定向</li>
<li><strong>端口 443（HTTPS）</strong>：接收加密流量</li>
<li><strong>端口 8080</strong>：健康检查端口</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=技术实现>技术实现<a href=#技术实现 class=hash-link aria-label="Direct link to 技术实现" title="Direct link to 技术实现">​</a></h4>
<p><strong>基于 Traefik</strong>：</p>
<ul>
<li>使用<code>Traefik</code>作为反向代理和证书管理器</li>
<li><code>Traefik</code>是现代化的云原生代理</li>
<li>支持自动服务发现和动态配置</li>
<li>集成<code>Let's Encrypt``ACME</code> 客户端</li>
</ul>
<p><strong>ACME 客户端</strong>：</p>
<ul>
<li>内置 <code>LEGO（Let's Encrypt GO）</code>客户端</li>
<li>支持多种<code>ACME</code>验证方式</li>
<li>证书存储在<code>Secret</code>中</li>
</ul>
<p><strong>容器配置</strong>：</p>
<ul>
<li>运行在独立的<code>Kubernetes Pod</code>中</li>
<li>使用<code>PVC</code>持久化证书数据</li>
<li>通过<code>Service</code>暴露<code>HTTPS</code>端口</li>
</ul>
<p><strong>配置示例</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">proxy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">https</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> letsencrypt</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">letsencrypt</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">contactEmail</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> admin@example.com</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">acmeServer</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> https</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">//acme</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">v02.api.letsencrypt.org/directory</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">hosts</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> jupyterhub.example.com</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>技术实现</strong>：</p>
<ul>
<li>运行在独立的<code>Kubernetes Pod</code>中</li>
<li>使用<code>Traefik</code>作为代理和证书管理器</li>
<li>通过<code>Kubernetes Service</code>暴露<code>HTTPS</code>端口（<code>443</code>）</li>
<li>证书存储在<code>PersistentVolume</code>中，避免重复申请</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=组件之间的协作流程>组件之间的协作流程<a href=#组件之间的协作流程 class=hash-link aria-label="Direct link to 组件之间的协作流程" title="Direct link to 组件之间的协作流程">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=用户首次访问流程>用户首次访问流程<a href=#用户首次访问流程 class=hash-link aria-label="Direct link to 用户首次访问流程" title="Direct link to 用户首次访问流程">​</a></h3>
<ol>
<li><strong>用户访问</strong>：用户通过浏览器访问<code>JupyterHub</code>地址（通过<code>Proxy</code>的 <code>Service</code>）</li>
<li><strong>HTTPS 终止</strong>（可选）：如果启用 <code>Autohttps</code>，请求先经过<code>Traefik</code>进行<code>HTTPS</code>解密</li>
<li><strong>身份验证</strong>：<code>Proxy</code> 发现用户未登录，将请求转发到 <code>Hub</code></li>
<li><strong>认证处理</strong>：<code>Hub</code> 的<code>Authenticator</code>验证用户身份（用户名密码、<code>OAuth</code> 等）</li>
<li><strong>创建环境</strong>：认证成功后，<code>Hub</code> 通过<code>KubeSpawner</code>调用<code>Kubernetes API</code>创建用户 <code>Pod</code></li>
<li><strong>调度 Pod</strong>：<code>Kubernetes</code> 根据<code>User Scheduler</code>的策略将<code>Pod</code>调度到合适的节点</li>
<li><strong>等待就绪</strong>：<code>Hub</code> 等待用户<code>Pod</code>启动并进入<code>Ready</code>状态</li>
<li><strong>更新路由</strong>：<code>Hub</code> 通知<code>Proxy</code>添加路由规则（用户 →<code>Pod</code>地址）</li>
<li><strong>重定向</strong>：<code>Hub</code> 将用户重定向到 <code>Proxy</code>，<code>Proxy</code> 根据路由表将请求转发到用户 <code>Pod</code></li>
<li><strong>访问 Notebook</strong>：用户成功访问自己的<code>Jupyter Notebook</code>环境</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=用户再次访问流程>用户再次访问流程<a href=#用户再次访问流程 class=hash-link aria-label="Direct link to 用户再次访问流程" title="Direct link to 用户再次访问流程">​</a></h3>
<ol>
<li><strong>用户访问</strong>：用户通过浏览器访问<code>JupyterHub</code>地址</li>
<li><strong>识别身份</strong>：<code>Proxy</code> 通过<code>Cookie</code>识别用户身份</li>
<li><strong>检查 Pod</strong>：<code>Proxy</code> 检查该用户的<code>Pod</code>是否存在并运行中</li>
<li><strong>直接转发</strong>：如果<code>Pod</code>运行中，<code>Proxy</code> 直接将请求转发到用户 <code>Pod</code>（跳过 <code>Hub</code>）</li>
<li><strong>访问 Notebook</strong>：用户直接访问到自己之前的工作环境，所有数据和状态都保持不变</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=pod-停止和清理流程>Pod 停止和清理流程<a href=#pod-停止和清理流程 class=hash-link aria-label="Direct link to Pod 停止和清理流程" title="Direct link to Pod 停止和清理流程">​</a></h3>
<ol>
<li><strong>空闲检测</strong>：<code>jupyterhub-idle-culler</code> 检测到用户<code>Pod</code>空闲超时</li>
<li><strong>通知 Hub</strong>：<code>Idle Culler</code> 通过 API 通知<code>Hub</code>停止用户服务器</li>
<li><strong>停止 Pod</strong>：<code>Hub</code> 调用<code>Kubernetes API</code>删除用户 <code>Pod</code></li>
<li><strong>更新路由</strong>：<code>Hub</code> 通知<code>Proxy</code>删除对应的路由规则</li>
<li><strong>保留数据</strong>：用户的<code>PVC</code>保留，数据不丢失</li>
<li><strong>下次启动</strong>：用户再次访问时，重复首次访问流程，数据会重新挂载</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=简要总结>简要总结<a href=#简要总结 class=hash-link aria-label="Direct link to 简要总结" title="Direct link to 简要总结">​</a></h2>
<p><code>JupyterHub</code> 通过精心设计的架构，将认证、资源管理、代理路由等功能分离到不同的组件中，每个组件专注于自己的职责。以下是各核心组件的职责总结：</p>
<table><thead><tr><th>组件<th>角色定位<th>核心职责<th>关键技术<th>部署方式<tbody><tr><td><strong>Hub</strong><td>控制中枢<td>• 用户认证和授权<br>• 用户环境创建和管理<br>• 路由规则管理<br>• 管理界面提供<td>• <code>Authenticator</code>（认证器）<br>• <code>KubeSpawner</code>（环境生成器）<br>• <code>SQLite</code>/<code>PostgreSQL</code>（数据库）<td>单个 <code>Pod</code><br>端口<code>8081</code><tr><td><strong>Proxy</strong><td>流量网关<td>• 接收用户请求<br>• 智能路由分发<br>• 动态路由表管理<br>•<code>WebSocket</code>支持<td>• <code>Configurable HTTP Proxy (CHP)</code><br>• <code>REST API</code>（路由管理）<br>•<code>Cookie</code>会话管理<td>单个 <code>Pod</code><br>端口 <code>8000</code>（公共）<br>端口 <code>8001</code>（API）<tr><td><strong>Singleuser Server</strong><td>计算工作空间<td>• <code>Jupyter Notebook</code>服务<br>• 执行用户代码<br>• 数据持久化<br>• 文件管理<td>• <code>Jupyter Server/JupyterLab</code><br>• <code>IPython Kernel</code><br>•<code>PVC</code>持久化存储<td>每用户一个 <code>Pod</code><br>端口<code>8888</code><tr><td><strong>User Scheduler</strong><td>调度优化器（可选）<td>• 智能<code>Pod</code>调度<br>• 负载均衡<br>• 集群自动扩缩容支持<br>• 资源碎片优化<td>• 自定义 <code>Kubernetes Scheduler</code><br>• 亲和性和反亲和性策略<td>多副本 <code>Pod</code><br>（<code>2-3</code>个）<tr><td><strong>Autohttps</strong><td>安全卫士（可选）<td>•<code>HTTPS</code>证书自动管理<br>•<code>TLS</code>终止<br>• 强制<code>HTTPS</code>访问<br>• 证书自动续期<td>•<code>Traefik</code>反向代理<br>• <code>Let's Encrypt</code><br>•<code>ACME</code>协议<td>单个 <code>Pod</code><br>端口<code>80/443</code></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://z2jh.jupyter.org/en/stable/index.html target=_blank rel="noopener noreferrer">https://z2jh.jupyter.org/en/stable/index.html</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/model-development><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>模型开发</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/jupyterhub-deployment><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>JupyterHub安装部署</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#什么是jupyterhub class="table-of-contents__link toc-highlight">什么是JupyterHub</a><li><a href=#jupyterhub解决的问题 class="table-of-contents__link toc-highlight">JupyterHub解决的问题</a><ul><li><a href=#环境配置和管理问题 class="table-of-contents__link toc-highlight">环境配置和管理问题</a><li><a href=#计算资源分配问题 class="table-of-contents__link toc-highlight">计算资源分配问题</a><li><a href=#多用户协作和管理问题 class="table-of-contents__link toc-highlight">多用户协作和管理问题</a><li><a href=#数据持久化和共享问题 class="table-of-contents__link toc-highlight">数据持久化和共享问题</a></ul><li><a href=#jupyterhub系统架构 class="table-of-contents__link toc-highlight">JupyterHub系统架构</a><ul><li><a href=#架构设计特点 class="table-of-contents__link toc-highlight">架构设计特点</a><li><a href=#架构关系图 class="table-of-contents__link toc-highlight">架构关系图</a><li><a href=#数据流说明 class="table-of-contents__link toc-highlight">数据流说明</a></ul><li><a href=#jupyterhub的核心组件 class="table-of-contents__link toc-highlight">JupyterHub的核心组件</a><ul><li><a href=#hub核心控制器 class="table-of-contents__link toc-highlight">Hub（核心控制器）</a><li><a href=#proxy代理服务器 class="table-of-contents__link toc-highlight">Proxy（代理服务器）</a><li><a href=#singleuser-server用户notebook服务器 class="table-of-contents__link toc-highlight">Singleuser Server（用户Notebook服务器）</a><li><a href=#user-scheduler可选用户调度器 class="table-of-contents__link toc-highlight">User Scheduler（可选，用户调度器）</a><li><a href=#autohttps可选自动https class="table-of-contents__link toc-highlight">Autohttps（可选，自动HTTPS）</a></ul><li><a href=#组件之间的协作流程 class="table-of-contents__link toc-highlight">组件之间的协作流程</a><ul><li><a href=#用户首次访问流程 class="table-of-contents__link toc-highlight">用户首次访问流程</a><li><a href=#用户再次访问流程 class="table-of-contents__link toc-highlight">用户再次访问流程</a><li><a href=#pod-停止和清理流程 class="table-of-contents__link toc-highlight">Pod 停止和清理流程</a></ul><li><a href=#简要总结 class="table-of-contents__link toc-highlight">简要总结</a><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>