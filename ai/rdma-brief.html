<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/AI基础架构/RDMA/RDMA技术架构深度解析" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>RDMA技术架构深度解析 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/rdma-brief><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="RDMA技术架构深度解析 | John's Blog"><meta data-rh=true name=description content="全面深入地介绍RDMA（Remote Direct Memory Access）技术原理、架构实现和应用场景。详细解析InfiniBand、RoCE、iWARP三种主要RDMA实现方案，探讨CPU Offload、Kernel Bypass、Zero Copy等关键特性如何实现超低延迟和高带宽的网络通信，广泛应用于高性能计算、深度学习训练和数据中心网络优化"><meta data-rh=true property=og:description content="全面深入地介绍RDMA（Remote Direct Memory Access）技术原理、架构实现和应用场景。详细解析InfiniBand、RoCE、iWARP三种主要RDMA实现方案，探讨CPU Offload、Kernel Bypass、Zero Copy等关键特性如何实现超低延迟和高带宽的网络通信，广泛应用于高性能计算、深度学习训练和数据中心网络优化"><meta data-rh=true name=keywords content="RDMA,Remote Direct Memory Access,DMA,Direct Memory Access,网络通信,网络优化,网络性能,网络传输,网络延迟,InfiniBand,RoCE,iWARP,高性能计算,HPC,深度学习,机器学习,CPU Offload,Kernel Bypass,Zero Copy,低延迟,高带宽,Verbs接口,QP队列对,以太网,TCP卸载,无损网络,内存拷贝,系统吞吐量,网络架构,协议栈,数据中心,集群互联"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/rdma-brief><link data-rh=true rel=alternate href=https://johng.cn/ai/rdma-brief hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/rdma-brief hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.3251fb5b.js defer></script><script src=/assets/js/main.bf594746.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/app>AI应用技术</a><button aria-label="Expand sidebar category 'AI应用技术'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/infra>AI基础架构</a><button aria-label="Collapse sidebar category 'AI基础架构'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/hpc>HPC</a><button aria-label="Expand sidebar category 'HPC'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/vgpu>vGPU</a><button aria-label="Expand sidebar category 'vGPU'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/rdma>RDMA</a><button aria-label="Collapse sidebar category 'RDMA'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/rdma-brief>RDMA技术架构深度解析</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/rdma-infiniband-vs-roce>InfiniBand vs RoCE</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/rdma-hardware-topology>RDMA硬件管理及网络拓扑信息查看</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/nvidia>NVIDIA</a><button aria-label="Expand sidebar category 'NVIDIA'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/distributed-inference>分布式推理</a><button aria-label="Expand sidebar category '分布式推理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/scheduling>算力资源调度</a><button aria-label="Expand sidebar category '算力资源调度'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/what-is-llmops-mlops>LLMOps介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-acceleration-cards>常见智算加速卡汇总</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-ai-model-training-inference-framework>常见AI模型训练推理框架对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ai-training-inference-scenarios>AI模型训练推理常见业务场景痛点</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/basic>AI入门知识</a><button aria-label="Expand sidebar category 'AI入门知识'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/infra><span itemprop=name>AI基础架构</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/rdma><span itemprop=name>RDMA</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>RDMA技术架构深度解析</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>RDMA</code>，即 <code>Remote Direct Memory Access</code>，是一种绕过<strong>远程</strong>主机 <code>OS kernel</code> 访问其内存中数据的技术，概念源自于 <code>DMA</code> 技术。在 <code>DMA</code> 技术中，外部设备（<code>PCIe</code> 设备）能够绕过 <code>CPU</code> 直接访问 <code>host memory</code>；而 <code>RDMA</code> 则是指外部设备能够绕过 <code>CPU</code>，不仅可以访问本地主机的内存，还能够访问另一台主机上的用户态内存。由于不经过操作系统，不仅节省了大量 <code>CPU</code> 资源，同样也<strong>提高了系统吞吐量</strong>、<strong>降低了系统的网络通信延迟</strong>，在高性能计算和深度学习训练中得到了广泛的应用。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=技术背景>技术背景<a href=#技术背景 class=hash-link aria-label="Direct link to 技术背景" title="Direct link to 技术背景">​</a></h2>
<p>计算机网络通信中最重要两个衡量指标主要是 <strong>带宽</strong> 和 <strong>延迟</strong>。
现实计算机网络中的通信场景中，主要是以发送小消息为主，因此处理延迟是提升性能的关键。
传统的<code>TCP/IP</code>网络通信，数据需要通过用户空间发送到远程机器的用户空间，在这个过程中需要经历若干次内存拷贝：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAv0lEQVR4nGP4////q0/fLz16c/PZu+8/f11+9PXMo/8v71//f3H67yuLGZbtb2ndsyxjx6npBzaeujN/zamk+VfS997t+f/7+//f3xj8q4W1J2QILz2VsnHzhnN1fUf46q8wLLrn+B8MGNwKRXVK/KQapoVPam1Ylp01Qztyudisqw5Q6dWHZ83atGju+s1zN66Zs3bx8g1Lp+9YdurpGqj0lg9/Eh9/Pfrtx/8LU//uK7nz/knq/a+Tn/2ESAMAAkeBtJgheIMAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=389 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image.978c4e0.640.png srcset="/assets/ideal-img/image.978c4e0.640.png 640w,/assets/ideal-img/image.7fd3ee0.962.png 962w" alt=传统TCP/IP网络通信数据拷贝流程 width=640 height=389></noscript></div>
<ul>
<li>数据发送方需要讲数据从用户空间<code>Buffer</code>复制到内核空间的<code>Socket Buffer</code></li>
<li>数据发送方要在内核空间中添加数据包头，进行数据封装</li>
<li>数据从内核空间的<code>Socket Buffer</code>复制到<code>NIC Buffer</code>进行网络传输</li>
<li>数据接受方接收到从远程机器发送的数据包后，要将数据包从<code>NIC Buffer</code>中复制到内核空间的<code>Socket Buffer</code></li>
<li>经过一系列的多层网络协议进行数据包的解析工作，解析后的数据从内核空间的<code>Socket Buffer</code>被复制到用户空间<code>Buffer</code></li>
<li>这个时候再进行系统上下文切换，用户应用程序才被调用</li>
</ul>
<p>在高速网络条件下，传统的<code>TCP/IP</code>网络在<strong>主机侧数据移动和复制操作带来的高开销</strong>限制了可以在机器之间发送的带宽。为了提高数据传输带宽，人们提出了多种解决方案，这里主要介绍下面两种：</p>
<ul>
<li><code>TCP Offloading Engine</code></li>
<li><code>Remote Direct Memroy Access</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=tcp-offloading-engine>TCP Offloading Engine<a href=#tcp-offloading-engine class=hash-link aria-label="Direct link to TCP Offloading Engine" title="Direct link to TCP Offloading Engine">​</a></h2>
<p>在主机通过网络进行通信的过程中，<code>CPU</code> 需要耗费大量资源进行多层网络协议的数据包处理工作，包括数据复制、协议处理和中断处理。当主机收到网络数据包时，会引发大量的网络 <code>I/O</code> 中断，<code>CPU</code> 需要对 <code>I/O</code> 中断信号进行响应和确认。为了将 <code>CPU</code> 从这些操作中解放出来，人们发明了<code>TOE</code>（<code>TCP/IP Offloading Engine</code>）技术，将上述主机处理器的工作转移到网卡上。<code>TOE</code> 技术需要特定支持 <code>Offloading</code> 的网卡，这种特定网卡能够支持封装多层网络协议的数据包。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAIAAADzBuo/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR4nAGbAGT/AN/j4oypnZOvpO7v7v///////+/x8Jmwp5WupOjr6gDb4N56m46GpJjq6+r//v7//v7q7Ot2nIxymoni5uQAy9nTQJh0TJ184OPh+fj49/f35ujogqmefaab4+jnANXe3WWeiW+mkurs7P///////+rv8V+nj1mli9/m6QDn6vGnucWtvcny8/f////////x8/agvMKcur/r7vPFWHdA+suXzgAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=348 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-1.18bd968.640.png srcset="/assets/ideal-img/image-1.18bd968.640.png 640w,/assets/ideal-img/image-1.c8f8025.2516.png 2516w" alt=TOE技术架构示意图 width=640 height=348></noscript></div>
<ul>
<li><code>TOE</code> 技术将原来在协议栈中进行的<code>IP</code>分片、<code>TCP</code>分段、重组、<code>checksum</code>校验等操作，转移到网卡硬件中进行，降低系统<code>CPU</code>的消耗，提高服务器处理性能。</li>
<li>普通网卡处理每个数据包都要触发一次中断，<code>TOE</code> 网卡则让每个应用程序完成一次完整的数据处理进程后才触发一次中断，显著减轻服务器对中断的响应负担。</li>
<li><code>TOE</code> 网卡在接收数据时，在网卡内进行协议处理，因此，它不必将数据复制到内核空间缓冲区，而是直接复制到用户空间的缓冲区，这种"零拷贝"方式避免了网卡和服务器间的不必要的数据</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=rdmaremote-direct-memroy-access>RDMA(Remote Direct Memroy Access)<a href=#rdmaremote-direct-memroy-access class=hash-link aria-label="Direct link to RDMA(Remote Direct Memroy Access)" title="Direct link to RDMA(Remote Direct Memroy Access)">​</a></h2>
<p>为了消除传统网络通信带给计算任务的瓶颈，我们希望更快和更轻量级的网络通信，由此提出了<code>RDMA</code>技术。<code>RDMA</code>利用<code>Kernel Bypass</code>和 <code>Zero Copy</code>技术提供了低延迟的特性，同时减少了<code>CPU</code>占用，减少了内存带宽瓶颈，提供了很高的带宽利用率。<code>RDMA</code>提供了给基于 <code>IO</code> 的通道，这种通道允许一个应用程序通过<code>RDMA</code>设备对远程的虚拟内存进行直接的读写。</p>
<p><code>RDMA</code> 技术有以下几个特点：</p>
<ul>
<li><strong>CPU Offload</strong>：无需<code>CPU</code>干预，应用程序可以访问远程主机内存而不消耗远程主机中的任何<code>CPU</code>。远程主机内存能够被读取而不需要远程主机上的进程（或<code>CPU</code>)参与。远程主机的<code>CPU</code>的缓存(<code>cache</code>)不会被访问的内存内容所填充</li>
<li><strong>Kernel Bypass</strong>：<code>RDMA</code> 提供一个专有的 <code>Verbs interface</code>而不是传统的<code>TCP/IP Socket interface</code>。应用程序可以直接在用户态执行数据传输，不需要在内核态与用户态之间做上下文切换</li>
<li><strong>Zero Copy</strong>：每个应用程序都能直接访问集群中的设备的虚拟内存，这意味着应用程序能够直接执行数据传输，在不涉及到网络软件栈的情况下，数据能够被直接发送到缓冲区或者能够直接从缓冲区里接收，而不需要被复制到网络层。</li>
</ul>
<p>下面是 <code>RDMA</code> 整体框架架构图，从图中可以看出，<code>RDMA</code>在应用程序用户空间，提供了一系列 <code>Verbs</code> 接口操作<code>RDMA</code>硬件。<code>RDMA</code>绕过内核直接从用户空间访问<code>RDMA</code> 网卡。<code>RNIC</code>网卡中包括 <code>Cached Page Table Entry</code>，用来将虚拟页面映射到相应的物理页面。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVR4nAHZACb/AOqxTfbQjuz2/dvq9Oz1+9zs9tTo9O/2+/////7//wDePB3rgm3l8/nR4+7Z5+7S4erL3+rl7/T7+/r7/P0A6GZe75qW9fr68/Lx8u/u8e7r8PDu8fHw7O/u+vr6AP75+fz3+Obv8efv8erx8+z2+Ofz9ebx8+Hs7vj6+gD//v3k7vB4wtR2wtV0u890rbx0scR3scVwr8TS6vAA+/Pz6+LkyM/Xz9zfzKqox19aw2lfwGlXwX9u7vLxAP/9/OXf5piYtrOyuq6wv6ONjpaLdXSYinKVgNHY2TD2q1HVyXqDAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=461 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-2.374bd59.640.png srcset="/assets/ideal-img/image-2.374bd59.640.png 640w,/assets/ideal-img/image-2.6db0c70.840.png 840w" alt=RDMA整体框架架构图 width=640 height=461></noscript></div>
<p>目前<code>RDMA</code>有三种不同的硬件架构实现，它们都可以使用同一套<code>API</code>来使用，但它们有着不同的物理层和链路层：</p>
<ul>
<li>
<p><strong>Infiniband：</strong> 基于 <code>InfiniBand</code> 架构的 <code>RDMA</code> 技术，由 <code>IBTA</code>（<code>InfiniBand Trade Association</code>）提出。搭建基于 <code>IB</code> 技术的 <code>RDMA</code> 网络需要专用的 <code>IB</code> 网卡和 <code>IB</code> 交换机。从性能上，很明显<code>Infiniband</code>网络最好，但网卡和交换机是价格也很高，然而<code>RoCEv2</code>和<code>iWARP</code>仅需使用特殊的网卡就可以了，价格也相对便宜很多。</p>
</li>
<li>
<p><strong>iWARP：</strong> <code>Internet Wide Area RDMA Protocal</code>，基于 <code>TCP/IP</code> 协议的 <code>RDMA</code> 技术，由 <code>IETF</code> 标 准定义。<code>iWARP</code> 支持在标准以太网基础设施上使用 <code>RDMA</code> 技术，而不需要交换机支持无损以太网传输，但服务器需要使用支持<code>iWARP</code> 的网卡。与此同时，受 <code>TCP</code> 影响，性能稍差。</p>
</li>
<li>
<p><strong>RoCE：</strong> 基于以太网的 <code>RDMA</code> 技术，也是由 <code>IBTA</code> 提出。<code>RoCE</code>支持在标准以太网基础设施上使用<code>RDMA</code>技术，但是需要交换机支持无损以太网传输，需要服务器使用 <code>RoCE</code> 网卡，性能与 <code>IB</code> 相当。</p>
</li>
</ul>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR4nAG6AEX/AMzb6Zq41Jy717bJ3Ofk4+Xj5NXY0LDBo6/AorvJrwDX4OHR2dPT29bO19PCzczF0MzJ09DQ297N2N/U3eMAn9H4ULT/iM3/Y7r8Y7T0d776Saz/kNDijsp0k8yHAHq58xGL/mWz/TGa/Tef/3W5yT2bpofArnCvPnizVACezPVFo/mMxfF4t6Z6uLOnzIyFuEqtz4+LvW+TwXcAvNz3cq7lrdPuz+G7zuHA2u3bvNS+3/HexNvDz+TNf6KCppaYe2IAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=386 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-3.25e84e1.640.png srcset="/assets/ideal-img/image-3.25e84e1.640.png 640w,/assets/ideal-img/image-3.cbf12cf.1213.png 1213w" alt=三种RDMA硬件架构对比：InfiniBand、iWARP、RoCE width=640 height=386></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=io-瓶颈>I/O 瓶颈<a href=#io-瓶颈 class=hash-link aria-label="Direct link to I/O 瓶颈" title="Direct link to I/O 瓶颈">​</a></h3>
<p>时间回退到二十世纪的最后一年，随着<code>CPU</code>性能的迅猛发展，早在<code>1992</code>年<code>Intel</code>提出的 <a href=https://en.wikipedia.org/wiki/Peripheral_Component_Interconnect target=_blank rel="noopener noreferrer">PCI</a> 技术已经满足不了人民群众日益增长的<code>I/O</code>需求，<code>I/O</code> 系统的性能已经成为制约服务器性能的主要矛盾。尽管在<code>1998</code>年，<code>IBM</code> 联合 <code>HP</code> 、<code>Compaq</code> 提出了 <a href=https://en.wikipedia.org/wiki/PCI-X target=_blank rel="noopener noreferrer">PCI-X</a> 作为<code>PCI</code>技术的扩展升级，将通信带宽提升到<code>1066 MB/sec</code>，人们认为<code>PCI-X</code> 仍然无法满足高性能服务器性能的要求，要求构建下一代<code>I/O</code>架构的呼声此起彼伏。经过一系列角逐，<code>Infiniband</code>融合了当时两个竞争的设计 <code>Future I/O</code> 和 <code>Next Generation I/O</code>，建立了 <code>Infiniband</code> 行业联盟，也即 <a href=https://www.infinibandta.org/ target=_blank rel="noopener noreferrer">BTA (InfiniBand Trade Association)</a>，包括了当时的各大厂商 <code>Compaq</code>、<code>Dell</code>、<code>HP</code>、<code>IBM</code>、<code>Intel</code>、<code>Microsoft</code> 和 <code>Sun</code>。在当时，<code>InfiniBand</code> 被视为替换 <code>PCI</code> 架构的下一代 <code>I/O</code> 架构，并在 <code>2000</code> 年发布了 <code>1.0</code> 版本的 <code>Infiniband</code> 架构 <code>Specification</code>，<code>2001</code> 年 <code>Mellanox</code> 公司推出了支持 <code>10 Gbit/s</code>通信速率的设备。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVR4nD3L3QqCMBgAUN//USK6k0ACBUMhMX/IQoypuVIKzTkr53RfmND14Ug1YZqZqnaxdqiyf8pWqft1VfZCAABINeEnTw0Dc+dnh4S4iIS47Qf4KUiU9Etjo7sKjUwxcgETzHVixsYqzVuMr4EfaQuSn8XY/V3KMCWEAUDXNKltoa2M9NXnVY2cz3uIUX1JGxTTBLOjVzhGdMvKx/0NAF/8aqOwsyJhGAAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=414 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-4.4c7c285.640.png srcset="/assets/ideal-img/image-4.4c7c285.640.png 640w,/assets/ideal-img/image-4.0e8e02e.1908.png 1908w" alt=InfiniBand历史发展时间线 width=640 height=414></noscript></div>
<p>然而好景不长，<code>2000</code> 年互联网泡沫被戳破，人们对于是否要投资技术上如此跨越的技术产生犹豫。<code>Intel</code> 转而宣布要开发自己的 <a href=https://en.wikipedia.org/wiki/PCI_Express target=_blank rel="noopener noreferrer">PCIe</a> 架构，微软也停止了 <code>IB</code> 的开发。尽管如此，<code>Sun</code> 和 日立等公司仍然坚持对 <code>InfiniBand</code> 技术的研发，并由于其强大的性能优势逐渐在集群互联、存储系统、超级计算机内部互联等场景得到广泛应用，其软件协议栈也得到标准化，<a href=https://en.wikipedia.org/wiki/InfiniBand#History target=_blank rel="noopener noreferrer">Linux 也添加了对于 Infiniband 的支持</a>。进入<code>2010</code>年代，随着大数据和人工智能的爆发，<code>InfiniBand</code> 的应用场景从原来的超算等场景逐步扩散，得到了更加广泛的应用，<code>InfiniBand</code> 市场领导者 <code>Mellanox</code> 被 <code>NVIDIA</code> 收购，另一个主要玩家 <code>QLogic</code> 被 <code>Intel</code> 收购，<code>Oracle</code> 也开始制造自己的 <code>InfiniBand</code> 互联芯片和交换单元。到了 <code>2020</code> 年代，<code>Mellanox</code> 最新发布的 <code>NDR</code> 理论有效带宽已经可以达到 <a href=https://www.nvidia.com/en-us/networking/ndr/ target=_blank rel="noopener noreferrer">单端口 400 Gb/s</a>，为了运行 <code>400 Gb/s</code> 的 <code>HCA</code> 可以使用 <code>PCIe Gen5x16</code> 或者 <code>PCIe Gen4x32</code>。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAl0lEQVR4nB3BCw6CMAwA0N3/fH4SRY2CsLXdWFsKAxcx8T23/e37Lrq2g7SDQJy3z3cp9bNVp6qTzaIljmZLFas4rm3Q6w0yTo6IyrqWUlkKs3VoTZ/PT386tcmLA4CRNcUpRiGgpsvHRzjc+/MVicwxS8qT9zmgDoGbji8vvjz1cJMexNVaiRJgCjh6SAH57RNEw7SolR9Kk6dRar0oCwAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=384 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-5.cc691de.640.png srcset="/assets/ideal-img/image-5.cc691de.640.png 640w,/assets/ideal-img/image-5.bd31b78.1200.png 1200w" alt=InfiniBand各代速率演进：从SDR到NDR width=640 height=384></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=架构组成>架构组成<a href=#架构组成 class=hash-link aria-label="Direct link to 架构组成" title="Direct link to 架构组成">​</a></h3>
<p><code>InfiniBand</code> 架构为系统通信定义了多种设备：<code>channel adapter</code>、<code>switch</code>、<code>router</code>、<code>subnet manager</code>，它提供了一种基于通道的点对点消息队列转发模型，每个应用都可通过创建的虚拟通道直接获取本应用的数据消息，无需其他操作系统及协议栈的介入。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVR4nAXBTQuCMAAA0P3/c1CwIq1D56ImRh+sIrUow8RB5nDYyAY2BCcMEnsPtG2rteacJ0nCOVdKQQgxxnEcM8ZAVVW2bTuOQwh553nz+20OB8pYGIZpmoIsyyzLMgyj2+351+sluM/t5d47DUfjm+8DKSVCqA/hyDRfLy7ld+8e33leFIVSCtR1LYQgUXT0vC3GzyftDCbY9e9BIIQAZVlqrZum4Z/PAqH1zludH5sTmU5nlNI/QiiUeva+rPoAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=372 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-6.aec0f51.640.png srcset="/assets/ideal-img/image-6.aec0f51.640.png 640w,/assets/ideal-img/image-6.edd04dd.1656.png 1656w" alt=InfiniBand子网架构及设备组成 width=640 height=372></noscript></div>
<p>在一个子网中，必须有至少每个节点有一个<code>channel adapter</code>，并且有一个<code>subnet manager</code> 来管理<code>Link</code>。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR4nD2NPWsCQRBA90cLQSFnYWGwUiRgo4IIKezsrKKxvCIIFoJgoeB5uB83M7vo3OVuJBHy2gfvKedcmqYh6KqyUWQa9av3WmuTJAkAKCJgLgYDWa1CpxteW3f5g5mJSCFCzvn6S/ZHnjV5UstFqqdGROUyjO39eK6E5LsrcVv4IvFOPs3NIyltMdqH/rA8L+Q0k8NYzFLePsqXgw9ICgCKonj+RvOyN/35f//GichY6zK4EbxvbWdjAkIGeDXGe/8AVNG6R18ZgFgAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=428 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-7.8fbd593.640.png srcset="/assets/ideal-img/image-7.8fbd593.640.png 640w,/assets/ideal-img/image-7.299c816.1372.png 1372w" alt=InfiniBand子网拓扑示例 width=640 height=428></noscript></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=channel-adapters>Channel Adapters<a href=#channel-adapters class=hash-link aria-label="Direct link to Channel Adapters" title="Direct link to Channel Adapters">​</a></h4>
<p>可安装在主机或者其他任何系统(如存储设备)上的<strong>网络适配器</strong>，这种组件为数据包的始发地或者目的地，支持<code>Infiniband</code> 定义的所有软件 <code>Verbs</code></p>
<ul>
<li><code>Host Channel Adapter</code>：<code>HCA</code></li>
<li><code>Target Channel Adapter</code>：<code>TCA</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=switch>Switch<a href=#switch class=hash-link aria-label="Direct link to Switch" title="Direct link to Switch">​</a></h4>
<p><code>Switch</code> 包含多个 <code>InfiniBand</code> 端口，它根据每个数据包 <code>LRH</code> 里面的 <code>LID</code>，负责将一个端口上收到的数据包发送到另一个端口。除了 <code>Management Packets</code>，<code>Switch</code> 不产生或者消费任何 <code>Packets</code>。它包含有 <code>Subnet Manager</code> 配置的转发表，能够响应 <code>Subnet Manager</code> 的 <code>Management Packets</code>。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAIAAADzBuo/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVR4nGP4////jz//7r34cevRl3VbX23Z8Pz///9///77DwYMr37/n9RzpCVrdWne6qyVLz/9/v3g1Zd7Vx59+Q2WXnfxV13w9NiyM1aVj607XzVNOetWe68oesWyw+9A0lde/2+q2dMWNyOp7OiE479mJk3Ji1qWE7Hk8MYTIOn///+/+fb3xI1PT19+/v///4WLz9ZM33Ng15VvINv/AQAiynVzR8VxcwAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=308 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-8.f4662a5.640.png srcset="/assets/ideal-img/image-8.f4662a5.640.png 640w,/assets/ideal-img/image-8.04553c8.1633.png 1633w" alt="InfiniBand Switch转发原理" width=640 height=308></noscript></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=router>Router<a href=#router class=hash-link aria-label="Direct link to Router" title="Direct link to Router">​</a></h4>
<p><code>Router</code> 根据 <code>L3</code> 中的 <code>GRH</code>，负责将 <code>Packet</code> 从一个子网转发到另一个子网，当被转到到另一子网时，<code>Router</code> 会重建数据包中的 <code>LID</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=subnet-manager>Subnet Manager<a href=#subnet-manager class=hash-link aria-label="Direct link to Subnet Manager" title="Direct link to Subnet Manager">​</a></h4>
<p><code>Subnet Manager</code> 负责配置本地子网，使其保持工作：</p>
<ul>
<li>发现子网的物理拓扑</li>
<li>给子网中的每个端口分配<code>LIC</code> 和其他属性（如活动<code>MTU</code>、活动速度）</li>
<li>给子网交换机配置转发表</li>
<li>检测拓扑变化（如子网中节点的增删）</li>
<li>处理子网中的各种错误</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=分层设计>分层设计<a href=#分层设计 class=hash-link aria-label="Direct link to 分层设计" title="Direct link to 分层设计">​</a></h3>
<p><code>InfiniBand</code> 有着自己的协议栈，从上到下依次包括传输层、网络层、数据链路层和物理层：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmUlEQVR4nDXMzQqFIBBA4d7/qYKoRZv2iU44Zt4hsh9SsMYuwb1n+8Epcs7rugKA9/55nhgjM3vvlVLneRYhBK01IhIRMy/Lcl0XESHitm1FjBERjTHTNIUQjuMYx1FKaa19+b7vzz/nnNYaAKSU8zy/zMxENAyDMUYp1XUdAAghfvOUkrW2LEvnXN/3dV03TdO2bVVV+75/AWePoujZove5AAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=374 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-9.3b3e5a2.640.png srcset="/assets/ideal-img/image-9.3b3e5a2.640.png 640w,/assets/ideal-img/image-9.7c0aaf6.1836.png 1836w" alt=InfiniBand协议栈分�层结构 width=640 height=374></noscript></div>
<p>对应着不同的层，数据包的封装如下，下面将对每一层的封装详细介绍：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVR4nC3J24rDIBAAUP//50LZxpSNzngBG5p4iWlMcQQXyp7Xw263n/v9Ye1TzIJz7pxDxGEYAEGCZNuWrX3te9ZaG61TSiGEbV1DCKUUtr5CjGnf9+PIMcZSynme+cgxRe8901rN86+U0nxZa5VSQghEAAR2XRcRtUY+eCklACDi+3323onov51z0zSN48g5X5aFiHrvtVZWayWinLNSCgCMMdfn01qrtbbW/gBHar/Bx9pW4gAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=603 height=425 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-10.c015d0e.603.png srcset="/assets/ideal-img/image-10.c015d0e.603.png 603w" alt=InfiniBand数据包封装结构 width=603 height=425></noscript></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=physical-layer>Physical Layer<a href=#physical-layer class=hash-link aria-label="Direct link to Physical Layer" title="Direct link to Physical Layer">​</a></h4>
<p>物理层定义了 <code>InfiniBand</code> 具有的电气和机械特性，<code>InfiniBand</code> 支持光纤和铜作为传输介质。在物理层支持不同的 <code>Link</code> 速度，每个 <code>Link</code> 由四根线组成（每个方向两条），<code>Link</code> 可以聚合以提高速率，目前绝大多数的系统采用 <code>4 Link</code>。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVR4nGP4////zz+/9h4/+/7dp56Va9euO/fm+yufvKZjh+/8//+f4f///69evfIPCl6+fEV8YtLaNRt27trp6Oq2aNFShHRERPjKlSvT09I2btq4a+euAH+/5cuXQaVfvnwZFhq6fPmy9NTUzZs37Ny+I8jfd/lymO43797EJqdv3rwtNjN72bLNh04cMnP1WbJ4HVT697/fh85dff3204pDhy5ffPHg61Pr3LqTRx9Dpf/////r169///79/vXr39+/f//9fffhw5/ff/7//w8Ag9OfGZq0dYcAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=456 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-11.a09eee7.640.png srcset="/assets/ideal-img/image-11.a09eee7.640.png 640w,/assets/ideal-img/image-11.3e812ba.1338.png 1338w" alt=InfiniBand物理层不同Link速度规格 width=640 height=456></noscript></div>
<p>以<code>QDR</code> 为例，线上的 <code>Signalling Rate</code> 为 <code>10 Gb/s</code>，由于采用 <code>8b/10b</code> 编码，实际有效带宽单 <code>Link</code> 为 <code>10 Gb/s * 8/10 = 8 Gb/s</code>，如果是 <code>4 Link</code>，则带宽可以达到 <code>32 Gb/s</code>。因为是双向的，所以 <code>4 Link</code> 全双工的速率可以达到 <code>64 Gb/s</code>。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAIAAAAlXwkiAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWUlEQVR4nAXBWQqAIBQAQO9/tYg+JFrIgjT16du0DtCMWfdz2Y6YIUP1T/Qh+pDCk+4QoaCZrBtGiyStfySKxKUSiWYoLGrcdc/bhawFRVtv/UXuRJKgEssPochRYzyUNgYAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=201 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-23.8004063.640.png srcset="/assets/ideal-img/image-23.8004063.640.png 640w,/assets/ideal-img/image-23.534b727.2554.png 2554w" alt="QDR速率计算示例：4x QDR达到64Gb/s" width=640 height=201></noscript></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=link-layer>Link Layer<a href=#link-layer class=hash-link aria-label="Direct link to Link Layer" title="Direct link to Link Layer">​</a></h4>
<p><code>Link Layer</code> 是 <code>InfiniBand</code> 架构的核心，包含以下部分：</p>
<ul>
<li><code>Packets</code>：链路层由两种类型的<code>Packets</code>，<code>Data Packet</code> 和 <code>Management Packet</code>，数据包最大可以为 <code>4KB</code>，数据包传输的类型包括两种类型<!-- -->
<ul>
<li><code>Memory</code>：<code>RDMA read/write，atomic operation</code></li>
<li><code>Channel</code>：<code>send/receive，multicast transmission</code></li>
</ul>
</li>
<li><code>Switching</code>：在子网中，<code>Packet</code> 的转发和交换是在链路层完成的<!-- -->
<ul>
<li>一个子网内的每个设备有一个由 <code>subnet manager</code> 分配的 <code>16 bit Local ID</code> (<strong>LID</strong>)</li>
<li>每个 <code>Packet</code> 中有一个 <code>Local Route Header</code> (<code>LRH</code>) 指定了要发送的目标 <code>LID</code></li>
<li>在一个子网中通过 <code>LID</code> 来负责寻址</li>
</ul>
</li>
<li><code>QoS</code>：链路层提供了 <code>QoS</code> 保证，不需要数据缓冲<!-- -->
<ul>
<li><code>Virtual Lanes</code>：一种在一条物理链路上创建多条虚拟链路的机制。虚拟通道表示端口的一组用于收发数据包的缓冲区。支持的 <code>VL</code> 数是端口的一个属性。</li>
<li>每个 <code>Link</code> 支持 <code>15</code> 个标准的 <code>VL</code> 和一个用于 <code>Management</code> 的 <code>VL15</code>，<code>VL15</code> 具有最高等级，<code>VL0</code> 具有最低等级</li>
<li><code>Service Level</code>：<code>InfiniBand</code> 支持多达 <code>16</code> 个服务等级，但是并没有指定每个等级的策略。<code>InfiniBand</code> 通过将 <code>SL</code> 和 <code>VL</code> 映射支持 <code>QoS</code></li>
</ul>
</li>
<li><code>Credit Based Flow Control</code></li>
<li><code>Data Integrity</code>：链路层通过 <code>Packet</code> 中的 <code>CRC</code> 字段来进行数据完整性校验，其组成包括 <code>ICRC</code> 和 <code>VCRC</code>。</li>
</ul>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAIAAABol6gpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJ0lEQVR4nAXBwQ0AMAgCwO4/o0hDIL7cwbuXpJuSbFdhZpIAIP/uHprCGpI4ZpsxAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=88 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-12.3d01c89.640.png srcset="/assets/ideal-img/image-12.3d01c89.640.png 640w,/assets/ideal-img/image-12.dcc4ab3.870.png 870w" alt="InfiniBand链路层Virtual Lanes和QoS机制" width=640 height=88></noscript></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=network-layer>Network Layer<a href=#network-layer class=hash-link aria-label="Direct link to Network Layer" title="Direct link to Network Layer">​</a></h4>
<p>网络层负责将 <code>Packet</code> 从一个子网路由到另一个子网：</p>
<ul>
<li>在子网间传输的 <code>Packet</code> 都有一个 <code>Gloabl Route Header</code> (<code>GRH</code>)。在这个 <code>Header</code> 中包括了该 <code>Packet</code> 的 <code>128 bit</code> 的 源 <code>IPv6</code> 地址和目的 <code>IPv6</code> 地址</li>
<li>每个设备都有一个全局的 <code>UID</code> (<code>GUID</code>)，路由器通过每个 <code>Packet</code> 的 <code>GUID</code> 来实现在不同子网间的转发</li>
</ul>
<p>下面是 <code>GRH</code> 报头的格式，长 <code>40</code> 字节，可选，用于组播数据包以及需要穿越多个子网的数据包。它使用 <code>GID</code> 描述了源端口和目标端口，其格式与 <code>IPv6</code> 报头相同。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAIAAAA4WjmaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVR4nE2LMQ7AIAgA/f8bTQVUhuogEGTtYEx6410uISIA1ANV5hcAW2u99zFGYmYz23urmogD8Fri7kemUkBVI8Is5pScH3ffl4RI9w4RI6J//gCdk28xNXVYzgAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=253 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-13.b988f3a.640.png srcset="/assets/ideal-img/image-13.b988f3a.640.png 640w,/assets/ideal-img/image-13.4028756.874.png 874w" alt=InfiniBand网络层GRH报头格式 width=640 height=253></noscript></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=transport-layer>Transport Layer<a href=#transport-layer class=hash-link aria-label="Direct link to Transport Layer" title="Direct link to Transport Layer">​</a></h4>
<p>传输层负责 <code>Packet</code> 的按序传输、根据 <code>MTU</code> 分段和很多传输层的服务(<code>reliable connection</code>，<code>reliable datagram</code>，<code>unreliable connection</code>，<code>unreliable datagram</code>，<code>raw datagram</code>)。<code>InfiniBand</code> 的传输层提供了一个巨大的提升，因为所有的函数都是在硬件中实现的。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAIAAAAlXwkiAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAS0lEQVR4nB3BQQpAIQgFQO9/wHaFtHgkLSNLwe+HZsjd55yqeu9lZgCqak9E0DmnlCIimdlaq7X23vfe+ZC7A1hrRYSIABhjmNn3/FsRVL4SbRlLAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=180 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-14.321dc9f.640.png srcset="/assets/ideal-img/image-14.321dc9f.640.png 640w,/assets/ideal-img/image-14.e208000.1415.png 1415w" alt=InfiniBand传输层与TCP/IP协议栈对比 width=640 height=180></noscript></div>
<p>按照连接和可靠两个标准，可以划分出下图四种不同的传输模式：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAIAAADzBuo/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhklEQVR4nDXBSRKDIBAAQP7/siyX5KAXy1jlggaIgHFAkJnJKd2C/4xeV7sd8UgpG+Os9SkG4bdQ162c9dDPSsq5bQDi2EvdN0v3Et59n5fb0HZINL7XfJ6IRCmVHQhJaOPu18c0LFgIIJWCpWDOGCATkXDOd1VllSJm2E8kYuZ4ZPXxzPwDh0GNIWUYBysAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=296 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-16.11080db.640.png srcset="/assets/ideal-img/image-16.11080db.640.png 640w,/assets/ideal-img/image-16.28666b2.1659.png 1659w" alt=InfiniBand四种传输模式：RC、UC、RD、UD width=640 height=296></noscript></div>
<ul>
<li>可靠连接（<code>RC</code>）一个 <code>QP</code> 只和另一个 <code>QP</code> 相连，消息通过一个 <code>QP</code> 的发送队列可靠地传输到另一个 <code>QP</code> 的接收队列。数据包<strong>按序交付</strong>，<code>RC</code> 连接很类似于 <code>TCP</code> 连接。</li>
<li>不可靠连接（<code>UC</code>）一个 <code>QP</code> 只和另一个 <code>QP</code> 相连，连接是不可靠的，所以数据包可能有丢失。传输层出错的消息不会进行重传，错误处理必须由高层的协议来进行。</li>
<li>不可靠数据报（<code>UD</code>）一个 <code>QP</code> 可以和其它任意的 <code>UD QP</code> 进行数据传输和单包数据的接收。不保证按序性和交付性。交付的数据包可能被接收端丢弃。支持多播消息（一对多），<code>UD</code> 连接很类似于 <code>UDP</code> 连接。</li>
</ul>
<p>每种模式中可用的操作如下表所示，目前的 <code>RDMA</code> 硬件提供一种数据报传输：不可靠的数据报（<code>UD</code>），并且不支持 <code>memory verbs</code>。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAIAAADzBuo/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVR4nB3JQQ6EIAwAQP7/RA8mrhFSoS2lQCF42OhcxyEiEecPMwNEgOg9hACIye17uC4Sac/zzDl7NzNTbb33MYY7zzulItLWWvMzxmjv2tvb9juOG4ByVrNeiqoqs+QstVYXQvQhlVJqrapKlBE5RkqJROQPi8qMqTGUpDMAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=299 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-17.2780621.640.png srcset="/assets/ideal-img/image-17.2780621.640.png 640w,/assets/ideal-img/image-17.f0711f7.917.png 917w" alt=不同传输模式支持的操作类型对照表 width=640 height=299></noscript></div>
<p>下面是传输层的 <code>Base Transport Header</code> 的结构，长度为 <code>12</code> 字节，指定了源 <code>QP</code> 和 目标 <code>QP</code>、操作、数据包序列号和分区。</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAIAAADuA9qHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQUlEQVR4nAXBQQoAIQgAwP7/REVbkJKWFSHykF52ppkZABAR89O7rPWOMUREVd29RQQzI+I5FXHNvjnn3ruqMvMHhcE2vaTh6d0AAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=142 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-18.5d755f3.640.png srcset="/assets/ideal-img/image-18.5d755f3.640.png 640w,/assets/ideal-img/image-18.5d0e72a.1437.png 1437w" alt=InfiniBand传输层BTH报头结构 width=640 height=142></noscript></div>
<ul>
<li><code>Partition Key</code>：<code>InfiniBand</code> 中每个端口 <code>Device</code> 都有一个由 <code>SM</code> 配置 <code>P_Key</code> 表，每个 <code>QP</code> 都与这个表中的一个 <code>P_Key</code> 索引相关联。只有当两个 <code>QP</code> 相关联的 <code>P_Key</code> 键值相同时，它们才能互相收发数据包。</li>
<li><code>Destination QP</code>：<code>24 bit</code> 的目标 <code>QP ID</code>。</li>
</ul>
<p>根据传输层的服务类别和操作，有不定长度的扩展传输报头(<code>Extended Transport Header</code>，<code>ETH</code>)，比如下面是进行时候的 <code>ETH</code>：</p>
<p>下面是 <code>RDMA ETH</code>，面向于 <code>RDMA</code> 操作：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAIAAADuA9qHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPUlEQVR4nB3BMQ4AQQQAwP3/D0VBgkJCQRRnq01u5pgZM4uIuyMiABCRu6tqRJzM7O577+5WFSLOzO5+vweKjzcJ8ocgxwAAAABJRU5ErkJggg==")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=126 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-19.1541524.640.png srcset="/assets/ideal-img/image-19.1541524.640.png 640w,/assets/ideal-img/image-19.4cf80ee.889.png 889w" alt=RDMA扩展传输报头RETH结构 width=640 height=126></noscript></div>
<p>下面是 <code>Datagram ETH</code>，面向与 <code>UD</code> 和 <code>RD</code> 类型的服务：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAIAAABol6gpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJklEQVR4nAXBwQkAMBACsO4/piKC+rgRmrwkAEi2tS2J5LYkd/cBoyMbLkmFvWUAAAAASUVORK5CYII=")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=86 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-20.107825a.640.png srcset="/assets/ideal-img/image-20.107825a.640.png 640w,/assets/ideal-img/image-20.cba1ce1.896.png 896w" alt=Datagram扩展传输报头DETH结构 width=640 height=86></noscript></div>
<ul>
<li><code>Queue Key</code>：仅当两个不可靠 <code>QP</code> 的 <code>Q_Key</code> 相同时，它们才能接受对方的单播或组播消息，用于授权访问目标 <code>QP</code> 的 <code>Queue</code>。</li>
<li><code>Source QP</code>：<code>24 bit</code> 的 <code>source QP ID</code>，用于回复数据包的 <code>Destination QP</code></li>
</ul>
<p>下面是 <code>Reliable Datagram ETH</code>，面向于 <code>RC</code> 类型的服务，其中有 <code>End2End Context</code> 字段：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAIAAABol6gpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJElEQVR4nAXBsQ0AMAzDsP5/o7wZhoYcUfJtA5KobVVA3XZ3H5vrGrwtVMq5AAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=67 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-21.3993e57.640.png srcset="/assets/ideal-img/image-21.3993e57.640.png 640w,/assets/ideal-img/image-21.6ad4172.875.png 875w" alt=可靠数据报扩展传输报头RDETH结构 width=640 height=67></noscript></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=roce>RoCE<a href=#roce class=hash-link aria-label="Direct link to RoCE" title="Direct link to RoCE">​</a></h3>
<p><code>InfiniBand</code> 架构获得了极好的性能，但是其不仅要求在服务器上安装专门的 <code>InfiniBand</code> 网卡，还需要专门的交换机硬件，成本十分昂贵。而在企业界大量部署的是以太网络，为了复用现有的以太网，同时获得 <code>InfiniBand</code> 强大的性能，<code>IBTA</code> 组织推出了 <code>RoCE</code>（<code>RDMA over Converged Ethernet</code>）。<code>RoCE</code> 支持在以太网上承载 <code>IB</code> 协议，实现 <code>RDMA over Ethernet</code>，这样一来，仅需要在服务器上安装支持 <code>RoCE</code> 的网卡，而在交换机和路由器仍然使用标准的以太网基础设施。网络侧需要支持<strong>无损以太网络</strong>，这是由于 <code>IB</code> 的丢包处理机制中，任意一个报文的丢失都会造成大量的重传，严重影响数据传输性能。</p>
<p><code>RoCE</code> 与 <code>InfiniBand</code> 技术有相同的软件应用层及传输控制层，仅网络层及以太网链路层存在差异，如下图所示：</p>
<div style='background-size:cover;background-repeat:no-repeat;position:relative;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAIAAAA4WjmaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAh0lEQVR4nAF8AIP/AOjw8om2wn6vwbXKuefktdvctOThtbLLwt/o7v37+gD9/v7x9fPd4sDk5r/i4rrf37jg4Lje4L3p6ub7+/wA+Pv82unry9vJ4+fF6ejB5ubB6OfA2eDE7O/u/f39AOfv8ZS/ypG9zszaxOjmveHivunmvcDUyt/o7vz6+YXaZjPgzA1MAAAAAElFTkSuQmCC")'><svg style=width:100%;height:auto;max-width:100%;margin-bottom:-4px width=640 height=241 /><noscript><img style=width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0 src=/assets/ideal-img/image-22.4fc33e2.640.png srcset="/assets/ideal-img/image-22.4fc33e2.640.png 640w,/assets/ideal-img/image-22.f52498c.1447.png 1447w" alt=RoCE与InfiniBand协议栈对比 width=640 height=241></noscript></div>
<p><code>RoCE</code>协议分为两个版本：</p>
<ul>
<li><strong>RoCE v1协议：</strong> 基于以太网承载 <code>RDMA</code>，只能部署于二层网络，它的报文结构是在原有的 <code>IB</code> 架构的报文上增加二层以太网的报文头，通过 <code>Ethertype</code> <code>0x8915</code>标识 <code>RoCE</code> 报文。</li>
<li><strong>RoCE v2协议：</strong> 基于 <code>UDP/IP</code> 协议承载 <code>RDMA</code>，可部署于三层网络，它的报文结构是在原有的 <code>IB</code> 架构的报文上增加 <code>UDP</code> 头、<code>IP</code> 头和二层以太网报文头，通过 <code>UDP</code> 目的端口号 <code>4791</code> 标 识 <code>RoCE</code> 报文。<code>RoCE v2</code> 支持基于源端口号 <code>hash</code>，采用 <code>ECMP</code> 实现负载分担，提高了网络的利用率。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=iwarp>iWARP<a href=#iwarp class=hash-link aria-label="Direct link to iWARP" title="Direct link to iWARP">​</a></h3>
<p><code>iWARP</code> 从以下几个方面降低了主机侧网络负载：</p>
<ul>
<li><code>TCP/IP</code> 处理流程从 <code>CPU</code> 卸载到 <code>RDMA</code> 网卡处理，降低了 <code>CPU</code> 负载。</li>
<li>消除内存拷贝：应用程序可以直接将数据传输到对端应用程序内存中，显著降低 <code>CPU</code> 负载。</li>
<li>减少应用程序上、下文切换：应用程序可以绕过操作系统，直接在用户空间对 <code>RDMA</code> 网卡下发命令，降低了开销，显著降低了应用程序上、下文切换造成的延迟。</li>
</ul>
<p>由于 <code>TCP</code> 协议能够提供流量控制和拥塞管理，因此 <code>iWARP</code> 不需要以太网支持无损传输，仅通过普通以太网交换机和 <code>iWARP</code> 网卡即可实现，因此能够在广域网上应用，具有较好的扩展性。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://www.cnblogs.com/bandaoyu/p/16752034.html target=_blank rel="noopener noreferrer">https://www.cnblogs.com/bandaoyu/p/16752034.html</a></li>
<li><a href=https://houmin.cc/posts/454a90d3/ target=_blank rel="noopener noreferrer">https://houmin.cc/posts/454a90d3/</a></li>
<li><a href=https://www.mellanox.com/pdf/whitepapers/IB_Intro_WP_190.pdf target=_blank rel="noopener noreferrer">Introduction to InfiniBand White Paper</a></li>
<li><a href=https://www.snia.org/sites/default/files/files2/files2/SDC2013/presentations/Hardware/DavidDeming_Infiniband_Architectural_Overview.pdf target=_blank rel="noopener noreferrer">InfiniBand Architecture Overview</a></li>
<li><a href=https://www.afs.enea.it/asantoro/V1r1_2_1.Release_12062007.pdf target=_blank rel="noopener noreferrer">InfiniBand Architecture Specification Release 1.2.1</a></li>
<li><a href=https://zcopy.wordpress.com/2010/10/08/quick-concepts-part-1-%E2%80%93-introduction-to-rdma/ target=_blank rel="noopener noreferrer">Introduction to RDMA</a></li>
<li><a href=https://www.mellanox.com/related-docs/prod_software/RDMA_Aware_Programming_user_manual.pdf target=_blank rel="noopener noreferrer">RDMA Aware Network Programming User Manual</a></li>
<li><a href=https://github.com/jcxue/RDMA-Tutorial target=_blank rel="noopener noreferrer">RDMA-Tutorial</a></li>
<li><a href=http://www.rdmamojo.com/ target=_blank rel="noopener noreferrer">RDMA Mojo Blog</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/rdma><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>RDMA</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/rdma-infiniband-vs-roce><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>InfiniBand vs RoCE</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#技术背景 class="table-of-contents__link toc-highlight">技术背景</a><li><a href=#tcp-offloading-engine class="table-of-contents__link toc-highlight">TCP Offloading Engine</a><li><a href=#rdmaremote-direct-memroy-access class="table-of-contents__link toc-highlight">RDMA(Remote Direct Memroy Access)</a><ul><li><a href=#io-瓶颈 class="table-of-contents__link toc-highlight">I/O 瓶颈</a><li><a href=#架构组成 class="table-of-contents__link toc-highlight">架构组成</a><li><a href=#分层设计 class="table-of-contents__link toc-highlight">分层设计</a><li><a href=#roce class="table-of-contents__link toc-highlight">RoCE</a><li><a href=#iwarp class="table-of-contents__link toc-highlight">iWARP</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>