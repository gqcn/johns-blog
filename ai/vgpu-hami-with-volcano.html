<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/vGPU/HAMi With Volcano" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>HAMi With Volcano | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/vgpu-hami-with-volcano><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="HAMi With Volcano | John's Blog"><meta data-rh=true name=description content="深入解析Volcano vGPU的完整执行流程和技术原理，包括deviceshare插件调度机制、Device Plugin资源分配、HAMi Core库注入方式（LD_LIBRARY_PATH vs LD_PRELOAD）、与独立HAMi部署的架构对比，以及Prometheus监控指标详解。基于源码分析，提供完整的组件交互流程图。"><meta data-rh=true property=og:description content="深入解析Volcano vGPU的完整执行流程和技术原理，包括deviceshare插件调度机制、Device Plugin资源分配、HAMi Core库注入方式（LD_LIBRARY_PATH vs LD_PRELOAD）、与独立HAMi部署的架构对比，以及Prometheus监控指标详解。基于源码分析，提供完整的组件交互流程图。"><meta data-rh=true name=keywords content="Volcano vGPU,deviceshare插件,HAMi Core,LD_LIBRARY_PATH注入,GPU调度流程,volcano-vgpu-device-plugin,Prometheus监控,binpack调度,CUDA API劫持,NVIDIA Runtime"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/vgpu-hami-with-volcano><link data-rh=true rel=alternate href=https://johng.cn/ai/vgpu-hami-with-volcano hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/vgpu-hami-with-volcano hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.b3f7724c.css><script src=/assets/js/runtime~main.29b9380d.js defer></script><script src=/assets/js/main.e9cac1b4.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" sidebarid=mainSidebar href=/ai>AI技术</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/cloud-native>云原生</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/notes>日常笔记</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/programming>开发语言</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/architecture>技术架构</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/observability>可观测性</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/life>生活笔记</a><a class="navbar__item navbar__link" href=/aboutme>关于我</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/nvidia>NVIDIA</a><button aria-label="Expand sidebar category 'NVIDIA'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/distributed-inference>分布式推理</a><button aria-label="Expand sidebar category '分布式推理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/scheduling>算力资源调度</a><button aria-label="Expand sidebar category '算力资源调度'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/rdma>RDMA</a><button aria-label="Expand sidebar category 'RDMA'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/vgpu>vGPU</a><button aria-label="Collapse sidebar category 'vGPU'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/vgpu-survey>vGPU方案调研</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/vgpu-hami>HAMi vGPU调研</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/vgpu-hami-with-volcano>HAMi With Volcano</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/vgpu-hami-test-with-volcano>HAMi Volcano安装测试</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/vgpu-hami-cuda-driver-api>HAMi CUDA Driver API</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-acceleration-cards>常见智算加速卡汇总</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/general-ai-model-and-reasoning-ai-model-difference>通用大模型和推理大模型区别</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-ai-model-training-inference-framework>常见AI模型训练推理框架对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ai-training-inference-scenarios>AI模型训练推理常见业务场景痛点</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/vgpu><span itemprop=name>vGPU</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>HAMi With Volcano</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><code>Volcano</code>原生支持<code>HAMi vGPU</code>，但需要启用对应的<code>deviceshare</code> 插件。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-volcano调度器配置>1. Volcano调度器配置<a href=#1-volcano调度器配置 class=hash-link aria-label="Direct link to 1. Volcano调度器配置" title="Direct link to 1. Volcano调度器配置">​</a></h2>
<p>具体配置如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_Ktv7>volcano-scheduler.conf</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">actions</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"enqueue, allocate, backfill"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">tiers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> priority</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> conformance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">plugins</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> drf</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> deviceshare</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">arguments</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 是否启用vgpu特性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">deviceshare.VGPUEnable</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#ae81ff>true</span><span class="token plain"> </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># volcano-vgpu-device-config这个ConfigMap对应的命名空间</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># 便于调度器自动读取ConfigMap内容</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">deviceshare.KnownGeometriesCMNamespace</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">system </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> predicates</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> proportion</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nodeorder</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> binpack</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>同时需要替换<code>NVIDIA Device Plugin</code>为 <a href=https://github.com/Project-HAMi/volcano-vgpu-device-plugin target=_blank rel="noopener noreferrer">https://github.com/Project-HAMi/volcano-vgpu-device-plugin</a> ，具体参考：<a href=https://project-hami.io/zh/docs/userguide/volcano-vgpu/NVIDIA-GPU/how-to-use-volcano-vgpu target=_blank rel="noopener noreferrer">https://project-hami.io/zh/docs/userguide/volcano-vgpu/NVIDIA-GPU/how-to-use-volcano-vgpu</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-volcano-vgpu执行流程>2. Volcano vGPU执行流程<a href=#2-volcano-vgpu执行流程 class=hash-link aria-label="Direct link to 2. Volcano vGPU执行流程" title="Direct link to 2. Volcano vGPU执行流程">​</a></h2>
<p><code>Volcano + HAMi vGPU</code>的完整执行流程涉及多个组件的协同工作，从<code>Pod</code>创建到最终运行在节点上，经历了以下关键步骤：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=21-组件交互概要>2.1 组件交互概要<a href=#21-组件交互概要 class=hash-link aria-label="Direct link to 2.1 组件交互概要" title="Direct link to 2.1 组件交互概要">​</a></h3>
<p>以下是<code>Volcano vGPU</code>资源使用的大致交互时序图，包含了关键的几个组件之间的交互。</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=22-详细交互流程>2.2 详细交互流程<a href=#22-详细交互流程 class=hash-link aria-label="Direct link to 2.2 详细交互流程" title="Direct link to 2.2 详细交互流程">​</a></h3>
<p>以下是通过梳理<code>Volcano</code>及<code>volcano-vgpu-device-plugin</code>源码得到的完整执行流程。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=221-阶段1pod创建>2.2.1 阶段1：Pod创建<a href=#221-阶段1pod创建 class=hash-link aria-label="Direct link to 2.2.1 阶段1：Pod创建" title="Direct link to 2.2.1 阶段1：Pod创建">​</a></h4>
<ol>
<li><strong>用户创建Pod</strong>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> vgpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">test</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">schedulerName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> volcano  </span><span class="token comment" style=color:#8292a2;font-style:italic># 指定使用 Volcano 调度器</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cuda</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">app</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nvidia/cuda</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">11.0</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">base</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">volcano.sh/vgpu-number</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># 请求 2 张 GPU 卡</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">volcano.sh/vgpu-memory</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3000</span><span class="token plain">     </span><span class="token comment" style=color:#8292a2;font-style:italic># （可选）每个 vGPU 使用 3G 显存</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">volcano.sh/vgpu-cores</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>50</span><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic># （可选）每个 vGPU 使用 50% 核心</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=222-阶段2调度器调度>2.2.2 阶段2：调度器调度<a href=#222-阶段2调度器调度 class=hash-link aria-label="Direct link to 2.2.2 阶段2：调度器调度" title="Direct link to 2.2.2 阶段2：调度器调度">​</a></h4>
<ol start=2>
<li>
<p><strong>Volcano Scheduler接收调度请求</strong></p>
<ul>
<li><code>Scheduler</code>从<code>API Server</code>获取待调度的<code>Pod</code></li>
<li>初始化调度会话（<code>Session</code>），注册<code>deviceshare</code>插件的预选和打分函数</li>
</ul>
</li>
<li>
<p><strong>deviceshare插件预选（Predicate）</strong></p>
<p><strong>核心逻辑</strong>（<code>deviceshare.go:125-162</code>）：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 遍历所有注册的设备类型（vGPU/GPU-Share等）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> val </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">RegisteredDevices </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> dev</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> ok </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Others</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">val</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Devices</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> ok </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#8292a2;font-style:italic>// 调用vGPU的FilterNode方法</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        code</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> msg</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> dev</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>FilterNode</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">schedulePolicy</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> api</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>NewFitErrWithStatus</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> predicateStatus</span><span class="token operator" style=color:#66d9ef>...</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>vGPU预选检查</strong>（<code>device_info.go:247-259</code>）：</p>
<ul>
<li>调用<code>checkNodeGPUSharingPredicateAndScore</code>函数执行资源匹配</li>
<li>检查节点<code>Annotation</code>中的设备注册信息（<code>volcano.sh/node-vgpu-register</code>）</li>
<li>遍历节点所有<code>GPU</code>设备，逐一检查是否满足<code>Pod</code>请求：<!-- -->
<ul>
<li>显存是否充足：<code>device.Memory - device.UsedMem >= request.Memreq</code></li>
<li>算力是否充足：<code>device.UsedCore + request.Coresreq &lt;= 100</code></li>
<li>设备类型是否匹配（<code>NVIDIA</code>/<code>AMD</code>/昇腾等）</li>
<li>独占模式检查：<code>Coresreq=100</code>时设备不能被其他<code>Pod</code>占用</li>
</ul>
</li>
<li>将匹配结果缓存到<code>gs.Score</code>，避免打分阶段重复计算</li>
</ul>
</li>
<li>
<p><strong>deviceshare插件打分（Score）</strong></p>
<p><strong>核心逻辑</strong>（<code>deviceshare.go:164-179</code>）：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 计算节点设备得分</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">score</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> status </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getDeviceScore</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>TODO</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> task</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Pod</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> node</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">schedulePolicy</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">nodeScore </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">score</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>float64</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">dp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">scheduleWeight</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>vGPU打分策略</strong>（<code>utils.go:440-453</code>）：</p>
<ul>
<li><strong>binpack模式</strong>：<code>score = 10 * (UsedMem / TotalMem)</code>，优先选择资源使用率高的节点</li>
<li><strong>spread模式</strong>：<code>score = 10</code>（仅当设备已被<code>1</code>个<code>Pod</code>使用时），优先选择资源分散的节点</li>
<li>直接返回预选阶段缓存的<code>gs.Score</code>，无需重复计算</li>
</ul>
</li>
<li>
<p><strong>调度决策与资源分配</strong></p>
<p><strong>Allocate阶段</strong>（<code>device_info.go:261-295</code>）：</p>
<ul>
<li>选择得分最高的节点</li>
<li>调用<code>Allocate</code>方法执行资源分配</li>
<li>更新<code>Pod Annotation</code>，记录分配的设备信息：<!-- -->
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">volcano.sh/vgpu-node</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> dev</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">app</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">2</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">150</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">master</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">volcano.sh/vgpu-time</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"18446744073709551615"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">volcano.sh/vgpu-ids-new</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'GPU-uuid1,NVIDIA,3000,50:GPU-uuid2,NVIDIA,3000,50:'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">volcano.sh/bind-phase</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> allocating</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>将<code>Pod</code>绑定到目标节点</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=223-阶段3device-plugin分配>2.2.3 阶段3：Device Plugin分配<a href=#223-阶段3device-plugin分配 class=hash-link aria-label="Direct link to 2.2.3 阶段3：Device Plugin分配" title="Direct link to 2.2.3 阶段3：Device Plugin分配">​</a></h4>
<ol start=6>
<li>
<p><strong>Device Plugin Allocate</strong>（<code>plugin.go:416-515</code>）</p>
<p><strong>核心逻辑</strong>：</p>
<ul>
<li><code>Kubelet</code>检测到<code>Pod</code>被调度到本节点，调用<code>Allocate</code>方法</li>
<li>从<code>Pod Annotation</code>读取<code>Volcano</code>分配的设备信息（<code>volcano.sh/vgpu-ids-new</code>）</li>
<li>注入容器环境变量（<code>plugin.go:460-476</code>）：<!-- -->
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>// 设置GPU可见性</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">response</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Envs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"NVIDIA_VISIBLE_DEVICES"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> strings</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Join</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">m</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>GetContainerDeviceStrArray</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">devreq</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>","</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// 为每个vGPU设置显存限制</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> i</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dev </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>range</span><span class="token plain"> devreq </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    limitKey </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprintf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"CUDA_DEVICE_MEMORY_LIMIT_%v"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> i</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    response</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Envs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">limitKey</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprintf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"%vm"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dev</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Usedmem</span><span class="token operator" style=color:#66d9ef>*</span><span class="token function" style=color:#e6db74>int32</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">config</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">GPUMemoryFactor</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>// 设置算力限制（如果Pod未指定volcano.sh/vgpu-cores，则为0，表示不限制算力）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">response</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Envs</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token string" style=color:#a6e22e>"CUDA_DEVICE_SM_LIMIT"</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprint</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">devreq</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Usedcores</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>挂载<code>vGPU</code>库和配置文件（<code>plugin.go:485-508</code>）：<!-- -->
<ul>
<li><code>/usr/local/vgpu/libvgpu.so</code>：<code>CUDA API</code>劫持库</li>
<li><code>/etc/ld.so.preload</code>：预加载配置（内容为<code>/usr/local/vgpu/libvgpu.so</code>）</li>
<li><code>/tmp/vgpu</code>：缓存目录</li>
<li><code>/tmp/vgpulock</code>：进程锁目录</li>
</ul>
</li>
<li>返回<code>ContainerAllocateResponse</code>给<code>Kubelet</code></li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=224-阶段4容器启动>2.2.4 阶段4：容器启动<a href=#224-阶段4容器启动 class=hash-link aria-label="Direct link to 2.2.4 阶段4：容器启动" title="Direct link to 2.2.4 阶段4：容器启动">​</a></h4>
<ol start=7>
<li>
<p><strong>Container Runtime处理</strong></p>
<ul>
<li><code>Kubelet</code>将环境变量和挂载信息传递给容器运行时</li>
<li>挂载<code>GPU</code>设备文件（<code>/dev/nvidia*</code>）</li>
<li>挂载<code>NVIDIA</code>驱动库，并设置<code>LD_LIBRARY_PATH</code>环境变量</li>
<li>挂载<code>/etc/ld.so.preload</code>文件（内容为<code>/usr/local/vgpu/libvgpu.so</code>）</li>
<li>容器启动时，动态链接器读取<code>/etc/ld.so.preload</code>文件，强制预加载<code>libvgpu.so</code></li>
<li><code>libvgpu.so</code>从环境变量读取<code>CUDA_DEVICE_MEMORY_LIMIT_*</code>和<code>CUDA_DEVICE_SM_LIMIT</code>，初始化资源限制</li>
</ul>
<p><strong>注意</strong>：这里使用的是<code>/etc/ld.so.preload</code><strong>文件</strong>而非<code>LD_PRELOAD</code><strong>环境变量</strong>。通过<code>env</code>命令看不到<code>LD_PRELOAD</code>，但可以通过<code>cat /etc/ld.so.preload</code>查看预加载配置。</p>
<p><strong>两种预加载机制对比：</strong></p>
<table><thead><tr><th>特性<th>/etc/ld.so.preload文件<th>LD_PRELOAD环境变量<tbody><tr><td>类型<td>配置文件<td>环境变量<tr><td><code>env</code>可见<td>❌ 不可见<td>✅ 可见<tr><td>查看方式<td><code>cat /etc/ld.so.preload</code><td><code>echo $LD_PRELOAD</code><tr><td>作用范围<td>系统级，所有进程<td>进程级，继承环境变量<tr><td><code>Volcano vGPU</code><td>✅ 使用<td>❌ 不使用<tr><td><code>HAMI</code>独立部署<td>❌ 不使用<td>✅ 使用</table>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=225-阶段5应用运行>2.2.5 阶段5：应用运行<a href=#225-阶段5应用运行 class=hash-link aria-label="Direct link to 2.2.5 阶段5：应用运行" title="Direct link to 2.2.5 阶段5：应用运行">​</a></h4>
<ol start=8>
<li>
<p><strong>CUDA API劫持与资源限制</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">应用调用 cuMemAlloc(3000MB)</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">     ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">libvgpu.so 劫持（通过 /etc/ld.so.preload）</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">     ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">检查 CUDA_DEVICE_MEMORY_LIMIT_0=3000m（显存限制）</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">     ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">检查 CUDA_DEVICE_SM_LIMIT=50（算力限制）</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">     ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">调用真实 CUDA Driver API</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">     ↓</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">返回结果给应用</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-volcano-vgpu与hami独立部署的区别>3. Volcano vGPU与HAMi独立部署的区别<a href=#3-volcano-vgpu与hami独立部署的区别 class=hash-link aria-label="Direct link to 3. Volcano vGPU与HAMi独立部署的区别" title="Direct link to 3. Volcano vGPU与HAMi独立部署的区别">​</a></h2>
<table><thead><tr><th>对比项<th>独立HAMi<th>Volcano + HAMi<tbody><tr><td><strong>调度器</strong><td><code>Kubernetes Default Scheduler</code> + <code>HAMi Scheduler Extender</code><td><code>Volcano Scheduler</code><tr><td><strong>Webhook</strong><td><code>HAMi Mutating Webhook</code><td><code>Volcano Mutating Webhook</code><tr><td><strong>资源名称</strong><td><code>nvidia.com/gpu</code>、<code>nvidia.com/gpumem</code><td><code>volcano.sh/vgpu-number</code>、<code>volcano.sh/vgpu-memory</code><tr><td><strong>调度插件</strong><td><code>Scheduler Extender</code>（外部扩展）<td><code>deviceshare Plugin</code>（内置插件）<tr><td><strong>设备分配</strong><td><code>HAMi Device Plugin</code><td><code>volcano-vgpu-device-plugin</code><tr><td><strong>环境变量注入</strong><td><code>Webhook</code>注入<td><code>Device Plugin Allocate</code>注入</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-volcano-vgpu监控指标>4. Volcano vGPU监控指标<a href=#4-volcano-vgpu监控指标 class=hash-link aria-label="Direct link to 4. Volcano vGPU监控指标" title="Direct link to 4. Volcano vGPU监控指标">​</a></h2>
<p><code>Volcano Scheduler</code>在调度<code>vGPU</code>资源时会暴露<code>Prometheus</code>监控指标，用于观测<code>GPU</code>设备的分配和使用情况。这些指标定义在 <code>pkg/scheduler/api/devices/nvidia/vgpu/metrics.go</code> 中。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=41-设备级指标>4.1 设备级指标<a href=#41-设备级指标 class=hash-link aria-label="Direct link to 4.1 设备级指标" title="Direct link to 4.1 设备级指标">​</a></h3>
<table><thead><tr><th>指标名称<th>类型<th>标签<th>说明<th>单位<tbody><tr><td><code>volcano_vgpu_device_memory_limit</code><td><code>Gauge</code><td><code>devID</code>, <code>NodeName</code><td><code>GPU</code>卡的总显存容量<td><code>MB</code><tr><td><code>volcano_vgpu_device_allocated_memory</code><td><code>Gauge</code><td><code>devID</code>, <code>NodeName</code><td><code>GPU</code>卡已分配的显存总量<td><code>MB</code><tr><td><code>volcano_vgpu_device_allocated_cores</code><td><code>Gauge</code><td><code>devID</code>, <code>NodeName</code><td><code>GPU</code>卡已分配的算力百分比<td><code>% (0-100)</code><tr><td><code>volcano_vgpu_device_shared_number</code><td><code>Gauge</code><td><code>devID</code>, <code>NodeName</code><td>共享此 <code>GPU</code>卡的<code>Pod</code>数量<td><code>个</code></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=42-pod-级指标>4.2 Pod 级指标<a href=#42-pod-级指标 class=hash-link aria-label="Direct link to 4.2 Pod 级指标" title="Direct link to 4.2 Pod 级指标">​</a></h3>
<table><thead><tr><th>指标名称<th>类型<th>标签<th>说明<th>单位<tbody><tr><td><code>volcano_vgpu_device_memory_allocation_for_a_certain_pod</code><td><code>Gauge</code><td><code>devID</code>, <code>NodeName</code>, <code>podName</code><td>特定<code>Pod</code>在此<code>GPU</code>卡上分配的显存<td><code>MB</code><tr><td><code>volcano_vgpu_device_core_allocation_for_a_certain_pod</code><td><code>Gauge</code><td><code>devID</code>, <code>NodeName</code>, <code>podName</code><td>特定<code>Pod</code>在此<code>GPU</code>卡上分配的算力<td><code>% (0-100)</code></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=43-常用-promql-查询示例>4.3 常用 PromQL 查询示例<a href=#43-常用-promql-查询示例 class=hash-link aria-label="Direct link to 4.3 常用 PromQL 查询示例" title="Direct link to 4.3 常用 PromQL 查询示例">​</a></h3>
<ol>
<li>
<p><strong>查看节点上所有 GPU 卡的显存使用率</strong>：</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">volcano_vgpu_device_allocated_memory / volcano_vgpu_device_memory_limit * 100</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>查看 GPU 卡的平均共享数</strong>：</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">avg(volcano_vgpu_device_shared_number) by (NodeName)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>查看特定节点上 GPU 算力分配情况</strong>：</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">volcano_vgpu_device_allocated_cores{NodeName="node-1"}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>查看特定 Pod 的 GPU 显存分配</strong>：</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">volcano_vgpu_device_memory_allocation_for_a_certain_pod{podName="my-training-pod"}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>统计集群中 GPU 卡的总显存利用率</strong>：</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">sum(volcano_vgpu_device_allocated_memory) / sum(volcano_vgpu_device_memory_limit) * 100</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=44-指标访问方式>4.4 指标访问方式<a href=#44-指标访问方式 class=hash-link aria-label="Direct link to 4.4 指标访问方式" title="Direct link to 4.4 指标访问方式">​</a></h3>
<p><code>Volcano Scheduler</code>默认在 <code>:8080/metrics</code> 端点暴露<code>Prometheus</code>监控指标。可以通过以下方式访问：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 直接访问 Scheduler Pod</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl port-forward </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> volcano-system svc/volcano-scheduler </span><span class="token number" style=color:#ae81ff>8080</span><span class="token plain">:8080</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>curl</span><span class="token plain"> http://localhost:8080/metrics </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>grep</span><span class="token plain"> volcano_vgpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 或配置 Prometheus 自动采集</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 在 Prometheus 配置中添加 Volcano Scheduler 的 ServiceMonitor</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=45-指标参考数据>4.5 指标参考数据<a href=#45-指标参考数据 class=hash-link aria-label="Direct link to 4.5 指标参考数据" title="Direct link to 4.5 指标参考数据">​</a></h3>
<p>指标文件：<a href=/assets/files/volcano-vgpu-metrics-3ddb1dcc752b3015e00d18c2dd31969c.txt target=_blank>volcano-vgpu-metrics.txt</a></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/vgpu-hami><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>HAMi vGPU调研</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/vgpu-hami-test-with-volcano><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>HAMi Volcano安装测试</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-volcano调度器配置 class="table-of-contents__link toc-highlight">1. Volcano调度器配置</a><li><a href=#2-volcano-vgpu执行流程 class="table-of-contents__link toc-highlight">2. Volcano vGPU执行流程</a><ul><li><a href=#21-组件交互概要 class="table-of-contents__link toc-highlight">2.1 组件交互概要</a><li><a href=#22-详细交互流程 class="table-of-contents__link toc-highlight">2.2 详细交互流程</a><ul><li><a href=#221-阶段1pod创建 class="table-of-contents__link toc-highlight">2.2.1 阶段1：Pod创建</a><li><a href=#222-阶段2调度器调度 class="table-of-contents__link toc-highlight">2.2.2 阶段2：调度器调度</a><li><a href=#223-阶段3device-plugin分配 class="table-of-contents__link toc-highlight">2.2.3 阶段3：Device Plugin分配</a><li><a href=#224-阶段4容器启动 class="table-of-contents__link toc-highlight">2.2.4 阶段4：容器启动</a><li><a href=#225-阶段5应用运行 class="table-of-contents__link toc-highlight">2.2.5 阶段5：应用运行</a></ul></ul><li><a href=#3-volcano-vgpu与hami独立部署的区别 class="table-of-contents__link toc-highlight">3. Volcano vGPU与HAMi独立部署的区别</a><li><a href=#4-volcano-vgpu监控指标 class="table-of-contents__link toc-highlight">4. Volcano vGPU监控指标</a><ul><li><a href=#41-设备级指标 class="table-of-contents__link toc-highlight">4.1 设备级指标</a><li><a href=#42-pod-级指标 class="table-of-contents__link toc-highlight">4.2 Pod 级指标</a><li><a href=#43-常用-promql-查询示例 class="table-of-contents__link toc-highlight">4.3 常用 PromQL 查询示例</a><li><a href=#44-指标访问方式 class="table-of-contents__link toc-highlight">4.4 指标访问方式</a><li><a href=#45-指标参考数据 class="table-of-contents__link toc-highlight">4.5 指标参考数据</a></ul></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>