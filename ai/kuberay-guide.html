<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/训练微调/Ray分布式计算引擎/KubeRay基本介绍与使用" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>KubeRay基本介绍与使用 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/kuberay-guide><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="KubeRay基本介绍与使用 | John's Blog"><meta data-rh=true name=description content="全面介绍KubeRay的核心概念、架构设计和使用方法。KubeRay是运行在Kubernetes上的开源Ray Operator，用于简化Ray应用的部署和管理。本文详细讲解KubeRay的三大核心组件RayCluster、RayJob和RayService的特点和应用场景，介绍如何通过Helm快速安装和配置KubeRay，并提供完整的运行示例，帮助读者快速上手并掌握KubeRay在机器学习训练、推理和服务部署等场景中的实际应用，实现云原生环境下的分布式计算。"><meta data-rh=true property=og:description content="全面介绍KubeRay的核心概念、架构设计和使用方法。KubeRay是运行在Kubernetes上的开源Ray Operator，用于简化Ray应用的部署和管理。本文详细讲解KubeRay的三大核心组件RayCluster、RayJob和RayService的特点和应用场景，介绍如何通过Helm快速安装和配置KubeRay，并提供完整的运行示例，帮助读者快速上手并掌握KubeRay在机器学习训练、推理和服务部署等场景中的实际应用，实现云原生环境下的分布式计算。"><meta data-rh=true name=keywords content="KubeRay,Ray,Kubernetes,分布式计算,机器学习,AI训练,RayCluster,RayJob,RayService,Kubernetes Operator,云原生,Ray Serve,模型部署,批量推理,分布式训练,资源管理,弹性伸缩,容器编排,集群管理,高可用性"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/kuberay-guide><link data-rh=true rel=alternate href=https://johng.cn/ai/kuberay-guide hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/kuberay-guide hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.d14e1eeb.css><script src=/assets/js/runtime~main.7816b8b8.js defer></script><script src=/assets/js/main.4c5f7df7.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/agents-deep-dive-from-llm-to-autonomous-agents>智能体</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/copilot-skills-guide>应用开发</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/online-offline-batch-inference>推理服务</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/hpc-development-training-platform>训练微调</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/hpc-development-training-platform>开发训练平台</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/pytorch-intro>开发训练框架</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/kubeflow-trainer-in-hpc>Kubeflow Trainer</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/ai/ray-distributed-computing>Ray分布式计算引擎</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ray-distributed-computing>Ray分布式计算引擎介绍</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/kuberay-guide>KubeRay基本介绍与使用</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/kuberay-rayjob-configuration>KubeRay RayJob配置详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/volcano-ray-plugin>通过Volcano Job插件部署使用Ray Cluster</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/machine-learning-fundamentals>AI模型与机器学习</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/training>AI模型训练技术详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/fine-tuning>AI模型微调技术详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/training-parallel-strategies>AI模型训练并行策略介绍</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/model-development>模型开发</a><button aria-label="Expand sidebar category '模型开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/rdma-brief>基础架构</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/ai/basic-terminology>入门知识</a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统��和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li class=breadcrumbs__item><span class=breadcrumbs__link>训练微调</span><meta itemprop=position content=2><li class=breadcrumbs__item><span class=breadcrumbs__link>Ray分布式计算引擎</span><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>KubeRay基本介绍与使用</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=kuberay基本介绍>KubeRay基本介绍<a href=#kuberay基本介绍 class=hash-link aria-label="Direct link to KubeRay基本介绍" title="Direct link to KubeRay基本介绍">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=什么是kuberay>什么是KubeRay<a href=#什么是kuberay class=hash-link aria-label="Direct link to 什么是KubeRay" title="Direct link to 什么是KubeRay">​</a></h3>
<p><code>KubeRay</code>是一个强大的开源<code>Kubernetes Operator</code>，用于简化<code>Ray</code>应用在<code>Kubernetes</code>上的部署和管理。<code>Ray</code>是一个用于构建和运行分布式应用程序的统一框架，特别适合机器学习工作负载，而<code>KubeRay</code>则将<code>Ray</code>的强大能力与<code>Kubernetes</code>的云原生特性完美结合。</p>
<p><strong>通俗理解</strong>：如果把<code>Ray</code>比作一个强大的分布式计算引擎，那么<code>KubeRay</code>就是让这个引擎能够在<code>Kubernetes</code>这个云原生平台上平稳运行的"管家"。它负责自动创建、管理和维护<code>Ray</code>集群，让开发者可以专注于编写分布式应用代码，而无需担心底层的集群管理问题。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=kuberay解决的核心问题>KubeRay解决的核心问题<a href=#kuberay解决的核心问题 class=hash-link aria-label="Direct link to KubeRay解决的核心问题" title="Direct link to KubeRay解决的核心问题">​</a></h3>
<p>在<code>Kubernetes</code>上运行<code>Ray</code>应用面临诸多挑战，<code>KubeRay</code>主要解决以下问题：</p>
<table><thead><tr><th>问题领域<th>具体挑战<th>KubeRay解决方案<tbody><tr><td><strong>集群生命周期管理</strong><td>手动创建和维护<code>Ray</code>集群复杂且易出错<td>自动化集群创建、删除和更新流程<tr><td><strong>资源调度</strong><td><code>Ray</code>节点与<code>Kubernetes Pod</code>的资源协调困难<td>无缝集成<code>Kubernetes</code>资源调度系统<tr><td><strong>弹性伸缩</strong><td>根据工作负载动态调整集群规模困难<td>内置自动伸缩功能，支持节点动态增减<tr><td><strong>容错能力</strong><td>节点故障时手动恢复集群耗时费力<td>自动故障检测和恢复机制<tr><td><strong>任务管理</strong><td>提交和监控<code>Ray</code>任务需要额外工具<td>提供声明式<code>API</code>简化任务提交和管理<tr><td><strong>服务部署</strong><td>部署和维护<code>Ray Serve</code>服务复杂<td>支持零停机升级和高可用服务部署</table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=kuberay核心组件>KubeRay核心组件<a href=#kuberay核心组件 class=hash-link aria-label="Direct link to KubeRay核心组件" title="Direct link to KubeRay核心组件">​</a></h3>
<p><code>KubeRay</code>提供了三个核心自定义资源定义（<code>CRD</code>），每个都针对不同的使用场景：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=raycluster>RayCluster<a href=#raycluster class=hash-link aria-label="Direct link to RayCluster" title="Direct link to RayCluster">​</a></h4>
<p><strong>用途</strong>：管理长期运行的<code>Ray</code>集群。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>完整的生命周期管理</strong>：自动处理集群的创建、删除和更新</li>
<li><strong>自动伸缩</strong>：根据工作负载自动增加或减少工作节点</li>
<li><strong>容错保障</strong>：自动检测和恢复故障节点，确保集群稳定运行</li>
<li><strong>资源隔离</strong>：支持多租户场景，不同用户可以拥有独立的<code>Ray</code>集群</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Ray集群架构</div><div class=admonitionContent_BuS1><p>关于<code>Ray</code>集群中<code>Head Node</code>和<code>Worker Node</code>的详细职责和架构说明，请参考：<a href=/ai/ray-distributed-computing#ray%E9%9B%86%E7%BE%A4ray-cluster>Ray分布式计算引擎介绍 - Ray集群</a></div></div>
<p><strong>适用场景</strong>：</p>
<ul>
<li>需要长期运行的交互式开发环境</li>
<li>多个用户共享的<code>Ray</code>集群</li>
<li>需要频繁提交不同任务的场景</li>
</ul>
<p><strong>工作原理</strong>：</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=rayjob>RayJob<a href=#rayjob class=hash-link aria-label="Direct link to RayJob" title="Direct link to RayJob">​</a></h4>
<p><strong>用途</strong>：自动创建<code>Ray</code>集群并提交一次性批处理任务。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>自动化工作流</strong>：创建集群、提交任务、清理资源一气呵成</li>
<li><strong>任务隔离</strong>：每个任务可以拥有独立的集群配置</li>
<li><strong>资源优化</strong>：任务完成后可自动删除集群，节省资源</li>
<li><strong>状态跟踪</strong>：实时监控任务执行状态和结果</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>一次性的批处理任务（如数据处理、模型训练）</li>
<li><code>CI/CD</code>流程中的自动化测试</li>
<li>定期执行的批量推理任务</li>
</ul>
<p><strong>工作原理</strong>：</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=rayservice>RayService<a href=#rayservice class=hash-link aria-label="Direct link to RayService" title="Direct link to RayService">​</a></h4>
<p><strong>用途</strong>：部署和管理生产级的<code>Ray Serve</code>应用。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>零停机升级</strong>：更新服务时不中断现有请求</li>
<li><strong>高可用性</strong>：支持多副本部署和自动故障转移</li>
<li><strong>流量管理</strong>：智能路由和负载均衡</li>
<li><strong>版本控制</strong>：支持蓝绿部署和金丝雀发布</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>在线推理服务（如模型<code>API</code>）</li>
<li>实时数据处理服务</li>
<li>需要高可用性的生产环境</li>
</ul>
<p><strong>工作原理</strong>：</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=kuberay核心功能>KubeRay核心功能<a href=#kuberay核心功能 class=hash-link aria-label="Direct link to KubeRay核心功能" title="Direct link to KubeRay核心功能">​</a></h3>
<p>除了三大核心组件，<code>KubeRay</code>还提供以下重要功能：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=自动伸缩>自动伸缩<a href=#自动伸缩 class=hash-link aria-label="Direct link to 自动伸缩" title="Direct link to 自动伸缩">​</a></h4>
<p><code>KubeRay</code>支持基于资源利用率和任务需求的自动伸缩：</p>
<table><thead><tr><th>伸缩类型<th>触发条件<th>行为描述<tbody><tr><td><strong>扩容</strong><td>任务队列积压或资源不足<td>自动创建新的工作节点<code>Pod</code><tr><td><strong>缩容</strong><td>节点空闲超过阈值时间<td>优雅关闭空闲节点，释放资源<tr><td><strong>手动伸缩</strong><td>用户更新<code>replicas</code>配置<td>根据配置增加或减少节点数量</table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=容错与高可用>容错与高可用<a href=#容错与高可用 class=hash-link aria-label="Direct link to 容错与高可用" title="Direct link to 容错与高可用">​</a></h4>
<p><code>KubeRay</code>内置多层容错机制：</p>
<ul>
<li><strong>节点级容错</strong>：自动检测和重启失败的<code>Pod</code></li>
<li><strong>集群级容错</strong>：<code>Head</code>节点故障时自动恢复集群状态</li>
<li><strong>任务级容错</strong>：支持任务重试和断点续传</li>
<li><strong>数据持久化</strong>：可选的状态持久化到外部存储</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=与kubernetes生态集成>与Kubernetes生态集成<a href=#与kubernetes生态集成 class=hash-link aria-label="Direct link to 与Kubernetes生态集成" title="Direct link to 与Kubernetes生态集成">​</a></h4>
<p><code>KubeRay</code>深度集成<code>Kubernetes</code>生态系统：</p>
<ul>
<li><strong>监控</strong>：兼容<code>Prometheus</code>和<code>Grafana</code></li>
<li><strong>日志</strong>：集成标准<code>Kubernetes</code>日志系统</li>
<li><strong>调度</strong>：支持<code>Volcano</code>、<code>YuniKorn</code>、<code>Kueue</code>等调度器</li>
<li><strong>网络</strong>：兼容各类<code>Ingress Controller</code></li>
<li><strong>存储</strong>：支持<code>PersistentVolume</code>持久化存储</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=kuberay安装与配置>KubeRay安装与配置<a href=#kuberay安装与配置 class=hash-link aria-label="Direct link to KubeRay安装与配置" title="Direct link to KubeRay安装与配置">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=前置要求>前置要求<a href=#前置要求 class=hash-link aria-label="Direct link to 前置要求" title="Direct link to 前置要求">​</a></h3>
<p>在安装<code>KubeRay</code>之前，请确保满足以下条件：</p>
<table><thead><tr><th>组件<th>最低版本要求<th>说明<tbody><tr><td><strong>Kubernetes</strong><td><code>v1.23.0+</code><td>需要支持<code>CRD</code>和<code>Operator</code>特性<tr><td><strong>kubectl</strong><td><code>v1.23.0+</code><td>用于操作<code>Kubernetes</code>集群<tr><td><strong>Helm</strong><td><code>v3.0+</code><td>用于安装<code>KubeRay Operator</code><tr><td><strong>容器运行时</strong><td><code>Docker 19.03+</code> 或 <code>containerd</code><td>用于运行容器</table>
<p><strong>资源建议</strong>：</p>
<ul>
<li>开发环境：至少<code>2</code>核<code>CPU</code>，<code>4GB</code>内存</li>
<li>生产环境：根据工作负载规模调整，建议预留充足资源</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=通过helm安装kuberay-operator>通过Helm安装KubeRay Operator<a href=#通过helm安装kuberay-operator class=hash-link aria-label="Direct link to 通过Helm安装KubeRay Operator" title="Direct link to 通过Helm安装KubeRay Operator">​</a></h3>
<p><code>Helm</code>是安装<code>KubeRay</code>的推荐方式，步骤如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 添加 KubeRay Helm 仓库</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm repo </span><span class="token function" style=color:#e6db74>add</span><span class="token plain"> kuberay https://ray-project.github.io/kuberay-helm/</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 更新仓库信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm repo update</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 安装 KubeRay Operator（包含 CRD 和 Operator）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> kuberay-operator kuberay/kuberay-operator </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> kuberay-operator </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  --create-namespace </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token parameter variable" style=color:#f8f8f2>--version</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1.5</span><span class="token plain">.1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 验证安装，检查 Operator Pod 状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get pods </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> kuberay-operator</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 期望输出类似：</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># NAME                                READY   STATUS    RESTARTS   AGE</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># kuberay-operator-6fcbb94f64-mbfnr   1/1     Running   0          30s</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=验证安装>验证安装<a href=#验证安装 class=hash-link aria-label="Direct link to 验证安装" title="Direct link to 验证安装">​</a></h3>
<p>安装完成后，验证<code>KubeRay</code>是否正常工作：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 检查 Operator Pod 状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get pods </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> kuberay-operator</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 应该看到 kuberay-operator Pod 处于 Running 状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 检查 CRD 是否已安装</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get crd </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>grep</span><span class="token plain"> ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 期望输出：</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># rayclusters.ray.io</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># rayjobs.ray.io</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># rayservices.ray.io</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 查看 Operator 日志</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl logs </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> kuberay-operator </span><span class="token parameter variable" style=color:#f8f8f2>-l</span><span class="token plain"> app.kubernetes.io/name</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">kuberay-operator</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 应该看到类似 "Starting controller" 的日志</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=卸载kuberay>卸载KubeRay<a href=#卸载kuberay class=hash-link aria-label="Direct link to 卸载KubeRay" title="Direct link to 卸载KubeRay">​</a></h3>
<p>如需卸载<code>KubeRay</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 卸载 Operator</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm uninstall kuberay-operator </span><span class="token parameter variable" style=color:#f8f8f2>-n</span><span class="token plain"> kuberay-operator</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 卸载Helm安装包默认不会删除CRD，需要手动删除CRD（注意：这会删除所有相关资源）</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl delete crd rayclusters.ray.io</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl delete crd rayjobs.ray.io</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl delete crd rayservices.ray.io</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>注意</div><div class=admonitionContent_BuS1><p>删除<code>CRD</code>会同时删除所有基于该<code>CRD</code>创建的资源实例（如<code>RayCluster</code>、<code>RayJob</code>等），请谨慎操作。</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=kuberay使用示例>KubeRay使用示例<a href=#kuberay使用示例 class=hash-link aria-label="Direct link to KubeRay使用示例" title="Direct link to KubeRay使用示例">​</a></h2>
<blockquote>
<p><code>Ray</code>的官方镜像仓库为：<a href=https://hub.docker.com/r/rayproject/ray target=_blank rel="noopener noreferrer">https://hub.docker.com/r/rayproject/ray</a> ，为简化示例，这里使用精简版的<code>rayproject/ray:latest-py311-cpu</code>镜像。作者本机是<code>arm64</code>系统，请读者根据实际环境选择合适的镜像。</p>
</blockquote>
<p>这个示例展示如何使用<code>RayJob</code>自动创建集群、执行任务并清理资源。</p>
<blockquote>
<p>本示例来源于官网：<a href=https://docs.ray.io/en/latest/cluster/kubernetes/getting-started/rayjob-quick-start.html target=_blank rel="noopener noreferrer">https://docs.ray.io/en/latest/cluster/kubernetes/getting-started/rayjob-quick-start.html</a></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=准备python代码>准备Python代码<a href=#准备python代码 class=hash-link aria-label="Direct link to 准备Python代码" title="Direct link to 准备Python代码">​</a></h3>
<p>首先创建一个<code>ConfigMap</code>来存储要执行的<code>Python</code>代码：</p>
<blockquote>
<p>来源官网示例：<a href=https://raw.githubusercontent.com/ray-project/kuberay/v1.5.1/ray-operator/config/samples/ray-job.sample.yaml target=_blank rel="noopener noreferrer">https://raw.githubusercontent.com/ray-project/kuberay/v1.5.1/ray-operator/config/samples/ray-job.sample.yaml</a></p>
</blockquote>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_Ktv7>ray-job-code-sample.yaml</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>######################Ray code sample#################################</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># this sample is from https://docs.ray.io/en/latest/cluster/job-submission.html#quick-start-example</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># it is mounted into the container and executed to show the Ray job at work</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ConfigMap</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">code</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">sample_code.py</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    import ray</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    import os</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    import requests</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ray.init()</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    @ray.remote</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">class Counter</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">def __init__(self)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token comment" style=color:#8292a2;font-style:italic># Used to verify runtimeEnv</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            self.name = os.getenv("counter_name")</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            assert self.name == "test_counter"</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            self.counter = 0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">def inc(self)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            self.counter += 1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">def get_counter(self)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            return "</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> got </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain">".format(self.name</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> self.counter)</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    counter = Counter.remote()</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">for _ in range(5)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        ray.get(counter.inc.remote())</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        print(ray.get(counter.get_counter.remote()))</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># Verify that the correct runtime env was used for the job.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    assert requests.__version__ == "2.26.0"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>应用这个配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> ray-job-code-sample.yaml</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=创建rayjob>创建RayJob<a href=#创建rayjob class=hash-link aria-label="Direct link to 创建RayJob" title="Direct link to 创建RayJob">​</a></h3>
<p>创建<code>RayJob</code>资源定义：</p>
<blockquote>
<p>来源官网示例：<a href=https://raw.githubusercontent.com/ray-project/kuberay/v1.5.1/ray-operator/config/samples/ray-job.sample.yaml target=_blank rel="noopener noreferrer">https://raw.githubusercontent.com/ray-project/kuberay/v1.5.1/ray-operator/config/samples/ray-job.sample.yaml</a></p>
</blockquote>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_Ktv7>ray-job-sample.yaml</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ray.io/v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> RayJob</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> rayjob</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># submissionMode specifies how RayJob submits the Ray job to the RayCluster.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># The default value is "K8sJobMode", meaning RayJob will submit the Ray job via a submitter Kubernetes Job.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># The alternative value is "HTTPMode", indicating that KubeRay will submit the Ray job by sending an HTTP request to the RayCluster.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># submissionMode: "K8sJobMode"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">entrypoint</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> python /home/ray/samples/sample_code.py</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># shutdownAfterJobFinishes specifies whether the RayCluster should be deleted after the RayJob finishes. Default is false.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># shutdownAfterJobFinishes: false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ttlSecondsAfterFinished specifies the number of seconds after which the RayCluster will be deleted after the RayJob finishes.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># ttlSecondsAfterFinished: 10</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># activeDeadlineSeconds is the duration in seconds that the RayJob may be active before</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># KubeRay actively tries to terminate the RayJob; value must be positive integer.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># activeDeadlineSeconds: 120</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># RuntimeEnvYAML represents the runtime environment configuration provided as a multi-line YAML string.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># See https://docs.ray.io/en/latest/ray-core/handling-dependencies.html for details.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># (New in KubeRay version 1.0.)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">runtimeEnvYAML</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>|</span><span class="token scalar string" style=color:#a6e22e></span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    pip:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - requests==2.26.0</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      - pendulum==2.1.2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>    env_vars:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token scalar string" style=color:#a6e22e>      counter_name: "test_counter"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># Suspend specifies whether the RayJob controller should create a RayCluster instance.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># If a job is applied with the suspend field set to true, the RayCluster will not be created and we will wait for the transition to false.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># If the RayCluster is already created, it will be deleted. In the case of transition to false, a new RayCluster will be created.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># suspend: false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># rayClusterSpec specifies the RayCluster instance to be created by the RayJob controller.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">rayClusterSpec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">rayVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'2.46.0'</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># should match the Ray version in the image of the containers</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># Ray head pod template</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">headGroupSpec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># The `rayStartParams` are used to configure the `ray start` command.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># See https://github.com/ray-project/kuberay/blob/master/docs/guidance/rayStartParams.md for the default settings of `rayStartParams` in KubeRay.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># See https://docs.ray.io/en/latest/cluster/cli.html#ray-start for all available options in `rayStartParams`.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">rayStartParams</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic>#pod template</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">head</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> rayproject/ray</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">py311</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">ports</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>6379</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gcs</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>8265</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># Ray dashboard</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> dashboard</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10001</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> client</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"200m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> /home/ray/samples</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> code</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">volumes</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token comment" style=color:#8292a2;font-style:italic># You set volumes at the Pod level, then mount them into containers inside that Pod</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> code</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">configMap</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token comment" style=color:#8292a2;font-style:italic># Provide the name of the ConfigMap you want to mount.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">job</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">code</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token comment" style=color:#8292a2;font-style:italic># An array of keys from the ConfigMap to create as files</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">items</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> sample_code.py</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">path</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> sample_code.py</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token key atrule">workerGroupSpecs</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># the pod replicas in this group typed worker</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">minReplicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">maxReplicas</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># logical group name, for this called small-group, also can be functional</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">groupName</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> small</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">group</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># The `rayStartParams` are used to configure the `ray start` command.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># See https://github.com/ray-project/kuberay/blob/master/docs/guidance/rayStartParams.md for the default settings of `rayStartParams` in KubeRay.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic># See https://docs.ray.io/en/latest/cluster/cli.html#ray-start for all available options in `rayStartParams`.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">rayStartParams</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#8292a2;font-style:italic>#pod template</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> ray</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">worker </span><span class="token comment" style=color:#8292a2;font-style:italic># must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',  or '123-abc'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> rayproject/ray</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">latest</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">py311</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cpu</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              </span><span class="token key atrule">requests</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token key atrule">cpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"200m"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># SubmitterPodTemplate is the template for the pod that will run the `ray job submit` command against the RayCluster.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># If SubmitterPodTemplate is specified, the first container is assumed to be the submitter container.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># submitterPodTemplate:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#   spec:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#     restartPolicy: Never</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#     containers:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#     - name: my-custom-rayjob-submitter-pod</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#       image: rayproject/ray:latest-py311-cpu</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#       # If Command is not specified, the correct command will be supplied at runtime using the RayJob spec `entrypoint` field.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#       # Specifying Command is not recommended.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic>#       # command: ["sh", "-c", "ray job submit --address=http://$RAY_DASHBOARD_ADDRESS --submission-id=$RAY_JOB_SUBMISSION_ID -- echo hello world"]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>提交并监控任务：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 提交 RayJob</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl apply </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> ray-job-sample.yaml</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 查看 RayJob 状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get rayjob rayjob-sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 期望输出：</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># NAME            JOB STATUS   DEPLOYMENT STATUS   START TIME   END TIME   AGE</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># rayjob-sample   RUNNING      Running             1m                      1m</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 查看任务日志</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl logs </span><span class="token parameter variable" style=color:#f8f8f2>-l</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">job-name</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">rayjob-sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 任务完成后查看最终状态</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl get rayjob rayjob-sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 期望输出：</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># NAME            JOB STATUS   DEPLOYMENT STATUS   START TIME   END TIME   AGE</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># rayjob-sample   SUCCEEDED    Complete            5m           4m         5m</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=执行过程>执行过程<a href=#执行过程 class=hash-link aria-label="Direct link to 执行过程" title="Direct link to 执行过程">​</a></h3>
<p>在提交<code>RayJob</code>后，<code>KubeRay</code>会自动执行以下步骤：</p>
<ol>
<li><strong>创建RayCluster</strong>：根据<code>rayClusterSpec</code>定义，自动创建一个临时的<code>RayCluster</code>，包括<code>Head Node</code>和指定数量的<code>Worker Nodes</code>。</li>
<li><strong>加载代码</strong>：将<code>ConfigMap</code>中的<code>Python</code>代码挂载到<code>Head Node</code>的指定路径。</li>
<li><strong>执行任务</strong>：在<code>Head Node</code>上运行指定的<code>Python</code>代码，利用<code>Ray</code>的分布式计算能力执行任务。</li>
<li><strong>监控状态</strong>：实时跟踪任务的执行状态，并输出日志。</li>
<li><strong>清理资源</strong>：任务完成后，根据配置自动删除临时的<code>RayCluster</code>，释放资源。</li>
</ol>
<p>完整的<code>Pod</code>状态变化日志如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-head-b6mxp                 0/1     Pending             0          0s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-small-group-worker-lhsmj   0/1     Pending             0          0s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-head-b6mxp                 0/1     ContainerCreating   0          0s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-small-group-worker-lhsmj   0/1     Init:0/1            0          0s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-head-b6mxp                 0/1     Running             0          1s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-small-group-worker-lhsmj   0/1     Init:0/1            0          1s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-small-group-worker-lhsmj   0/1     PodInitializing     0          8s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-b5rs7-small-group-worker-lhsmj   0/1     Running             0          9s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-c9flz                            0/1     Pending             0          0s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-c9flz                            0/1     ContainerCreating   0          0s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-c9flz                            1/1     Running             0          1s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-c9flz                            0/1     Completed           0          21s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-8j6rw-head-wjkhr                 0/1     Terminating         0          6m11s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-8j6rw-small-group-worker-wwwdg   0/1     Terminating         0          7m51s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-ls588-head-48xsc                 0/1     Terminating         0          7m16s</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">rayjob-sample-ls588-small-group-worker-nqz9b   0/1     Terminating         0          12m</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=清理资源>清理资源<a href=#清理资源 class=hash-link aria-label="Direct link to 清理资源" title="Direct link to 清理资源">​</a></h3>
<p>完成实验后，有一部分资源需要手动清理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># RayJob 通常会自动清理，但如果需要手动删除：</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl delete rayjob rayjob-sample</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 删除 ConfigMap</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl delete configmap ray-job-code-sample</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href=https://github.com/ray-project/kuberay target=_blank rel="noopener noreferrer">KubeRay GitHub 仓库</a></li>
<li><a href=https://docs.ray.io/en/latest/cluster/kubernetes/index.html target=_blank rel="noopener noreferrer">KubeRay 官方文档</a></li>
<li><a href=https://docs.ray.io/ target=_blank rel="noopener noreferrer">Ray 官方文档</a></li>
<li><a href=https://kubernetes.io/docs/ target=_blank rel="noopener noreferrer">Kubernetes 官方文档</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/ray-distributed-computing><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Ray分布式计算引擎介绍</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/kuberay-rayjob-configuration><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>KubeRay RayJob配置详解</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#kuberay基本介绍 class="table-of-contents__link toc-highlight">KubeRay基本介绍</a><ul><li><a href=#什么是kuberay class="table-of-contents__link toc-highlight">什么是KubeRay</a><li><a href=#kuberay解决的核心问题 class="table-of-contents__link toc-highlight">KubeRay解决的核心问题</a><li><a href=#kuberay核心组件 class="table-of-contents__link toc-highlight">KubeRay核心组件</a><ul><li><a href=#raycluster class="table-of-contents__link toc-highlight">RayCluster</a><li><a href=#rayjob class="table-of-contents__link toc-highlight">RayJob</a><li><a href=#rayservice class="table-of-contents__link toc-highlight">RayService</a></ul><li><a href=#kuberay核心功能 class="table-of-contents__link toc-highlight">KubeRay核心功能</a><ul><li><a href=#自动伸缩 class="table-of-contents__link toc-highlight">自动伸缩</a><li><a href=#容错与高可用 class="table-of-contents__link toc-highlight">容错与高可用</a><li><a href=#与kubernetes生态集成 class="table-of-contents__link toc-highlight">与Kubernetes生态集成</a></ul></ul><li><a href=#kuberay安装与配置 class="table-of-contents__link toc-highlight">KubeRay安装与配置</a><ul><li><a href=#前置要求 class="table-of-contents__link toc-highlight">前置要求</a><li><a href=#通过helm安装kuberay-operator class="table-of-contents__link toc-highlight">通过Helm安装KubeRay Operator</a><li><a href=#验证安装 class="table-of-contents__link toc-highlight">验证安装</a><li><a href=#卸载kuberay class="table-of-contents__link toc-highlight">卸载KubeRay</a></ul><li><a href=#kuberay使用示例 class="table-of-contents__link toc-highlight">KubeRay使用示例</a><ul><li><a href=#准备python代码 class="table-of-contents__link toc-highlight">准备Python代码</a><li><a href=#创建rayjob class="table-of-contents__link toc-highlight">创建RayJob</a><li><a href=#执行过程 class="table-of-contents__link toc-highlight">执行过程</a><li><a href=#清理资源 class="table-of-contents__link toc-highlight">清理资源</a></ul><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>