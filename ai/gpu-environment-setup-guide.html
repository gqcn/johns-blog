<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/算力基础设施与调度技术/NVIDIA/GPU环境搭建指南：在裸机、Docker、K8S环境中使用GPU" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>GPU环境搭建指南：在裸机、Docker、K8S环境中使用GPU | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/gpu-environment-setup-guide><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="GPU环境搭建指南：在裸机、Docker、K8S环境中使用GPU | John's Blog"><meta data-rh=true name=description content="详细介绍如何在裸机、Docker和Kubernetes环境中配置和使用NVIDIA GPU，包括GPU驱动安装、CUDA Toolkit配置、nvidia-container-toolkit部署、K8S device-plugin安装以及GPU监控配置的完整指南"><meta data-rh=true property=og:description content="详细介绍如何在裸机、Docker和Kubernetes环境中配置和使用NVIDIA GPU，包括GPU驱动安装、CUDA Toolkit配置、nvidia-container-toolkit部署、K8S device-plugin安装以及GPU监控配置的完整指南"><meta data-rh=true name=keywords content="GPU环境搭建,NVIDIA GPU,GPU Driver,CUDA Toolkit,nvidia-container-toolkit,K8S GPU,device-plugin,Docker GPU,nvidia-smi,GPU监控,DCGM exporter,Tesla T4"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/gpu-environment-setup-guide><link data-rh=true rel=alternate href=https://johng.cn/ai/gpu-environment-setup-guide hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/gpu-environment-setup-guide hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.3503e6ad.css><script src=/assets/js/runtime~main.b9c89a65.js defer></script><script src=/assets/js/main.4830e2a2.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/database-and-middleware>数据库与中间件</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/llm-application-development>大模型应用与智能体开发</a><button aria-label="Expand sidebar category '大模型应用与智能体开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/infrastructure-scheduling>算力基础设施与调度技术</a><button aria-label="Collapse sidebar category '算力基础设施与调度技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/nvidia>NVIDIA</a><button aria-label="Collapse sidebar category 'NVIDIA'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/nfd-gfd>NFD&GFD</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-operator>GPU Operator</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-dcgm-exporter>GPU DCGM-Exporter监控方案</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-share-solutions>GPU Share 常见技术方案</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-share-mps-mig>GPU Share MPS&MIG具体操作与注意事项</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-mig-docker-specify-subcard>GPU MIG拆卡后使用docker指定子卡执行</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/ai/gpu-mig-pod-pending-terminating-troubleshooting>GPU MIG拆卡后Pod偶发Pending/Terminating状态阻塞问题排查</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/gpu-environment-setup-guide>GPU环境搭建指南：在裸机、Docker、K8S环境中使用GPU</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/rdma>RDMA</a><button aria-label="Expand sidebar category 'RDMA'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/vgpu>vGPU</a><button aria-label="Expand sidebar category 'vGPU'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/distributed-inference>分布式推理</a><button aria-label="Expand sidebar category '分布式推理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/scheduling>算力资源调度</a><button aria-label="Expand sidebar category '算力资源调度'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-acceleration-cards>常见智算加速卡汇总</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/general-ai-model-and-reasoning-ai-model-difference>通用大模型和推理大模型区别</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/common-ai-model-training-inference-framework>常见AI模型训练推理框架对比</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/ai-training-inference-scenarios>AI模型训练推理常见业务场景痛点</a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/infrastructure-scheduling><span itemprop=name>算力基础设施与调度技术</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/nvidia><span itemprop=name>NVIDIA</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>GPU环境搭建指南：在裸机、Docker、K8S环境中使用GPU</span><meta itemprop=position content=4></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><blockquote>
<p>本来打算编写一篇从<code>0</code>到<code>1</code>搭建<code>GPU</code>环境的教程，但是发现网上已经有很多优秀的教程了，本文参考的原文链接：<a href=https://www.lixueduan.com/posts/ai/01-how-to-use-gpu/ target=_blank rel="noopener noreferrer">https://www.lixueduan.com/posts/ai/01-how-to-use-gpu/</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-概述>1. 概述<a href=#1-概述 class=hash-link aria-label="Direct link to 1. 概述" title="Direct link to 1. 概述">​</a></h2>
<p>仅以比较常见的<code>NVIDIA GPU</code>举例，系统为<code>Ubuntu</code>，对于其他厂家的<code>GPU</code>设备理论上流程都是一样的。</p>
<hr>
<p>省流：</p>
<ul>
<li>
<p>对于裸机环境，只需要安装对应的<code>GPU Driver</code>以及<code>CUDA Toolkit</code>。</p>
</li>
<li>
<p>对应<code>Docker</code>环境，需要额外安装<code>nvidia-container-toolkit</code>并配置<code>docker</code>使用<code>nvidia runtime</code>。</p>
</li>
<li>
<p>对应<code>K8S</code>环境，需要额外安装对应的<code>device-plugin</code>使得<code>kubelet</code>能够感知到节点上的<code>GPU</code>设备，以便<code>K8S</code>能够进行<code>GPU</code>管理。</p>
</li>
</ul>
<p>注意：一般在<code>K8S</code>中使用都会直接使用<code>gpu-operator</code>方式进行安装，本文主要为了搞清各个组件的作用，因此进行手动安装。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-裸机环境>2. 裸机环境<a href=#2-裸机环境 class=hash-link aria-label="Direct link to 2. 裸机环境" title="Direct link to 2. 裸机环境">​</a></h2>
<p>裸机中要使用上<code>GPU</code>需要安装以下组件：</p>
<ul>
<li><code>GPU Driver</code></li>
<li><code>CUDA Toolkit</code></li>
</ul>
<p>二者的关系如<code>NVIDIA</code>官网上的这个图所示：</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-e4debffc2e6e36f7ef32a0c48df490c7.png width=500 height=390 class=img_ev3q></p>
<p><code>GPU Driver</code>包括了<code>GPU</code>驱动和<code>CUDA</code>驱动，<code>CUDA Toolkit</code>则包含了<code>CUDA Runtime</code>。</p>
<p><code>GPU</code>作为一个<code>PCIE</code>设备，只要安装好之后，在系统中就可以通过<code>lspci</code>命令查看到，先确认机器上是否有<code>GPU</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">root@test:~</span><span class="token comment" style=color:#8292a2;font-style:italic># lspci | grep NVIDIA</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">3b:00.0 3D controller: NVIDIA Corporation TU104GL </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">Tesla T4</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rev a1</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token number" style=color:#ae81ff>86</span><span class="token plain">:00.0 3D controller: NVIDIA Corporation TU104GL </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">Tesla T4</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">rev a1</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>可以看到，该设备有两张<code>Tesla T4 GPU</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安装驱动>安装驱动<a href=#安装驱动 class=hash-link aria-label="Direct link to 安装驱动" title="Direct link to 安装驱动">​</a></h3>
<blockquote>
<p>注意：在<code>Ubuntu</code>系统下，可以使用<code>apt</code>源来安装驱动（具体参考：<a href=https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes target=_blank rel="noopener noreferrer">https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes</a> ），也可以手动下载<code>run</code>文件来安装。本文以手动下载<code>run</code>文件来安装为例。</p>
</blockquote>
<p>首先到 <a href="https://www.nvidia.cn/Download/index.aspx?lang=cn#" target=_blank rel="noopener noreferrer">NVIDIA 驱动下载</a> 下载对应的显卡驱动：</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-1-9f2224e0d9b75b941e75f886cf318ac4.png width=1356 height=1478 class=img_ev3q></p>
<p>最终下载得到的是一个<code>.run</code>文件，例如 <code>NVIDIA-Linux-x86_64-550.54.14.run</code>。</p>
<p>然后直接<code>sh</code>方式运行该文件即可</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>sh</span><span class="token plain"> NVIDIA-Linux-x86_64-550.54.14.run</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>接下来会进入图形化界面，一路选择<code>yes/ok</code>就好。</p>
<p>运行以下命令检查是否安装成功：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>如果出现显卡信息则是安装成功，就像这样：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">root@test:~ nvidia-smi</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Wed Jul </span><span class="token number" style=color:#ae81ff>10</span><span class="token plain"> 05:41:52 </span><span class="token number" style=color:#ae81ff>2024</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+---------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> NVIDIA-SMI </span><span class="token number" style=color:#ae81ff>535.161</span><span class="token plain">.08             Driver Version: </span><span class="token number" style=color:#ae81ff>535.161</span><span class="token plain">.08   CUDA Version: </span><span class="token number" style=color:#ae81ff>12.2</span><span class="token plain">     </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">-----------------------------------------+----------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> GPU  Name                 Persistence-M </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> Bus-Id        Disp.A </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> Volatile Uncorr. ECC </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> Fan  Temp   Perf          Pwr:Usage/Cap </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">         Memory-Usage </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> GPU-Util  Compute M. </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                                         </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                      </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">               MIG M. </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>=</span><span class="token operator" style=color:#66d9ef>+=</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>=</span><span class="token operator" style=color:#66d9ef>+=</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>=</span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">   </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">  Tesla T4                       On  </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> 00000000:3B:00.0 Off </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                    </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> N/A   51C    P0              29W /  70W </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">  12233MiB / 15360MiB </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">      </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">%      Default </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                                         </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                      </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                  N/A </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------+----------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">   </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">  Tesla T4                       On  </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> 00000000:86:00.0 Off </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                    </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> N/A   49C    P0              30W /  70W </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">   6017MiB / 15360MiB </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">      </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">%      Default </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                                         </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                      </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">                  N/A </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+-----------------------------------------+----------------------+----------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+---------------------------------------------------------------------------------------+</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> Processes:                                                                            </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">  GPU   GI   CI        PID   Type   Process name                            GPU Memory </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">        ID   ID                                                             Usage      </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>=</span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain">   </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">+---------------------------------------------------------------------------------------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>至此，我们就安装好<code>GPU</code>驱动了，系统也能正常识别到<code>GPU</code>。</p>
<p>这里显示的<code>CUDA</code>版本表示当前驱动最大支持的<code>CUDA</code>版本。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安装-cuda-toolkit>安装 CUDA Toolkit<a href=#安装-cuda-toolkit class=hash-link aria-label="Direct link to 安装 CUDA Toolkit" title="Direct link to 安装 CUDA Toolkit">​</a></h3>
<blockquote>
<p>注意：在<code>Ubuntu</code>系统下，可以使用<code>apt</code>源来安装<code>CUDA Toolkit</code>（具体参考：<a href=https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes target=_blank rel="noopener noreferrer">https://documentation.ubuntu.com/server/how-to/graphics/install-nvidia-drivers/#installing-the-drivers-on-servers-and-or-for-computing-purposes</a> ），也可以手动下载<code>run</code>文件来安装。本文以手动下载<code>run</code>文件来安装为例。</p>
</blockquote>
<p>对于深度学习程序，一般都要依赖 <code>CUDA</code> 环境，因此需要在机器上安装 <code>CUDA Toolkit</code>。</p>
<p>也是到 <a href=https://developer.nvidia.com/cuda-toolkit-archive target=_blank rel="noopener noreferrer">NVIDIA CUDA Toolkit 下载</a> 下载对应的安装包，选择操作系统和安装方式即可</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-2-2813229c1e60ea8800ae79ac91b6c866.png width=2310 height=1472 class=img_ev3q></p>
<p>和安装驱动类似，也是一个<code>.run</code>文件。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 下载安装文件</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>wget</span><span class="token plain"> https://developer.download.nvidia.com/compute/cuda/12.2.0/local_installers/cuda_12.2.0_535.54.03_linux.run</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 开始安装</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>sh</span><span class="token plain"> cuda_12.2.0_535.54.03_linux.run</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>注意：之前安装过驱动了，这里就不再安装驱动，仅安装<code>CUDA Toolkit</code>相关组件。</p>
</blockquote>
<p>安装完成后输出如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">root@iZbp15lv2der847tlwkkd3Z:~</span><span class="token comment" style=color:#8292a2;font-style:italic># sudo sh cuda_12.2.0_535.54.03_linux.run</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> Summary </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>==</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Driver:   Installed</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Toolkit:  Installed </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> /usr/local/cuda-12.2/</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Please </span><span class="token function" style=color:#e6db74>make</span><span class="token plain"> sure that</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"> -   </span><span class="token environment constant" style=color:#e6db74>PATH</span><span class="token plain"> includes /usr/local/cuda-12.2/bin -   LD_LIBRARY_PATH includes /usr/local/cuda-12.2/lib64, or, </span><span class="token function" style=color:#e6db74>add</span><span class="token plain"> /usr/local/cuda-12.2/lib64 to /etc/ld.so.conf and run ldconfig as root</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">To uninstall the CUDA Toolkit, run cuda-uninstaller </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> /usr/local/cuda-12.2/bin</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">To uninstall the NVIDIA Driver, run nvidia-uninstall</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Logfile is /var/log/cuda-installer.log</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>根据提示配置下<code>PATH</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 添加 CUDA 12.2 到 PATH</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token builtin class-name" style=color:#e6db74>export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style=color:#e6db74>PATH</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">/usr/local/cuda-12.2/bin:</span><span class="token environment constant" style=color:#e6db74>$PATH</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 添加 CUDA 12.2 的 lib64 到 LD_LIBRARY_PATH</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token builtin class-name" style=color:#e6db74>export</span><span class="token plain"> </span><span class="token assign-left variable" style=color:#f8f8f2>LD_LIBRARY_PATH</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">/usr/local/cuda-12.2/lib64:</span><span class="token variable" style=color:#f8f8f2>$LD_LIBRARY_PATH</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行以下命令查看版本，确认安装成功：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">root@iZbp15lv2der847tlwkkd3Z:~</span><span class="token comment" style=color:#8292a2;font-style:italic># nvcc -V</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">nvcc: NVIDIA </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">R</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> Cuda compiler driver</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Copyright </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">c</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>2005</span><span class="token plain">-2023 NVIDIA Corporation</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Built on Tue_Jun_13_19:16:58_PDT_2023</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Cuda compilation tools, release </span><span class="token number" style=color:#ae81ff>12.2</span><span class="token plain">, V12.2.91</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Build cuda_12.2.r12.2/compiler.32965470_0</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=测试>测试<a href=#测试 class=hash-link aria-label="Direct link to 测试" title="Direct link to 测试">​</a></h3>
<p>我们使用一个简单的<code>Pytorch</code>程序来检测<code>GPU</code>和<code>CUDA</code>是否正常。</p>
<p>整个调用链大概是这样的：</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-3-b39b92caf317ad480f77b64e037b05c7.png width=1198 height=983 class=img_ev3q></p>
<p>使用下面代码来测试能够正常使用， <code>check_cuda_pytorch.py</code>内容如下：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>def</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>check_cuda_with_pytorch</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#a6e22e>"""检查 PyTorch CUDA 环境是否正常工作"""</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>try</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"检查 PyTorch CUDA 环境:"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">is_available</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"CUDA 设备可用，当前 CUDA 版本是: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">version</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">cuda</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"PyTorch 版本是: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">__version__</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"检测到 </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">cuda</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">device_count</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> 个 CUDA 设备。"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> i </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">cuda</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">device_count</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"设备 </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">cuda</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">get_device_name</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"设备 </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> 的显存总量: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">cuda</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">get_device_properties</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">total_memory </span><span class="token string-interpolation interpolation operator" style=color:#66d9ef>/</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation number" style=color:#ae81ff>1024</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style=color:#66d9ef>**</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style=color:#ae81ff>3</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> GB"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"设备 </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> 的显存当前使用量: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">cuda</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">memory_allocated</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style=color:#66d9ef>/</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation number" style=color:#ae81ff>1024</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style=color:#66d9ef>**</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style=color:#ae81ff>3</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> GB"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">                </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"设备 </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> 的显存最大使用量: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">torch</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">cuda</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>.</span><span class="token string-interpolation interpolation">memory_reserved</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style=color:#66d9ef>/</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation interpolation number" style=color:#ae81ff>1024</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style=color:#66d9ef>**</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style=color:#ae81ff>3</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>)</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e> GB"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>else</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"CUDA 设备不可用。"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>except</span><span class="token plain"> Exception </span><span class="token keyword" style=color:#66d9ef>as</span><span class="token plain"> e</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>print</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string-interpolation string" style=color:#a6e22e>f"检查 PyTorch CUDA 环境时出现错误: </span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style=color:#f8f8f2>}</span><span class="token string-interpolation string" style=color:#a6e22e>"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> __name__ </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"__main__"</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    check_cuda_with_pytorch</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>先安装下<code>torch</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">pip </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> torch</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>运行一下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">python3 check_cuda_pytorch.py</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>正常输出应该是这样的：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">检查 PyTorch CUDA 环境:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">CUDA 设备可用，当前 CUDA 版本是: 12.1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">PyTorch 版本是: 2.3.0+cu121</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">检测到 1 个 CUDA 设备。</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">设备 0: Tesla T4</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">设备 0 的显存总量: 14.75 GB</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">设备 0 的显存当前使用量: 0.00 GB</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">设备 0 的显存最大使用量: 0.00 GB</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-docker-环境>3. Docker 环境<a href=#3-docker-环境 class=hash-link aria-label="Direct link to 3. Docker 环境" title="Direct link to 3. Docker 环境">​</a></h2>
<p>上一步中我们已经在裸机上安装了<code>GPU Driver</code>、<code>CUDA Toolkit</code> 等工具，实现了在宿主机上使用<code>GPU</code>。</p>
<p>现在希望在<code>Docker</code>容器中使用<code>GPU</code>，需要怎么处理呢?</p>
<p>为了让<code>Docker</code>容器中也能使用<code>GPU</code>，大致步骤如下：</p>
<ul>
<li>1）安装 <code>nvidia-container-toolkit</code> 组件</li>
<li>2）<code>docker</code> 配置使用 <code>nvidia-runtime</code></li>
<li>3）启动容器时增加 <code>--gpu</code> 参数</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安装-nvidia-container-toolkit>安装 nvidia-container-toolkit<a href=#安装-nvidia-container-toolkit class=hash-link aria-label="Direct link to 安装 nvidia-container-toolkit" title="Direct link to 安装 nvidia-container-toolkit">​</a></h3>
<p><strong>NVIDIA Container Toolkit 的主要作用是将 NVIDIA</strong> <strong>GPU</strong> <strong>设备挂载到容器中。</strong></p>
<blockquote>
<p>兼容生态系统中的任意容器运行时，<code>docker</code>、<code>containerd</code>、<code>cri-o</code> 等。</p>
</blockquote>
<p>NVIDIA 官方安装文档：<a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html target=_blank rel="noopener noreferrer">nvidia-container-toolkit-install-guide</a></p>
<p>对于<code>Ubuntu</code>系统，安装命令如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># 1. Configure the production repository</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>curl</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-fsSL</span><span class="token plain"> https://nvidia.github.io/libnvidia-container/gpgkey </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> gpg </span><span class="token parameter variable" style=color:#f8f8f2>--dearmor</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-o</span><span class="token plain"> /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>curl</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-s</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-L</span><span class="token plain"> https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>sed</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g'</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>\</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>tee</span><span class="token plain"> /etc/apt/sources.list.d/nvidia-container-toolkit.list</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Optionally, configure the repository to use experimental packages </span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>sed</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-i</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-e</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'/experimental/ s/^#//g'</span><span class="token plain"> /etc/apt/sources.list.d/nvidia-container-toolkit.list</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 2. Update the packages list from the repository</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>apt-get</span><span class="token plain"> update</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 3. Install the NVIDIA Container Toolkit packages</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>apt-get</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-y</span><span class="token plain"> nvidia-container-toolkit</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=配置使用该-runtime>配置使用该 runtime<a href=#配置使用该-runtime class=hash-link aria-label="Direct link to 配置使用该 runtime" title="Direct link to 配置使用该 runtime">​</a></h3>
<p>支持<code>Docker</code>、<code>Containerd</code>、<code>CRI-O</code>、<code>Podman</code>等<code>CRI</code>。</p>
<blockquote>
<p>具体见官方文档 <a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#configuration target=_blank rel="noopener noreferrer">container-toolkit#install-guide</a></p>
</blockquote>
<p>这里以<code>Docker</code>为例进行配置：</p>
<p>旧版本需要手动在 <code>/etc/docker/daemon.json</code> 中增加配置，指定使用<code>nvidia</code>的 <code>runtime</code>。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token property" style=color:#f92672>"runtimes"</span><span class="token operator" style=color:#66d9ef>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token property" style=color:#f92672>"nvidia"</span><span class="token operator" style=color:#66d9ef>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token property" style=color:#f92672>"args"</span><span class="token operator" style=color:#66d9ef>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token property" style=color:#f92672>"path"</span><span class="token operator" style=color:#66d9ef>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"nvidia-container-runtime"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>新版<code>toolkit</code>带了一个<code>nvidia-ctk</code>工具，执行以下命令即可一键配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> nvidia-ctk runtime configure </span><span class="token parameter variable" style=color:#f8f8f2>--runtime</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">docker</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>然后重启<code>Docker</code>即可</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> systemctl restart </span><span class="token function" style=color:#e6db74>docker</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=测试-1>测试<a href=#测试-1 class=hash-link aria-label="Direct link to 测试" title="Direct link to 测试">​</a></h3>
<p>安装<code>nvidia-container-toolkit</code> 后，整个调用链如下：</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-4-036167c19bbeb408c3cb0c93abdda176.png width=569 height=369 class=img_ev3q></p>
<p>调用链从<code>containerd –> runC</code>变成<code>containerd –> nvidia-container-runtime –> runC</code>。</p>
<p>然后<code>nvidia-container-runtime</code> 在中间拦截了容器<code>spec</code>，就可以把<code>GPU</code>相关配置添加进去，再传给<code>runC</code>的<code>spec</code>里面就包含<code>GPU</code>信息了。</p>
<p><code>Docker</code>环境中的<code>CUDA</code>调用大概是这样的：</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-5-1c4558d2263a7ee0a3f5e09233d3c2a1.png width=522 height=369 class=img_ev3q></p>
<p>从图中可以看到，<code>CUDA Toolkit</code>跑到容器里了，因此宿主机上不需要再安装<code>CUDA Toolkit</code>。</p>
<blockquote>
<p>使用一个带<code>CUDA Toolkit</code>的镜像即可。</p>
</blockquote>
<p>最后我们启动一个<code>Docker</code>容器进行测试，其中命令中增加 <code>--gpu</code> 参数来指定要分配给容器的 <code>GPU</code>。</p>
<p><code>--gpu</code> 参数可选值：</p>
<ul>
<li><code>--gpus all</code>：表示将所有 GPU 都分配给该容器</li>
<li><code>--gpus "device=&lt;id>[,&lt;id>...]"</code>：对于多<code>GPU</code>场景，可以通过<code>id</code>指定分配给容器的<code>GPU</code>，例如<code>–gpu "device=0"</code> 表示只分配<code>0</code>号<code>GPU</code>给该容器</li>
<li><code>GPU</code>编号则是通过<code>nvidia-smi</code> 命令进行查看</li>
</ul>
<p>这里我们直接使用一个带<code>cuda</code>的镜像来测试，启动该容器并执行<code>nvidia-smi</code> 命令</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>docker</span><span class="token plain"> run </span><span class="token parameter variable" style=color:#f8f8f2>--rm</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>--gpus</span><span class="token plain"> all nvidia/cuda:12.0.1-runtime-ubuntu22.04 nvidia-smi</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>正常情况下应该是可以打印出容器中的<code>GPU</code>信息的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-k8s-环境>4. K8S 环境<a href=#4-k8s-环境 class=hash-link aria-label="Direct link to 4. K8S 环境" title="Direct link to 4. K8S 环境">​</a></h2>
<p>更进一步，在<code>K8S</code>环境中使用<code>GPU</code>，则需要在集群中部署以下组件：</p>
<ul>
<li><code>gpu-device-plugin</code> 用于管理<code>GPU</code>，<code>device-plugin</code> 以<code>DaemonSet</code>方式运行到集群各个节点，以感知节点上的<code>GPU</code>设备，从而让<code>K8S</code>能够对节点上的<code>GPU</code>设备进行管理。</li>
<li><code>gpu-exporter</code>：用于监控<code>GPU</code>。</li>
</ul>
<p>各组件关系如下图所示：</p>
<p><img decoding=async loading=lazy alt="alt text" src=/assets/images/image-6-7b35f60219f4194a195edaa171ef5172.png width=742 height=353 class=img_ev3q></p>
<ul>
<li>
<p>左图为手动安装的场景，只需要在集群中安装<code>device-plugin</code>和监控即可使用。</p>
</li>
<li>
<p>右图为使用<code>gpu-operotar</code>安装场景，本篇暂时忽略</p>
</li>
</ul>
<p>大致工作流程如下：</p>
<ul>
<li>每个节点的<code>kubelet</code>组件维护该节点的<code>GPU</code>设备状态（哪些已用，哪些未用）并定时报告给调度器，调度器知道每一个节点有多少张<code>GPU</code>卡可用。</li>
<li>调度器为<code>pod</code>选择节点时，从符合条件的节点中选择一个节点。</li>
<li>当<code>pod</code>调度到节点上后，<code>kubelet</code>组件为<code>pod</code>分配<code>GPU</code>设备 ID，并将这些 ID 作为参数传递给<code>NVIDIA Device Plugin</code>。</li>
<li><code>NVIDIA Device Plugin</code> 将分配给该<code>pod</code>的容器的<code>GPU</code>设备 ID 写入到容器的环境变量<code>NVIDIA_VISIBLE_DEVICES</code>中，然后将信息返回给<code>kubelet</code>。</li>
<li><code>kubelet</code> 启动容器。</li>
<li><code>NVIDIA Container Toolkit</code> 检测容器的<code>spec</code>中存在环境变量<code>NVIDIA_VISIBLE_DEVICES</code>，然后根据环境变量的值将<code>GPU</code>设备挂载到容器中。</li>
</ul>
<p>在 Docker 环境我们在启动容器时通过 <code>--gpu</code> 参数手动指定分配给容器的 GPU，K8S 环境则由 device-plugin 自行管理。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安装-device-plugin>安装 device-plugin<a href=#安装-device-plugin class=hash-link aria-label="Direct link to 安装 device-plugin" title="Direct link to 安装 device-plugin">​</a></h3>
<p><code>device-plugin</code>一般由对应的<code>GPU</code>厂家提供，比如<code>NVIDIA</code>的 <a href=https://github.com/NVIDIA/k8s-device-plugin target=_blank rel="noopener noreferrer">k8s-device-plugin</a></p>
<p>安装其实很简单，将对应的<code>yaml</code> <code>apply</code>到集群即可。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">kubectl create </span><span class="token parameter variable" style=color:#f8f8f2>-f</span><span class="token plain"> https://raw.githubusercontent.com/NVIDIA/K8S-device-plugin/v0.15.0/deployments/static/nvidia-device-plugin.yml</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>就像这样</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">root@test:~</span><span class="token comment" style=color:#8292a2;font-style:italic># kgo get po -l app=nvidia-device-plugin-daemonset</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">NAME                                   READY   STATUS    RESTARTS   AGE</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">nvidia-device-plugin-daemonset-7nkjw   </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain">/1     Running   </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">          10m</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>device-plugin</code>启动之后，会感知节点上的<code>GPU</code>设备并上报给<code>kubelet</code>，最终由<code>kubelet</code>提交到<code>kube-apiserver</code>。</p>
<p>因此我们可以在<code>Node</code>的可分配资源中看到<code>GPU</code>，就像这样：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">root@test:~</span><span class="token comment" style=color:#8292a2;font-style:italic># k describe node test|grep Capacity -A7</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Capacity:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  cpu:                </span><span class="token number" style=color:#ae81ff>48</span><span class="token plain">  ephemeral-storage:  460364840Ki  hugepages-1Gi:      </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">  hugepages-2Mi:      </span><span class="token number" style=color:#ae81ff>0</span><span class="token plain">  memory:             98260824Ki  nvidia.com/gpu:     </span><span class="token number" style=color:#ae81ff>2</span><span class="token plain">  pods:               </span><span class="token number" style=color:#ae81ff>110</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>可以看到，除了常见的<code>cpu</code>、<code>memory</code>之外，还有<code>nvidia.com/gpu</code>, 这个就是<code>GPU</code>资源，数量为<code>2</code>说明我们有两张<code>GPU</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=安装-gpu-监控>安装 GPU 监控<a href=#安装-gpu-监控 class=hash-link aria-label="Direct link to 安装 GPU 监控" title="Direct link to 安装 GPU 监控">​</a></h3>
<p>除此之外，如果你需要监控集群<code>GPU</code>资源使用情况，你可能还需要安装 <a href=https://github.com/NVIDIA/dcgm-exporter target=_blank rel="noopener noreferrer">DCCM exporter</a> 结合<code>Prometheus</code>输出<code>GPU</code>资源监控信息。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">helm repo </span><span class="token function" style=color:#e6db74>add</span><span class="token plain"> gpu-helm-charts https://nvidia.github.io/dcgm-exporter/helm-charts</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm repo update</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">helm </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> --generate-name gpu-helm-charts/dcgm-exporter</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>查看<code>metrics</code>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#e6db74>curl</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-sL</span><span class="token plain"> http://127.0.0.1:8080/metrics</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># HELP DCGM_FI_DEV_SM_CLOCK SM clock frequency (in MHz).# TYPE DCGM_FI_DEV_SM_CLOCK gauge# HELP DCGM_FI_DEV_MEM_CLOCK Memory clock frequency (in MHz).# TYPE DCGM_FI_DEV_MEM_CLOCK gauge# HELP DCGM_FI_DEV_MEMORY_TEMP Memory temperature (in C).# TYPE DCGM_FI_DEV_MEMORY_TEMP gauge</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>..</span><span class="token plain">.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">DCGM_FI_DEV_SM_CLOCK</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"0"</span><span class="token plain">, </span><span class="token assign-left variable" style=color:#f8f8f2>UUID</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"GPU-604ac76c-d9cf-fef3-62e9-d92044ab6e52"</span><span class="token plain">,container</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token plain">,namespace</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token plain">,pod</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>139</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">DCGM_FI_DEV_MEM_CLOCK</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"0"</span><span class="token plain">, </span><span class="token assign-left variable" style=color:#f8f8f2>UUID</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"GPU-604ac76c-d9cf-fef3-62e9-d92044ab6e52"</span><span class="token plain">,container</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token plain">,namespace</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token plain">,pod</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>405</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">DCGM_FI_DEV_MEMORY_TEMP</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">gpu</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"0"</span><span class="token plain">, </span><span class="token assign-left variable" style=color:#f8f8f2>UUID</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"GPU-604ac76c-d9cf-fef3-62e9-d92044ab6e52"</span><span class="token plain">,container</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token plain">,namespace</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token plain">,pod</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>""</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>9223372036854775794</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>..</span><span class="token plain">.</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=测试-2>测试<a href=#测试-2 class=hash-link aria-label="Direct link to 测试" title="Direct link to 测试">​</a></h3>
<p>在<code>K8S</code>创建<code>Pod</code>要使用<code>GPU</code>资源很简单，和<code>cpu</code>、<code>memory</code>等常规资源一样，在<code>resource</code>中申请即可。</p>
<p>比如，下面这个<code>yaml</code>里面我们就通过<code>resource.limits</code>申请了该<code>Pod</code>要使用<code>1</code>个<code>GPU</code>。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Never</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cuda</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nvcr.io/nvidia/k8s/cuda</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">vectoradd</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cuda10.2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># requesting 1 GPU</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这样<code>kueb-scheduler</code>在调度该<code>Pod</code>时就会考虑到这个情况，将其调度到有<code>GPU</code>资源的节点。</p>
<p>启动后，查看日志，正常应该会打印 测试通过的信息。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token key atrule">apiVersion</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> v1</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> gpu</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">pod</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> Never</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> cuda</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">container</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> nvcr.io/nvidia/k8s/cuda</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">sample</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">vectoradd</span><span class="token punctuation" style=color:#f8f8f2>-</span><span class="token plain">cuda10.2</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic># requesting 1 GPU</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>至此，在<code>K8S</code>环境中也可以使用<code>GPU</code>了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=5-小结>5. 小结<a href=#5-小结 class=hash-link aria-label="Direct link to 5. 小结" title="Direct link to 5. 小结">​</a></h2>
<p>本文主要分享了在裸机、<code>Docker</code>环境、<code>K8S</code>环境中如何使用<code>GPU</code>。</p>
<ul>
<li>
<p>对于裸机环境，只需要安装对应的<code>GPU Driver</code>即可。</p>
</li>
<li>
<p>对应<code>Docker</code>环境，需要额外安装 <code>nvidia-container-toolkit</code> 并配置<code>docker</code>使用<code>nvidia runtime</code>。</p>
</li>
<li>
<p>对应<code>K8S</code>环境，需要额外安装对应的 <code>device-plugin</code> 使得<code>kubelet</code>能够感知到节点上的<code>GPU</code>设备，以便<code>K8S</code>能够进行<code>GPU</code>管理。</p>
</li>
</ul>
<p>现在一般都是在<code>K8S</code>环境中使用，为了简化安装步骤，<code>NVIDIA</code>也提供了 <code>gpu-operator</code>来简化安装部署，本文的安装步骤仅供参考学习。</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/gpu-mig-pod-pending-terminating-troubleshooting><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>GPU MIG拆卡后Pod偶发Pending/Terminating状态阻塞问题排查</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/rdma><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>RDMA</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-概述 class="table-of-contents__link toc-highlight">1. 概述</a><li><a href=#2-裸机环境 class="table-of-contents__link toc-highlight">2. 裸机环境</a><ul><li><a href=#安装驱动 class="table-of-contents__link toc-highlight">安装驱动</a><li><a href=#安装-cuda-toolkit class="table-of-contents__link toc-highlight">安装 CUDA Toolkit</a><li><a href=#测试 class="table-of-contents__link toc-highlight">测试</a></ul><li><a href=#3-docker-环境 class="table-of-contents__link toc-highlight">3. Docker 环境</a><ul><li><a href=#安装-nvidia-container-toolkit class="table-of-contents__link toc-highlight">安装 nvidia-container-toolkit</a><li><a href=#配置使用该-runtime class="table-of-contents__link toc-highlight">配置使用该 runtime</a><li><a href=#测试-1 class="table-of-contents__link toc-highlight">测试</a></ul><li><a href=#4-k8s-环境 class="table-of-contents__link toc-highlight">4. K8S 环境</a><ul><li><a href=#安装-device-plugin class="table-of-contents__link toc-highlight">安装 device-plugin</a><li><a href=#安装-gpu-监控 class="table-of-contents__link toc-highlight">安装 GPU 监控</a><li><a href=#测试-2 class="table-of-contents__link toc-highlight">测试</a></ul><li><a href=#5-小结 class="table-of-contents__link toc-highlight">5. 小结</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 johng.cn</div></div></div></footer></div>