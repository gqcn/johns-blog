<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/AI技术/推理服务/在线推理与离线批量推理" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>在线推理与离线批量推理 | John's Blog</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johng.cn/ai/online-offline-batch-inference><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=author content="John Guo"><meta data-rh=true property=og:image content=https://johng.cn/img/favicon.png><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="在线推理与离线批量推理 | John's Blog"><meta data-rh=true name=description content=本文深入介绍AI模型推理业务场景中的离线批量推理技术。首先阐述在线推理的概念及其面临的资源利用率低、成本高等挑战，进而引出离线批量推理的定义与核心特点。文章详细分析了离线批量推理在内容审核、用户画像更新、数据标注、金融风控、医疗影像分析等7大应用场景，并从响应延迟、吞吐量、资源调度等14个维度系统对比在线推理与离线批量推理的区别。最后介绍实现离线批量推理的推理框架（如Triton、vLLM）、批处理编排工具（如Spark、Ray）及最佳实践，帮助读者全面理解并应用离线批量推理技术><meta data-rh=true property=og:description content=本文深入介绍AI模型推理业务场景中的离线批量推理技术。首先阐述在线推理的概念及其面临的资源利用率低、成本高等挑战，进而引出离线批量推理的定义与核心特点。文章详细分析了离线批量推理在内容审核、用户画像更新、数据标注、金融风控、医疗影像分析等7大应用场景，并从响应延迟、吞吐量、资源调度等14个维度系统对比在线推理与离线批量推理的区别。最后介绍实现离线批量推理的推理框架（如Triton、vLLM）、批处理编排工具（如Spark、Ray）及最佳实践，帮助读者全面理解并应用离线批量推理技术><meta data-rh=true name=keywords content="AI技术,离线批量推理,离线跑批,Batch Inference,在线推理,Online Inference,大模型推理,LLM推理,吞吐量优化,推理服务,模型训练,数据处理,批量处理,资源调度,成本优化,GPU利用率,内容审核,用户画像,分布式推理,TensorFlow Serving,Triton,vLLM"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://johng.cn/ai/online-offline-batch-inference><link data-rh=true rel=alternate href=https://johng.cn/ai/online-offline-batch-inference hreflang=en><link data-rh=true rel=alternate href=https://johng.cn/ai/online-offline-batch-inference hreflang=x-default><link data-rh=true rel=preconnect href=https://XGS1CPQERK-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="John's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="John's Blog Atom Feed"><link rel=search type=application/opensearchdescription+xml title="John's Blog" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?6b4ae23dc83ee5efe875b7172af6c7c1 async></script><link rel=stylesheet href=/assets/css/styles.2f56d3c4.css><script src=/assets/js/runtime~main.21dc4f31.js defer></script><script src=/assets/js/main.2361e6c6.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">John's Blog</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/ai>AI技术</a><a class="navbar__item navbar__link" href=/cloud-native>云原生</a><a class="navbar__item navbar__link" href=/notes>日常笔记</a><a class="navbar__item navbar__link" href=/programming>开发语言</a><a class="navbar__item navbar__link" href=/architecture>技术架构</a><a class="navbar__item navbar__link" href=/observability>可观测性</a><a class="navbar__item navbar__link" href=/life>生活笔记</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/aboutme>关于我</a><a class="navbar__item navbar__link" href=/blog>博客</a><a href=https://goframe.org/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-goframe-link"></a><a href=https://github.com/gqcn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/ai>AI技术</a><button aria-label="Collapse sidebar category 'AI技术'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/agents>智能体</a><button aria-label="Expand sidebar category '智能体'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/app>应用开发</a><button aria-label="Expand sidebar category '应用开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/ai/inference>推理服务</a><button aria-label="Collapse sidebar category '推理服务'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/ai/online-offline-batch-inference>在线推理与离线批量推理</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/pd-separation>PD(Prefill&Decode)分离</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/nvidia-dynamo>NVIDIA Dynamo: 分布式AI推理的高效引擎</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/ai/single-node-multi-gpu-nvlink-communication-issue>单机多卡部署，GPU之间无法使用NVLINK通信问题排查</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/training-fine-tuning>训练微调</a><button aria-label="Expand sidebar category '训练微调'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/model-development>模型开发</a><button aria-label="Expand sidebar category '模型开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/infra>基础架构</a><button aria-label="Expand sidebar category '基础架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/ai/basic>入门知识</a><button aria-label="Expand sidebar category '入门知识'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/cloud-native>云原生</a><button aria-label="Expand sidebar category '云原生'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/notes>日常笔记</a><button aria-label="Expand sidebar category '日常笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/programming>开发语言</a><button aria-label="Expand sidebar category '开发语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/architecture>技术架构</a><button aria-label="Expand sidebar category '技术架构'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/management>技术管理</a><button aria-label="Expand sidebar category '技术管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/observability>可观测性</a><button aria-label="Expand sidebar category '可观测性'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/database-and-middleware>数据库与中间件</a><button aria-label="Expand sidebar category '数据库与中间件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/operating-systems-and-networks>操作系统和网络</a><button aria-label="Expand sidebar category '操作系统和网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/life>生活笔记</a><button aria-label="Expand sidebar category '生活笔记'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai><span itemprop=name>AI技术</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/ai/inference><span itemprop=name>推理服务</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>在线推理与离线批量推理</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=什么是在线推理>什么是在线推理<a href=#什么是在线推理 class=hash-link aria-label="Direct link to 什么是在线推理" title="Direct link to 什么是在线推理">​</a></h2>
<p>在线推理（<code>Online Inference</code>）是指<code>AI</code>模型实时响应用户请求的推理模式。在这种模式下，系统需要在用户提交请求后尽快返回结果，通常要求响应延迟在毫秒到秒级范围内。</p>
<p>在线推理的典型特征包括：</p>
<ul>
<li><strong>实时性要求高</strong>：用户期待即时响应，系统需要快速处理单个或少量请求</li>
<li><strong>交互式场景</strong>：用户与系统进行实时交互，如聊天对话、实时翻译、语音识别等</li>
<li><strong>低延迟优先</strong>：优化目标是降低单个请求的响应时间（<code>Latency</code>）</li>
<li><strong>资源常驻</strong>：服务需要持续运行，保持模型加载在内存中以随时响应请求</li>
</ul>
<p>常见的在线推理应用场景包括：</p>
<ul>
<li>智能客服对话系统</li>
<li>实时语音转文字服务</li>
<li>在线图像识别和分类</li>
<li>实时推荐系统</li>
<li>大语言模型（<code>LLM</code>）对话服务</li>
</ul>
<p>然而，在线推理也面临一些挑战：</p>
<ol>
<li><strong>资源利用率不高</strong>：为了保证低延迟，系统通常需要预留大量计算资源，但在请求量较低时这些资源处于空闲状态</li>
<li><strong>资源维持成本高</strong>：需要维持<code>7x24</code>小时的服务，<code>GPU</code>等昂贵资源长期占用</li>
<li><strong>不适合批量处理</strong>：对于需要处理大规模数据集的场景（如每日用户画像更新、内容审核、数据标注等），在线推理模式效率低下</li>
<li><strong>无法充分利用批处理优化</strong>：在线推理为了低延迟，通常使用较小的<code>Batch Size</code>，无法发挥<code>GPU</code>等硬件的并行计算能力</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=什么是离线批量推理>什么是离线批量推理<a href=#什么是离线批量推理 class=hash-link aria-label="Direct link to 什么是离线批量推理" title="Direct link to 什么是离线批量推理">​</a></h2>
<p>为了解决在线推理在处理大规模数据时的效率和成本问题，<strong>离线批量推理</strong>（<code>Offline Batch Inference</code>，简称<strong>离线跑批</strong>）应运而生。</p>
<p>离线批量推理是指对大规模数据集进行非实时的批量处理和推理的模式。与在线推理不同，离线批量推理不要求实时响应，而是将大量数据打包成批次，通过充分利用硬件并行计算能力，以更高的吞吐量完成推理任务。</p>
<p>离线批量推理的核心特点：</p>
<ul>
<li><strong>批量处理</strong>：一次性处理成百上千甚至上百万条数据记录</li>
<li><strong>高吞吐量</strong>：优化目标是单位时间内处理更多数据，而非单个请求的响应速度</li>
<li><strong>弹性调度</strong>：可以根据业务需求灵活调度计算资源，任务完成后释放资源</li>
<li><strong>成本优化</strong>：通过批量处理和资源复用，大幅降低单条数据的推理成本</li>
<li><strong>非实时性</strong>：通常在业务低峰期执行，结果可以延迟几小时甚至几天返回</li>
</ul>
<p>离线批量推理解决的核心痛点：</p>
<ol>
<li><strong>降低推理成本</strong>：通过大批量处理，充分发挥<code>GPU</code>的并行计算能力，降低单条数据的处理成本</li>
<li><strong>提高资源利用率</strong>：任务执行时集中使用资源，完成后释放，避免资源长期空闲</li>
<li><strong>适合大规模数据处理</strong>：能够高效处理TB甚至PB级别的数据集</li>
<li><strong>灵活的时间窗口</strong>：不受实时性约束，可以在计算资源充裕或电价较低的时段执行</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=离线批量推理的应用场景>离线批量推理的应用场景<a href=#离线批量推理的应用场景 class=hash-link aria-label="Direct link to 离线批量推理的应用场景" title="Direct link to 离线批量推理的应用场景">​</a></h2>
<p>离线批量推理在诸多业务场景中发挥着重要作用：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=内容审核与过滤>内容审核与过滤<a href=#内容审核与过滤 class=hash-link aria-label="Direct link to 内容审核与过滤" title="Direct link to 内容审核与过滤">​</a></h3>
<p>对平台上每日新增的海量用户生成内容（图片、视频、文本）进行审核，检测违规、暴力、色情等不良内容。</p>
<ul>
<li><strong>数据规模</strong>：短视频平台每天可能新增数百万条视频</li>
<li><strong>处理方式</strong>：在业务低峰期集中处理当天或前一天的内容</li>
<li><strong>时效要求</strong>：通常要求24小时内完成审核即可</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=用户画像与推荐系统>用户画像与推荐系统<a href=#用户画像与推荐系统 class=hash-link aria-label="Direct link to 用户画像与推荐系统" title="Direct link to 用户画像与推荐系统">​</a></h3>
<p>定期更新用户兴趣标签、行为偏好、购买倾向等特征，为推荐系统提供数据支持。</p>
<ul>
<li><strong>数据规模</strong>：数亿用户的行为数据需要定期分析</li>
<li><strong>处理方式</strong>：每日或每周执行批量特征提取和更新</li>
<li><strong>时效要求</strong>：T+1日更新即可满足大多数推荐场景</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=数据标注与增强>数据标注与增强<a href=#数据标注与增强 class=hash-link aria-label="Direct link to 数据标注与增强" title="Direct link to 数据标注与增强">​</a></h3>
<p>使用预训练模型对大规模无标注数据进行自动标注，或对现有数据进行增强处理。</p>
<ul>
<li><strong>数据规模</strong>：训练数据集通常包含数百万到数亿条样本</li>
<li><strong>处理方式</strong>：批量生成标注结果，供后续人工审核或模型训练使用</li>
<li><strong>时效要求</strong>：作为离线训练流程的一部分，无实时性要求</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=金融风控与反欺诈>金融风控与反欺诈<a href=#金融风控与反欺诈 class=hash-link aria-label="Direct link to 金融风控与反欺诈" title="Direct link to 金融风控与反欺诈">​</a></h3>
<p>对历史交易数据进行批量风险评估，识别异常交易模式和潜在欺诈行为。</p>
<ul>
<li><strong>数据规模</strong>：每日数百万笔交易记录</li>
<li><strong>处理方式</strong>：夜间批量分析，生成风险报告</li>
<li><strong>时效要求</strong>：次日提供分析结果即可</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=医疗影像分析>医疗影像分析<a href=#医疗影像分析 class=hash-link aria-label="Direct link to 医疗影像分析" title="Direct link to 医疗影像分析">​</a></h3>
<p>对大规模医疗影像数据库进行批量分析，辅助疾病筛查和诊断。</p>
<ul>
<li><strong>数据规模</strong>：医院积累的数十万到数百万份影像资料</li>
<li><strong>处理方式</strong>：定期批量处理，生成初步诊断报告</li>
<li><strong>时效要求</strong>：非急诊场景，几天内完成即可</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=视频理解与摘要生成>视频理解与摘要生成<a href=#视频理解与摘要生成 class=hash-link aria-label="Direct link to 视频理解与摘要生成" title="Direct link to 视频理解与摘要生成">​</a></h3>
<p>对视频库中的内容进行批量分析，提取关键帧、生成标签、自动生成摘要等。</p>
<ul>
<li><strong>数据规模</strong>：视频平台的海量视频内容</li>
<li><strong>处理方式</strong>：新上传视频的批量处理，或对存量视频的重新分析</li>
<li><strong>时效要求</strong>：通常不要求实时处理</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=大语言模型批量生成任务>大语言模型批量生成任务<a href=#大语言模型批量生成任务 class=hash-link aria-label="Direct link to 大语言模型批量生成任务" title="Direct link to 大语言模型批量生成任务">​</a></h3>
<p>使用<code>LLM</code>对大规模文本数据进行批量处理，如翻译、摘要、问答对生成等。</p>
<ul>
<li><strong>数据规模</strong>：数百万条文本记录</li>
<li><strong>处理方式</strong>：充分利用模型的批处理能力，提高<code>GPU</code>利用率</li>
<li><strong>时效要求</strong>：作为数据处理流程的一环，无实时要求</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=在线推理与离线批量推理的区别>在线推理与离线批量推理的区别<a href=#在线推理与离线批量推理的区别 class=hash-link aria-label="Direct link to 在线推理与离线批量推理的区别" title="Direct link to 在线推理与离线批量推理的区别">​</a></h2>
<p>下表从多个维度对比了在线推理和离线批量推理的差异：</p>
<table><thead><tr><th><strong>维度</strong><th><strong>在线推理（Online Inference）</strong><th><strong>离线批量推理（Offline Batch Inference）</strong><tbody><tr><td><strong>响应延迟要求</strong><td>极低（毫秒到秒级），用户期待即时响应<td>无严格要求（小时到天级），结果可延迟返回<tr><td><strong>吞吐量优先级</strong><td>低，优先保证单个请求的低延迟<td>高，优化单位时间内处理的数据总量<tr><td><strong>数据处理方式</strong><td>单条或小批量实时处理<td>大批量集中处理（可达数百万条）<tr><td><strong>Batch Size</strong><td>小（通常1-32），受延迟限制<td>大（可达数百到数千），充分利用硬件并行能力<tr><td><strong>资源调度策略</strong><td>常驻服务，7x24小时运行<td>弹性调度，任务完成后释放资源<tr><td><strong>资源利用率</strong><td>较低，为保证低延迟预留资源<td>高，批量处理时<code>GPU</code>接近满载运行<tr><td><strong>成本模型</strong><td>按服务时长计费，成本较高<td>按任务量计费，单条数据成本低<tr><td><strong>典型应用</strong><td>聊天对话、实时翻译、在线客服、实时推荐<td>内容审核、用户画像更新、数据标注、定期报告生成<tr><td><strong>服务可用性</strong><td>高可用，需要监控和自动恢复<td>任务式，失败可重试<tr><td><strong>并发处理能力</strong><td>需要处理高并发请求<td>顺序或并行处理固定数据集<tr><td><strong>硬件优化方向</strong><td>低延迟优化（如快速内存访问、低通信延迟）<td>高吞吐优化（如大内存、高带宽、多卡并行）<tr><td><strong>监控指标</strong><td><code>P99/P95 Latency</code>、<code>QPS</code>、<code>TTFT</code>、<code>TPOT</code><td>吞吐量（<code>Throughput</code>）、总处理时间、成功率<tr><td><strong>扩展策略</strong><td>横向扩展副本数，负载均衡<td>增加批处理任务的并行度，分布式数据处理<tr><td><strong>典型执行时间</strong><td>持续在线服务<td>定时任务（如每日凌晨执行）或按需触发</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=如何实现离线批量推理>如何实现离线批量推理<a href=#如何实现离线批量推理 class=hash-link aria-label="Direct link to 如何实现离线批量推理" title="Direct link to 如何实现离线批量推理">​</a></h2>
<p>实现离线批量推理需要考虑数据处理、模型加载、批量推理执行和结果存储等环节。以下是常用的工具和框架：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=推理框架>推理框架<a href=#推理框架 class=hash-link aria-label="Direct link to 推理框架" title="Direct link to 推理框架">​</a></h3>
<table><thead><tr><th><strong>框架名称</strong><th><strong>特点与优势</strong><th><strong>适用场景</strong><tbody><tr><td><strong>TensorFlow Serving / TorchServe</strong><td>主流在线推理框架，支持批量推理模式，可设置较大的<code>batch_size</code>和<code>max_batch_delay</code>来优化吞吐量<td>适合已使用<code>TensorFlow</code>或<code>PyTorch</code>训练的模型，需要在线和离线推理混合部署的场景<tr><td><strong>NVIDIA Triton Inference Server</strong><td>支持多种后端（<code>TensorFlow</code>、<code>PyTorch</code>、<code>ONNX</code>、<code>TensorRT</code>等），支持动态批处理（<code>Dynamic Batching</code>），可充分利用<code>GPU</code>资源<td>企业级多模型服务场景，需要统一推理平台管理多种模型框架<tr><td><strong>vLLM</strong><td>专为大语言模型设计的高性能推理引擎，通过<code>PagedAttention</code>技术优化显存使用，支持大批量推理和高吞吐<td><code>LLM</code>批量推理场景，如文本生成、翻译、摘要等任务<tr><td><strong>TensorRT-LLM</strong><td><code>NVIDIA</code>针对<code>LLM</code>推理的优化框架，支持高吞吐量批量推理，提供多种量化和优化策略，可配合<code>Triton</code>使用<td>需要极致性能的<code>LLM</code>推理场景，特别是<code>NVIDIA GPU</code>环境<tr><td><strong>ONNX Runtime</strong><td>跨平台推理引擎，支持多种硬件加速器，提供批处理优化和量化支持<td>需要跨平台部署或使用多种硬件加速器的场景</table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=批处理编排工具>批处理编排工具<a href=#批处理编排工具 class=hash-link aria-label="Direct link to 批处理编排工具" title="Direct link to 批处理编排工具">​</a></h3>
<table><thead><tr><th><strong>工具/框架</strong><th><strong>核心能力</strong><th><strong>适用场景</strong><tbody><tr><td><strong>Apache Spark</strong><td>分布式数据处理框架，支持大规模数据集分片和并行处理，原生支持<code>Python</code>和<code>Scala</code><td>需要处理<code>PB</code>级数据集，已有<code>Hadoop</code>/<code>Spark</code>生态的企业，数据和推理任务紧密耦合的场景<tr><td><strong>Ray</strong><td>分布式计算框架，提供<code>Ray Serve</code>用于模型服务和<code>Ray Data</code>用于数据处理，支持动态资源调度<td>需要灵活资源调度的<code>Python</code>为主的<code>ML</code>工作流，支持在线和离线推理混合部署<tr><td><strong>Kubernetes + KubeFlow</strong><td>使用<code>Kubernetes</code>的<code>Job</code>/<code>CronJob</code>调度批量任务，<code>KubeFlow</code>提供<code>ML</code>工作流编排和<code>Pipeline</code>管理<td>云原生环境，需要标准化容器部署和完整<code>MLOps</code>流程的企业<tr><td><strong>Apache Airflow / Prefect</strong><td>工作流编排和调度工具，支持复杂<code>DAG</code>定义、任务依赖管理和失败重试<td>复杂数据处理和推理流程，需要精细化任务依赖管理和调度的场景<tr><td><strong>AWS Batch / Azure Batch / Google Cloud Batch</strong><td>云厂商提供的批处理服务，自动管理计算资源，按需扩缩容，与云生态深度集成<td>云上部署，希望减少运维复杂度，利用<code>Spot</code>实例降低成本的场景</table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=实现示例伪代码>实现示例（伪代码）<a href=#实现示例伪代码 class=hash-link aria-label="Direct link to 实现示例（伪代码）" title="Direct link to 实现示例（伪代码）">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> torch</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>from</span><span class="token plain"> transformers </span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> AutoModelForCausalLM</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> AutoTokenizer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 加载模型和tokenizer</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">model </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> AutoModelForCausalLM</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">from_pretrained</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"model_name"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">tokenizer </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> AutoTokenizer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">from_pretrained</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"model_name"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">to</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"cuda"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token builtin" style=color:#e6db74>eval</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 读取待处理的数据集</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">data </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> load_dataset_from_storage</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 从对象存储或数据库读取</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 批量推理配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">batch_size </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>256</span><span class="token plain">  </span><span class="token comment" style=color:#8292a2;font-style:italic># 根据GPU显存调整</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">results </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 分批处理数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>for</span><span class="token plain"> i </span><span class="token keyword" style=color:#66d9ef>in</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>range</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>len</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">data</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> batch_size</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    batch </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> data</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">i</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain">i </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> batch_size</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 数据预处理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    inputs </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">batch</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> padding</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> truncation</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> return_tensors</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>"pt"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    inputs </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> inputs</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">to</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"cuda"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 批量推理</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>with</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">no_grad</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        outputs </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> model</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">generate</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token operator" style=color:#66d9ef>**</span><span class="token plain">inputs</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> max_length</span><span class="token operator" style=color:#66d9ef>=</span><span class="token number" style=color:#ae81ff>512</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 结果解码</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    batch_results </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">batch_decode</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">outputs</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> skip_special_tokens</span><span class="token operator" style=color:#66d9ef>=</span><span class="token boolean" style=color:#ae81ff>True</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    results</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">extend</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">batch_results</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#8292a2;font-style:italic># 定期保存检查点</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> i </span><span class="token operator" style=color:#66d9ef>%</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>10000</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>==</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        save_checkpoint</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">results</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># 保存最终结果</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">save_results_to_storage</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">results</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=总结>总结<a href=#总结 class=hash-link aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>离线批量推理作为AI推理服务的重要组成部分，在处理大规模数据集时具有显著的成本和效率优势。通过合理选择推理框架、优化批处理配置、实施分布式并行等技术手段，可以在保证推理质量的前提下，大幅降低推理成本、提高资源利用率。</p>
<p>在实际业务中，在线推理和离线批量推理往往结合使用：在线推理满足实时交互需求，离线批量推理处理大规模定期任务，二者互补，共同构建高效的AI推理服务体系。</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/ai/inference><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>推理服务</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/ai/pd-separation><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>PD(Prefill&Decode)分离</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#什么是在线推理 class="table-of-contents__link toc-highlight">什么是在线推理</a><li><a href=#什么是离线批量推理 class="table-of-contents__link toc-highlight">什么是离线批量推理</a><li><a href=#离线批量推理的应用场景 class="table-of-contents__link toc-highlight">离线批量推理的应用场景</a><ul><li><a href=#内容审核与过滤 class="table-of-contents__link toc-highlight">内容审核与过滤</a><li><a href=#用户画像与推荐系统 class="table-of-contents__link toc-highlight">用户画像与推荐系统</a><li><a href=#数据标注与增强 class="table-of-contents__link toc-highlight">数据标注与增强</a><li><a href=#金融风控与反欺诈 class="table-of-contents__link toc-highlight">金融风控与反欺诈</a><li><a href=#医疗影像分析 class="table-of-contents__link toc-highlight">医疗影像分析</a><li><a href=#视频理解与摘要生成 class="table-of-contents__link toc-highlight">视频理解与摘要生成</a><li><a href=#大语言模型批量生成任务 class="table-of-contents__link toc-highlight">大语言模型批量生成任务</a></ul><li><a href=#在线推理与离线批量推理的区别 class="table-of-contents__link toc-highlight">在线推理与离线批量推理的区别</a><li><a href=#如何实现离线批量推理 class="table-of-contents__link toc-highlight">如何实现离线批量推理</a><ul><li><a href=#推理框架 class="table-of-contents__link toc-highlight">推理框架</a><li><a href=#批处理编排工具 class="table-of-contents__link toc-highlight">批处理编排工具</a><li><a href=#实现示例伪代码 class="table-of-contents__link toc-highlight">实现示例（伪代码）</a></ul><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2026 johng.cn</div></div></div></footer></div>